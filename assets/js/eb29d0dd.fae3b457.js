"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[92249],{5357(e,n,t){t.d(n,{A:()=>i});const i=t.p+"assets/images/ai-prompt-selector-en-91a8a8b25fa4798839b1d88150bb85b7.png"},13424(e,n,t){t.d(n,{A:()=>i});const i=t.p+"assets/images/ai-prompt-api-867ce005e059588819b7a7899a1f53b4.png"},28453(e,n,t){t.d(n,{R:()=>o,x:()=>a});var i=t(96540);const s={},r=i.createContext(s);function o(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(r.Provider,{value:n},e.children)}},64624(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"plugin-center/ai/ai-prompt","title":"AiPrompt Plugin","description":"aiPrompt plugin","source":"@site/versioned_docs/version-2.7.0.1/plugin-center/ai/ai-prompt.md","sourceDirName":"plugin-center/ai","slug":"/plugin-center/ai/ai-prompt","permalink":"/docs/2.7.0.1/plugin-center/ai/ai-prompt","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/shenyu-website/edit/main/versioned_docs/version-2.7.0.1/plugin-center/ai/ai-prompt.md","tags":[],"version":"2.7.0.1","frontMatter":{"title":"AiPrompt Plugin","keywords":["aiPrompt"],"description":"aiPrompt plugin"},"sidebar":"tutorialSidebar","previous":{"title":"Mock Plugin","permalink":"/docs/2.7.0.1/plugin-center/mock/mock-plugin"},"next":{"title":"AiProxy Plugin","permalink":"/docs/2.7.0.1/plugin-center/ai/ai-proxy"}}');var s=t(74848),r=t(28453);const o={title:"AiPrompt Plugin",keywords:["aiPrompt"],description:"aiPrompt plugin"},a=void 0,l={},c=[{value:"Explanation",id:"explanation",level:2},{value:"Plugin Configuration",id:"plugin-configuration",level:2},{value:"API Usage",id:"api-usage",level:2}];function p(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"explanation",children:"Explanation"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.strong,{children:"aiPrompt"})," plugin is used to dynamically inject preset prompt content (such as system-role messages or contextual information) into requests before forwarding them. When a request configured with aiPrompt reaches the gateway, the plugin first adds the specified prompt text to the request body (for example, inserting a ",(0,s.jsx)(n.strong,{children:"system"})," message at the beginning of the message list). This is useful for unified context control or preset roles\u2014for instance, automatically adding a \u201cYou are a translation assistant\u201d system prompt to every request. Used together with aiProxy, it\u2019s primarily for enhancing prompts."]}),"\n",(0,s.jsx)(n.h2,{id:"plugin-configuration",children:"Plugin Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["In the ShenYu admin interface, you first create a ",(0,s.jsx)(n.strong,{children:"Selector"})," and then a ",(0,s.jsx)(n.strong,{children:"Rule"}),". A Selector matches incoming requests (by path, headers, etc.), while a Rule configures plugin parameters or forwarding targets. For more on Selector and Rule setup, see ",(0,s.jsx)(n.a,{href:"../../user-guide/admin-usage/selector-and-rule",children:"Selector and Rule Management"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"When configuring aiPrompt, pay attention to:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Selector"}),": Defines which requests to match. For example, set ",(0,s.jsx)(n.code,{children:"Pattern"})," to ",(0,s.jsx)(n.code,{children:"/**"})," to match all requests, or specify a particular route."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Rule"}),": Specify plugin parameters at the rule level:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"prepend"}),": ",(0,s.jsx)(n.strong,{children:"Prepend prompt content."})," This text is inserted before the user\u2019s original messages as the first message sent to the LLM. Typically used to inject global system instructions or context, e.g., \u201cYou are a translation assistant; translate user input into English.\u201d"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"preRole"}),": ",(0,s.jsx)(n.strong,{children:"Role for the prepend prompt."})," Sets the ",(0,s.jsx)(n.code,{children:"role"})," field for the ",(0,s.jsx)(n.code,{children:"prepend"})," message (same options as the OpenAI Chat API)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"append"}),": ",(0,s.jsx)(n.strong,{children:"Append prompt content."})," Text added after the user\u2019s messages."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"postRole"}),": ",(0,s.jsx)(n.strong,{children:"Role for the append prompt."})," Sets the ",(0,s.jsx)(n.code,{children:"role"})," field for the ",(0,s.jsx)(n.code,{children:"append"})," message."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Below are example screenshots of aiPrompt plugin configuration in the admin UI:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(5357).A+"",width:"2573",height:"1051"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(96778).A+"",width:"2583",height:"1025"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," The aiPrompt plugin depends on aiProxy. In a typical request flow, apply ",(0,s.jsx)(n.strong,{children:"AiPrompt"})," first (if injecting prompts), then ",(0,s.jsx)(n.strong,{children:"AiTokenLimiter"})," for token counting/rate limiting (if needed), and finally ",(0,s.jsx)(n.strong,{children:"AiProxy"})," to forward the request to the LLM service. Ensure ",(0,s.jsx)(n.strong,{children:"AiTokenLimiter"}),"\u2019s ",(0,s.jsx)(n.strong,{children:"sort"})," value is ",(0,s.jsx)(n.strong,{children:"less than"})," ",(0,s.jsx)(n.strong,{children:"AiProxy"})," and ",(0,s.jsx)(n.strong,{children:"greater than"})," ",(0,s.jsx)(n.strong,{children:"AiPrompt"})," in the \u201cPlugin Management\u201d order."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"api-usage",children:"API Usage"}),"\n",(0,s.jsx)(n.p,{children:"After enabling the aiProxy plugin, you can send requests to the ShenYu gateway (e.g., via Postman) to obtain LLM responses through the proxy:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl --location --request POST \'http://localhost:9195/ai/proxy/v1/chat/completions\' \\\n  --header \'Content-Type: application/json\' \\\n  --data-raw \'{\n    "model": "gpt-4o-mini",\n    "messages": [\n      {\n        "role": "user",\n        "content": "I bloom amidst slaughter, like a flower at dawn."\n      }\n    ]\n  }\'\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(13424).A+"",width:"851",height:"1064"})})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},96778(e,n,t){t.d(n,{A:()=>i});const i=t.p+"assets/images/ai-prompt-rule-en-ad41c83349adf623db8ded5f479296c1.png"}}]);