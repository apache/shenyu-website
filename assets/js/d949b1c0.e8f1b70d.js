"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[38069],{7818:(e,t,n)=>{n.d(t,{A:()=>l});const l=n.p+"assets/images/logging-config-en-2d08ddb2fde45effd73f6de8dcf9677c.png"},15739:(e,t,n)=>{n.d(t,{A:()=>l});const l=n.p+"assets/images/shenyu-agent-logging-arch-9071c054a78f807fac785e44ff908ca4.png"},25401:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>r,default:()=>a,frontMatter:()=>i,metadata:()=>d,toc:()=>c});var l=n(74848),s=n(28453);const i={title:"Logging-RocketMQ Plugin",keywords:["Logging","RocketMQ"],description:"Logging-RocketMQ Plugin"},r=void 0,d={id:"plugin-center/observability/logging-rocketmq",title:"Logging-RocketMQ Plugin",description:"Logging-RocketMQ Plugin",source:"@site/versioned_docs/version-2.4.3/plugin-center/observability/logging-rocketmq.md",sourceDirName:"plugin-center/observability",slug:"/plugin-center/observability/logging-rocketmq",permalink:"/docs/2.4.3/plugin-center/observability/logging-rocketmq",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/shenyu-website/edit/main/versioned_docs/version-2.4.3/plugin-center/observability/logging-rocketmq.md",tags:[],version:"2.4.3",frontMatter:{title:"Logging-RocketMQ Plugin",keywords:["Logging","RocketMQ"],description:"Logging-RocketMQ Plugin"},sidebar:"tutorialSidebar",previous:{title:"Logging Plugin",permalink:"/docs/2.4.3/plugin-center/observability/logging-plugin"},next:{title:"Metrics Plugin",permalink:"/docs/2.4.3/plugin-center/observability/metrics-plugin"}},o={},c=[{value:"Description",id:"description",level:2},{value:"Technical Solutions",id:"technical-solutions",level:2},{value:"Plugin Usage",id:"plugin-usage",level:2},{value:"1.Add the <code>Logging-RocketMQ</code> dependency to the gateway&#39;s <code>pom.xml</code> file.",id:"1add-the-logging-rocketmq-dependency-to-the-gateways-pomxml-file",level:3},{value:"2.In <code>shenyu-admin</code> --&gt; Basic Configuration --&gt; Plugin Management --&gt; <code>loggingRocketMQ</code>, configure the rocketMQ parameter and set it to on.",id:"2in-shenyu-admin----basic-configuration----plugin-management----loggingrocketmq-configure-the-rocketmq-parameter-and-set-it-to-on",level:3},{value:"2.1Open the plugin and configure rocketmq, configure it as follows.",id:"21open-the-plugin-and-configure-rocketmq-configure-it-as-follows",level:4},{value:"2.2 Configuring Selectors and Rulers",id:"22-configuring-selectors-and-rulers",level:4},{value:"Logging information",id:"logging-information",level:2},{value:"Consumption and display of Logging",id:"consumption-and-display-of-logging",level:2},{value:"Panel Display",id:"panel-display",level:2}];function g(e){const t={a:"a",blockquote:"blockquote",br:"br",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t.h2,{id:"description",children:"Description"}),"\n",(0,l.jsxs)(t.blockquote,{children:["\n",(0,l.jsxs)(t.p,{children:[(0,l.jsx)(t.code,{children:"Apache ShenYu"})," The gateway receives requests from the client, forwards them to the server, and returns the server results to the client. The gateway can record the details of each request\uff0c",(0,l.jsx)(t.br,{}),"\n","The list includes: request time, request parameters, request path, response result, response status code, time consumption, upstream IP, exception information waiting.",(0,l.jsx)(t.br,{}),"\n","The Logging-RocketMQ plugin is a plugin that records access logs and sends them to the RocketMQ cluster."]}),"\n"]}),"\n",(0,l.jsx)(t.h2,{id:"technical-solutions",children:"Technical Solutions"}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsxs)(t.p,{children:["Architecture Diagram",(0,l.jsx)(t.br,{}),"\n",(0,l.jsx)(t.img,{src:n(15739).A+"",width:"1092",height:"588"})]}),"\n"]}),"\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsxs)(t.p,{children:["Full asynchronous collection and delivery of ",(0,l.jsx)(t.code,{children:"Logging"})," inside the ",(0,l.jsx)(t.code,{children:"Apache ShenYu"})," gateway"]}),"\n"]}),"\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsxs)(t.p,{children:["Logging platform by consuming the logs in the ",(0,l.jsx)(t.code,{children:"RocketMQ"})," cluster for repository, and then using ",(0,l.jsx)(t.code,{children:"Grafana"}),", ",(0,l.jsx)(t.code,{children:"Kibana"})," or other visualization platform to display"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(t.h2,{id:"plugin-usage",children:"Plugin Usage"}),"\n",(0,l.jsxs)(t.h3,{id:"1add-the-logging-rocketmq-dependency-to-the-gateways-pomxml-file",children:["1.Add the ",(0,l.jsx)(t.code,{children:"Logging-RocketMQ"})," dependency to the gateway's ",(0,l.jsx)(t.code,{children:"pom.xml"})," file."]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-xml",children:"        \x3c!--shenyu logging-rocketmq plugin start--\x3e\n        <dependency>\n          <groupId>org.apache.shenyu</groupId>\n          <artifactId>shenyu-spring-boot-starter-plugin-logging-rocketmq</artifactId>\n          <version>${project.version}</version>\n        </dependency>\n        \x3c!--shenyu logging-rocketmq plugin end--\x3e\n"})}),"\n",(0,l.jsxs)(t.h3,{id:"2in-shenyu-admin----basic-configuration----plugin-management----loggingrocketmq-configure-the-rocketmq-parameter-and-set-it-to-on",children:["2.In ",(0,l.jsx)(t.code,{children:"shenyu-admin"})," --\x3e Basic Configuration --\x3e Plugin Management --\x3e ",(0,l.jsx)(t.code,{children:"loggingRocketMQ"}),", configure the rocketMQ parameter and set it to on."]}),"\n",(0,l.jsx)(t.h4,{id:"21open-the-plugin-and-configure-rocketmq-configure-it-as-follows",children:"2.1Open the plugin and configure rocketmq, configure it as follows."}),"\n",(0,l.jsx)(t.p,{children:(0,l.jsx)(t.img,{src:n(7818).A+"",width:"2559",height:"1143"})}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsx)(t.li,{children:"The individual configuration items are described as follows:"}),"\n"]}),"\n",(0,l.jsxs)(t.table,{children:[(0,l.jsx)(t.thead,{children:(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.th,{style:{textAlign:"left"}}),(0,l.jsx)(t.th,{style:{textAlign:"left"}}),(0,l.jsx)(t.th,{style:{textAlign:"left"}}),(0,l.jsx)(t.th,{style:{textAlign:"left"}})]})}),(0,l.jsxs)(t.tbody,{children:[(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"config-item"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"type"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"description"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"remarks"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"topic"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Message Queue Topics"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"must"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"namesrvAddr"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Message queue nameserver address"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"must"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"producerGroup"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Log Message Producer Group"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"must"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"sampleRate"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Sampling rate, range 0~1, 0: off, 0.01: acquisition 1%, 1: acquisition 100%"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Optional, default 1, all collection"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"compressAlg"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Compression algorithm, no compression by default, currently supports LZ4 compression"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Optional, no compression by default"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"maxResponseBody"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Ingeter"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Maximum response size, above the threshold no response will be collected"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Optional, default 512KB"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"maxRequestBody"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Ingeter"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Maximum request body size, above the threshold no request body will be collected"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Optional, default 512KB"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Except for topic, namesrvAddr, producerGroup, all others are optional, in most cases only these 3 items need to be configured."}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]})]})]}),"\n",(0,l.jsx)(t.h4,{id:"22-configuring-selectors-and-rulers",children:"2.2 Configuring Selectors and Rulers"}),"\n",(0,l.jsxs)(t.p,{children:["For detailed configuration of selectors and rules, please refer to: ",(0,l.jsx)(t.a,{href:"../../user-guide/admin-usage/selector-and-rule",children:"Selector and rule management"}),"\u3002\nIn addition sometimes a large gateway cluster corresponds to multiple applications (business), different applications (business) corresponds to different topics, related to isolation,",(0,l.jsx)(t.br,{}),"\n","then you can configure different topics (optional) and sampling rate (optional) by selector, the meaning of the configuration items as shown in the table above.",(0,l.jsx)(t.br,{}),"\n","The operation is shown below:\n",(0,l.jsx)(t.img,{src:n(76343).A+"",width:"2553",height:"981"})]}),"\n",(0,l.jsx)(t.h2,{id:"logging-information",children:"Logging information"}),"\n",(0,l.jsx)(t.p,{children:"The fields of the captured access log are as follows."}),"\n",(0,l.jsxs)(t.table,{children:[(0,l.jsx)(t.thead,{children:(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"Field Name"}),(0,l.jsx)(t.th,{style:{textAlign:"center"},children:"Meaning"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"Description"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"Remarks"})]})}),(0,l.jsxs)(t.tbody,{children:[(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"clientIp"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"Client IP"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"timeLocal"}),(0,l.jsxs)(t.td,{style:{textAlign:"center"},children:["Request time string, format: yyyy-MM-dd HH:mm",":ss",".SSS"]}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"method"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"request method (different rpc type is not the same, http class for: get, post wait, rpc class for the interface name)"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"requestHeader"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"Request header (json format)"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"responseHeader"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"Response header (json format)"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"queryParams"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"Request query parameters"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"requestBody"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"Request Body (body of binary type will not be captured)"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"requestUri"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"Request uri"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"responseBody"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"Response body"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"responseContentLength"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"Response body size"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"rpcType"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"rpc type"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"status"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"response status"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"upstreamIp"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"Upstream (program providing the service) IP"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"upstreamResponseTime"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"Time taken by the upstream (program providing the service) to respond to the request (ms ms)"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"userAgent"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"Requested user agent"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"host"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"The requested host"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"module"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"Requested modules"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"path"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"The requested path"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"traceId"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"Requested Link Tracking ID"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Need to access link tracking plugins, such as skywalking,zipkin"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]})]})]}),"\n",(0,l.jsx)(t.h2,{id:"consumption-and-display-of-logging",children:"Consumption and display of Logging"}),"\n",(0,l.jsxs)(t.p,{children:["As each logging platform has differences, such as storage available clickhouse, ElasticSearch, etc., visualization has self-developed or open source Grafana, Kibana, etc..",(0,l.jsx)(t.br,{}),"\n","Logging-RocketMQ plugin uses RocketMQ to decouple production and consumption, while outputting logs in json format,\nconsumption and visualization require users to choose different technology stacks to achieve their own situation."]}),"\n",(0,l.jsx)(t.h2,{id:"panel-display",children:"Panel Display"}),"\n",(0,l.jsxs)(t.p,{children:["Users can choose to visualize the implementation according to their own situation.",(0,l.jsx)(t.br,{}),"\n","The following shows the effect of ",(0,l.jsx)(t.code,{children:"Grafana"}),":",(0,l.jsx)(t.br,{}),"\n",(0,l.jsx)(t.a,{href:"https://play.grafana.org",children:"Grafana Sandbox Experience"})]}),"\n",(0,l.jsx)(t.p,{children:(0,l.jsx)(t.img,{src:n(43573).A+"",width:"2560",height:"1355"})})]})}function a(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,l.jsx)(t,{...e,children:(0,l.jsx)(g,{...e})}):g(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>d});var l=n(96540);const s={},i=l.createContext(s);function r(e){const t=l.useContext(i);return l.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),l.createElement(i.Provider,{value:t},e.children)}},43573:(e,t,n)=>{n.d(t,{A:()=>l});const l=n.p+"assets/images/grafana-loki-gateway-381810a5db3b2c0640dbe3fc4b99f5f5.png"},76343:(e,t,n)=>{n.d(t,{A:()=>l});const l=n.p+"assets/images/logging-option-topic-en-98fcb4293da1c41228784a4ef4b4e22d.png"}}]);