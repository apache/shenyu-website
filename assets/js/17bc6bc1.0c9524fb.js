"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[50982],{28453(n,e,a){a.d(e,{R:()=>l,x:()=>i});var s=a(96540);const t={},o=s.createContext(t);function l(n){const e=s.useContext(o);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:l(n.components),s.createElement(o.Provider,{value:e},n.children)}},39201(n,e,a){a.r(e),a.d(e,{assets:()=>r,contentTitle:()=>i,default:()=>d,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"deployment/deployment-k8s","title":"K8s Deployment","description":"K8s Deployment","source":"@site/versioned_docs/version-2.4.2/deployment/deployment-k8s.md","sourceDirName":"deployment","slug":"/deployment/deployment-k8s","permalink":"/docs/2.4.2/deployment/deployment-k8s","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/shenyu-website/edit/main/versioned_docs/version-2.4.2/deployment/deployment-k8s.md","tags":[],"version":"2.4.2","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"K8s Deployment","keywords":["k8s"],"description":"K8s Deployment"},"sidebar":"tutorialSidebar","previous":{"title":"Docker Deployment","permalink":"/docs/2.4.2/deployment/deployment-docker"},"next":{"title":"Helm Deployment","permalink":"/docs/2.4.2/deployment/deployment-helm"}}');var t=a(74848),o=a(28453);const l={sidebar_position:4,title:"K8s Deployment",keywords:["k8s"],description:"K8s Deployment"},i=void 0,r={},c=[{value:"Example 1: Using h2 as a database",id:"example-1-using-h2-as-a-database",level:2},{value:"1. Create Namespace and ConfigMap",id:"1-create-namespace-and-configmap",level:3},{value:"2. Create shenyu-admin",id:"2-create-shenyu-admin",level:3},{value:"3. Create shenyu-bootstrap",id:"3-create-shenyu-bootstrap",level:3},{value:"Example 2: Use MySQL as the database",id:"example-2-use-mysql-as-the-database",level:2},{value:"1. Create Namespace and ConfigMap",id:"1-create-namespace-and-configmap-1",level:3},{value:"2. Create Endpoints to represent MySQL",id:"2-create-endpoints-to-represent-mysql",level:3},{value:"3. Create shenyu-admin",id:"3-create-shenyu-admin",level:3},{value:"4. Create shenyu-bootstrap",id:"4-create-shenyu-bootstrap",level:3},{value:"Test Access",id:"test-access",level:2}];function p(n){const e={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsxs)(e.p,{children:["Before you read this document, you need to complete some preparations before deploying Shenyu according to the ",(0,t.jsx)(e.a,{href:"./deployment-before.md",children:"Deployment Prerequisites document"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(e.p,{children:["This article introduces the use of ",(0,t.jsx)(e.code,{children:"K8s"})," to deploy the ",(0,t.jsx)(e.code,{children:"Apache ShenYu"})," gateway."]}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"Catalog"}),"\n",(0,t.jsx)(e.p,{children:"Example 1: Using h2 as a database"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsx)(e.li,{children:"create Namespace and ConfigMap"}),"\n",(0,t.jsx)(e.li,{children:"deploying shenyu-admin"}),"\n",(0,t.jsx)(e.li,{children:"deploy shenyu-bootstrap"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"Example 2: Use MySQL as the database"}),"\n",(0,t.jsx)(e.p,{children:"Similar to the h2 process, there are two points to note"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:["you need to load ",(0,t.jsx)(e.a,{href:"https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.18/mysql-connector-java-8.0.18.jar",children:"mysql-connector.jar"}),", the download command is executed when the container is started"]}),"\n",(0,t.jsx)(e.li,{children:"you need to specify an external MySQL database configuration to proxy the external MySQL database via Endpoints"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"The process is as follows."}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsx)(e.li,{children:"create Namespace and ConfigMap"}),"\n",(0,t.jsx)(e.li,{children:"create Endpoints to proxy external MySQL"}),"\n",(0,t.jsx)(e.li,{children:"deploy shenyu-admin"}),"\n",(0,t.jsx)(e.li,{children:"deploy shenyu-bootstrap"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"example-1-using-h2-as-a-database",children:"Example 1: Using h2 as a database"}),"\n",(0,t.jsx)(e.h3,{id:"1-create-namespace-and-configmap",children:"1. Create Namespace and ConfigMap"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"create shenyu-ns.yaml"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",children:'apiVersion: v1\nkind: Namespace\nmetadata:\n  name: shenyu\n  labels:\n    name: shenyu\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: shenyu-cm\n  namespace: shenyu\ndata:\n  shenyu-admin-application.yml: |\n    server:\n      port: 9095\n      address: 0.0.0.0\n    spring:\n      profiles:\n        active: h2\n      thymeleaf:\n        cache: true\n        encoding: utf-8\n        enabled: true\n        prefix: classpath:/static/\n        suffix: .html\n    mybatis:\n      config-location: classpath:/mybatis/mybatis-config.xml\n      mapper-locations: classpath:/mappers/*.xml\n    shenyu:\n      register:\n        registerType: http #http #zookeeper #etcd #nacos #consul\n        serverLists: #localhost:2181 #http://localhost:2379 #localhost:8848\n        props:\n          sessionTimeout: 5000\n          connectionTimeout: 2000\n          checked: true\n          zombieCheckTimes: 5\n          scheduledTime: 10\n          nacosNameSpace: ShenyuRegisterCenter\n      sync:\n        websocket:\n          enabled: true\n      aes:\n        secret:\n          key: 2095132720951327\n          iv: 6075877187097700\n      ldap:\n        enabled: false\n        url: ldap://xxxx:xxx\n        bind-dn: cn=xxx,dc=xxx,dc=xxx\n        password: xxxx\n        base-dn: ou=xxx,dc=xxx,dc=xxx\n        object-class: person\n        login-field: cn\n      jwt:\n        expired-seconds: 86400000\n      shiro:\n        white-list:\n          - /\n          - /favicon.*\n          - /static/**\n          - /index**\n          - /platform/login\n          - /websocket\n          - /error\n          - /actuator/health\n          - /swagger-ui.html\n          - /webjars/**\n          - /swagger-resources/**\n          - /v2/api-docs\n          - /csrf\n      swagger:\n        enable: true\n    logging:\n      level:\n        root: info\n        org.springframework.boot: info\n        org.apache.ibatis: info\n        org.apache.shenyu.bonuspoint: info\n        org.apache.shenyu.lottery: info\n        org.apache.shenyu: info\n  shenyu-admin-application-h2.yml: |\n    shenyu:\n      database:\n        dialect: h2\n        init_script: "sql-script/h2/schema.sql"\n        init_enable: true\n    spring:\n      datasource:\n        url: jdbc:h2:mem:~/shenyu;DB_CLOSE_DELAY=-1;MODE=MySQL;\n        username: sa\n        password: sa\n        driver-class-name: org.h2.Driver\n  shenyu-bootstrap-application.yml: |\n    server:\n      port: 9195\n      address: 0.0.0.0\n    spring:\n      main:\n        allow-bean-definition-overriding: true\n      application:\n        name: shenyu-bootstrap\n      cloud:\n        loadbalancer:\n          ribbon:\n            enabled: false\n        discovery:\n          enabled: false\n        nacos:\n          discovery:\n            server-addr: 127.0.0.1:8848 # Spring Cloud Alibaba Dubbo use this.\n            enabled: false\n    management:\n      health:\n        defaults:\n          enabled: false\n    shenyu:\n      netty:\n        tcp:\n          # set to false, user can custom the netty tcp server config.\n          webServerFactoryEnabled: true\n          selectCount: 1\n          workerCount: 4\n          serverSocketChannel:\n            soRcvBuf: 87380\n            soBackLog: 128\n            soReuseAddr: false\n            connectTimeoutMillis: 10000\n            writeBufferHighWaterMark: 65536\n            writeBufferLowWaterMark: 32768\n            writeSpinCount: 16\n            autoRead: true\n            allocType: "pooled"\n          socketChannel:\n            soKeepAlive: false\n            soReuseAddr: false\n            soLinger: -1\n            tcpNoDelay: true\n            soRcvBuf: 87380\n            soSndBuf: 16384\n            ipTos: 0\n            allowHalfClosure: false\n            connectTimeoutMillis: 10000\n            writeBufferHighWaterMark: 65536\n            writeBufferLowWaterMark: 32768\n            writeSpinCount: 16\n            autoRead: true\n            allocType: "pooled"\n      instance:\n        enabled: false\n        registerType: zookeeper #etcd #consul\n        serverLists: localhost:2181 #http://localhost:2379 #localhost:8848\n        props:\n      cross:\n        enabled: true\n        allowedHeaders:\n        allowedMethods: "*"\n        allowedOrigin: "*"\n        allowedExpose: "*"\n        maxAge: "18000"\n        allowCredentials: true\n      switchConfig:\n        local: true\n      file:\n        enabled: true\n        maxSize : 10\n      sync:\n        websocket:\n          urls: ws://shenyu-admin-svc.shenyu.svc.cluster.local:9095/websocket\n      exclude:\n        enabled: false\n        paths:\n          - /favicon.ico\n      fallback:\n        enabled: true\n      extPlugin:\n        path:\n        enabled: true\n        threads: 1\n        scheduleTime: 300\n        scheduleDelay: 30\n      scheduler:\n        enabled: false\n        type: fixed\n        threads: 16\n      upstreamCheck:\n        enabled: false\n        timeout: 3000\n        healthyThreshold: 1\n        unhealthyThreshold: 1\n        interval: 5000\n        printEnabled: true\n        printInterval: 60000\n    eureka:\n      client:\n        enabled: false\n        serviceUrl:\n          defaultZone: http://localhost:8761/eureka/\n      instance:\n        prefer-ip-address: true\n    logging:\n      level:\n        root: info\n        org.springframework.boot: info\n        org.apache.ibatis: info\n        org.apache.shenyu.bonuspoint: info\n        org.apache.shenyu.lottery: info\n        org.apache.shenyu: info\n'})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["execute ",(0,t.jsx)(e.code,{children:"kubectl apply -f shenyu-ns.yaml"})]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"2-create-shenyu-admin",children:"2. Create shenyu-admin"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"create shenyu-admin.yaml"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",children:"# Example of using the nodeport type to expose ports\napiVersion: v1\nkind: Service\nmetadata:\n  namespace: shenyu\n  name: shenyu-admin-svc\nspec:\n  selector:\n    app: shenyu-admin\n  type: NodePort\n  ports:\n  - protocol: TCP\n    port: 9095\n    targetPort: 9095\n    nodePort: 31095\n---\n# shenyu-admin\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  namespace: shenyu\n  name: shenyu-admin\nspec:\n  selector:\n    matchLabels:\n      app: shenyu-admin\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: shenyu-admin\n    spec:\n      volumes:\n      - name: shenyu-admin-application\n        configMap:\n          name: shenyu-cm\n          items:\n          - key: shenyu-admin-application.yml\n            path: shenyu-admin-application.yml\n      - name: shenyu-admin-application-h2\n        configMap:\n          name: shenyu-cm\n          items:\n          - key: shenyu-admin-application-h2.yml\n            path: shenyu-admin-application-h2.yml\n      containers:\n      - name: shenyu-admin\n        image: apache/shenyu-admin:2.4.2\n        imagePullPolicy: Always\n        ports:\n        - containerPort: 9095\n        env:\n        - name: 'TZ'\n          value: 'Asia/Beijing'\n        volumeMounts:\n        - name: shenyu-admin-application\n          mountPath: /opt/shenyu-admin/conf/application.yml\n          subPath: shenyu-admin-application.yml\n        - name: shenyu-admin-application-h2\n          mountPath: /opt/shenyu-admin/conf/application-h2.yml\n          subPath: shenyu-admin-application-h2.yml\n"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["execute",(0,t.jsx)(e.code,{children:"kubectl apply -f shenyu-admin.yaml"})]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"3-create-shenyu-bootstrap",children:"3. Create shenyu-bootstrap"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"create shenyu-bootstrap.yaml"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",children:"# Example of using the nodeport type to expose ports\napiVersion: v1\nkind: Service\nmetadata:\n  namespace: shenyu\n  name: shenyu-bootstrap-svc\nspec:\n  selector:\n    app: shenyu-bootstrap\n  type: NodePort\n  ports:\n  - protocol: TCP\n    port: 9195\n    targetPort: 9195\n    nodePort: 31195\n---\n# shenyu-bootstrap\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  namespace: shenyu\n  name: shenyu-bootstrap\nspec:\n  selector:\n    matchLabels:\n      app: shenyu-bootstrap\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: shenyu-bootstrap\n    spec:\n      volumes:\n      - name: shenyu-bootstrap-application\n        configMap:\n          name: shenyu-cm\n          items:\n          - key: shenyu-bootstrap-application.yml\n            path: shenyu-bootstrap-application.yml\n      containers:\n      - name: shenyu-bootstrap\n        image: apache/shenyu-bootstrap:2.4.2\n        ports:\n        - containerPort: 9195\n        env:\n        - name: TZ\n          value: Asia/Beijing\n        volumeMounts:\n        - name: shenyu-bootstrap-application\n          mountPath: /opt/shenyu-bootstrap/conf/application.yml\n          subPath: shenyu-bootstrap-application.yml\n"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["execute ",(0,t.jsx)(e.code,{children:"kubectl apply -f shenyu-bootstrap.yaml"})]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"example-2-use-mysql-as-the-database",children:"Example 2: Use MySQL as the database"}),"\n",(0,t.jsx)(e.h3,{id:"1-create-namespace-and-configmap-1",children:"1. Create Namespace and ConfigMap"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"create shenyu-ns.yaml"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",children:'apiVersion: v1\nkind: Namespace\nmetadata:\n  name: shenyu\n  labels:\n    name: shenyu\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: shenyu-cm\n  namespace: shenyu\ndata:\n  shenyu-admin-application.yml: |\n    server:\n      port: 9095\n      address: 0.0.0.0\n    spring:\n      profiles:\n        active: mysql\n      thymeleaf:\n        cache: true\n        encoding: utf-8\n        enabled: true\n        prefix: classpath:/static/\n        suffix: .html\n    mybatis:\n      config-location: classpath:/mybatis/mybatis-config.xml\n      mapper-locations: classpath:/mappers/*.xml\n    shenyu:\n      register:\n        registerType: http #http #zookeeper #etcd #nacos #consul\n        serverLists: #localhost:2181 #http://localhost:2379 #localhost:8848\n        props:\n          sessionTimeout: 5000\n          connectionTimeout: 2000\n          checked: true\n          zombieCheckTimes: 5\n          scheduledTime: 10\n          nacosNameSpace: ShenyuRegisterCenter\n      sync:\n        websocket:\n          enabled: true\n      aes:\n        secret:\n          key: 2095132720951327\n          iv: 6075877187097700\n      ldap:\n        enabled: false\n        url: ldap://xxxx:xxx\n        bind-dn: cn=xxx,dc=xxx,dc=xxx\n        password: xxxx\n        base-dn: ou=xxx,dc=xxx,dc=xxx\n        object-class: person\n        login-field: cn\n      jwt:\n        expired-seconds: 86400000\n      shiro:\n        white-list:\n          - /\n          - /favicon.*\n          - /static/**\n          - /index**\n          - /platform/login\n          - /websocket\n          - /error\n          - /actuator/health\n          - /swagger-ui.html\n          - /webjars/**\n          - /swagger-resources/**\n          - /v2/api-docs\n          - /csrf\n      swagger:\n        enable: true\n    logging:\n      level:\n        root: info\n        org.springframework.boot: info\n        org.apache.ibatis: info\n        org.apache.shenyu.bonuspoint: info\n        org.apache.shenyu.lottery: info\n        org.apache.shenyu: info\n  shenyu-admin-application-mysql.yml: |\n    shenyu:\n      database:\n        dialect: mysql\n        init_script: "sql-script/mysql/schema.sql"\n        init_enable: true\n    spring:\n      datasource:\n        url: jdbc:mysql://mysql.shenyu.svc.cluster.local:3306/shenyu?useUnicode=true&characterEncoding=utf-8&useSSL=false\n        username: {your_mysql_user}\n        password: {your_mysql_password}\n        driver-class-name: com.mysql.jdbc.Driver\n  shenyu-bootstrap-application.yml: |\n    server:\n      port: 9195\n      address: 0.0.0.0\n    spring:\n      main:\n        allow-bean-definition-overriding: true\n      application:\n        name: shenyu-bootstrap\n      cloud:\n        loadbalancer:\n          ribbon:\n            enabled: false\n        discovery:\n          enabled: false\n        nacos:\n          discovery:\n            server-addr: 127.0.0.1:8848 # Spring Cloud Alibaba Dubbo use this.\n            enabled: false\n    management:\n      health:\n        defaults:\n          enabled: false\n    shenyu:\n      netty:\n        tcp:\n          # set to false, user can custom the netty tcp server config.\n          webServerFactoryEnabled: true\n          selectCount: 1\n          workerCount: 4\n          serverSocketChannel:\n            soRcvBuf: 87380\n            soBackLog: 128\n            soReuseAddr: false\n            connectTimeoutMillis: 10000\n            writeBufferHighWaterMark: 65536\n            writeBufferLowWaterMark: 32768\n            writeSpinCount: 16\n            autoRead: true\n            allocType: "pooled"\n          socketChannel:\n            soKeepAlive: false\n            soReuseAddr: false\n            soLinger: -1\n            tcpNoDelay: true\n            soRcvBuf: 87380\n            soSndBuf: 16384\n            ipTos: 0\n            allowHalfClosure: false\n            connectTimeoutMillis: 10000\n            writeBufferHighWaterMark: 65536\n            writeBufferLowWaterMark: 32768\n            writeSpinCount: 16\n            autoRead: true\n            allocType: "pooled"\n      instance:\n        enabled: false\n        registerType: zookeeper #etcd #consul\n        serverLists: localhost:2181 #http://localhost:2379 #localhost:8848\n        props:\n      cross:\n        enabled: true\n        allowedHeaders:\n        allowedMethods: "*"\n        allowedOrigin: "*"\n        allowedExpose: "*"\n        maxAge: "18000"\n        allowCredentials: true\n      switchConfig:\n        local: true\n      file:\n        enabled: true\n        maxSize : 10\n      sync:\n        websocket:\n          urls: ws://shenyu-admin-svc.shenyu.svc.cluster.local:9095/websocket\n      exclude:\n        enabled: false\n        paths:\n          - /favicon.ico\n      fallback:\n        enabled: true\n      extPlugin:\n        path:\n        enabled: true\n        threads: 1\n        scheduleTime: 300\n        scheduleDelay: 30\n      scheduler:\n        enabled: false\n        type: fixed\n        threads: 16\n      upstreamCheck:\n        enabled: false\n        timeout: 3000\n        healthyThreshold: 1\n        unhealthyThreshold: 1\n        interval: 5000\n        printEnabled: true\n        printInterval: 60000\n    eureka:\n      client:\n        enabled: false\n        serviceUrl:\n          defaultZone: http://localhost:8761/eureka/\n      instance:\n        prefer-ip-address: true\n    logging:\n      level:\n        root: info\n        org.springframework.boot: info\n        org.apache.ibatis: info\n        org.apache.shenyu.bonuspoint: info\n        org.apache.shenyu.lottery: info\n        org.apache.shenyu: info\n'})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["execute ",(0,t.jsx)(e.code,{children:"kubectl apply -f shenyu-ns.yaml"})]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"2-create-endpoints-to-represent-mysql",children:"2. Create Endpoints to represent MySQL"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"create shenyu-ep.yaml"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",children:"kind: Service\napiVersion: v1\nmetadata:\n  name: mysql\n  namespace: shenyu\nspec:\n  ports:\n  - port: 3306\n    name: mysql\n    targetPort: {your_mysql_port}\n---\nkind: Endpoints\napiVersion: v1\nmetadata:\n  name: mysql\n  namespace: shenyu\nsubsets:\n- addresses:\n  - ip: {your_mysql_ip}\n  ports:\n  - port: {your_mysql_port}\n    name: mysql\n"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["execute ",(0,t.jsx)(e.code,{children:"kubectl apply -f shenyu-ep.yaml"})]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"3-create-shenyu-admin",children:"3. Create shenyu-admin"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"create shenyu-admin.yaml"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",children:"# Example of using the nodeport type to expose ports\napiVersion: v1\nkind: Service\nmetadata:\n  namespace: shenyu\n  name: shenyu-admin-svc\nspec:\n  selector:\n    app: shenyu-admin\n  type: NodePort\n  ports:\n  - protocol: TCP\n    port: 9095\n    targetPort: 9095\n    nodePort: 31095\n---\n# shenyu-admin\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  namespace: shenyu\n  name: shenyu-admin\nspec:\n  selector:\n    matchLabels:\n      app: shenyu-admin\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: shenyu-admin\n    spec:\n      volumes:\n      - name: shenyu-admin-application\n        configMap:\n          name: shenyu-cm\n          items:\n          - key: shenyu-admin-application.yml\n            path: shenyu-admin-application.yml\n      - name: shenyu-admin-application-mysql\n        configMap:\n          name: shenyu-cm\n          items:\n          - key: shenyu-admin-application-mysql.yml\n            path: shenyu-admin-application-mysql.yml\n      - name: mysql-connector-volume\n        emptyDir: {}\n      initContainers:\n      - name: download-mysql-jar\n        image: busybox:1.35.0\n        command: [ \"sh\",\"-c\"]\n        args: [\"wget https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.23/mysql-connector-java-8.0.23.jar;\n            wget https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.23/mysql-connector-java-8.0.23.jar.md5;\n            if [ $(md5sum mysql-connector-java-8.0.23.jar | cut -d ' ' -f1) = $(cat mysql-connector-java-8.0.23.jar.md5) ];\n            then echo success;\n            else echo failed;\n            exit 1;\n            fi;\n            mv /mysql-connector-java-8.0.23.jar /opt/shenyu-admin/ext-lib/mysql-connector-java.jar\" ]\n        volumeMounts:\n        - name: mysql-connector-volume\n          mountPath: /opt/shenyu-admin/ext-lib\n      containers:\n      - name: shenyu-admin\n        image: apache/shenyu-admin:2.4.2\n        imagePullPolicy: Always\n        ports:\n        - containerPort: 9095\n        env:\n        - name: 'TZ'\n          value: 'Asia/Beijing'\n        - name: SPRING_PROFILES_ACTIVE\n          value: mysql\n        volumeMounts:\n        - name: shenyu-admin-application\n          mountPath: /opt/shenyu-admin/conf/application.yml\n          subPath: shenyu-admin-application.yml\n        - name: shenyu-admin-application-mysql\n          mountPath: /opt/shenyu-admin/conf/application-mysql.yml\n          subPath: shenyu-admin-application-mysql.yml\n        - name: mysql-connector-volume\n          mountPath: /opt/shenyu-admin/ext-lib\n"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["execute",(0,t.jsx)(e.code,{children:"kubectl apply -f shenyu-admin.yaml"})]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"4-create-shenyu-bootstrap",children:"4. Create shenyu-bootstrap"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"create shenyu-bootstrap.yaml"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",children:"# Example of using the nodeport type to expose ports\napiVersion: v1\nkind: Service\nmetadata:\n  namespace: shenyu\n  name: shenyu-bootstrap-svc\nspec:\n  selector:\n    app: shenyu-bootstrap\n  type: NodePort\n  ports:\n  - protocol: TCP\n    port: 9195\n    targetPort: 9195\n    nodePort: 31195\n---\n# shenyu-bootstrap\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  namespace: shenyu\n  name: shenyu-bootstrap\nspec:\n  selector:\n    matchLabels:\n      app: shenyu-bootstrap\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: shenyu-bootstrap\n    spec:\n      volumes:\n      - name: shenyu-bootstrap-application\n        configMap:\n          name: shenyu-cm\n          items:\n          - key: shenyu-bootstrap-application.yml\n            path: shenyu-bootstrap-application.yml\n      containers:\n      - name: shenyu-bootstrap\n        image: apache/shenyu-bootstrap:2.4.2\n        ports:\n        - containerPort: 9195\n        env:\n        - name: TZ\n          value: Asia/Beijing\n        volumeMounts:\n        - name: shenyu-bootstrap-application\n          mountPath: /opt/shenyu-bootstrap/conf/application.yml\n          subPath: shenyu-bootstrap-application.yml\n"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["execute ",(0,t.jsx)(e.code,{children:"kubectl apply -f shenyu-bootstrap.yaml"})]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"test-access",children:"Test Access"}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Access Address"}),"\uff1ahttp://{K8S_CLUSTER_IP}:31095/"]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Account/password"}),"\uff1aadmin/123456"]})]})}function d(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(p,{...n})}):p(n)}}}]);