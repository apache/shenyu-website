"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[31725],{28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>l});var r=t(96540);const i={},s=r.createContext(i);function o(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(s.Provider,{value:n},e.children)}},86143:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>c});var r=t(74848),i=t(28453);const s={sidebar_position:1,title:"Filter Extension",keywords:["soul"],description:"filter extension"},o=void 0,l={id:"developer-guide/custom-filter",title:"Filter Extension",description:"filter extension",source:"@site/versioned_docs/version-2.3.0-Legacy/developer-guide/custom-filter.md",sourceDirName:"developer-guide",slug:"/developer-guide/custom-filter",permalink:"/docs/2.3.0-Legacy/developer-guide/custom-filter",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/shenyu-website/edit/main/versioned_docs/version-2.3.0-Legacy/developer-guide/custom-filter.md",tags:[],version:"2.3.0-Legacy",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"Filter Extension",keywords:["soul"],description:"filter extension"},sidebar:"tutorialSidebar",previous:{title:"Redirect Plugin",permalink:"/docs/2.3.0-Legacy/plugins/redirect-plugin"},next:{title:"Custom Plugin",permalink:"/docs/2.3.0-Legacy/developer-guide/custom-plugin"}},a={},c=[{value:"Description",id:"description",level:2},{value:"CORS Support",id:"cors-support",level:2},{value:"Filtering Spring Boot health check",id:"filtering-spring-boot-health-check",level:2},{value:"Extending <code>org.dromara.soul.web.filter.AbstractWebFilter</code>",id:"extending-orgdromarasoulwebfilterabstractwebfilter",level:2}];function d(e){const n={code:"code",h2:"h2",li:"li",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"description",children:"Description"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["This doc shows a demo for how to extend ",(0,r.jsx)(n.code,{children:"org.springframework.web.server.WebFliter"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"cors-support",children:"CORS Support"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"org.dromara.soul.bootstrap.cors.CrossFilter"})," is designed for WebFilter implementation."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'public class CrossFilter implements WebFilter {\n\n    private static final String ALLOWED_HEADERS = "x-requested-with, authorization, Content-Type, Authorization, credential, X-XSRF-TOKEN,token,username,client";\n\n    private static final String ALLOWED_METHODS = "*";\n\n    private static final String ALLOWED_ORIGIN = "*";\n\n    private static final String ALLOWED_EXPOSE = "*";\n\n    private static final String MAX_AGE = "18000";\n\n    @Override\n    @SuppressWarnings("all")\n    public Mono<Void> filter(final ServerWebExchange exchange, final WebFilterChain chain) {\n        ServerHttpRequest request = exchange.getRequest();\n        if (CorsUtils.isCorsRequest(request)) {\n            ServerHttpResponse response = exchange.getResponse();\n            HttpHeaders headers = response.getHeaders();\n            headers.add("Access-Control-Allow-Origin", ALLOWED_ORIGIN);\n            headers.add("Access-Control-Allow-Methods", ALLOWED_METHODS);\n            headers.add("Access-Control-Max-Age", MAX_AGE);\n            headers.add("Access-Control-Allow-Headers", ALLOWED_HEADERS);\n            headers.add("Access-Control-Expose-Headers", ALLOWED_EXPOSE);\n            headers.add("Access-Control-Allow-Credentials", "true");\n            if (request.getMethod() == HttpMethod.OPTIONS) {\n                response.setStatusCode(HttpStatus.OK);\n                return Mono.empty();\n            }\n        }\n        return chain.filter(exchange);\n    }\n}\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Registering CrossFilter as a Spring Bean and you are ready to go."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"filtering-spring-boot-health-check",children:"Filtering Spring Boot health check"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["You can control the order by applying ",(0,r.jsx)(n.code,{children:"@Order"})," to the implementation class ."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Component\n@Order(-99)\npublic final class HealthFilter implements WebFilter {\n\n    private static final String[] FILTER_TAG = {"/actuator/health", "/health_check"};\n\n    @Override\n    public Mono<Void> filter(@Nullable final ServerWebExchange exchange, @Nullable final WebFilterChain chain) {\n        ServerHttpRequest request = Objects.requireNonNull(exchange).getRequest();\n        String urlPath = request.getURI().getPath();\n        for (String check : FILTER_TAG) {\n            if (check.equals(urlPath)) {\n                String result = JsonUtils.toJson(new Health.Builder().up().build());\n                DataBuffer dataBuffer = exchange.getResponse().bufferFactory().wrap(result.getBytes());\n                return exchange.getResponse().writeWith(Mono.just(dataBuffer));\n            }\n        }\n        return Objects.requireNonNull(chain).filter(exchange);\n    }\n}\n\n'})}),"\n",(0,r.jsxs)(n.h2,{id:"extending-orgdromarasoulwebfilterabstractwebfilter",children:["Extending ",(0,r.jsx)(n.code,{children:"org.dromara.soul.web.filter.AbstractWebFilter"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Add a new class and inherit from ",(0,r.jsx)(n.code,{children:"org.dromara.soul.web.filter.AbstractWebFilter"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Implement abstract methods of parent class."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"   /**\n     * this is Template Method ,children Implement your own filtering logic.\n     *\n     * @param exchange the current server exchange\n     * @param chain    provides a way to delegate to the next filter\n     * @return {@code Mono<Boolean>} result\uff1aTRUE (is pass)\uff0cand flow next filter\uff1bFALSE (is not pass) execute doDenyResponse(ServerWebExchange exchange)\n     */\n    protected abstract Mono<Boolean> doFilter(ServerWebExchange exchange, WebFilterChain chain);\n\n    /**\n     * this is Template Method ,children Implement your own And response client.\n     *\n     * @param exchange the current server exchange.\n     * @return {@code Mono<Void>} response msg.\n     */\n    protected abstract Mono<Void> doDenyResponse(ServerWebExchange exchange);\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["if method ",(0,r.jsx)(n.code,{children:"doFilter"})," returns Mono ",(0,r.jsx)(n.code,{children:"true"}),", this filter is passing, but not vice versa. While rejecting, it will call method ",(0,r.jsx)(n.code,{children:"doDenyResponse"})," and sending infos in response body to frontend."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);