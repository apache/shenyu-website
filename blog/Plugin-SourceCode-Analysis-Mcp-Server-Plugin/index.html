<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache ShenYu Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache ShenYu Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Apache ShenYu" href="/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/news/rss.xml" title="Apache ShenYu Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/news/atom.xml" title="Apache ShenYu Blog Atom Feed"><title data-react-helmet="true">McpServer Plugin Source Code Analysis | Apache ShenYu</title><meta data-react-helmet="true" property="og:title" content="McpServer Plugin Source Code Analysis | Apache ShenYu"><meta data-react-helmet="true" name="description" content="In the Shenyu gateway, when you start this plugin, Shenyu becomes a fully-featured McpServer."><meta data-react-helmet="true" property="og:description" content="In the Shenyu gateway, when you start this plugin, Shenyu becomes a fully-featured McpServer."><meta data-react-helmet="true" property="og:url" content="https://shenyu.apache.org//blog/Plugin-SourceCode-Analysis-Mcp-Server-Plugin"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.svg"><link data-react-helmet="true" rel="canonical" href="https://shenyu.apache.org//blog/Plugin-SourceCode-Analysis-Mcp-Server-Plugin"><link data-react-helmet="true" rel="alternate" href="https://shenyu.apache.org//blog/Plugin-SourceCode-Analysis-Mcp-Server-Plugin" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://shenyu.apache.org//zh/blog/Plugin-SourceCode-Analysis-Mcp-Server-Plugin" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://shenyu.apache.org//blog/Plugin-SourceCode-Analysis-Mcp-Server-Plugin" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.cc2d0c98.css">
<link rel="preload" href="/assets/js/runtime~main.69138608.js" as="script">
<link rel="preload" href="/assets/js/main.c501959f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Apache ShenYu Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/logo-light.svg" alt="Apache ShenYu Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/download">Download</a><a class="navbar__item navbar__link" href="/document">Docs</a><a class="navbar__item navbar__link" href="/community/contributor-guide">Community</a><a class="navbar__item navbar__link" href="/team">Team</a><a class="navbar__item navbar__link" href="/event">Event</a><a class="navbar__item navbar__link" href="/news">News</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/users">Users</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Foundation</a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License</a></li><li><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events</a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li><li><a href="https://www.apache.org/foundation/policies/privacy.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks</a></li></ul></div><a href="https://github.com/apache/shenyu" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg t="1631348384596" class="icon" viewBox="0 0 1024 1024" version="1.1" style="vertical-align:text-bottom;margin-right:5px" p-id="557" width="20" height="20"><path d="M547.797333 638.208l-104.405333-103.168 1.237333-1.28a720.170667 720.170667 0 0 0 152.490667-268.373333h120.448V183.082667h-287.744V100.906667H347.605333v82.218666H59.818667V265.386667h459.178666a648.234667 648.234667 0 0 1-130.304 219.946666 643.242667 643.242667 0 0 1-94.976-137.728H211.541333a722.048 722.048 0 0 0 122.453334 187.434667l-209.194667 206.378667 58.368 58.368 205.525333-205.525334 127.872 127.829334 31.232-83.84m231.424-208.426667h-82.218666l-184.96 493.312h82.218666l46.037334-123.306667h195.242666l46.464 123.306667h82.218667l-185.002667-493.312m-107.690666 287.744l66.56-178.005333 66.602666 178.005333z" fill="currentColor" p-id="558"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/blog/Plugin-SourceCode-Analysis-Mcp-Server-Plugin" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li><a href="/zh/blog/Plugin-SourceCode-Analysis-Mcp-Server-Plugin" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">ç®€ä½“ä¸­æ–‡</a></li></ul></div><div class="react-toggle toggle_2i4l react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_Bc3W"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><main class="col col--9 col--offset-1"><article><header><h1 class="blogPostTitle_d4p0">McpServer Plugin Source Code Analysis</h1><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2025-10-22T15:10:50.199Z">October 22, 2025</time> Â· 11 min read</div><div class="avatar margin-vert--md"><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/478320" target="_blank" rel="noopener noreferrer">yusiheng</a></div><small class="avatar__subtitle">Apache ShenYu Contributor</small></div></div></header><div class="markdown"><p>In the Shenyu gateway, when you start this plugin, Shenyu becomes a fully-featured McpServer.<br>
You can easily register a service as a tool within the Shenyu gateway by simple configuration and use the extended functions the gateway offers.</p><blockquote><p>This article is based on version <code>shenyu-2.7.0.2</code>. Here, I will track the Shenyu Mcp plugin chain and analyze the source code of its SSE communication.</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h3><blockquote><p>The Shenyu gateway&#x27;s Mcp plugin is built on top of the spring-ai-mcp extension. To better understand how the Mcp plugin works, Iâ€™ll briefly introduce how some official Mcp Java classes collaborate within its JDK.</p></blockquote><p>I want to start by introducing three key official Mcp Java classes:</p><blockquote><ol><li><strong>McpServer</strong><br>This class manages resources like tools, Resource, promote, etc.</li><li><strong>TransportProvider</strong><br>Provides corresponding communication methods based on client-server communication protocols.</li><li><strong>Session</strong><br>Handles request data, response data, and notifications, offers some basic methods and corresponding handlers, and executes tool queries and calls here.</li></ol></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="1-service-registration"></a>1. Service Registration<a class="hash-link" href="#1-service-registration" title="Direct link to heading">#</a></h3><p>In Shenyu Admin, after filling in endpoint and tool information for the McpServer plugin, this info is automatically registered into Shenyu bootstrap.<br>
You can refer to the official <a href="https://shenyu.incubator.apache.org/blog/DataSync-SourceCode-Analysis-WebSocket-Data-Sync" target="_blank" rel="noopener noreferrer">websocket data sync source code</a> for details.</p><p>Shenyu bootstrap receives the data synced from admin in the <code>handler()</code> method of <code>McpServerPluginDataHandler</code>.</p><ul><li><code>handlerSelector()</code> receives URL data and creates McpServer.</li><li><code>handlerRule()</code> receives tool info and registers tools.</li></ul><p>These two methods together form the service registration part of the Shenyu Mcp plugin. Below, I will analyze these two methods in detail.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="11-transport-and-mcpserver-registration"></a>1.1 Transport and McpServer Registration<a class="hash-link" href="#11-transport-and-mcpserver-registration" title="Direct link to heading">#</a></h4><p>Letâ€™s analyze the <code>handlerSelector()</code> method, which handles McpServer registration.</p><ul><li>What <code>handlerSelector()</code> does:</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">public class McpServerPluginDataHandler implements PluginDataHandler {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void handlerSelector(final SelectorData selectorData) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Get URI</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        String uri = selectorData.getConditionList().stream()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                .filter(condition -&gt; Constants.URI.equals(condition.getParamType()))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                .map(ConditionData::getParamValue)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                .findFirst()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                .orElse(null);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Build McpServer</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ShenyuMcpServer shenyuMcpServer = GsonUtils.getInstance().fromJson(Objects.isNull(selectorData.getHandle()) ? DEFAULT_MESSAGE_ENDPOINT : selectorData.getHandle(), ShenyuMcpServer.class);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        shenyuMcpServer.setPath(path);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Cache shenyuMcpServer</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        CACHED_SERVER.get().cachedHandle(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                selectorData.getId(),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                shenyuMcpServer);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        String messageEndpoint = shenyuMcpServer.getMessageEndpoint();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Try to get or register transportProvider</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        shenyuMcpServerManager.getOrCreateMcpServerTransport(uri, messageEndpoint);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><blockquote><p><code>ShenyuMcpServerManager</code> is the management center of McpServer in Shenyu. It not only stores <code>McpAsyncServer</code>, <code>CompositeTransportProvider</code>, etc., but also contains methods to register Transport and McpServer.</p></blockquote><ul><li>The <code>getOrCreateMcpServerTransport()</code> method works as follows:</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ShenyuMcpServerManager {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ShenyuSseServerTransportProvider getOrCreateMcpServerTransport(final String uri, final String messageEndPoint) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Remove /streamablehttp and /message suffixes</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        String normalizedPath = processPath(uri);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return getOrCreateTransport(normalizedPath, SSE_PROTOCOL,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                () -&gt; createSseTransport(normalizedPath, messageEndPoint));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private &lt;T&gt; T getOrCreateTransport(final String normalizedPath, final String protocol,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                       final java.util.function.Supplier&lt;T&gt; transportFactory) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Get composite Transport instance</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        CompositeTransportProvider compositeTransport = getOrCreateCompositeTransport(normalizedPath);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        T transport = switch (protocol) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            case SSE_PROTOCOL -&gt; (T) compositeTransport.getSseTransport();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            case STREAMABLE_HTTP_PROTOCOL -&gt; (T) compositeTransport.getStreamableHttpTransport();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            default -&gt; null;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // If instance is missing in cache, create a new one</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (Objects.isNull(transport)) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Call createSseTransport() to create and store a new transport</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            transport = transportFactory.get();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Create McpAsyncServer and register the transport</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            addTransportToSharedServer(normalizedPath, protocol, transport);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return transport;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="111-transport-registration"></a>1.1.1 Transport Registration<a class="hash-link" href="#111-transport-registration" title="Direct link to heading">#</a></h5><ul><li><code>createSseTransport()</code> method<blockquote><p>This method is called within <code>getOrCreateMcpServerTransport()</code> and is used to create a Transport</p></blockquote></li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ShenyuMcpServerManager {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private ShenyuSseServerTransportProvider createSseTransport(final String normalizedPath, final String messageEndPoint) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        String messageEndpoint = normalizedPath + messageEndPoint;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ShenyuSseServerTransportProvider transportProvider = ShenyuSseServerTransportProvider.builder()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                .objectMapper(objectMapper)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                .sseEndpoint(normalizedPath)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                .messageEndpoint(messageEndpoint)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                .build();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Register the two functions of transportProvider to the Manager&#x27;s routeMap</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        registerRoutes(normalizedPath, messageEndpoint, transportProvider::handleSseConnection, transportProvider::handleMessage);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return transportProvider;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="112-mcpserver-registration"></a>1.1.2 McpServer Registration<a class="hash-link" href="#112-mcpserver-registration" title="Direct link to heading">#</a></h5><ul><li><code>addTransportToSharedServer()</code> method<blockquote><p>This method is called within <code>getOrCreateMcpServerTransport()</code> and is used to create and save McpServer</p></blockquote></li></ul><p>This method creates a new McpServer, stores it in <code>sharedServerMap</code>, and saves the TransportProvider obtained above into <code>compositeTransportMap</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ShenyuMcpServerManager {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void addTransportToSharedServer(final String normalizedPath, final String protocol, final Object transportProvider) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Get or create and register McpServer</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        getOrCreateSharedServer(normalizedPath);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Save the new transport protocol into compositeTransportMap</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        compositeTransport.addTransport(protocol, transportProvider);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private McpAsyncServer getOrCreateSharedServer(final String normalizedPath) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return sharedServerMap.computeIfAbsent(normalizedPath, path -&gt; {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Get transport protocols</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            CompositeTransportProvider compositeTransport = getOrCreateCompositeTransport(path);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Select server capabilities</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            var capabilities = McpSchema.ServerCapabilities.builder()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .tools(true)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .logging()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .build();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Create and store McpServer</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            McpAsyncServer server = McpServer</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .async(compositeTransport)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .serverInfo(&quot;MCP Shenyu Server (Multi-Protocol)&quot;, &quot;1.0.0&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .capabilities(capabilities)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .tools(Lists.newArrayList())</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .build();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span></span><span class="token-line" style="color:#393A34"><span class="token plain">            return server;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="12-tools-registration"></a>1.2 Tools Registration<a class="hash-link" href="#12-tools-registration" title="Direct link to heading">#</a></h4><ul><li><code>handlerRule()</code> method works as follows:</li></ul><ol><li>Captures the tool configuration info users fill in for the Tool, all used to build the tool</li><li>Deserializes to create <code>ShenyuMcpServerTool</code> and obtains tool info</li></ol><blockquote><p>Note: <code>ShenyuMcpServerTool</code> is also a Shenyu-side object for storing tool info, unrelated by inheritance to <code>McpServerTool</code></p></blockquote><ol start="3"><li>Calls <code>addTool()</code> method to create the tool using this info and registers the tool to the matching McpServer based on SelectorId</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">public class McpServerPluginDataHandler implements PluginDataHandler {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void handlerRule(final RuleData ruleData) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        Optional.ofNullable(ruleData.getHandle()).ifPresent(s -&gt; {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Deserialize a new ShenyuMcpServerTool</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            ShenyuMcpServerTool mcpServerTool = GsonUtils.getInstance().fromJson(s, ShenyuMcpServerTool.class);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Cache mcpServerTool</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            CACHED_TOOL.get().cachedHandle(CacheKeyUtils.INST.getKey(ruleData), mcpServerTool);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Build MCP schema</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            List&lt;McpServerToolParameter&gt; parameters = mcpServerTool.getParameters();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            String inputSchema = JsonSchemaUtil.createParameterSchema(parameters);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            ShenyuMcpServer server = CACHED_SERVER.get().obtainHandle(ruleData.getSelectorId());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (Objects.nonNull(server)) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                // Save tool info into Manager&#x27;s sharedServerMap</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                shenyuMcpServerManager.addTool(server.getPath(),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        StringUtils.isBlank(mcpServerTool.getName()) ? ruleData.getName()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                : mcpServerTool.getName(),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        mcpServerTool.getDescription(),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        mcpServerTool.getRequestConfig(),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        inputSchema);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li><code>addTool()</code> method<blockquote><p>This method is called by <code>handlerRule()</code> to add a new tool</p></blockquote></li></ul><p>This method performs:</p><ol><li><p>Converts the previous tool info into a <code>shenyuToolDefinition</code> object</p></li><li><p>Creates a <code>ShenyuToolCallback</code> object using the converted <code>shenyuToolDefinition</code></p><blockquote><p><code>ShenyuToolCallback</code> overrides the <code>call()</code> method of <code>ToolCallBack</code> and registers this overridden method to <code>AsyncToolSpecification</code>, so calling the tool&#x27;s <code>call()</code> will actually invoke this overridden method</p></blockquote></li><li><p>Converts <code>ShenyuToolCallback</code> to <code>AsyncToolSpecification</code> and registers it to the corresponding McpServer</p></li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">public class McpServerPluginDataHandler implements PluginDataHandler {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void addTool(final String serverPath, final String name, final String description,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        final String requestTemplate, final String inputSchema) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        String normalizedPath = normalizeServerPath(serverPath);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Build Definition object</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ToolDefinition shenyuToolDefinition = ShenyuToolDefinition.builder()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                .name(name)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                .description(description)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                .requestConfig(requestTemplate)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                .inputSchema(inputSchema)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                .build();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ShenyuToolCallback shenyuToolCallback = new ShenyuToolCallback(shenyuToolDefinition);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Get previously registered McpServer and register the Tool</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        McpAsyncServer sharedServer = sharedServerMap.get(normalizedPath);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (AsyncToolSpecification asyncToolSpecification : McpToolUtils.toAsyncToolSpecifications(shenyuToolCallback)) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            sharedServer.addTool(asyncToolSpecification).block();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>With this, service registration analysis is complete.</p><p>Service registration overview diagram<br>
<img src="/assets/images/Mcp-server-register-en-daa12f6fee06542c61e64f8e6c587268.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="2-plugin-execution"></a>2. Plugin Execution<a class="hash-link" href="#2-plugin-execution" title="Direct link to heading">#</a></h3><p>Clients will send two types of messages with <code>/sse</code> and <code>/message</code> suffixes. These messages are captured by the Shenyu McpServer plugin, which handles them differently. When receiving <code>/sse</code> messages, the plugin creates and saves a session object, then returns a session id for <code>/message</code> usage. When receiving <code>/message</code> messages, the plugin executes methods based on the method info carried by the <code>/message</code> message, such as fetching work lists, tool invocation, and resource lists.</p><ul><li><code>doExecute()</code> method works as follows:</li></ul><ol><li>Matches the path and checks if the Mcp plugin registered it</li><li>Calls <code>routeByProtocol()</code> to choose the appropriate handling plan based on the request protocol</li></ol><blockquote><p>This article focuses on the SSE request mode, so we enter the <code>handleSseRequest()</code> method</p></blockquote><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">public class McpServerPlugin extends AbstractShenyuPlugin {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected Mono&lt;Void&gt; doExecute(final ServerWebExchange exchange,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   final ShenyuPluginChain chain,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   final SelectorData selector,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   final RuleData rule) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        final String uri = exchange.getRequest().getURI().getRawPath();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Check if Mcp plugin registered this route; if not, continue chain without handling</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!shenyuMcpServerManager.canRoute(uri)) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            return chain.execute(exchange);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        final ServerRequest request = ServerRequest.create(exchange, messageReaders);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Choose handling method based on URI protocol</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return routeByProtocol(exchange, chain, request, selector, uri);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Mono&lt;Void&gt; routeByProtocol(final ServerWebExchange exchange,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                       final ShenyuPluginChain chain,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                       final ServerRequest request,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                       final SelectorData selector,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                       final String uri) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (isStreamableHttpProtocol(uri)) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            return handleStreamableHttpRequest(exchange, chain, request, uri);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else if (isSseProtocol(uri)) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Handle SSE requests</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            return handleSseRequest(exchange, chain, request, selector, uri);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        } </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li><code>handleSseRequest()</code> method<blockquote><p>Called by <code>routeByProtocol()</code> to determine if the client wants to create a session or call a tool based on URI suffix</p></blockquote></li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">public class McpServerPlugin extends AbstractShenyuPlugin {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Mono&lt;Void&gt; handleSseRequest(final ServerWebExchange exchange,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        final ShenyuPluginChain chain,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        final ServerRequest request,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        final SelectorData selector,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        final String uri) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ShenyuMcpServer server = McpServerPluginDataHandler.CACHED_SERVER.get().obtainHandle(selector.getId());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        String messageEndpoint = server.getMessageEndpoint();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Get the transport provider</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ShenyuSseServerTransportProvider transportProvider</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                = shenyuMcpServerManager.getOrCreateMcpServerTransport(uri, messageEndpoint);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Determine if the request is an SSE connection or a message call</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (uri.endsWith(messageEndpoint)) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            setupSessionContext(exchange, chain);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            return handleMessageEndpoint(exchange, transportProvider, request);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            return handleSseEndpoint(exchange, transportProvider, request);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="21-client-sends-sse-request"></a>2.1 Client Sends SSE Request<a class="hash-link" href="#21-client-sends-sse-request" title="Direct link to heading">#</a></h4><blockquote><p>If the client sends a request ending with <code>/sse</code>, the <code>handleSseEndpoint()</code> method is executed</p></blockquote><ul><li><code>handleSseEndpoint()</code> mainly does:</li></ul><ol><li>Sets SSE request headers</li><li>Calls <code>ShenyuSseServerTransportProvider.createSseFlux()</code> to create the SSE stream</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">public class McpServerPlugin extends AbstractShenyuPlugin {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Mono&lt;Void&gt; handleSseEndpoint(final ServerWebExchange exchange,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                         final ShenyuSseServerTransportProvider transportProvider,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                         final ServerRequest request) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Configure SSE request headers</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        configureSseHeaders(exchange);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Create SSE stream</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return exchange.getResponse()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                .writeWith(transportProvider</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        .createSseFlux(request));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li><code>createSseFlux()</code> method<blockquote><p>Called by <code>handleSseEndpoint()</code>; mainly used to create and save a session</p><ol><li>Creates session; the session factory registers a series of handlers, which are the objects actually executing tool calls</li><li>Saves the session for reuse</li><li>Sends the session id as a parameter of the endpoint URL back to the client, to be used when calling the message endpoint</li></ol></blockquote></li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">public class ShenyuSseServerTransportProvider implements McpServerTransportProvider {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Flux&lt;ServerSentEvent&lt;?&gt;&gt; createSseFlux(final ServerRequest request) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Flux.&lt;ServerSentEvent&lt;?&gt;&gt;create(sink -&gt; {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    WebFluxMcpSessionTransport sessionTransport = new WebFluxMcpSessionTransport(sink);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // Create McpServerSession and temporarily store plugin chain info</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    McpServerSession session = sessionFactory.create(sessionTransport);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    String sessionId = session.getId();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    sessions.put(sessionId, session);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // Send session id info back to client</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    String endpointUrl = this.baseUrl + this.messageEndpoint + &quot;?sessionId=&quot; + sessionId;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ServerSentEvent&lt;String&gt; endpointEvent = ServerSentEvent.&lt;String&gt;builder()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            .event(ENDPOINT_EVENT_TYPE)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            .data(endpointUrl)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            .build();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                }).doOnSubscribe(subscription -&gt; LOGGER.info(&quot;SSE Flux subscribed&quot;))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                .doOnRequest(n -&gt; LOGGER.debug(&quot;SSE Flux requested {} items&quot;, n));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="22-client-sends-message-request"></a>2.2 Client Sends Message Request<a class="hash-link" href="#22-client-sends-message-request" title="Direct link to heading">#</a></h4><blockquote><p>If the client sends a request ending with <code>/message</code>, the current <code>ShenyuPluginChain</code> info is saved into the session, and <code>handleMessageEndpoint()</code> is called.<br>
Subsequent tool calls continue executing this plugin chain, so plugins after the Mcp plugin will affect tool requests.</p></blockquote><ul><li><code>handleMessageEndpoint()</code> method, calls <code>ShenyuSseServerTransportProvider.handleMessageEndpoint()</code> to process</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">if (uri.endsWith(messageEndpoint)) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">       setupSessionContext(exchange, chain);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">       return handleMessageEndpoint(exchange, transportProvider, request);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">public class McpServerPlugin extends AbstractShenyuPlugin {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Mono&lt;Void&gt; handleMessageEndpoint(final ServerWebExchange exchange,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                             final ShenyuSseServerTransportProvider transportProvider,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                             final ServerRequest request) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Handle message requests</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return transportProvider.handleMessageEndpoint(request)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                .flatMap(result -&gt; {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    return exchange.getResponse()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            .writeWith(Mono.just(exchange.getResponse().bufferFactory().wrap(responseBody.getBytes())));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li><code>handleMessageEndpoint()</code> method<blockquote><p>Called by <code>McpServerPlugin.handleMessageEndpoint()</code>, hands over the request to the session for processing</p></blockquote></li></ul><p>The session&#x27;s <code>handler()</code> method performs different actions depending on the message.<br>
For example, when the method in the message is <code>&quot;tools/call&quot;</code>, the tool invocation handler executes the <code>call()</code> method to call the tool.<br>
The related source is omitted here.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">public class ShenyuSseServerTransportProvider implements McpServerTransportProvider {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Mono&lt;MessageHandlingResult&gt; handleMessageEndpoint(final ServerRequest request) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Get session</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        String sessionId = request.queryParam(&quot;sessionId&quot;).get();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        McpServerSession session = sessions.get(sessionId);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return request.bodyToMono(String.class)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                .flatMap(body -&gt; {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    McpSchema.JSONRPCMessage message = McpSchema.deserializeJsonRpcMessage(objectMapper, body);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    return session.handle(message);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>At this point, the Shenyu Mcp Plugin service invocation source code analysis is complete.</p><p>Process flow overview<br>
<img src="/assets/images/Mcp-server-execute-en-29cfc2484b94d6221407e4063d52ad29.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="3-tool-invocation"></a>3. Tool Invocation<a class="hash-link" href="#3-tool-invocation" title="Direct link to heading">#</a></h3><blockquote><p>If the client sends a message to invoke a tool, the session will use the tool invocation handler to execute the toolâ€™s <code>call()</code> method.<br>
From service registration, we know the tool call actually runs the <code>call()</code> method of <code>ShenyuToolCallback</code>.</p></blockquote><p>Therefore, the tool invocation executes the following:</p><ul><li><code>call()</code> method mainly does:</li></ul><ol><li>Gets session id</li><li>Gets <code>requestTemplate</code>, the extra configuration provided by Shenyu</li><li>Gets the previously stored Shenyu plugin chain and passes the tool call info to the chain for continued execution</li><li>Asynchronously waits for the tool response</li></ol><p>After the plugin chain completes, the tool call request is actually sent to the service hosting the tool.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">public class ShenyuToolCallback implements ToolCallback {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    @NonNull</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String call(@NonNull final String input, final ToolContext toolContext) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Extract sessionId from MCP request</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        final McpSyncServerExchange mcpExchange = extractMcpExchange(toolContext);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        final String sessionId = extractSessionId(mcpExchange);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Extract requestTemplate info</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        final String configStr = extractRequestConfig(shenyuTool);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Get the previously stored plugin chain by sessionId</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        final ServerWebExchange originExchange = getOriginExchange(sessionId);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        final ShenyuPluginChain chain = getPluginChain(originExchange);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Execute the tool call</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return executeToolCall(originExchange, chain, sessionId, configStr, input);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String executeToolCall(final ServerWebExchange originExchange,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   final ShenyuPluginChain chain,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   final String sessionId,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   final String configStr,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   final String input) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        final CompletableFuture&lt;String&gt; responseFuture = new CompletableFuture&lt;&gt;();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        final ServerWebExchange decoratedExchange = buildDecoratedExchange(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                originExchange, responseFuture, sessionId, configStr, input);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Execute plugin chain, call the actual tool</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        chain.execute(decoratedExchange)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                .subscribe();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Wait for response</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        final String result = responseFuture.get(DEFAULT_TIMEOUT_SECONDS, TimeUnit.SECONDS);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This concludes the Shenyu MCP Plugin tool invocation analysis.</p><p><img src="data:image/png;base64,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"></p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="4-summary"></a>4. Summary<a class="hash-link" href="#4-summary" title="Direct link to heading">#</a></h3><p>This article analyzed the source code from Mcp service registration, through Mcp plugin service invocation, to tool invocation.<br>
The McpServer plugin makes Shenyu a powerful and centralized McpServer.</p><hr></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_xD8n"><div class="col"><b>Tags:</b><a class="margin-horiz--sm" href="/blog/tags/plugin">plugin</a><a class="margin-horiz--sm" href="/blog/tags/mcp">mcp</a><a class="margin-horiz--sm" href="/blog/tags/apache-shen-yu">Apache ShenYu</a></div><div class="col margin-top--sm"><a href="https://github.com/apache/shenyu-website/edit/main/blog/Plugin-SourceCode-Analysis-Mcp-Server-Plugin.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/Plugin-SourceCode-Analysis-Dubbo-Plugin"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« Code Analysis For Dubbo Plugin</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/DataSync-SourceCode-Analysis-Apollo-Data-Sync"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Apollo Data Synchronization Source Code Analysis Â»</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link">Introduction</a></li><li><a href="#1-service-registration" class="table-of-contents__link">1. Service Registration</a></li><li><a href="#2-plugin-execution" class="table-of-contents__link">2. Plugin Execution</a></li><li><a href="#3-tool-invocation" class="table-of-contents__link">3. Tool Invocation</a></li><li><a href="#4-summary" class="table-of-contents__link">4. Summary</a></li></ul></div></div></div></div></div></div>
<script src="/assets/js/runtime~main.69138608.js"></script>
<script src="/assets/js/main.c501959f.js"></script>
</body>
</html>