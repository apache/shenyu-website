"use strict";(self.webpackChunkshenyu_website=self.webpackChunkshenyu_website||[]).push([[96800],{15680:(e,n,t)=>{t.d(n,{xA:()=>s,yg:()=>y});var a=t(96540);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var o=a.createContext({}),g=function(e){var n=a.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},s=function(e){var n=g(e.components);return a.createElement(o.Provider,{value:n},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,l=e.originalType,o=e.parentName,s=p(e,["components","mdxType","originalType","parentName"]),u=g(t),d=i,y=u["".concat(o,".").concat(d)]||u[d]||c[d]||l;return t?a.createElement(y,r(r({ref:n},s),{},{components:t})):a.createElement(y,r({ref:n},s))}));function y(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var l=t.length,r=new Array(l);r[0]=d;var p={};for(var o in n)hasOwnProperty.call(n,o)&&(p[o]=n[o]);p.originalType=e,p[u]="string"==typeof e?e:i,r[1]=p;for(var g=2;g<l;g++)r[g]=t[g];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},63483:(e,n,t)=>{t.r(n),t.d(n,{contentTitle:()=>r,default:()=>u,frontMatter:()=>l,metadata:()=>p,toc:()=>o});var a=t(58168),i=(t(96540),t(15680));const l={title:"Http\u957f\u8f6e\u8be2\u6570\u636e\u540c\u6b65\u6e90\u7801\u5206\u6790",author:"midnight2104",author_title:"Apache ShenYu Committer",author_url:"https://github.com/midnight2104",tags:["http","data sync","Apache ShenYu"]},r=void 0,p={permalink:"/zh/blog/DataSync-SourceCode-Analysis-Http-Data-Sync",editUrl:"https://github.com/apache/shenyu-website/edit/main/i18n/zh/docusaurus-plugin-content-blog/DataSync-SourceCode-Analysis-Http-Data-Sync.md",source:"@site/i18n/zh/docusaurus-plugin-content-blog/DataSync-SourceCode-Analysis-Http-Data-Sync.md",title:"Http\u957f\u8f6e\u8be2\u6570\u636e\u540c\u6b65\u6e90\u7801\u5206\u6790",description:"Apache ShenYu \u662f\u4e00\u4e2a\u5f02\u6b65\u7684\uff0c\u9ad8\u6027\u80fd\u7684\uff0c\u8de8\u8bed\u8a00\u7684\uff0c\u54cd\u5e94\u5f0f\u7684 API \u7f51\u5173\u3002",date:"2025-01-17T07:37:17.835Z",formattedDate:"2025\u5e741\u670817\u65e5",tags:[{label:"http",permalink:"/zh/blog/tags/http"},{label:"data sync",permalink:"/zh/blog/tags/data-sync"},{label:"Apache ShenYu",permalink:"/zh/blog/tags/apache-shen-yu"}],readingTime:36.79,truncated:!1,prevItem:{title:"Etcd\u6570\u636e\u540c\u6b65\u6e90\u7801\u5206\u6790",permalink:"/zh/blog/DataSync-SourceCode-Analysis-Etcd-Data-Sync"},nextItem:{title:"WebSocket\u6570\u636e\u540c\u6b65\u6e90\u7801\u5206\u6790",permalink:"/zh/blog/DataSync-SourceCode-Analysis-WebSocket-Data-Sync"}},o=[{value:"1. Http\u957f\u8f6e\u8be2",id:"1-http\u957f\u8f6e\u8be2",children:[]},{value:"2. \u7f51\u5173\u6570\u636e\u540c\u6b65",id:"2-\u7f51\u5173\u6570\u636e\u540c\u6b65",children:[]},{value:"3. admin\u6570\u636e\u540c\u6b65",id:"3-admin\u6570\u636e\u540c\u6b65",children:[]},{value:"4. \u603b\u7ed3",id:"4-\u603b\u7ed3",children:[]}],g={toc:o},s="wrapper";function u(e){let{components:n,...l}=e;return(0,i.yg)(s,(0,a.A)({},g,l,{components:n,mdxType:"MDXLayout"}),(0,i.yg)("blockquote",null,(0,i.yg)("p",{parentName:"blockquote"},(0,i.yg)("a",{parentName:"p",href:"https://shenyu.apache.org/zh/docs/index"},"Apache ShenYu")," \u662f\u4e00\u4e2a\u5f02\u6b65\u7684\uff0c\u9ad8\u6027\u80fd\u7684\uff0c\u8de8\u8bed\u8a00\u7684\uff0c\u54cd\u5e94\u5f0f\u7684 ",(0,i.yg)("inlineCode",{parentName:"p"},"API")," \u7f51\u5173\u3002")),(0,i.yg)("p",null,"\u5728",(0,i.yg)("inlineCode",{parentName:"p"},"ShenYu"),"\u7f51\u5173\u4e2d\uff0c\u6570\u636e\u540c\u6b65\u662f\u6307\uff0c\u5f53\u5728\u540e\u53f0\u7ba1\u7406\u7cfb\u7edf\u4e2d\uff0c\u6570\u636e\u53d1\u9001\u4e86\u66f4\u65b0\u540e\uff0c\u5982\u4f55\u5c06\u66f4\u65b0\u7684\u6570\u636e\u540c\u6b65\u5230\u7f51\u5173\u4e2d\u3002",(0,i.yg)("inlineCode",{parentName:"p"},"Apache ShenYu")," \u7f51\u5173\u5f53\u524d\u652f\u6301",(0,i.yg)("inlineCode",{parentName:"p"},"ZooKeeper"),"\u3001",(0,i.yg)("inlineCode",{parentName:"p"},"WebSocket"),"\u3001",(0,i.yg)("inlineCode",{parentName:"p"},"Http\u957f\u8f6e\u8be2"),"\u3001",(0,i.yg)("inlineCode",{parentName:"p"},"Nacos")," \u3001",(0,i.yg)("inlineCode",{parentName:"p"},"Etcd")," \u548c ",(0,i.yg)("inlineCode",{parentName:"p"},"Consul")," \u8fdb\u884c\u6570\u636e\u540c\u6b65\u3002\u672c\u6587\u7684\u4e3b\u8981\u5185\u5bb9\u662f\u57fa\u4e8e",(0,i.yg)("inlineCode",{parentName:"p"},"Http\u957f\u8f6e\u8be2"),"\u7684\u6570\u636e\u540c\u6b65\u6e90\u7801\u5206\u6790\u3002"),(0,i.yg)("blockquote",null,(0,i.yg)("p",{parentName:"blockquote"},"\u672c\u6587\u57fa\u4e8e",(0,i.yg)("inlineCode",{parentName:"p"},"shenyu-2.5.0"),"\u7248\u672c\u8fdb\u884c\u6e90\u7801\u5206\u6790\uff0c\u5b98\u7f51\u7684\u4ecb\u7ecd\u8bf7\u53c2\u8003 ",(0,i.yg)("a",{parentName:"p",href:"https://shenyu.apache.org/zh/docs/design/data-sync"},"\u6570\u636e\u540c\u6b65\u539f\u7406")," \u3002")),(0,i.yg)("h3",{id:"1-http\u957f\u8f6e\u8be2"},"1. Http\u957f\u8f6e\u8be2"),(0,i.yg)("p",null,"\u8fd9\u91cc\u76f4\u63a5\u5f15\u7528\u5b98\u7f51\u7684\u76f8\u5173\u63cf\u8ff0\uff1a"),(0,i.yg)("blockquote",null,(0,i.yg)("p",{parentName:"blockquote"},(0,i.yg)("inlineCode",{parentName:"p"},"Zookeeper"),"\u548c",(0,i.yg)("inlineCode",{parentName:"p"},"WebSocket")," \u6570\u636e\u540c\u6b65\u7684\u673a\u5236\u6bd4\u8f83\u7b80\u5355\uff0c\u800c ",(0,i.yg)("inlineCode",{parentName:"p"},"Http\u957f\u8f6e\u8be2"),"\u5219\u6bd4\u8f83\u590d\u6742\u3002 ",(0,i.yg)("inlineCode",{parentName:"p"},"Apache ShenYu")," \u501f\u9274\u4e86 ",(0,i.yg)("inlineCode",{parentName:"p"},"Apollo"),"\u3001",(0,i.yg)("inlineCode",{parentName:"p"},"Nacos")," \u7684\u8bbe\u8ba1\u601d\u60f3\uff0c\u53d6\u5176\u7cbe\u534e\uff0c\u81ea\u5df1\u5b9e\u73b0\u4e86 ",(0,i.yg)("inlineCode",{parentName:"p"},"Http\u957f\u8f6e\u8be2"),"\u6570\u636e\u540c\u6b65\u529f\u80fd\u3002\u6ce8\u610f\uff0c\u8fd9\u91cc\u5e76\u975e\u4f20\u7edf\u7684 ",(0,i.yg)("inlineCode",{parentName:"p"},"ajax")," \u957f\u8f6e\u8be2\uff01")),(0,i.yg)("p",null,(0,i.yg)("img",{src:t(54823).A})),(0,i.yg)("p",null,(0,i.yg)("inlineCode",{parentName:"p"},"Http\u957f\u8f6e\u8be2")," \u673a\u5236\u5982\u4e0a\u6240\u793a\uff0c",(0,i.yg)("inlineCode",{parentName:"p"},"Apache ShenYu"),"\u7f51\u5173\u4e3b\u52a8\u8bf7\u6c42 ",(0,i.yg)("inlineCode",{parentName:"p"},"shenyu-admin")," \u7684\u914d\u7f6e\u670d\u52a1\uff0c\u8bfb\u53d6\u8d85\u65f6\u65f6\u95f4\u4e3a ",(0,i.yg)("inlineCode",{parentName:"p"},"90s"),"\uff0c\u610f\u5473\u7740\u7f51\u5173\u5c42\u8bf7\u6c42\u914d\u7f6e\u670d\u52a1\u6700\u591a\u4f1a\u7b49\u5f85 ",(0,i.yg)("inlineCode",{parentName:"p"},"90s"),"\uff0c\u8fd9\u6837\u4fbf\u4e8e ",(0,i.yg)("inlineCode",{parentName:"p"},"shenyu-admin")," \u914d\u7f6e\u670d\u52a1\u53ca\u65f6\u54cd\u5e94\u53d8\u66f4\u6570\u636e\uff0c\u4ece\u800c\u5b9e\u73b0\u51c6\u5b9e\u65f6\u63a8\u9001\u3002"),(0,i.yg)("p",null,(0,i.yg)("inlineCode",{parentName:"p"},"Http\u957f\u8f6e\u8be2")," \u673a\u5236\u662f\u7531\u7f51\u5173\u4e3b\u52a8\u8bf7\u6c42 ",(0,i.yg)("inlineCode",{parentName:"p"},"shenyu-admin")," \uff0c\u6240\u4ee5\u8fd9\u6b21\u7684\u6e90\u7801\u5206\u6790\uff0c\u6211\u4eec\u4ece\u7f51\u5173\u8fd9\u4e00\u4fa7\u5f00\u59cb\u3002"),(0,i.yg)("h3",{id:"2-\u7f51\u5173\u6570\u636e\u540c\u6b65"},"2. \u7f51\u5173\u6570\u636e\u540c\u6b65"),(0,i.yg)("h4",{id:"21-\u52a0\u8f7d\u914d\u7f6e"},"2.1 \u52a0\u8f7d\u914d\u7f6e"),(0,i.yg)("p",null,(0,i.yg)("inlineCode",{parentName:"p"},"Http\u957f\u8f6e\u8be2")," \u6570\u636e\u540c\u6b65\u914d\u7f6e\u7684\u52a0\u8f7d\u662f\u901a\u8fc7",(0,i.yg)("inlineCode",{parentName:"p"},"spring boot"),"\u7684",(0,i.yg)("inlineCode",{parentName:"p"},"starter"),"\u673a\u5236\uff0c\u5f53\u6211\u4eec\u5f15\u5165\u76f8\u5173\u4f9d\u8d56\u548c\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6709\u5982\u4e0b\u914d\u7f6e\u65f6\uff0c\u5c31\u4f1a\u52a0\u8f7d\u3002"),(0,i.yg)("p",null,"\u5728",(0,i.yg)("inlineCode",{parentName:"p"},"pom"),"\u6587\u4ef6\u4e2d\u5f15\u5165\u4f9d\u8d56\uff1a"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-xml"},"\x3c!--shenyu data sync start use http--\x3e\n<dependency>\n    <groupId>org.apache.shenyu</groupId>\n    <artifactId>shenyu-spring-boot-starter-sync-data-http</artifactId>\n    <version>${project.version}</version>\n</dependency>\n")),(0,i.yg)("p",null,"\u5728",(0,i.yg)("inlineCode",{parentName:"p"},"application.yml"),"\u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0\u914d\u7f6e\uff1a"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-yaml"},"shenyu:\n    sync:\n       http:\n          url : http://localhost:9095\n")),(0,i.yg)("p",null,"\u5f53\u7f51\u5173\u542f\u52a8\u65f6\uff0c\u914d\u7f6e\u7c7b",(0,i.yg)("inlineCode",{parentName:"p"},"HttpSyncDataConfiguration"),"\u5c31\u4f1a\u6267\u884c\uff0c\u52a0\u8f7d\u76f8\u5e94\u7684",(0,i.yg)("inlineCode",{parentName:"p"},"Bean"),"\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},'/**\n * Http sync data configuration for spring boot.\n */\n@Configuration\n@ConditionalOnClass(HttpSyncDataService.class)\n@ConditionalOnProperty(prefix = "shenyu.sync.http", name = "url")\n@EnableConfigurationProperties(value = HttpConfig.class)\npublic class HttpSyncDataConfiguration {\n\n  private static final Logger LOGGER = LoggerFactory.getLogger(HttpSyncDataConfiguration.class);\n\n  /**\n   * Rest template.\n   * \u521b\u5efaRestTemplate\n   * @param httpConfig the http config       http\u914d\u7f6e\n   * @return the rest template\n   */\n  @Bean\n  public RestTemplate restTemplate(final HttpConfig httpConfig) {\n    OkHttp3ClientHttpRequestFactory factory = new OkHttp3ClientHttpRequestFactory();\n    factory.setConnectTimeout(Objects.isNull(httpConfig.getConnectionTimeout()) ? (int) HttpConstants.CLIENT_POLLING_CONNECT_TIMEOUT : httpConfig.getConnectionTimeout());\n    factory.setReadTimeout(Objects.isNull(httpConfig.getReadTimeout()) ? (int) HttpConstants.CLIENT_POLLING_READ_TIMEOUT : httpConfig.getReadTimeout());\n    factory.setWriteTimeout(Objects.isNull(httpConfig.getWriteTimeout()) ? (int) HttpConstants.CLIENT_POLLING_WRITE_TIMEOUT : httpConfig.getWriteTimeout());\n    return new RestTemplate(factory);\n  }\n\n  /**\n   * AccessTokenManager.\n   * \u521b\u5efaAccessTokenManager,\u4e13\u95e8\u7528\u6237\u5bf9admin\u8fdb\u884chttp\u8bf7\u6c42\u65f6access token\u7684\u5904\u7406\n   * @param httpConfig   the http config.      \n   * @param restTemplate the rest template.\n   * @return the access token manager.\n   */\n  @Bean\n  public AccessTokenManager accessTokenManager(final HttpConfig httpConfig, final RestTemplate restTemplate) {\n    return new AccessTokenManager(restTemplate, httpConfig);\n  }\n\n  /**\n   * Http sync data service.\n   * \u521b\u5efa HttpSyncDataService \n   * @param httpConfig         the http config\n   * @param pluginSubscriber   the plugin subscriber\n   * @param restTemplate       the rest template\n   * @param metaSubscribers    the meta subscribers\n   * @param authSubscribers    the auth subscribers\n   * @param accessTokenManager the access token manager\n   * @return the sync data service\n   */\n  @Bean\n  public SyncDataService httpSyncDataService(final ObjectProvider<HttpConfig> httpConfig,\n                                             final ObjectProvider<PluginDataSubscriber> pluginSubscriber,\n                                             final ObjectProvider<RestTemplate> restTemplate,\n                                             final ObjectProvider<List<MetaDataSubscriber>> metaSubscribers,\n                                             final ObjectProvider<List<AuthDataSubscriber>> authSubscribers,\n                                             final ObjectProvider<AccessTokenManager> accessTokenManager) {\n    LOGGER.info("you use http long pull sync shenyu data");\n    return new HttpSyncDataService(\n            Objects.requireNonNull(httpConfig.getIfAvailable()),\n            Objects.requireNonNull(pluginSubscriber.getIfAvailable()),\n            Objects.requireNonNull(restTemplate.getIfAvailable()),\n            metaSubscribers.getIfAvailable(Collections::emptyList),\n            authSubscribers.getIfAvailable(Collections::emptyList),\n            Objects.requireNonNull(accessTokenManager.getIfAvailable())\n    );\n  }\n}\n\n')),(0,i.yg)("p",null,(0,i.yg)("inlineCode",{parentName:"p"},"HttpSyncDataConfiguration"),"\u662f",(0,i.yg)("inlineCode",{parentName:"p"},"Http\u957f\u8f6e\u8be2"),"\u6570\u636e\u540c\u6b65\u7684\u914d\u7f6e\u7c7b\uff0c\u8d1f\u8d23\u521b\u5efa",(0,i.yg)("inlineCode",{parentName:"p"},"HttpSyncDataService"),"\uff08\u8d1f\u8d23",(0,i.yg)("inlineCode",{parentName:"p"},"http"),"\u6570\u636e\u540c\u6b65\u7684\u5177\u4f53\u5b9e\u73b0\uff09\u3001",(0,i.yg)("inlineCode",{parentName:"p"},"RestTemplate"),"\u548c",(0,i.yg)("inlineCode",{parentName:"p"},"AccessTokenManager")," \uff08\u8d1f\u8d23\u4e0e",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"http\u8c03\u7528\u65f6access token\u7684\u5904\u7406\uff09\u3002\u5b83\u7684\u6ce8\u89e3\u5982\u4e0b\uff1a"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"@Configuration"),"\uff1a\u8868\u793a\u8fd9\u662f\u4e00\u4e2a\u914d\u7f6e\u7c7b\uff1b"),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"@ConditionalOnClass(HttpSyncDataService.class)"),"\uff1a\u6761\u4ef6\u6ce8\u89e3\uff0c\u8868\u793a\u8981\u6709",(0,i.yg)("inlineCode",{parentName:"li"},"HttpSyncDataService"),"\u8fd9\u4e2a\u7c7b\uff1b"),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},'@ConditionalOnProperty(prefix = "shenyu.sync.http", name = "url")'),"\uff1a\u6761\u4ef6\u6ce8\u89e3\uff0c\u8981\u6709",(0,i.yg)("inlineCode",{parentName:"li"},"shenyu.sync.http.url"),"\u8fd9\u4e2a\u5c5e\u6027\u914d\u7f6e\u3002"),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"@EnableConfigurationProperties(value = HttpConfig.class)"),"\uff1a\u8868\u793a\u8ba9HttpConfig\u4e0a\u7684\u6ce8\u89e3",(0,i.yg)("inlineCode",{parentName:"li"},'@ConfigurationProperties(prefix = "shenyu.sync.http")'),"\u751f\u6548\uff0c\u5c06",(0,i.yg)("inlineCode",{parentName:"li"},"HttpConfig"),"\u8fd9\u4e2a\u914d\u7f6e\u7c7b\u6ce8\u5165Ioc\u5bb9\u5668\u4e2d\u3002")),(0,i.yg)("h4",{id:"22-\u5c5e\u6027\u521d\u59cb\u5316"},"2.2 \u5c5e\u6027\u521d\u59cb\u5316"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"HttpSyncDataService")),(0,i.yg)("p",null,"\u5728",(0,i.yg)("inlineCode",{parentName:"p"},"HttpSyncDataService"),"\u7684\u6784\u9020\u51fd\u6570\u4e2d\uff0c\u5b8c\u6210\u5c5e\u6027\u521d\u59cb\u5316\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},'public class HttpSyncDataService implements SyncDataService {\n\n    // \u7701\u7565\u4e86\u5c5e\u6027\u5b57\u6bb5......\n\n    public HttpSyncDataService(final HttpConfig httpConfig,\n                               final PluginDataSubscriber pluginDataSubscriber,\n                               final RestTemplate restTemplate,\n                               final List<MetaDataSubscriber> metaDataSubscribers,\n                               final List<AuthDataSubscriber> authDataSubscribers,\n                               final AccessTokenManager accessTokenManager) {\n          // 1.\u8bbe\u7f6eaccessTokenManager\n          this.accessTokenManager = accessTokenManager;\n          // 2.\u521b\u5efa\u6570\u636e\u5904\u7406\u5668\n          this.factory = new DataRefreshFactory(pluginDataSubscriber, metaDataSubscribers, authDataSubscribers);\n          // 3.shenyu-admin\u7684url\uff0c \u591a\u4e2a\u7528\u9017\u53f7(,)\u5206\u5272\n          this.serverList = Lists.newArrayList(Splitter.on(",").split(httpConfig.getUrl()));\n          // 4.\u53ea\u7528\u4e8ehttp\u957f\u8f6e\u8be2\u7684restTemplate\n          this.restTemplate = restTemplate;\n          // 5.\u5f00\u59cb\u6267\u884c\u957f\u8f6e\u8be2\u4efb\u52a1\n          this.start();\n    }\n\n    //......\n}\n')),(0,i.yg)("p",null,"\u4e0a\u9762\u4ee3\u7801\u4e2d\u7701\u7565\u4e86\u5176\u4ed6\u51fd\u6570\u548c\u76f8\u5173\u5b57\u6bb5\uff0c\u5728\u6784\u9020\u51fd\u6570\u4e2d\u5b8c\u6210\u5c5e\u6027\u7684\u521d\u59cb\u5316\uff0c\u4e3b\u8981\u662f\uff1a"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"\u8bbe\u7f6e",(0,i.yg)("inlineCode",{parentName:"p"},"accessTokenManager"),"\uff0c\u5b9a\u65f6\u5411",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u8bf7\u6c42\u66f4\u65b0",(0,i.yg)("inlineCode",{parentName:"p"},"accessToken"),"\u7684\u503c\u3002\u7136\u540e\u6bcf\u6b21\u5411",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u53d1\u8d77\u8bf7\u6c42\u65f6\u90fd\u5fc5\u987b\u5c06",(0,i.yg)("inlineCode",{parentName:"p"},"header"),"\u7684",(0,i.yg)("inlineCode",{parentName:"p"},"X-Access-Token"),"\u5c5e\u6027\u8bbe\u7f6e\u6210",(0,i.yg)("inlineCode",{parentName:"p"},"accessToken"),"\u5bf9\u5e94\u7684\u503c\uff1b")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"\u521b\u5efa\u6570\u636e\u5904\u7406\u5668\uff0c\u7528\u4e8e\u540e\u7eed\u7f13\u5b58\u5404\u79cd\u7c7b\u578b\u7684\u6570\u636e\uff08\u63d2\u4ef6\u3001\u9009\u62e9\u5668\u3001\u89c4\u5219\u3001\u5143\u6570\u636e\u548c\u8ba4\u8bc1\u6570\u636e\uff09\uff1b")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"\u83b7\u53d6",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u5c5e\u6027\u914d\u7f6e\uff0c\u4e3b\u8981\u662f\u83b7\u53d6",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u7684",(0,i.yg)("inlineCode",{parentName:"p"},"url"),"\uff0c",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u6709\u53ef\u80fd\u662f\u96c6\u7fa4\uff0c\u591a\u4e2a\u7528\u9017\u53f7",(0,i.yg)("inlineCode",{parentName:"p"},"(,)"),"\u5206\u5272\uff1b")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"\u8bbe\u7f6e",(0,i.yg)("inlineCode",{parentName:"p"},"RestTemplate"),"\uff0c\u7528\u4e8e\u5411",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u53d1\u8d77\u8bf7\u6c42\uff1b")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"\u5f00\u59cb\u6267\u884c\u957f\u8f6e\u8be2\u4efb\u52a1\u3002"))),(0,i.yg)("h4",{id:"23-\u5f00\u59cb\u957f\u8f6e\u8be2"},"2.3 \u5f00\u59cb\u957f\u8f6e\u8be2"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"HttpSyncDataService#start()")),(0,i.yg)("p",null,"\u5728",(0,i.yg)("inlineCode",{parentName:"p"},"start()"),"\u65b9\u6cd5\u4e2d\uff0c\u5e72\u4e86\u4e24\u4ef6\u4e8b\u60c5\uff0c\u4e00\u4e2a\u662f\u83b7\u53d6\u5168\u91cf\u6570\u636e\uff0c\u5373\u8bf7\u6c42",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u7aef\u83b7\u53d6\u6240\u6709\u9700\u8981\u540c\u6b65\u7684\u6570\u636e\uff0c\u7136\u540e\u5c06\u83b7\u53d6\u5230\u7684\u6570\u636e\u7f13\u5b58\u5230\u7f51\u5173\u5185\u5b58\u4e2d\u3002\u53e6\u4e00\u4e2a\u662f\u5f00\u542f\u591a\u7ebf\u7a0b\u6267\u884c\u957f\u8f6e\u8be2\u4efb\u52a1\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},'public class HttpSyncDataService implements SyncDataService {\n    \n    // ......\n\n    private void start() {\n      // // \u53ea\u521d\u59cb\u5316\u4e00\u6b21\uff0c\u901a\u8fc7\u539f\u5b50\u7c7b\u5b9e\u73b0\u3002 \n      if (RUNNING.compareAndSet(false, true)) {\n        // \u521d\u6b21\u542f\u52a8\uff0c\u83b7\u53d6\u5168\u91cf\u6570\u636e\n        this.fetchGroupConfig(ConfigGroupEnum.values());\n        // \u4e00\u4e2a\u540e\u53f0\u670d\u52a1\uff0c\u4e00\u4e2a\u7ebf\u7a0b\n        int threadSize = serverList.size();\n        // \u81ea\u5b9a\u4e49\u7ebf\u7a0b\u6c60\n        this.executor = new ThreadPoolExecutor(threadSize, threadSize, 60L, TimeUnit.SECONDS,\n                new LinkedBlockingQueue<>(),\n                ShenyuThreadFactory.create("http-long-polling", true));\n        // \u5f00\u59cb\u957f\u8f6e\u8be2\uff0c\u4e00\u4e2aadmin\u670d\u52a1\uff0c\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\u7528\u4e8e\u6570\u636e\u540c\u6b65\n        this.serverList.forEach(server -> this.executor.execute(new HttpLongPollingTask(server)));\n      } else {\n        LOG.info("shenyu http long polling was started, executor=[{}]", executor);\n      }\n    }\n  \n    // ......\n}\n')),(0,i.yg)("h5",{id:"231-\u83b7\u53d6\u5168\u91cf\u6570\u636e"},"2.3.1 \u83b7\u53d6\u5168\u91cf\u6570\u636e"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"HttpSyncDataService#fetchGroupConfig()")),(0,i.yg)("p",null,(0,i.yg)("inlineCode",{parentName:"p"},"ShenYu"),"\u5c06\u6240\u6709\u9700\u8981\u540c\u6b65\u7684\u6570\u636e\u8fdb\u884c\u4e86\u5206\u7ec4\uff0c\u4e00\u5171\u67095\u79cd\u6570\u636e\u7c7b\u578b\uff0c\u5206\u522b\u662f\u63d2\u4ef6\u3001\u9009\u62e9\u5668\u3001\u89c4\u5219\u3001\u5143\u6570\u636e\u548c\u8ba4\u8bc1\u6570\u636e\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},"public enum ConfigGroupEnum {\n    APP_AUTH, // \u8ba4\u8bc1\u6570\u636e\n    PLUGIN, //\u63d2\u4ef6\n    RULE, // \u89c4\u5219\n    SELECTOR, // \u9009\u62e9\u5668\n    META_DATA; // \u5143\u6570\u636e\n}\n")),(0,i.yg)("p",null,(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u6709\u53ef\u80fd\u662f\u96c6\u7fa4\uff0c\u8fd9\u91cc\u901a\u8fc7\u5faa\u73af\u7684\u65b9\u5f0f\u5411\u6bcf\u4e2a",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u53d1\u8d77\u8bf7\u6c42\uff0c\u6709\u4e00\u4e2a\u6267\u884c\u6210\u529f\u4e86\uff0c\u90a3\u4e48\u5411",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u83b7\u53d6\u5168\u91cf\u6570\u636e\u5e76\u7f13\u5b58\u5230\u7f51\u5173\u7684\u64cd\u4f5c\u5c31\u6267\u884c\u6210\u529f\u3002\u5982\u679c\u51fa\u73b0\u4e86\u5f02\u5e38\uff0c\u5c31\u5411\u4e0b\u4e00\u4e2a",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u53d1\u8d77\u8bf7\u6c42\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},'public class HttpSyncDataService implements SyncDataService {\n\n  // ......\n\n  private void fetchGroupConfig(final ConfigGroupEnum... groups) throws ShenyuException {\n    // admin\u6709\u53ef\u80fd\u662f\u96c6\u7fa4\uff0c\u8fd9\u91cc\u901a\u8fc7\u5faa\u73af\u7684\u65b9\u5f0f\u5411\u6bcf\u4e2aadmin\u53d1\u8d77\u8bf7\u6c42\n    for (int index = 0; index < this.serverList.size(); index++) {\n      String server = serverList.get(index);\n      try {\n        // \u771f\u6b63\u53bb\u6267\u884c\n        this.doFetchGroupConfig(server, groups);\n        // \u6709\u4e00\u4e2a\u6210\u529f\uff0c\u5c31\u6210\u529f\u4e86\uff0c\u53ef\u4ee5\u9000\u51fa\u5faa\u73af\n        break;\n      } catch (ShenyuException e) {\n        // \u51fa\u73b0\u5f02\u5e38\uff0c\u5c1d\u8bd5\u6267\u884c\u4e0b\u4e00\u4e2a\n        // \u6700\u540e\u4e00\u4e2a\u4e5f\u6267\u884c\u5931\u8d25\u4e86\uff0c\u629b\u51fa\u5f02\u5e38\n        if (index >= serverList.size() - 1) {\n          throw e;\n        }\n        LOG.warn("fetch config fail, try another one: {}", serverList.get(index + 1));\n      }\n    }\n  }\n\n  // ......\n}\n')),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"HttpSyncDataService#doFetchGroupConfig()")),(0,i.yg)("p",null,"\u5728\u6b64\u65b9\u6cd5\u4e2d\uff0c\u9996\u5148\u62fc\u88c5\u8bf7\u6c42\u53c2\u6570\uff0c\u7136\u540e\u901a\u8fc7",(0,i.yg)("inlineCode",{parentName:"p"},"httpClient"),"\u53d1\u8d77\u8bf7\u6c42\uff0c\u5230",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u4e2d\u83b7\u53d6\u6570\u636e\uff0c\u6700\u540e\u5c06\u83b7\u53d6\u5230\u7684\u6570\u636e\u66f4\u65b0\u5230\u7f51\u5173\u5185\u5b58\u4e2d\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},'public class HttpSyncDataService implements SyncDataService {\n  private void doFetchGroupConfig(final String server, final ConfigGroupEnum... groups) {\n    // 1. \u62fc\u8bf7\u6c42\u53c2\u6570\uff0c\u6240\u6709\u5206\u7ec4\u679a\u4e3e\u7c7b\u578b\n    StringBuilder params = new StringBuilder();\n    for (ConfigGroupEnum groupKey : groups) {\n      params.append("groupKeys").append("=").append(groupKey.name()).append("&");\n    }\n    // admin\u7aef\u63d0\u4f9b\u7684\u63a5\u53e3  /configs/fetch\n    String url = server + Constants.SHENYU_ADMIN_PATH_CONFIGS_FETCH + "?" + StringUtils.removeEnd(params.toString(), "&");\n    LOG.info("request configs: [{}]", url);\n    String json;\n    try {\n      HttpHeaders headers = new HttpHeaders();\n      // \u8bbe\u7f6eaccessToken\n      headers.set(Constants.X_ACCESS_TOKEN, this.accessTokenManager.getAccessToken());\n      HttpEntity<String> httpEntity = new HttpEntity<>(headers);\n      // 2. \u53d1\u8d77\u8bf7\u6c42\uff0c\u83b7\u53d6\u53d8\u66f4\u6570\u636e\n      json = this.restTemplate.exchange(url, HttpMethod.GET, httpEntity, String.class).getBody();\n    } catch (RestClientException e) {\n      String message = String.format("fetch config fail from server[%s], %s", url, e.getMessage());\n      LOG.warn(message);\n      throw new ShenyuException(message, e);\n    }\n    // 3. \u66f4\u65b0\u7f51\u5173\u5185\u5b58\u4e2d\u6570\u636e\n    boolean updated = this.updateCacheWithJson(json);\n    if (updated) {\n      LOG.debug("get latest configs: [{}]", json);\n      return;\n    }\n    // \u66f4\u65b0\u6210\u529f\uff0c\u6b64\u65b9\u6cd5\u5c31\u6267\u884c\u5b8c\u6210\u4e86\n    LOG.info("The config of the server[{}] has not been updated or is out of date. Wait for 30s to listen for changes again.", server);\n    // \u670d\u52a1\u7aef\u6ca1\u6709\u6570\u636e\u66f4\u65b0\uff0c\u5c31\u7b4930s\n    ThreadUtils.sleep(TimeUnit.SECONDS, 30);\n  }\n}\n')),(0,i.yg)("p",null,"\u4ece\u4ee3\u7801\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230 ",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u7aef\u63d0\u4f9b\u7684\u83b7\u53d6\u5168\u91cf\u6570\u636e\u63a5\u53e3\u662f  ",(0,i.yg)("inlineCode",{parentName:"p"},"/configs/fetch"),"\uff0c\u8fd9\u91cc\u5148\u4e0d\u8fdb\u4e00\u6b65\u6df1\u5165\uff0c\u653e\u5728\u540e\u6587\u518d\u5206\u6790\u3002"),(0,i.yg)("p",null,"\u83b7\u53d6\u5230",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u8fd4\u56de\u7ed3\u679c\u6570\u636e\uff0c\u5e76\u6210\u529f\u66f4\u65b0\uff0c\u90a3\u4e48\u6b64\u65b9\u6cd5\u5c31\u6267\u884c\u7ed3\u675f\u4e86\u3002\u5982\u679c\u6ca1\u6709\u66f4\u65b0\u6210\u529f\uff0c\u90a3\u4e48\u6709\u53ef\u80fd\u662f\u670d\u52a1\u7aef\u6ca1\u6709\u6570\u636e\u66f4\u65b0\uff0c\u5c31\u7b49\u5f85",(0,i.yg)("inlineCode",{parentName:"p"},"30s"),"\u3002"),(0,i.yg)("p",null,"\u8fd9\u91cc\u9700\u8981\u63d0\u524d\u8bf4\u660e\u4e00\u4e0b\uff0c\u7f51\u5173\u5728\u5224\u65ad\u662f\u5426\u66f4\u65b0\u6210\u529f\u65f6\uff0c\u6709\u6bd4\u5bf9\u6570\u636e\u7684\u64cd\u4f5c\uff0c\u9a6c\u4e0a\u5c31\u4f1a\u63d0\u5230\u3002"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"HttpSyncDataService#updateCacheWithJson()")),(0,i.yg)("p",null,"\u66f4\u65b0\u7f51\u5173\u5185\u5b58\u4e2d\u7684\u6570\u636e\u3002\u4f7f\u7528",(0,i.yg)("inlineCode",{parentName:"p"},"GSON"),"\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\uff0c\u4ece\u5c5e\u6027",(0,i.yg)("inlineCode",{parentName:"p"},"data"),"\u4e2d\u62ff\u771f\u6b63\u7684\u6570\u636e\uff0c\u7136\u540e\u4ea4\u7ed9",(0,i.yg)("inlineCode",{parentName:"p"},"DataRefreshFactory"),"\u53bb\u505a\u66f4\u65b0\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},'    private boolean updateCacheWithJson(final String json) {\n        // \u4f7f\u7528GSON\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\n        JsonObject jsonObject = GSON.fromJson(json, JsonObject.class);\n        // if the config cache will be updated?\n        return factory.executor(jsonObject.getAsJsonObject("data"));\n    }\n')),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"DataRefreshFactory#executor()")),(0,i.yg)("p",null,"\u6839\u636e\u4e0d\u540c\u6570\u636e\u7c7b\u578b\u53bb\u66f4\u65b0\u6570\u636e\uff0c\u8fd4\u56de\u66f4\u65b0\u7ed3\u679c\u3002\u5177\u4f53\u66f4\u65b0\u903b\u8f91\u4ea4\u7ed9\u4e86",(0,i.yg)("inlineCode",{parentName:"p"},"dataRefresh.refresh()"),"\u65b9\u6cd5\u3002\u5728\u66f4\u65b0\u7ed3\u679c\u4e2d\uff0c\u6709\u4e00\u79cd\u6570\u636e\u7c7b\u578b\u8fdb\u884c\u4e86\u66f4\u65b0\uff0c\u5c31\u8868\u793a\u6b64\u6b21\u64cd\u4f5c\u53d1\u751f\u4e86\u66f4\u65b0\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},"    public boolean executor(final JsonObject data) {\n        //\u5e76\u884c\u66f4\u65b0\u6570\u636e\n        List<Boolean> result = ENUM_MAP.values().parallelStream()\n                .map(dataRefresh -> dataRefresh.refresh(data))\n                .collect(Collectors.toList());\n        //\u6709\u4e00\u4e2a\u66f4\u65b0\u5c31\u8868\u793a\u6b64\u6b21\u53d1\u751f\u4e86\u66f4\u65b0\u64cd\u4f5c\n        return result.stream().anyMatch(Boolean.TRUE::equals);\n    }\n")),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"AbstractDataRefresh#refresh()")),(0,i.yg)("p",null,"\u6570\u636e\u66f4\u65b0\u903b\u8f91\u91c7\u7528\u7684\u662f\u6a21\u677f\u65b9\u6cd5\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u901a\u7528\u64cd\u4f5c\u5728\u62bd\u8c61\u65b9\u6cd5\u4e2d\u5b8c\u6210\uff0c\u4e0d\u540c\u7684\u5b9e\u73b0\u903b\u8f91\u7531\u5b50\u7c7b\u5b8c\u6210\u30025\u79cd\u6570\u636e\u7c7b\u578b\u5177\u4f53\u7684\u66f4\u65b0\u903b\u8f91\u6709\u4e9b\u5dee\u5f02\uff0c\u4f46\u662f\u4e5f\u5b58\u5728\u901a\u7528\u7684\u66f4\u65b0\u903b\u8f91\uff0c\u7c7b\u56fe\u5173\u7cfb\u5982\u4e0b\uff1a"),(0,i.yg)("p",null,(0,i.yg)("img",{src:t(19093).A})),(0,i.yg)("p",null,"\u5728\u901a\u7528\u7684",(0,i.yg)("inlineCode",{parentName:"p"},"refresh()"),"\u65b9\u6cd5\u4e2d\uff0c\u8d1f\u8d23\u6570\u636e\u7c7b\u578b\u8f6c\u6362\uff0c\u5224\u65ad\u662f\u5426\u9700\u8981\u66f4\u65b0\uff0c\u548c\u5b9e\u9645\u7684\u6570\u636e\u5237\u65b0\u64cd\u4f5c\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},"public abstract class AbstractDataRefresh<T> implements DataRefresh {\n\n  // ......\n\n  @Override\n  public Boolean refresh(final JsonObject data) {\n    // \u6570\u636e\u7c7b\u578b\u8f6c\u6362\n    JsonObject jsonObject = convert(data);\n    if (Objects.isNull(jsonObject)) {\n      return false;\n    }\n\n    boolean updated = false;\n    // \u5f97\u5230\u6570\u636e\u7c7b\u578b\n    ConfigData<T> result = fromJson(jsonObject);\n    // \u662f\u5426\u9700\u8981\u66f4\u65b0\n    if (this.updateCacheIfNeed(result)) {\n      updated = true;\n      // \u771f\u6b63\u7684\u66f4\u65b0\u903b\u8f91\uff0c\u6570\u636e\u5237\u65b0\u64cd\u4f5c\n      refresh(result.getData());\n    }\n\n    return updated;\n  }\n\n  // ......\n}\n")),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"AbstractDataRefresh#updateCacheIfNeed()")),(0,i.yg)("p",null,"\u6570\u636e\u8f6c\u6362\u7684\u8fc7\u7a0b\uff0c\u5c31\u662f\u6839\u636e\u4e0d\u540c\u7684\u6570\u636e\u7c7b\u578b\u8fdb\u884c\u8f6c\u6362\uff0c\u6211\u4eec\u5c31\u4e0d\u518d\u8fdb\u4e00\u6b65\u8ffd\u8e2a\u4e86\uff0c\u770b\u770b\u6570\u636e\u662f\u5426\u9700\u8981\u66f4\u65b0\u7684\u903b\u8f91\u3002\u65b9\u6cd5\u540d\u662f",(0,i.yg)("inlineCode",{parentName:"p"},"updateCacheIfNeed()"),"\uff0c\u901a\u8fc7\u65b9\u6cd5\u91cd\u8f7d\u5b9e\u73b0\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},'public abstract class AbstractDataRefresh<T> implements DataRefresh {\n\n  // ......\n\n  // result\u662f\u6570\u636e\n  protected abstract boolean updateCacheIfNeed(ConfigData<T> result);\n\n  // newVal\u662f\u83b7\u53d6\u5230\u7684\u6700\u65b0\u7684\u503c\n  // groupEnum \u662f\u54ea\u79cd\u6570\u636e\u7c7b\u578b\n  protected boolean updateCacheIfNeed(final ConfigData<T> newVal, final ConfigGroupEnum groupEnum) {\n    // \u5982\u679c\u662f\u7b2c\u4e00\u6b21\uff0c\u90a3\u4e48\u76f4\u63a5\u653e\u5230cache\u4e2d\uff0c\u8fd4\u56de true\uff0c\u8868\u793a\u6b64\u6b21\u8fdb\u884c\u4e86\u66f4\u65b0\n    if (GROUP_CACHE.putIfAbsent(groupEnum, newVal) == null) {\n      return true;\n    }\n    ResultHolder holder = new ResultHolder(false);\n    GROUP_CACHE.merge(groupEnum, newVal, (oldVal, value) -> {\n      // md5 \u503c\u76f8\u540c\uff0c\u4e0d\u9700\u8981\u66f4\u65b0\n      if (StringUtils.equals(oldVal.getMd5(), newVal.getMd5())) {\n        LOG.info("Get the same config, the [{}] config cache will not be updated, md5:{}", groupEnum, oldVal.getMd5());\n        return oldVal;\n      }\n\n      // \u5f53\u524d\u7f13\u5b58\u7684\u6570\u636e\u4fee\u6539\u65f6\u95f4\u5927\u4e8e \u65b0\u6765\u7684\u6570\u636e\uff0c\u4e0d\u9700\u8981\u66f4\u65b0\n      // must compare the last update time\n      if (oldVal.getLastModifyTime() >= newVal.getLastModifyTime()) {\n        LOG.info("Last update time earlier than the current configuration, the [{}] config cache will not be updated", groupEnum);\n        return oldVal;\n      }\n      LOG.info("update {} config: {}", groupEnum, newVal);\n      holder.result = true;\n      return newVal;\n    });\n    return holder.result;\n  }\n\n  // ......\n}\n')),(0,i.yg)("p",null,"\u4ece\u4e0a\u9762\u7684\u6e90\u7801\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u6709\u4e24\u79cd\u60c5\u51b5\u4e0d\u9700\u8981\u66f4\u65b0\uff1a"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"\u4e24\u4e2a\u7684\u6570\u636e\u7684",(0,i.yg)("inlineCode",{parentName:"li"},"md5")," \u503c\u76f8\u540c\uff0c\u4e0d\u9700\u8981\u66f4\u65b0;"),(0,i.yg)("li",{parentName:"ul"},"\u5f53\u524d\u7f13\u5b58\u7684\u6570\u636e\u4fee\u6539\u65f6\u95f4\u5927\u4e8e \u65b0\u6765\u7684\u6570\u636e\uff0c\u4e0d\u9700\u8981\u66f4\u65b0\u3002")),(0,i.yg)("p",null,"\u5176\u4ed6\u60c5\u51b5\u9700\u8981\u66f4\u65b0\u6570\u636e\u3002"),(0,i.yg)("p",null,"\u5206\u6790\u5230\u8fd9\u91cc\uff0c\u5c31\u5c06",(0,i.yg)("inlineCode",{parentName:"p"},"start()")," \u65b9\u6cd5\u4e2d\u521d\u6b21\u542f\u52a8\uff0c\u83b7\u53d6\u5168\u91cf\u6570\u636e\u7684\u903b\u8f91\u5206\u6790\u5b8c\u4e86\uff0c\u63a5\u4e0b\u6765\u662f\u957f\u8f6e\u8be2\u7684\u64cd\u4f5c\u3002\u4e3a\u4e86\u65b9\u4fbf\uff0c\u6211\u5c06",(0,i.yg)("inlineCode",{parentName:"p"},"start()"),"\u65b9\u6cd5\u518d\u7c98\u8d34\u4e00\u6b21\uff1a"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},'public class HttpSyncDataService implements SyncDataService {\n\n  // ......\n\n  private void start() {\n    // // \u53ea\u521d\u59cb\u5316\u4e00\u6b21\uff0c\u901a\u8fc7\u539f\u5b50\u7c7b\u5b9e\u73b0\u3002 \n    if (RUNNING.compareAndSet(false, true)) {\n      // \u521d\u6b21\u542f\u52a8\uff0c\u83b7\u53d6\u5168\u91cf\u6570\u636e\n      this.fetchGroupConfig(ConfigGroupEnum.values());\n      // \u4e00\u4e2a\u540e\u53f0\u670d\u52a1\uff0c\u4e00\u4e2a\u7ebf\u7a0b\n      int threadSize = serverList.size();\n      // \u81ea\u5b9a\u4e49\u7ebf\u7a0b\u6c60\n      this.executor = new ThreadPoolExecutor(threadSize, threadSize, 60L, TimeUnit.SECONDS,\n              new LinkedBlockingQueue<>(),\n              ShenyuThreadFactory.create("http-long-polling", true));\n      // \u5f00\u59cb\u957f\u8f6e\u8be2\uff0c\u4e00\u4e2aadmin\u670d\u52a1\uff0c\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\u7528\u4e8e\u6570\u636e\u540c\u6b65\n      this.serverList.forEach(server -> this.executor.execute(new HttpLongPollingTask(server)));\n    } else {\n      LOG.info("shenyu http long polling was started, executor=[{}]", executor);\n    }\n  }\n\n  // ......\n}\n')),(0,i.yg)("h5",{id:"232-\u6267\u884c\u957f\u8f6e\u8be2\u4efb\u52a1"},"2.3.2 \u6267\u884c\u957f\u8f6e\u8be2\u4efb\u52a1"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"HttpLongPollingTask#run()")),(0,i.yg)("p",null,"\u957f\u8f6e\u8be2\u4efb\u52a1\u662f",(0,i.yg)("inlineCode",{parentName:"p"},"HttpLongPollingTask"),"\uff0c\u5b83\u5b9e\u73b0\u4e86",(0,i.yg)("inlineCode",{parentName:"p"},"Runnable"),"\u63a5\u53e3\uff0c\u4efb\u52a1\u903b\u8f91\u5728",(0,i.yg)("inlineCode",{parentName:"p"},"run()"),"\u65b9\u6cd5\u4e2d\u3002\u901a\u8fc7",(0,i.yg)("inlineCode",{parentName:"p"},"while()"),"\u5faa\u73af\u5b9e\u73b0\u4e0d\u65ad\u6267\u884c\u4efb\u52a1\uff0c\u5373\u957f\u8f6e\u8be2\u3002\u5728\u6bcf\u4e00\u6b21\u7684\u8f6e\u8be2\u4e2d\u6709\u4e09\u6b21\u91cd\u8bd5\u903b\u8f91\uff0c\u4e00\u6b21\u8f6e\u8be2\u4efb\u52a1\u5931\u8d25\u4e86\uff0c\u7b49 ",(0,i.yg)("inlineCode",{parentName:"p"},"5s")," \u518d\u7ee7\u7eed\uff0c",(0,i.yg)("inlineCode",{parentName:"p"},"3")," \u6b21\u90fd\u5931\u8d25\u4e86\uff0c\u7b49",(0,i.yg)("inlineCode",{parentName:"p"},"5")," \u5206\u949f\u518d\u8bd5\u3002"),(0,i.yg)("p",null,"\u5f00\u59cb\u957f\u8f6e\u8be2\uff0c\u4e00\u4e2a",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u670d\u52a1\uff0c\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\u7528\u4e8e\u6570\u636e\u540c\u6b65\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},'class HttpLongPollingTask implements Runnable {\n\n  private final String server;\n\n  HttpLongPollingTask(final String server) {\n    this.server = server;\n  }\n\n  @Override\n  public void run() {\n    // \u4e00\u76f4\u8f6e\u8be2\n    while (RUNNING.get()) {\n      // \u9ed8\u8ba4\u91cd\u8bd5 3 \u6b21\n      int retryTimes = 3;\n      for (int time = 1; time <= retryTimes; time++) {\n        try {\n          doLongPolling(server);\n        } catch (Exception e) {\n          if (time < retryTimes) {\n            LOG.warn("Long polling failed, tried {} times, {} times left, will be suspended for a while! {}",\n                    time, retryTimes - time, e.getMessage());\n            // \u957f\u8f6e\u8be2\u5931\u8d25\u4e86\uff0c\u7b49 5s \u518d\u7ee7\u7eed\n            ThreadUtils.sleep(TimeUnit.SECONDS, 5);\n            continue;\n          }\n          LOG.error("Long polling failed, try again after 5 minutes!", e);\n          // 3 \u6b21\u90fd\u5931\u8d25\u4e86\uff0c\u7b49 5 \u5206\u949f\u518d\u8bd5\n          ThreadUtils.sleep(TimeUnit.MINUTES, 5);\n        }\n      }\n    }\n    LOG.warn("Stop http long polling.");\n  }\n}\n')),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"HttpSyncDataService#doLongPolling()")),(0,i.yg)("p",null,"\u6267\u884c\u957f\u8f6e\u8be2\u4efb\u52a1\u7684\u6838\u5fc3\u903b\u8f91\uff1a"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"\u6839\u636e\u6570\u636e\u7c7b\u578b\u7ec4\u88c5\u8bf7\u6c42\u53c2\u6570\uff1a",(0,i.yg)("inlineCode",{parentName:"li"},"md5")," \u548c ",(0,i.yg)("inlineCode",{parentName:"li"},"lastModifyTime"),"\uff1b"),(0,i.yg)("li",{parentName:"ul"},"\u7ec4\u88c5\u8bf7\u6c42\u5934\u548c\u8bf7\u6c42\u4f53\uff1b"),(0,i.yg)("li",{parentName:"ul"},"\u5411",(0,i.yg)("inlineCode",{parentName:"li"},"admin"),"\u53d1\u8d77\u8bf7\u6c42\uff0c\u5224\u65ad\u7ec4\u6570\u636e\u662f\u5426\u53d1\u751f\u53d8\u66f4\uff1b"),(0,i.yg)("li",{parentName:"ul"},"\u6839\u636e\u53d1\u751f\u53d8\u66f4\u7684\u7ec4\uff0c\u518d\u53bb\u83b7\u53d6\u6570\u636e\u3002")),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},'public class HttpSyncDataService implements SyncDataService {\n  private void doLongPolling(final String server) {\n    // \u7ec4\u88c5\u8bf7\u6c42\u53c2\u6570\uff1amd5 \u548c lastModifyTime\n    MultiValueMap<String, String> params = new LinkedMultiValueMap<>(8);\n    for (ConfigGroupEnum group : ConfigGroupEnum.values()) {\n      ConfigData<?> cacheConfig = factory.cacheConfigData(group);\n      if (cacheConfig != null) {\n        String value = String.join(",", cacheConfig.getMd5(), String.valueOf(cacheConfig.getLastModifyTime()));\n        params.put(group.name(), Lists.newArrayList(value));\n      }\n    }\n    // \u7ec4\u88c5\u8bf7\u6c42\u5934\u548c\u8bf7\u6c42\u4f53\n    HttpHeaders headers = new HttpHeaders();\n    headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);\n    // \u8bbe\u7f6eaccessToken\n    headers.set(Constants.X_ACCESS_TOKEN, this.accessTokenManager.getAccessToken());\n    HttpEntity<MultiValueMap<String, String>> httpEntity = new HttpEntity<>(params, headers);\n    String listenerUrl = server + Constants.SHENYU_ADMIN_PATH_CONFIGS_LISTENER;\n\n    JsonArray groupJson;\n    //\u5411admin\u53d1\u8d77\u8bf7\u6c42\uff0c\u5224\u65ad\u7ec4\u6570\u636e\u662f\u5426\u53d1\u751f\u53d8\u66f4\n    //\u8fd9\u91cc\u53ea\u662f\u5224\u65ad\u4e86\u67d0\u4e2a\u7ec4\u662f\u5426\u53d1\u751f\u53d8\u66f4\n    try {\n      String json = this.restTemplate.postForEntity(listenerUrl, httpEntity, String.class).getBody();\n      LOG.info("listener result: [{}]", json);\n      JsonObject responseFromServer = GsonUtils.getGson().fromJson(json, JsonObject.class);\n      groupJson = responseFromServer.getAsJsonArray("data");\n    } catch (RestClientException e) {\n      String message = String.format("listener configs fail, server:[%s], %s", server, e.getMessage());\n      throw new ShenyuException(message, e);\n    }\n    // \u6839\u636e\u53d1\u751f\u53d8\u66f4\u7684\u7ec4\uff0c\u518d\u53bb\u83b7\u53d6\u6570\u636e\n    /**\n     * \u5b98\u7f51\u5bf9\u6b64\u5904\u7684\u89e3\u91ca\uff1a\n     * \u7f51\u5173\u6536\u5230\u54cd\u5e94\u4fe1\u606f\u4e4b\u540e\uff0c\u53ea\u77e5\u9053\u662f\u54ea\u4e2a Group \u53d1\u751f\u4e86\u914d\u7f6e\u53d8\u66f4\uff0c\u8fd8\u9700\u8981\u518d\u6b21\u8bf7\u6c42\u8be5 Group \u7684\u914d\u7f6e\u6570\u636e\u3002\n     * \u8fd9\u91cc\u53ef\u80fd\u4f1a\u5b58\u5728\u4e00\u4e2a\u7591\u95ee\uff1a\u4e3a\u4ec0\u4e48\u4e0d\u662f\u76f4\u63a5\u5c06\u53d8\u66f4\u7684\u6570\u636e\u5199\u51fa\uff1f\n     * \u6211\u4eec\u5728\u5f00\u53d1\u7684\u65f6\u5019\uff0c\u4e5f\u6df1\u5165\u8ba8\u8bba\u8fc7\u8be5\u95ee\u9898\uff0c\u56e0\u4e3a http \u957f\u8f6e\u8be2\u673a\u5236\u53ea\u80fd\u4fdd\u8bc1\u51c6\u5b9e\u65f6\uff0c\u5982\u679c\u5728\u7f51\u5173\u5c42\u5904\u7406\u4e0d\u53ca\u65f6\uff0c\n     * \u6216\u8005\u7ba1\u7406\u5458\u9891\u7e41\u66f4\u65b0\u914d\u7f6e\uff0c\u5f88\u6709\u53ef\u80fd\u4fbf\u9519\u8fc7\u4e86\u67d0\u4e2a\u914d\u7f6e\u53d8\u66f4\u7684\u63a8\u9001\uff0c\u5b89\u5168\u8d77\u89c1\uff0c\u6211\u4eec\u53ea\u544a\u77e5\u67d0\u4e2a Group \u4fe1\u606f\u53d1\u751f\u4e86\u53d8\u66f4\u3002\n     *\n     * \u4e2a\u4eba\u7406\u89e3\uff1a\n     * \u5982\u679c\u5c06\u53d8\u66f4\u6570\u636e\u76f4\u63a5\u5199\u51fa\uff0c\u5f53\u7ba1\u7406\u5458\u9891\u7e41\u66f4\u65b0\u914d\u7f6e\u65f6\uff0c\u7b2c\u4e00\u6b21\u66f4\u65b0\u4e86\uff0c\u5c06client\u79fb\u9664\u963b\u585e\u961f\u5217\uff0c\u8fd4\u56de\u54cd\u5e94\u4fe1\u606f\u7ed9\u7f51\u5173\u3002\n     * \u5982\u679c\u8fd9\u4e2a\u65f6\u5019\u8fdb\u884c\u4e86\u7b2c\u4e8c\u6b21\u66f4\u65b0\uff0c\u90a3\u4e48\u5f53\u524d\u7684client\u662f\u4e0d\u5728\u963b\u585e\u961f\u5217\u4e2d\uff0c\u6240\u4ee5\u8fd9\u4e00\u6b21\u7684\u53d8\u66f4\u5c31\u4f1a\u9519\u8fc7\u3002\n     * \u7f51\u5173\u5c42\u5904\u7406\u4e0d\u53ca\u65f6\uff0c\u4e5f\u662f\u540c\u7406\u3002\n     * \u8fd9\u662f\u4e00\u4e2a\u957f\u8f6e\u8be2\uff0c\u4e00\u4e2a\u7f51\u5173\u4e00\u4e2a\u540c\u6b65\u7ebf\u7a0b\uff0c\u53ef\u80fd\u5b58\u5728\u8017\u65f6\u7684\u8fc7\u7a0b\u3002\n     * \u5982\u679cadmin\u6709\u6570\u636e\u53d8\u66f4\uff0c\u5f53\u524d\u7f51\u5173client\u662f\u6ca1\u6709\u5728\u963b\u585e\u961f\u5217\u4e2d\uff0c\u5c31\u4e0d\u5230\u6570\u636e\u3002\n     */\n    if (Objects.nonNull(groupJson) && groupJson.size() > 0) {\n      // fetch group configuration async.\n      ConfigGroupEnum[] changedGroups = GsonUtils.getGson().fromJson(groupJson, ConfigGroupEnum[].class);\n      LOG.info("Group config changed: {}", Arrays.toString(changedGroups));\n      this.doFetchGroupConfig(server, changedGroups);\n    }\n  }\n}\n')),(0,i.yg)("p",null,"\u8fd9\u91cc\u9700\u8981\u7279\u522b\u89e3\u91ca\u4e00\u70b9\u7684\u662f\uff1a\u5728\u957f\u8f6e\u8be2\u4efb\u52a1\u4e2d\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u62ff\u5230\u53d8\u66f4\u7684\u6570\u636e\uff1f\u800c\u662f\u5148\u5224\u65ad\u54ea\u4e2a\u5206\u7ec4\u6570\u636e\u53d1\u751f\u4e86\u53d8\u66f4\uff0c\u7136\u540e\u518d\u6b21\u8bf7\u6c42",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\uff0c\u83b7\u53d6\u53d8\u66f4\u6570\u636e\uff1f"),(0,i.yg)("p",null,"\u5b98\u7f51\u5bf9\u6b64\u5904\u7684\u89e3\u91ca\u662f\uff1a"),(0,i.yg)("blockquote",null,(0,i.yg)("p",{parentName:"blockquote"},"\u7f51\u5173\u6536\u5230\u54cd\u5e94\u4fe1\u606f\u4e4b\u540e\uff0c\u53ea\u77e5\u9053\u662f\u54ea\u4e2a Group \u53d1\u751f\u4e86\u914d\u7f6e\u53d8\u66f4\uff0c\u8fd8\u9700\u8981\u518d\u6b21\u8bf7\u6c42\u8be5 Group \u7684\u914d\u7f6e\u6570\u636e\u3002\n\u8fd9\u91cc\u53ef\u80fd\u4f1a\u5b58\u5728\u4e00\u4e2a\u7591\u95ee\uff1a\u4e3a\u4ec0\u4e48\u4e0d\u662f\u76f4\u63a5\u5c06\u53d8\u66f4\u7684\u6570\u636e\u5199\u51fa\uff1f\n\u6211\u4eec\u5728\u5f00\u53d1\u7684\u65f6\u5019\uff0c\u4e5f\u6df1\u5165\u8ba8\u8bba\u8fc7\u8be5\u95ee\u9898\uff0c\u56e0\u4e3a ",(0,i.yg)("inlineCode",{parentName:"p"},"http")," \u957f\u8f6e\u8be2\u673a\u5236\u53ea\u80fd\u4fdd\u8bc1\u51c6\u5b9e\u65f6\uff0c\u5982\u679c\u5728\u7f51\u5173\u5c42\u5904\u7406\u4e0d\u53ca\u65f6\uff0c\n\u6216\u8005\u7ba1\u7406\u5458\u9891\u7e41\u66f4\u65b0\u914d\u7f6e\uff0c\u5f88\u6709\u53ef\u80fd\u4fbf\u9519\u8fc7\u4e86\u67d0\u4e2a\u914d\u7f6e\u53d8\u66f4\u7684\u63a8\u9001\uff0c\u5b89\u5168\u8d77\u89c1\uff0c\u6211\u4eec\u53ea\u544a\u77e5\u67d0\u4e2a Group \u4fe1\u606f\u53d1\u751f\u4e86\u53d8\u66f4\u3002")),(0,i.yg)("p",null,"\u4e2a\u4eba\u7406\u89e3\u662f\uff1a"),(0,i.yg)("blockquote",null,(0,i.yg)("p",{parentName:"blockquote"},"\u5982\u679c\u5c06\u53d8\u66f4\u6570\u636e\u76f4\u63a5\u5199\u51fa\uff0c\u7ba1\u7406\u5458\u9891\u7e41\u66f4\u65b0\u914d\u7f6e\u65f6\uff0c\u7b2c\u4e00\u6b21\u66f4\u65b0\u4e86\uff0c\u5c06",(0,i.yg)("inlineCode",{parentName:"p"},"client"),"\u79fb\u9664\u963b\u585e\u961f\u5217\uff0c\u8fd4\u56de\u54cd\u5e94\u4fe1\u606f\u7ed9\u7f51\u5173\u3002\u5982\u679c\u8fd9\u4e2a\u65f6\u5019\u8fdb\u884c\u4e86\u7b2c\u4e8c\u6b21\u66f4\u65b0\uff0c\u90a3\u4e48\u5f53\u524d\u7684",(0,i.yg)("inlineCode",{parentName:"p"},"client"),"\u662f\u4e0d\u5728\u963b\u585e\u961f\u5217\u4e2d\uff0c\u6240\u4ee5\u8fd9\u4e00\u6b21\u7684\u53d8\u66f4\u5c31\u4f1a\u9519\u8fc7\u3002\u7f51\u5173\u5c42\u5904\u7406\u4e0d\u53ca\u65f6\uff0c\u4e5f\u662f\u540c\u7406\u3002 \u8fd9\u662f\u4e00\u4e2a\u957f\u8f6e\u8be2\uff0c\u4e00\u4e2a\u7f51\u5173\u4e00\u4e2a\u540c\u6b65\u7ebf\u7a0b\uff0c\u53ef\u80fd\u5b58\u5728\u8017\u65f6\u7684\u8fc7\u7a0b\u3002\u5982\u679c",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u6709\u6570\u636e\u53d8\u66f4\uff0c\u5f53\u524d\u7f51\u5173client\u662f\u6ca1\u6709\u5728\u963b\u585e\u961f\u5217\u4e2d\uff0c\u5c31\u4f1a\u66f4\u65b0\u4e0d\u5230\u6570\u636e\u3002")),(0,i.yg)("p",null,"\u6211\u4eec\u8fd8\u6ca1\u6709\u5206\u6790\u5230",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u7aef\u7684\u5904\u7406\u903b\u8f91\uff0c\u5148\u5927\u6982\u8bf4\u4e00\u4e0b\u3002\u5728",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u7aef\uff0c\u4f1a\u5c06\u7f51\u5173",(0,i.yg)("inlineCode",{parentName:"p"},"client"),"\u653e\u5230\u963b\u585e\u961f\u5217\uff0c\u6709\u6570\u636e\u53d8\u66f4\uff0c\u7f51\u5173",(0,i.yg)("inlineCode",{parentName:"p"},"client"),"\u5c31\u4f1a\u51fa\u961f\u5217\uff0c\u53d1\u9001\u53d8\u66f4\u6570\u636e\u3002\u6240\u4ee5\uff0c\u5982\u679c\u6709\u6570\u636e\u53d8\u66f4\u65f6\uff0c\u7f51\u5173",(0,i.yg)("inlineCode",{parentName:"p"},"client"),"\u4e0d\u5728\u963b\u585e\u961f\u5217\uff0c\u90a3\u4e48\u5c31\u65e0\u6cd5\u5f97\u5230\u5f53\u524d\u53d8\u66f4\u7684\u6570\u636e\u3002"),(0,i.yg)("p",null,"\u77e5\u9053\u54ea\u4e2a\u5206\u7ec4\u6570\u636e\u53d1\u751f\u53d8\u66f4\u65f6\uff0c\u4e3b\u52a8\u518d\u5411",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u83b7\u53d6\u53d8\u66f4\u7684\u6570\u636e\uff0c\u6839\u636e\u5206\u7ec4\u4e0d\u540c\uff0c\u5168\u91cf\u62ff\u6570\u636e\u3002\u8c03\u7528\u65b9\u6cd5\u662f",(0,i.yg)("inlineCode",{parentName:"p"},"doFetchGroupConfig()"),"\uff0c\u8fd9\u4e2a\u5728\u524d\u9762\u5df2\u7ecf\u5206\u6790\u8fc7\u4e86\u3002"),(0,i.yg)("p",null,"\u5206\u6790\u5230\u8fd9\u91cc\uff0c\u7f51\u5173\u7aef\u7684\u6570\u636e\u540c\u6b65\u64cd\u4f5c\u5c31\u5b8c\u6210\u4e86\u3002\u957f\u8f6e\u8be2\u4efb\u52a1\u5c31\u662f\u4e0d\u65ad\u5411",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u53d1\u8d77\u8bf7\u6c42\uff0c\u770b\u770b\u6570\u636e\u662f\u5426\u53d1\u751f\u53d8\u66f4\uff0c\u5982\u679c\u6709\u5206\u7ec4\u6570\u636e\u53d1\u751f\u53d8\u66f4\uff0c\u90a3\u4e48\u5c31\u518d\u4e3b\u52a8\u5411",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u53d1\u8d77\u8bf7\u6c42\uff0c\u83b7\u53d6\u53d8\u66f4\u6570\u636e\uff0c\u7136\u540e\u66f4\u65b0\u7f51\u5173\u5185\u5b58\u4e2d\u7684\u6570\u636e\u3002"),(0,i.yg)("p",null,"\u7f51\u5173\u7aef\u957f\u8f6e\u8be2\u4efb\u52a1\u6d41\u7a0b\uff1a"),(0,i.yg)("p",null,(0,i.yg)("img",{src:t(45127).A})),(0,i.yg)("h3",{id:"3-admin\u6570\u636e\u540c\u6b65"},"3. admin\u6570\u636e\u540c\u6b65"),(0,i.yg)("p",null,"\u4ece\u524d\u9762\u5206\u6790\u7684\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u7f51\u5173\u7aef\u4e3b\u8981\u8c03\u7528",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u7684\u4e24\u4e2a\u63a5\u53e3\uff1a"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"/configs/listener"),"\uff1a\u5224\u65ad\u7ec4\u6570\u636e\u662f\u5426\u53d1\u751f\u53d8\u66f4\uff1b"),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"/configs/fetch"),"\uff1a\u83b7\u53d6\u53d8\u66f4\u7ec4\u6570\u636e\u3002")),(0,i.yg)("p",null,"\u76f4\u63a5\u4ece\u8fd9\u4e24\u4e2a\u63a5\u53e3\u5206\u6790\u7684\u8bdd\uff0c\u53ef\u80fd\u6709\u7684\u5730\u65b9\u4e0d\u597d\u7406\u89e3\uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u662f\u4ece",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u542f\u52a8\u6d41\u7a0b\u5f00\u59cb\u5206\u6790\u6570\u636e\u540c\u6b65\u8fc7\u7a0b\u3002"),(0,i.yg)("h4",{id:"31-\u52a0\u8f7d\u914d\u7f6e"},"3.1 \u52a0\u8f7d\u914d\u7f6e"),(0,i.yg)("p",null,"\u5982\u679c\u5728\u914d\u7f6e\u6587\u4ef6",(0,i.yg)("inlineCode",{parentName:"p"},"application.yml"),"\u4e2d\uff0c\u8fdb\u884c\u4e86\u5982\u4e0b\u914d\u7f6e\uff0c\u5c31\u8868\u793a\u901a\u8fc7",(0,i.yg)("inlineCode",{parentName:"p"},"http\u957f\u8f6e\u8be2"),"\u7684\u65b9\u5f0f\u8fdb\u884c\u6570\u636e\u540c\u6b65\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-yaml"},"shenyu:\n  sync:\n      http:\n        enabled: true\n")),(0,i.yg)("p",null,"\u7a0b\u5e8f\u542f\u52a8\u65f6\uff0c\u901a\u8fc7",(0,i.yg)("inlineCode",{parentName:"p"},"springboot"),"\u6761\u4ef6\u88c5\u914d\u5b9e\u73b0\u6570\u636e\u540c\u6b65\u7c7b\u7684\u914d\u7f6e\u52a0\u8f7d\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u521b\u5efa",(0,i.yg)("inlineCode",{parentName:"p"},"HttpLongPollingDataChangedListener"),"\uff0c\u8d1f\u8d23\u5904\u7406\u957f\u8f6e\u8be2\u7684\u76f8\u5173\u5b9e\u73b0\u903b\u8f91\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},'/**\n * \u6570\u636e\u540c\u6b65\u914d\u7f6e\u7c7b\n * \u901a\u8fc7springboot\u6761\u4ef6\u88c5\u914d\u5b9e\u73b0\n * The type Data sync configuration.\n */\n@Configuration\npublic class DataSyncConfiguration {\n\n    /**\n     * http\u957f\u8f6e\u8be2\n     * http long polling.\n     */\n    @Configuration\n    @ConditionalOnProperty(name = "shenyu.sync.http.enabled", havingValue = "true")\n    @EnableConfigurationProperties(HttpSyncProperties.class)\n    static class HttpLongPollingListener {\n\n        @Bean\n        @ConditionalOnMissingBean(HttpLongPollingDataChangedListener.class)\n        public HttpLongPollingDataChangedListener httpLongPollingDataChangedListener(final HttpSyncProperties httpSyncProperties) {\n            return new HttpLongPollingDataChangedListener(httpSyncProperties);\n        }\n    }\n}\n')),(0,i.yg)("h4",{id:"32-\u6570\u636e\u53d8\u66f4\u76d1\u542c\u5668\u5b9e\u4f8b\u5316"},"3.2 \u6570\u636e\u53d8\u66f4\u76d1\u542c\u5668\u5b9e\u4f8b\u5316"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"HttpLongPollingDataChangedListener")),(0,i.yg)("p",null,"\u6570\u636e\u53d8\u66f4\u76d1\u542c\u5668\u901a\u8fc7\u6784\u9020\u51fd\u6570\u7684\u65b9\u5f0f\u5b8c\u6210\u5b9e\u4f8b\u5316\u548c\u521d\u59cb\u5316\u64cd\u4f5c\u3002\u5728\u6784\u9020\u51fd\u6570\u4e2d\u4f1a\u521b\u5efa\u963b\u585e\u961f\u5217\uff0c\u7528\u4e8e\u5b58\u653e\u5ba2\u6237\u7aef\uff1b\u521b\u5efa\u7ebf\u7a0b\u6c60\uff0c\u7528\u4e8e\u6267\u884c\u5ef6\u8fdf\u4efb\u52a1\uff0c\u5468\u671f\u4efb\u52a1\uff1b\u4fdd\u5b58\u957f\u8f6e\u8be2\u76f8\u5173\u5c5e\u6027\u4fe1\u606f\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},'    public HttpLongPollingDataChangedListener(final HttpSyncProperties httpSyncProperties) {\n        // \u9ed8\u8ba4\u5ba2\u6237\u7aef\uff08\u8fd9\u91cc\u662f\u7f51\u5173\uff091024\u4e2a\n        this.clients = new ArrayBlockingQueue<>(1024);\n        // \u521b\u5efa\u7ebf\u7a0b\u6c60\n        // ScheduledThreadPoolExecutor \u53ef\u4ee5\u6267\u884c\u5ef6\u8fdf\u4efb\u52a1\uff0c\u5468\u671f\u4efb\u52a1\uff0c\u666e\u901a\u4efb\u52a1\n        this.scheduler = new ScheduledThreadPoolExecutor(1,\n                ShenyuThreadFactory.create("long-polling", true));\n        // \u957f\u8f6e\u8be2\u7684\u5c5e\u6027\u4fe1\u606f\n        this.httpSyncProperties = httpSyncProperties;\n    }\n')),(0,i.yg)("p",null,"\u53e6\u5916\uff0c\u5b83\u7684\u7c7b\u56fe\u5173\u7cfb\u5982\u4e0b\uff1a"),(0,i.yg)("p",null,(0,i.yg)("img",{src:t(77875).A})),(0,i.yg)("p",null,"\u5b9e\u73b0\u4e86",(0,i.yg)("inlineCode",{parentName:"p"},"InitializingBean"),"\u63a5\u53e3\uff0c\u6240\u4ee5\u5728",(0,i.yg)("inlineCode",{parentName:"p"},"bean"),"\u7684\u521d\u59cb\u5316\u8fc7\u7a0b\u4e2d\u6267\u884c",(0,i.yg)("inlineCode",{parentName:"p"},"afterInitialize()"),"\u65b9\u6cd5\u3002\u901a\u8fc7\u7ebf\u7a0b\u6c60\u6267\u884c\u5468\u671f\u4efb\u52a1\uff1a\u66f4\u65b0\u5185\u5b58\u4e2d",(0,i.yg)("inlineCode",{parentName:"p"},"\uff08CACHE\uff09"),"\u7684\u6570\u636e\u6bcf\u9694",(0,i.yg)("inlineCode",{parentName:"p"},"5"),"\u5206\u949f\u6267\u884c\u4e00\u6b21\uff0c",(0,i.yg)("inlineCode",{parentName:"p"},"5"),"\u5206\u949f\u540e\u5f00\u59cb\u6267\u884c\u3002\u5237\u65b0\u672c\u5730\u7f13\u5b58\u5c31\u662f\u4ece\u6570\u636e\u5e93\u8bfb\u53d6\u6570\u636e\u5230\u672c\u5730\u7f13\u5b58\uff08\u8fd9\u91cc\u5c31\u662f\u5185\u5b58\uff09\uff0c\u901a\u8fc7",(0,i.yg)("inlineCode",{parentName:"p"},"refreshLocalCache()"),"\u5b8c\u6210\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},'public class HttpLongPollingDataChangedListener extends AbstractDataChangedListener {\n\n  // ......\n\n  /**\n   * \u5728 InitializingBean\u63a5\u53e3\u4e2d\u7684afterPropertiesSet()\u65b9\u6cd5\u4e2d\u88ab\u8c03\u7528\uff0c\u5373\u5728bean\u7684\u521d\u59cb\u5316\u8fc7\u7a0b\u4e2d\u6267\u884c\n   */\n  @Override\n  protected void afterInitialize() {\n    long syncInterval = httpSyncProperties.getRefreshInterval().toMillis();\n    // \u6267\u884c\u5468\u671f\u4efb\u52a1\uff1a\u66f4\u65b0\u5185\u5b58\u4e2d\uff08CACHE\uff09\u7684\u6570\u636e\u6bcf\u96945\u5206\u949f\u6267\u884c\u4e00\u6b21\uff0c5\u5206\u949f\u540e\u5f00\u59cb\u6267\u884c\n    // \u9632\u6b62admin\u5148\u542f\u52a8\u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u4ea7\u751f\u4e86\u6570\u636e\uff1b\u7136\u540e\u7f51\u5173\u521d\u6b21\u8fde\u63a5\u65f6\uff0c\u6ca1\u6709\u62ff\u5230\u5168\u91cf\u6570\u636e\n    scheduler.scheduleWithFixedDelay(() -> {\n      LOG.info("http sync strategy refresh config start.");\n      try {\n        // \u4ece\u6570\u636e\u5e93\u8bfb\u53d6\u6570\u636e\u5230\u672c\u5730\u7f13\u5b58\uff08\u8fd9\u91cc\u5c31\u662f\u5185\u5b58\uff09\n        this.refreshLocalCache();\n        LOG.info("http sync strategy refresh config success.");\n      } catch (Exception e) {\n        LOG.error("http sync strategy refresh config error!", e);\n      }\n    }, syncInterval, syncInterval, TimeUnit.MILLISECONDS);\n    LOG.info("http sync strategy refresh interval: {}ms", syncInterval);\n  }\n\n  // ......\n}\n')),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"refreshLocalCache()")),(0,i.yg)("p",null,"\u5206\u522b\u5bf95\u79cd\u6570\u636e\u7c7b\u578b\u8fdb\u884c\u66f4\u65b0\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},"public abstract class AbstractDataChangedListener implements DataChangedListener, InitializingBean {\n\n  // ......\n\n  // \u4ece\u6570\u636e\u5e93\u8bfb\u53d6\u6570\u636e\u5230\u672c\u5730\u7f13\u5b58\uff08\u8fd9\u91cc\u5c31\u662f\u5185\u5b58\uff09\n  private void refreshLocalCache() {\n    //\u66f4\u65b0\u8ba4\u8bc1\u6570\u636e\n    this.updateAppAuthCache();\n    //\u66f4\u65b0\u63d2\u4ef6\u6570\u636e\n    this.updatePluginCache();\n    //\u66f4\u65b0\u89c4\u5219\u6570\u636e\n    this.updateRuleCache();\n    //\u66f4\u65b0\u9009\u62e9\u5668\u6570\u636e\n    this.updateSelectorCache();\n    //\u66f4\u65b0\u5143\u6570\u636e\n    this.updateMetaDataCache();\n  }\n\n  // ......\n}\n")),(0,i.yg)("p",null,"5\u4e2a\u66f4\u65b0\u65b9\u6cd5\u7684\u903b\u8f91\u662f\u7c7b\u4f3c\u7684\uff0c\u8c03\u7528",(0,i.yg)("inlineCode",{parentName:"p"},"service"),"\u65b9\u6cd5\u83b7\u53d6\u6570\u636e\uff0c\u7136\u540e\u653e\u5230\u5185\u5b58",(0,i.yg)("inlineCode",{parentName:"p"},"CACHE"),"\u4e2d\u3002\u4ee5\u66f4\u65b0\u89c4\u5219\u6570\u636e\u65b9\u6cd5",(0,i.yg)("inlineCode",{parentName:"p"},"updateRuleCache()"),"\u4e3a\u4f8b\uff0c\u4f20\u5165\u89c4\u5219\u679a\u4e3e\u7c7b\u578b\uff0c\u8c03\u7528",(0,i.yg)("inlineCode",{parentName:"p"},"ruleService.listAll()"),"\u4ece\u6570\u636e\u5e93\u83b7\u53d6\u6240\u6709\u89c4\u5219\u6570\u636e\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},"    /**\n     * Update rule cache.\n     */\n    protected void updateRuleCache() {\n        this.updateCache(ConfigGroupEnum.RULE, ruleService.listAll());\n    }\n")),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"updateCache()")),(0,i.yg)("p",null,"\u4f7f\u7528\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u66f4\u65b0\u5185\u5b58\u4e2d\u7684\u6570\u636e\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},'public abstract class AbstractDataChangedListener implements DataChangedListener, InitializingBean {\n\n  // ......\n\n  // \u7f13\u5b58\u6570\u636e\u7684 Map\n  protected static final ConcurrentMap<String, ConfigDataCache> CACHE = new ConcurrentHashMap<>();\n\n  /**\n   * if md5 is not the same as the original, then update lcoal cache.\n   * \u66f4\u65b0\u7f13\u5b58\u4e2d\u7684\u6570\u636e\n   * @param group ConfigGroupEnum\n   * @param <T> the type of class\n   * @param data the new config data\n   */\n  protected <T> void updateCache(final ConfigGroupEnum group, final List<T> data) {\n    //\u6570\u636e\u5e8f\u5217\u5316\n    String json = GsonUtils.getInstance().toJson(data);\n    //\u4f20\u5165md5\u503c\u548c\u4fee\u6539\u65f6\u95f4\n    ConfigDataCache newVal = new ConfigDataCache(group.name(), json, Md5Utils.md5(json), System.currentTimeMillis());\n    //\u66f4\u65b0\u5206\u7ec4\u6570\u636e\n    ConfigDataCache oldVal = CACHE.put(newVal.getGroup(), newVal);\n    LOG.info("update config cache[{}], old: {}, updated: {}", group, oldVal, newVal);\n  }\n\n  // ......\n}\n')),(0,i.yg)("p",null,"\u521d\u59cb\u5316\u7684\u8fc7\u7a0b\u5c31\u662f\u542f\u52a8\u5468\u671f\u6027\u4efb\u52a1\uff0c\u5b9a\u65f6\u4ece\u6570\u636e\u5e93\u83b7\u53d6\u6570\u636e\u66f4\u65b0\u5185\u5b58\u6570\u636e\u3002"),(0,i.yg)("p",null,"\u63a5\u4e0b\u6765\u5f00\u59cb\u5bf9\u4e24\u4e2a\u63a5\u53e3\u5f00\u59cb\u5206\u6790\uff1a"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"/configs/listener"),"\uff1a\u5224\u65ad\u7ec4\u6570\u636e\u662f\u5426\u53d1\u751f\u53d8\u66f4\uff1b"),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"/configs/fetch"),"\uff1a\u83b7\u53d6\u53d8\u66f4\u7ec4\u6570\u636e\u3002")),(0,i.yg)("h4",{id:"33--\u6570\u636e\u53d8\u66f4\u8f6e\u8be2\u63a5\u53e3"},"3.3  \u6570\u636e\u53d8\u66f4\u8f6e\u8be2\u63a5\u53e3"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"/configs/listener"),"\uff1a\u5224\u65ad\u7ec4\u6570\u636e\u662f\u5426\u53d1\u751f\u53d8\u66f4\uff1b")),(0,i.yg)("p",null,"\u63a5\u53e3\u7c7b\u662f",(0,i.yg)("inlineCode",{parentName:"p"},"ConfigController"),"\uff0c\u53ea\u6709\u4f7f\u7528",(0,i.yg)("inlineCode",{parentName:"p"},"http\u957f\u8f6e\u8be2"),"\u8fdb\u884c\u6570\u636e\u540c\u6b65\u65f6\u624d\u4f1a\u751f\u6548\u3002\u63a5\u53e3\u65b9\u6cd5",(0,i.yg)("inlineCode",{parentName:"p"},"listener()"),"\u6ca1\u6709\u5176\u4ed6\u903b\u8f91\uff0c\u76f4\u63a5\u8c03\u7528",(0,i.yg)("inlineCode",{parentName:"p"},"doLongPolling()"),"\u65b9\u6cd5\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},'   \n/**\n * This Controller only when HttpLongPollingDataChangedListener exist, will take effect.\n */\n@ConditionalOnBean(HttpLongPollingDataChangedListener.class)\n@RestController\n@RequestMapping("/configs")\npublic class ConfigController {\n\n    private final HttpLongPollingDataChangedListener longPollingListener;\n\n    public ConfigController(final HttpLongPollingDataChangedListener longPollingListener) {\n      this.longPollingListener = longPollingListener;\n    }\n    \n    // \u7701\u7565\u5176\u4ed6\u903b\u8f91\n\n    /**\n     * Listener.\n     * \u76d1\u542c\u6570\u636e\u53d8\u66f4\uff0c\u6267\u884c\u957f\u8f6e\u8be2\n     * @param request  the request\n     * @param response the response\n     */\n    @PostMapping(value = "/listener")\n    public void listener(final HttpServletRequest request, final HttpServletResponse response) {\n        longPollingListener.doLongPolling(request, response);\n    }\n\n}\n')),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"HttpLongPollingDataChangedListener#doLongPolling()")),(0,i.yg)("p",null,"\u6267\u884c\u957f\u8f6e\u8be2\u4efb\u52a1\uff1a\u5982\u679c\u6709\u6570\u636e\u53d8\u66f4\uff0c\u5c06\u4f1a\u7acb\u5373\u54cd\u5e94\u7ed9\u5ba2\u6237\u7aef\uff08\u8fd9\u91cc\u5c31\u662f\u7f51\u5173\u7aef\uff09\u3002\u5426\u5219\uff0c\u5ba2\u6237\u7aef\u4f1a\u4e00\u76f4\u88ab\u963b\u585e\uff0c\u76f4\u5230\u6709\u6570\u636e\u53d8\u66f4\u6216\u8005\u8d85\u65f6\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},'public class HttpLongPollingDataChangedListener extends AbstractDataChangedListener {\n\n  // ......\n\n  /**\n   * \u6267\u884c\u957f\u8f6e\u8be2\uff1a\u5982\u679c\u6709\u6570\u636e\u53d8\u66f4\uff0c\u4f1a\u7acb\u5373\u54cd\u5e94\u7ed9\u5ba2\u6237\u7aef\uff08\u8fd9\u91cc\u5c31\u662f\u7f51\u5173\u7aef\uff09\u3002\n   * \u5426\u5219\uff0c\u5426\u5219\u5ba2\u6237\u7aef\u4f1a\u4e00\u76f4\u88ab\u963b\u585e\uff0c\u76f4\u5230\u6709\u6570\u636e\u53d8\u66f4\u6216\u8005\u8d85\u65f6\u3002\n   * @param request\n   * @param response\n   */\n  public void doLongPolling(final HttpServletRequest request, final HttpServletResponse response) {\n    // compare group md5\n    // \u6bd4\u8f83md5\uff0c\u5224\u65ad\u7f51\u5173\u7684\u6570\u636e\u548cadmin\u7aef\u7684\u6570\u636e\u662f\u5426\u4e00\u81f4\uff0c\u5f97\u5230\u53d1\u751f\u53d8\u66f4\u7684\u6570\u636e\u7ec4\n    List<ConfigGroupEnum> changedGroup = compareChangedGroup(request);\n    String clientIp = getRemoteIp(request);\n    // response immediately.\n    // \u6709\u53d8\u66f4\u7684\u6570\u636e\uff0c\u5219\u7acb\u5373\u5411\u7f51\u5173\u54cd\u5e94\n    if (CollectionUtils.isNotEmpty(changedGroup)) {\n      this.generateResponse(response, changedGroup);\n      Log.info("send response with the changed group, ip={}, group={}", clientIp, changedGroup);\n      return;\n    }\n\n    // \u6ca1\u6709\u53d8\u66f4\uff0c\u5219\u5c06\u5ba2\u6237\u7aef\uff08\u8fd9\u91cc\u5c31\u662f\u7f51\u5173\uff09\u653e\u8fdb\u963b\u585e\u961f\u5217\n    final AsyncContext asyncContext = request.startAsync();\n    asyncContext.setTimeout(0L);\n    scheduler.execute(new LongPollingClient(asyncContext, clientIp, HttpConstants.SERVER_MAX_HOLD_TIMEOUT));\n  }\n\n  // ......\n}\n')),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"HttpLongPollingDataChangedListener#compareChangedGroup()")),(0,i.yg)("p",null,"\u5224\u65ad\u7ec4\u6570\u636e\u662f\u5426\u53d1\u751f\u53d8\u66f4\uff0c\u5224\u65ad\u903b\u8f91\u662f\u6bd4\u8f83\u7f51\u5173\u7aef\u548c",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u7aef\u7684",(0,i.yg)("inlineCode",{parentName:"p"},"md5"),"\u503c\u548c",(0,i.yg)("inlineCode",{parentName:"p"},"lastModifyTime"),"\u3002"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"\u5982\u679c",(0,i.yg)("inlineCode",{parentName:"li"},"md5"),"\u503c\u4e0d\u4e00\u6837\uff0c\u90a3\u4e48\u9700\u8981\u66f4\u65b0\uff1b"),(0,i.yg)("li",{parentName:"ul"},"\u5982\u679c",(0,i.yg)("inlineCode",{parentName:"li"},"admin"),"\u7aef\u7684",(0,i.yg)("inlineCode",{parentName:"li"},"lastModifyTime"),"\u5927\u4e8e\u7f51\u5173\u7aef\u7684",(0,i.yg)("inlineCode",{parentName:"li"},"lastModifyTime"),"\uff0c\u90a3\u4e48\u9700\u8981\u66f4\u65b0\u3002")),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"}," /**\n     * \u5224\u65ad\u7ec4\u6570\u636e\u662f\u5426\u53d1\u751f\u53d8\u66f4\n     * @param request\n     * @return\n     */\n    private List<ConfigGroupEnum> compareChangedGroup(final HttpServletRequest request) {\n        List<ConfigGroupEnum> changedGroup = new ArrayList<>(ConfigGroupEnum.values().length);\n        for (ConfigGroupEnum group : ConfigGroupEnum.values()) {\n            // \u7f51\u5173\u7aef\u6570\u636e\u7684md5\u503c\u548clastModifyTime\n            String[] params = StringUtils.split(request.getParameter(group.name()), ',');\n            if (params == null || params.length != 2) {\n                throw new ShenyuException(\"group param invalid:\" + request.getParameter(group.name()));\n            }\n            String clientMd5 = params[0];\n            long clientModifyTime = NumberUtils.toLong(params[1]);\n            ConfigDataCache serverCache = CACHE.get(group.name());\n            // do check. \u5224\u65ad\u7ec4\u6570\u636e\u662f\u5426\u53d1\u751f\u53d8\u66f4\n            if (this.checkCacheDelayAndUpdate(serverCache, clientMd5, clientModifyTime)) {\n                changedGroup.add(group);\n            }\n        }\n        return changedGroup;\n    }\n")),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"LongPollingClient")),(0,i.yg)("p",null,"\u6ca1\u6709\u53d8\u66f4\u6570\u636e\uff0c\u5219\u5c06\u5ba2\u6237\u7aef\uff08\u8fd9\u91cc\u5c31\u662f\u7f51\u5173\uff09\u653e\u8fdb\u963b\u585e\u961f\u5217\u3002\u963b\u585e\u65f6\u95f4\u662f60\u79d2\uff0c\u537360\u79d2\u540e\u79fb\u9664\uff0c\u5e76\u54cd\u5e94\u5ba2\u6237\u7aef\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},'class LongPollingClient implements Runnable {\n      // \u7701\u7565\u4e86\u5176\u4ed6\u903b\u8f91\n    \n        @Override\n        public void run() {\n            try {\n                // \u5148\u8bbe\u7f6e\u5b9a\u65f6\u4efb\u52a1\uff1a60\u79d2\u540e\u79fb\u9664\uff0c\u5e76\u54cd\u5e94\u5ba2\u6237\u7aef\n                this.asyncTimeoutFuture = scheduler.schedule(() -> {\n                    clients.remove(LongPollingClient.this);\n                    List<ConfigGroupEnum> changedGroups = compareChangedGroup((HttpServletRequest) asyncContext.getRequest());\n                    sendResponse(changedGroups);\n                }, timeoutTime, TimeUnit.MILLISECONDS);\n\n                // \u6dfb\u52a0\u5230\u963b\u585e\u961f\u5217\n                clients.add(this);\n\n            } catch (Exception ex) {\n                log.error("add long polling client error", ex);\n            }\n        }\n\n        /**\n         * Send response.\n         *\n         * @param changedGroups the changed groups\n         */\n        void sendResponse(final List<ConfigGroupEnum> changedGroups) {\n            // cancel scheduler\n            if (null != asyncTimeoutFuture) {\n                asyncTimeoutFuture.cancel(false);\n            }\n            // \u54cd\u5e94\u53d8\u66f4\u7684\u7ec4\n            generateResponse((HttpServletResponse) asyncContext.getResponse(), changedGroups);\n            asyncContext.complete();\n        }\n    }\n')),(0,i.yg)("h4",{id:"34--\u83b7\u53d6\u53d8\u66f4\u6570\u636e\u63a5\u53e3"},"3.4  \u83b7\u53d6\u53d8\u66f4\u6570\u636e\u63a5\u53e3"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"/configs/fetch"),"\uff1a\u83b7\u53d6\u53d8\u66f4\u6570\u636e\uff1b")),(0,i.yg)("p",null,"\u6839\u636e\u7f51\u5173\u4f20\u5165\u7684\u53c2\u6570\uff0c\u83b7\u53d6\u5206\u7ec4\u6570\u636e\uff0c\u8fd4\u56de\u7ed3\u679c\u3002\u4e3b\u8981\u5b9e\u73b0\u65b9\u6cd5\u662f",(0,i.yg)("inlineCode",{parentName:"p"},"longPollingListener.fetchConfig()"),"\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},'\n@ConditionalOnBean(HttpLongPollingDataChangedListener.class)\n@RestController\n@RequestMapping("/configs")\npublic class ConfigController {\n\n    private final HttpLongPollingDataChangedListener longPollingListener;\n  \n    public ConfigController(final HttpLongPollingDataChangedListener longPollingListener) {\n      this.longPollingListener = longPollingListener;\n    }\n\n    /**\n     * Fetch configs shenyu result.\n     * \u5168\u91cf\u83b7\u53d6\u5206\u7ec4\u6570\u636e\n     * @param groupKeys the group keys\n     * @return the shenyu result\n     */\n    @GetMapping("/fetch")\n    public ShenyuAdminResult fetchConfigs(@NotNull final String[] groupKeys) {\n        Map<String, ConfigData<?>> result = Maps.newHashMap();\n        for (String groupKey : groupKeys) {\n            ConfigData<?> data = longPollingListener.fetchConfig(ConfigGroupEnum.valueOf(groupKey));\n            result.put(groupKey, data);\n        }\n        return ShenyuAdminResult.success(ShenyuResultMessage.SUCCESS, result);\n    }\n    \n  // \u7701\u7565\u4e86\u5176\u4ed6\u63a5\u53e3\n\n}\n')),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"AbstractDataChangedListener#fetchConfig()")),(0,i.yg)("p",null,"\u6570\u636e\u83b7\u53d6\u76f4\u63a5\u4ece",(0,i.yg)("inlineCode",{parentName:"p"},"CACHE"),"\u4e2d\u62ff\uff0c\u7136\u540e\u6839\u636e\u4e0d\u540c\u5206\u7ec4\u7c7b\u578b\u8fdb\u884c\u5339\u914d\uff0c\u5c01\u88c5\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},'public abstract class AbstractDataChangedListener implements DataChangedListener, InitializingBean {\n  /**\n   * fetch configuration from cache.\n   * \u83b7\u53d6\u5206\u7ec4\u4e0b\u7684\u5168\u91cf\u6570\u636e\n   * @param groupKey the group key\n   * @return the configuration data\n   */\n  public ConfigData<?> fetchConfig(final ConfigGroupEnum groupKey) {\n    // \u76f4\u63a5\u4ece CACHE \u4e2d\u62ff\u6570\u636e\n    ConfigDataCache config = CACHE.get(groupKey.name());\n    switch (groupKey) {\n      case APP_AUTH: // \u8ba4\u8bc1\u6570\u636e\n        return buildConfigData(config, AppAuthData.class);\n      case PLUGIN: // \u63d2\u4ef6\u6570\u636e\n        return buildConfigData(config, PluginData.class);\n      case RULE:   // \u89c4\u5219\u6570\u636e\n        return buildConfigData(config, RuleData.class);\n      case SELECTOR:  // \u9009\u62e9\u5668\u6570\u636e\n        return buildConfigData(config, SelectorData.class);\n      case META_DATA: // \u5143\u6570\u636e\n        return buildConfigData(config, MetaData.class);\n      default:  // \u5176\u4ed6\u7c7b\u578b\uff0c\u629b\u51fa\u5f02\u5e38\n        throw new IllegalStateException("Unexpected groupKey: " + groupKey);\n    }\n  }\n}\n')),(0,i.yg)("h4",{id:"35-\u6570\u636e\u53d8\u66f4"},"3.5 \u6570\u636e\u53d8\u66f4"),(0,i.yg)("p",null,"\u5728\u4e4b\u524d\u7684",(0,i.yg)("inlineCode",{parentName:"p"},"websocket"),"\u6570\u636e\u540c\u6b65\u548c",(0,i.yg)("inlineCode",{parentName:"p"},"zookeeper"),"\u6570\u636e\u540c\u6b65\u6e90\u7801\u5206\u6790\u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u77e5\u9053",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u7aef\u6570\u636e\u540c\u6b65\u8bbe\u8ba1\u7ed3\u6784\u5982\u4e0b\uff1a"),(0,i.yg)("p",null,(0,i.yg)("img",{src:t(58225).A})),(0,i.yg)("p",null,"\u5404\u79cd\u6570\u636e\u53d8\u66f4\u76d1\u542c\u5668\u90fd\u662f",(0,i.yg)("inlineCode",{parentName:"p"},"DataChangedListener"),"\u7684\u5b50\u7c7b\u3002"),(0,i.yg)("p",null,"\u5f53\u5728",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u7aef\u4fee\u6539\u6570\u636e\u540e\uff0c\u901a\u8fc7",(0,i.yg)("inlineCode",{parentName:"p"},"Spring"),"\u7684\u4e8b\u4ef6\u5904\u7406\u673a\u5236\uff0c\u53d1\u9001\u4e8b\u4ef6\u901a\u77e5\u3002\u53d1\u9001\u903b\u8f91\u5982\u4e0b\uff1a"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},'\n/**\n * Event forwarders, which forward the changed events to each ConfigEventListener.\n * \u6570\u636e\u53d8\u66f4\u4e8b\u4ef6\u5206\u53d1\u5668\uff1a\u5f53admin\u7aef\u6709\u6570\u636e\u53d1\u751f\u53d8\u66f4\u65f6\uff0c\u5c06\u53d8\u66f4\u6570\u636e\u540c\u6b65\u5230 ShenYu \u7f51\u5173\n * \u6570\u636e\u53d8\u66f4\u4f9d\u8d56\u4e8eSpring\u7684\u4e8b\u4ef6\u76d1\u542c\u673a\u5236\uff1aApplicationEventPublisher --\x3e ApplicationEvent --\x3e ApplicationListener\n *\n */\n@Component\npublic class DataChangedEventDispatcher implements ApplicationListener<DataChangedEvent>, InitializingBean {\n\n   //\u7701\u7565\u4e86\u5176\u4ed6\u903b\u8f91\n\n    /**\n     * \u6709\u6570\u636e\u53d8\u66f4\u65f6\uff0c\u8c03\u7528\u6b64\u65b9\u6cd5\n     * @param event\n     */\n    @Override\n    @SuppressWarnings("unchecked")\n    public void onApplicationEvent(final DataChangedEvent event) {\n        // \u904d\u5386\u6570\u636e\u53d8\u66f4\u76d1\u542c\u5668(\u4e00\u822c\u4f7f\u7528\u4e00\u79cd\u6570\u636e\u540c\u6b65\u7684\u65b9\u5f0f\u5c31\u597d\u4e86)\n        for (DataChangedListener listener : listeners) {\n            // \u54ea\u79cd\u6570\u636e\u53d1\u751f\u53d8\u66f4\n            switch (event.getGroupKey()) {\n                case APP_AUTH: // \u8ba4\u8bc1\u4fe1\u606f\n                    listener.onAppAuthChanged((List<AppAuthData>) event.getSource(), event.getEventType());\n                    break;\n                case PLUGIN:  // \u63d2\u4ef6\u4fe1\u606f\n                    listener.onPluginChanged((List<PluginData>) event.getSource(), event.getEventType());\n                    break;\n                case RULE:    // \u89c4\u5219\u4fe1\u606f\n                    listener.onRuleChanged((List<RuleData>) event.getSource(), event.getEventType());\n                    break;\n                case SELECTOR:   // \u9009\u62e9\u5668\u4fe1\u606f\n                    listener.onSelectorChanged((List<SelectorData>) event.getSource(), event.getEventType());\n                    // \u5f53\u9009\u62e9\u5668\u6570\u636e\u66f4\u65b0\u65f6\uff0c\u66f4\u65b0API\u6587\u6863\u4fe1\u606f\n                    applicationContext.getBean(LoadServiceDocEntry.class).loadDocOnSelectorChanged((List<SelectorData>) event.getSource(), event.getEventType());\n                    break;\n                case META_DATA:  // \u5143\u6570\u636e\n                    listener.onMetaDataChanged((List<MetaData>) event.getSource(), event.getEventType());\n                    break;\n                default:  // \u5176\u4ed6\u7c7b\u578b\uff0c\u629b\u51fa\u5f02\u5e38\n                    throw new IllegalStateException("Unexpected value: " + event.getGroupKey());\n            }\n        }\n    }\n}\n')),(0,i.yg)("p",null,"\u5047\u8bbe\uff0c\u5bf9\u63d2\u4ef6\u4fe1\u606f\u8fdb\u884c\u4e86\u4fee\u6539\uff0c\u901a\u8fc7",(0,i.yg)("inlineCode",{parentName:"p"},"http\u957f\u8f6e\u8be2"),"\u7684\u65b9\u5f0f\u8fdb\u884c\u6570\u636e\u540c\u6b65\uff0c\u90a3\u4e48",(0,i.yg)("inlineCode",{parentName:"p"},"listener.onPluginChanged()"),"\u7684\u5b9e\u9645\u8c03\u7528\u7684\u662f",(0,i.yg)("inlineCode",{parentName:"p"},"org.apache.shenyu.admin.listener.AbstractDataChangedListener#onPluginChanged"),"\uff1a"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},"    /**\n     * \u5728admin\u7684\u64cd\u4f5c\uff0c\u6709\u63d2\u4ef6\u53d1\u751f\u4e86\u66f4\u65b0\n     * @param changed   the changed\n     * @param eventType the event type\n     */\n    @Override\n    public void onPluginChanged(final List<PluginData> changed, final DataEventTypeEnum eventType) {\n        if (CollectionUtils.isEmpty(changed)) {\n            return;\n        }\n        // \u66f4\u65b0\u5185\u5b58CACHE\n        this.updatePluginCache();\n        // \u6267\u884c\u53d8\u66f4\u4efb\u52a1\n        this.afterPluginChanged(changed, eventType);\n    }\n")),(0,i.yg)("p",null,"\u6709\u4e24\u4e2a\u5904\u7406\u64cd\u4f5c\uff0c\u4e00\u662f\u66f4\u65b0\u5185\u5b58",(0,i.yg)("inlineCode",{parentName:"p"},"CACHE"),"\uff0c\u8fd9\u4e2a\u5728\u524d\u9762\u5206\u6790\u8fc7\u4e86\uff1b\u53e6\u4e00\u4e2a\u662f\u6267\u884c\u53d8\u66f4\u4efb\u52a1\uff0c\u5728\u7ebf\u7a0b\u6c60\u4e2d\u6267\u884c\u3002"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"HttpLongPollingDataChangedListener#afterPluginChanged()")),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},"    @Override\n    protected void afterPluginChanged(final List<PluginData> changed, final DataEventTypeEnum eventType) {\n        // \u5728\u7ebf\u7a0b\u6c60\u4e2d\u6267\u884c\n        scheduler.execute(new DataChangeTask(ConfigGroupEnum.PLUGIN));\n    }\n")),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"DataChangeTask")),(0,i.yg)("p",null,"\u6570\u636e\u53d8\u66f4\u4efb\u52a1\uff1a\u5c06\u963b\u585e\u961f\u5217\u4e2d\u7684\u5ba2\u6237\u7aef\u4f9d\u6b21\u79fb\u9664\uff0c\u5e76\u53d1\u9001\u54cd\u5e94\uff0c\u901a\u77e5\u7f51\u5173\u6709\u7ec4\u6570\u636e\u53d1\u751f\u53d8\u66f4\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},'class DataChangeTask implements Runnable {\n        //\u7701\u7565\u4e86\u5176\u4ed6\u903b\u8f91 \n        @Override\n        public void run() {\n            // \u963b\u585e\u961f\u5217\u4e2d\u7684\u5ba2\u6237\u7aef\u8d85\u8fc7\u4e86\u7ed9\u5b9a\u7684\u503c100\uff0c\u5219\u5206\u6279\u6267\u884c\n            if (clients.size() > httpSyncProperties.getNotifyBatchSize()) {\n                List<LongPollingClient> targetClients = new ArrayList<>(clients.size());\n                clients.drainTo(targetClients);\n                List<List<LongPollingClient>> partitionClients = Lists.partition(targetClients, httpSyncProperties.getNotifyBatchSize());\n               // \u5206\u6279\u6267\u884c\n                partitionClients.forEach(item -> scheduler.execute(() -> doRun(item)));\n            } else {\n                // \u6267\u884c\u4efb\u52a1\n                doRun(clients);\n            }\n        }\n\n        private void doRun(final Collection<LongPollingClient> clients) {\n            // \u901a\u77e5\u6240\u6709\u5ba2\u6237\u7aef\u53d1\u751f\u4e86\u6570\u636e\u53d8\u66f4\n            for (Iterator<LongPollingClient> iter = clients.iterator(); iter.hasNext();) {\n                LongPollingClient client = iter.next();\n                iter.remove();\n                // \u53d1\u9001\u54cd\u5e94\n                client.sendResponse(Collections.singletonList(groupKey));\n                LOG.info("send response with the changed group,ip={}, group={}, changeTime={}", client.ip, groupKey, changeTime);\n            }\n        }\n    }\n')),(0,i.yg)("p",null,"\u81f3\u6b64\uff0c",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u7aef\u6570\u636e\u540c\u6b65\u903b\u8f91\u5c31\u5206\u6790\u5b8c\u4e86\u3002\u5728\u57fa\u4e8e",(0,i.yg)("inlineCode",{parentName:"p"},"http\u957f\u8f6e\u8be2"),"\u6570\u636e\u540c\u6b65\u662f\uff0c\u5b83\u4e3b\u8981\u6709\u4e09\u4e2a\u529f\u80fd\uff1a"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"\u63d0\u4f9b\u6570\u636e\u53d8\u66f4\u76d1\u542c\u63a5\u53e3\uff1b"),(0,i.yg)("li",{parentName:"ul"},"\u63d0\u4f9b\u83b7\u53d6\u53d8\u66f4\u6570\u636e\u63a5\u53e3\uff1b"),(0,i.yg)("li",{parentName:"ul"},"\u6709\u6570\u636e\u53d8\u66f4\u65f6\uff0c\u79fb\u9664\u963b\u585e\u961f\u5217\u4e2d\u7684\u5ba2\u6237\u7aef\uff0c\u5e76\u54cd\u5e94\u7ed3\u679c\u3002")),(0,i.yg)("p",null,"\u6700\u540e\uff0c\u7528\u4e09\u5f20\u56fe\u63cf\u8ff0\u4e0b",(0,i.yg)("inlineCode",{parentName:"p"},"admin"),"\u7aef\u957f\u8f6e\u8be2\u4efb\u52a1\u6d41\u7a0b\uff1a"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"/configs/listener"),"\u6570\u636e\u53d8\u66f4\u76d1\u542c\u63a5\u53e3\uff1a")),(0,i.yg)("p",null,(0,i.yg)("img",{src:t(72318).A})),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"/configs/fetch"),"\u83b7\u53d6\u53d8\u66f4\u6570\u636e\u63a5\u53e3\uff1a")),(0,i.yg)("p",null,(0,i.yg)("img",{src:t(59542).A})),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"\u5728admin\u540e\u53f0\u7ba1\u7406\u7cfb\u7edf\u66f4\u65b0\u6570\u636e\uff0c\u8fdb\u884c\u6570\u636e\u540c\u6b65\uff1a")),(0,i.yg)("p",null,(0,i.yg)("img",{src:t(82617).A})),(0,i.yg)("h3",{id:"4-\u603b\u7ed3"},"4. \u603b\u7ed3"),(0,i.yg)("p",null,"\u672c\u6587\u4e3b\u8981\u5bf9",(0,i.yg)("inlineCode",{parentName:"p"},"ShenYu"),"\u7f51\u5173\u4e2d\u7684",(0,i.yg)("inlineCode",{parentName:"p"},"http\u957f\u8f6e\u8be2"),"\u6570\u636e\u540c\u6b65\u8fdb\u884c\u4e86\u6e90\u7801\u5206\u6790\u3002\u6d89\u53ca\u5230\u7684\u4e3b\u8981\u77e5\u8bc6\u70b9\u5982\u4e0b\uff1a"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"http\u957f\u8f6e\u8be2"),"\u7531\u7f51\u5173\u7aef\u4e3b\u52a8\u53d1\u8d77\u8bf7\u6c42\uff0c\u4e0d\u65ad\u8bf7\u6c42",(0,i.yg)("inlineCode",{parentName:"li"},"admin"),"\u7aef\uff1b"),(0,i.yg)("li",{parentName:"ul"},"\u53d8\u66f4\u6570\u636e\u4ee5\u7ec4\u4e3a\u7c92\u5ea6\uff08\u8ba4\u8bc1\u4fe1\u606f\u3001\u63d2\u4ef6\u3001\u9009\u62e9\u5668\u3001\u89c4\u5219\u3001\u5143\u6570\u636e\uff09\uff1b"),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"http\u957f\u8f6e\u8be2"),"\u7ed3\u679c\u53ea\u62ff\u5230\u4e86\u53d8\u66f4\u7ec4\uff0c\u8fd8\u9700\u8981\u518d\u6b21\u53d1\u8d77\u8bf7\u6c42\u83b7\u53d6\u7ec4\u6570\u636e\uff1b"),(0,i.yg)("li",{parentName:"ul"},"\u6570\u636e\u662f\u5426\u66f4\u65b0\u7531",(0,i.yg)("inlineCode",{parentName:"li"},"md5"),"\u503c\u548c\u4fee\u6539\u65f6\u95f4",(0,i.yg)("inlineCode",{parentName:"li"},"lastModifyTime"),"\u51b3\u5b9a\u3002")))}u.isMDXComponent=!0},58225:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/data-changed-listener-admin-2f384e703652e9e28db8447b1cbdaea7.png"},77875:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/data-changed-listener-1c8e4c0f4279cdb33b27c52cc933cac5.png"},19093:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/data-refresh-a5628c71ea221ffb0a7a45f4ed40ae0e.png"},82617:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/http-long-polling-admin-update-zh-97645cfabead723acf9243cfae2d2dbc.png"},59542:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/http-long-polling-fetch-zh-59963a9119cc79d08e95aa5f4442f413.png"},72318:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/http-long-polling-listener-zh-a0458f05d312cb977f000662b3791567.png"},45127:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/http-long-polling-sequence-zh-9d03d97d038b1f3348c31b9eb0133086.png"},54823:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/http-long-polling-zh-bc8bd8fe6c4aa883a959f59fce05078a.png"}}]);