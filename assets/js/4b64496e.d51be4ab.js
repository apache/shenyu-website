"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[1089],{26752(e,n,i){i.d(n,{A:()=>s});const s=i.p+"assets/images/close_sofa_en-5e49d5ba450a5fb8dc793c11a7422f9a.png"},28208(e,n,i){i.d(n,{A:()=>s});const s=i.p+"assets/images/selector_config_en-0c4c2b8f91583b3e13bf41f09b0e2ab2.png"},28453(e,n,i){i.d(n,{R:()=>o,x:()=>a});var s=i(96540);const r={},l=s.createContext(r);function o(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(l.Provider,{value:n},e.children)}},32844(e,n,i){i.d(n,{A:()=>s});const s=i.p+"assets/images/metadata_config_en-fa04cf537ccb6e5e3e14b9cc6ad907a0.png"},40051(e,n,i){i.d(n,{A:()=>s});const s=i.p+"assets/images/sofa_registry_en-a6f245993c5792729effce29214f0b87.png"},51206(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>t});const s=JSON.parse('{"id":"plugin-center/proxy/sofa-plugin","title":"Sofa Plugin","description":"Sofa Plugin","source":"@site/versioned_docs/version-2.7.0.2/plugin-center/proxy/sofa-plugin.md","sourceDirName":"plugin-center/proxy","slug":"/plugin-center/proxy/sofa-plugin","permalink":"/docs/2.7.0.2/plugin-center/proxy/sofa-plugin","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/shenyu-website/edit/main/versioned_docs/version-2.7.0.2/plugin-center/proxy/sofa-plugin.md","tags":[],"version":"2.7.0.2","frontMatter":{"title":"Sofa Plugin","keywords":["sofa"],"description":"Sofa Plugin"},"sidebar":"tutorialSidebar","previous":{"title":"Mqtt Plugin","permalink":"/docs/2.7.0.2/plugin-center/proxy/mqtt-plugin"},"next":{"title":"Spring Cloud Plugin","permalink":"/docs/2.7.0.2/plugin-center/proxy/spring-cloud-plugin"}}');var r=i(74848),l=i(28453);const o={title:"Sofa Plugin",keywords:["sofa"],description:"Sofa Plugin"},a="1. Overview",c={},t=[{value:"1.1 Plugin name",id:"11-plugin-name",level:2},{value:"1.2 Appropriate scenario",id:"12-appropriate-scenario",level:2},{value:"1.3 Plugin functionality",id:"13-plugin-functionality",level:2},{value:"1.4 Plugin code",id:"14-plugin-code",level:2},{value:"1.5 Added since which shenyu version",id:"15-added-since-which-shenyu-version",level:2},{value:"2.1 Plugin-use procedure chart",id:"21-plugin-use-procedure-chart",level:2},{value:"2.2 Import pom",id:"22-import-pom",level:2},{value:"2.3 Configure in the client project",id:"23-configure-in-the-client-project",level:2},{value:"2.4 Enable plugin",id:"24-enable-plugin",level:2},{value:"2.5 Config plugin",id:"25-config-plugin",level:2},{value:"2.5.1 Registry Config",id:"251-registry-config",level:3},{value:"2.5.2 Selector config",id:"252-selector-config",level:3},{value:"2.5.3 Rule Config",id:"253-rule-config",level:3},{value:"2.5.4 Metadata config",id:"254-metadata-config",level:3},{value:"2.6 Examples",id:"26-examples",level:2},{value:"2.6.1 Accessing the sofa service via Zookeeper using ShenYu",id:"261-accessing-the-sofa-service-via-zookeeper-using-shenyu",level:3},{value:"2.6.1.1 Preparation",id:"2611-preparation",level:4},{value:"2.6.1.2 Plugin Config",id:"2612-plugin-config",level:4},{value:"2.6.2.6 Request service and check result",id:"2626-request-service-and-check-result",level:4}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"1-overview",children:"1. Overview"})}),"\n",(0,r.jsx)(n.h2,{id:"11-plugin-name",children:"1.1 Plugin name"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Sofa plugin"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"12-appropriate-scenario",children:"1.2 Appropriate scenario"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Protocol conversion, a plugin that converts http protocol requests into the sofa framework protocol"}),"\n",(0,r.jsx)(n.li,{children:"Service Load Balancing."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"13-plugin-functionality",children:"1.3 Plugin functionality"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Converting http protocol requests to sofa framework protocol."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"14-plugin-code",children:"1.4 Plugin code"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Core Module ",(0,r.jsx)(n.code,{children:"shenyu-plugin-sofa"})]}),"\n",(0,r.jsxs)(n.li,{children:["Core Class ",(0,r.jsx)(n.code,{children:"org.apache.shenyu.plugin.sofa.SofaPlugin"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"15-added-since-which-shenyu-version",children:"1.5 Added since which shenyu version"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"2.3.0"}),"\n"]}),"\n",(0,r.jsx)(n.h1,{id:"2-how-to-use-plugin",children:"2. How to use plugin"}),"\n",(0,r.jsx)(n.h2,{id:"21-plugin-use-procedure-chart",children:"2.1 Plugin-use procedure chart"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20220828222022336",src:i(91962).A+"",width:"172",height:"430"})}),"\n",(0,r.jsx)(n.h2,{id:"22-import-pom",children:"2.2 Import pom"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"        <dependency>\n            <groupId>com.alipay.sofa</groupId>\n            <artifactId>rpc-sofa-boot-starter</artifactId>\n            <version>${rpc-sofa-boot-starter.version}</version>\n        </dependency>\n        <dependency>\n            <groupId>org.apache.shenyu</groupId>\n            <artifactId>shenyu-spring-boot-starter-client-sofa</artifactId>\n            <version>${project.version}</version>\n            <exclusions>\n                <exclusion>\n                    <artifactId>guava</artifactId>\n                    <groupId>com.google.guava</groupId>\n                </exclusion>\n            </exclusions>\n        </dependency>\n"})}),"\n",(0,r.jsx)(n.h2,{id:"23-configure-in-the-client-project",children:"2.3 Configure in the client project"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Configure the sofa configuration in application.yml."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"com:\n  alipay:\n    sofa:\n      rpc:\n        registry-address: zookeeper://127.0.0.1:2181 # consul # nacos\n        bolt-port: 8888\nshenyu:\n  register:\n    registerType: http #zookeeper #etcd #nacos #consul\n    serverLists: http://localhost:9095 #localhost:2181 #http://localhost:2379 #localhost:8848\n    props:\n      username: admin\n      password: 123456\n  client:\n    sofa:\n      props:\n        contextPath: /sofa\n        ipAndPort: sofa\n        appName: sofa\n        port: 8888\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"Configure the service interface exposed by the sofa service in the xml file in the resources directory."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:'<beans xmlns="http://www.springframework.org/schema/beans"\n       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n       xmlns:sofa="http://sofastack.io/schema/sofaboot"\n       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd\n            http://sofastack.io/schema/sofaboot https://sofastack.io/schema/sofaboot.xsd"\n       default-autowire="byName">\n\t\t\x3c!-- \u793a\u4f8b sofa \u63a5\u53e3 --\x3e\n    <sofa:service ref="sofaSingleParamService" interface="org.apache.shenyu.examples.sofa.api.service.SofaSingleParamService">\n        <sofa:binding.bolt/>\n    </sofa:service>\n\t\t\x3c!-- \u793a\u4f8b sofa \u63a5\u53e3 --\x3e\n    <sofa:service ref="sofaMultiParamService" interface="org.apache.shenyu.examples.sofa.api.service.SofaMultiParamService">\n        <sofa:binding.bolt/>\n    </sofa:service>\n</beans>\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsxs)(n.li,{children:["Add the ",(0,r.jsx)(n.code,{children:"@ShenyuSofaClient"})," annotation to the interface."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@ShenyuSofaClient("/demo")\n@Service\npublic class SofaClientMultiParamServiceImpl implements SofaClientMultiParamService {\n    \n    @Override\n    @ShenyuSofaClient("/findByIdsAndName")\n    public SofaSimpleTypeBean findByIdsAndName(final List<Integer> ids, final String name) {\n        return new SofaSimpleTypeBean(ids.toString(), "hello world shenyu sofa param findByIdsAndName \uff1a" + name);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"24-enable-plugin",children:"2.4 Enable plugin"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["In shenyu-admin --\x3e BasicConfig --\x3e Plugin --\x3e ",(0,r.jsx)(n.code,{children:"sofa"})," set Status enabled."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20220829193836286",src:i(88119).A+"",width:"2042",height:"1037"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"25-config-plugin",children:"2.5 Config plugin"}),"\n",(0,r.jsx)(n.h3,{id:"251-registry-config",children:"2.5.1 Registry Config"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20220829193913149",src:i(40051).A+"",width:"2041",height:"1042"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"protocol"}),":  Register center protocol, currently supports zookeeper\u3001consul\u3001nacos."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"register"}),": The service IP and PORT of the registry."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"threadpool"}),"\uff1aThere are five types of business thread pools: ",(0,r.jsx)(n.code,{children:"fixed"}),", ",(0,r.jsx)(n.code,{children:"eager"}),", ",(0,r.jsx)(n.code,{children:"cached"}),", ",(0,r.jsx)(n.code,{children:"limited"})," and ",(0,r.jsx)(n.code,{children:"shared"}),". The first 4 types correspond to the thread pools officially provided by dubbo. Let's talk about ",(0,r.jsx)(n.code,{children:"shared"}),", as its name implies, ",(0,r.jsx)(n.code,{children:"all proxy plugins"})," share a ",(0,r.jsx)(n.code,{children:"shared"})," thread pool, the advantage of this is that it can reduce the number of thread pools, thereby reducing memory and improving resource utilization."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"corethreads"}),"\uff1aThe number of core threads in the business thread pool."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"threads"}),"\uff1aThe maximum number of threads in the business thread pool."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"queues"}),"\uff1aThe length of the blocking queue of the business thread pool, 0 means ",(0,r.jsx)(n.code,{children:"unbounded blocking queue"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"252-selector-config",children:"2.5.2 Selector config"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Flow needs to be matched by selector."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20220829193948830",src:i(28208).A+"",width:"2041",height:"1026"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Automatically configure the selector with the ",(0,r.jsx)(n.code,{children:"@ShenyuSofaClient"})," annotation."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"253-rule-config",children:"2.5.3 Rule Config"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"After the traffic has been successfully matched by the selector, it will enter the rules for the final traffic matching."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20220829194018202",src:i(97169).A+"",width:"2040",height:"1035"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Automatically configure the selector with the ",(0,r.jsx)(n.code,{children:"@ShenyuSofaClient"})," annotation."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"254-metadata-config",children:"2.5.4 Metadata config"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["When the ",(0,r.jsx)(n.code,{children:"sofa"})," application client accesses the ",(0,r.jsx)(n.code,{children:"Apache ShenYu"})," gateway, it will be automatically registered, and can be viewed in the ",(0,r.jsx)(n.code,{children:"-shenyu-admin"})," backend management system's basic configuration ",(0,r.jsx)(n.code,{children:"--\x3e"})," metadata management, each ",(0,r.jsx)(n.code,{children:"sofa"})," interface method, will correspond to a metadata."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20220829194058044",src:i(32844).A+"",width:"2039",height:"1038"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"AppName: specifies the name of the application to which the metadata belongs."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"MethodName: the name of the method to call."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Path: http request path."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"PathDescribe: the description of the path is easy to view."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"ParamsType: the parameters are separated by commas (,) in the order of interface parameter types."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["RpcExpand: other configurations of the ",(0,r.jsx)(n.code,{children:"sofa"})," interface, which support the ",(0,r.jsx)(n.code,{children:"JSON"})," format."]}),"\n",(0,r.jsxs)(n.p,{children:["examples\uff1a",(0,r.jsx)(n.code,{children:'{"loadbalance":"hash","retries":3,"timeout":-1}'})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"loadbalance"}),"\uff1aLoad balancing policy, currently supports roundRobin, random and hash."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"retries"}),"\uff1aNumber of retries to call client timeout failures."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"timeout"}),"\uff1aCalling the client's timeout time."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Interface: The fully qualified class name of the ",(0,r.jsx)(n.code,{children:"sofa"})," interface."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["RpcType\uff1achoose ",(0,r.jsx)(n.code,{children:"sofa"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"26-examples",children:"2.6 Examples"}),"\n",(0,r.jsx)(n.h3,{id:"261-accessing-the-sofa-service-via-zookeeper-using-shenyu",children:"2.6.1 Accessing the sofa service via Zookeeper using ShenYu"}),"\n",(0,r.jsx)(n.h4,{id:"2611-preparation",children:"2.6.1.1 Preparation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Start ",(0,r.jsx)(n.code,{children:"Zookeeper"})," service."]}),"\n",(0,r.jsxs)(n.li,{children:["Start ",(0,r.jsx)(n.code,{children:"ShenYu Admin"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Start ",(0,r.jsx)(n.code,{children:"Shenyu Bootstrap"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"2612-plugin-config",children:"2.6.1.2 Plugin Config"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["In shenyu-admin --\x3e BasicConfig --\x3e Plugin --\x3e ",(0,r.jsx)(n.code,{children:"sofa"})," set Status enabled, And adjust the registry configuration as needed."]}),"\n",(0,r.jsxs)(n.li,{children:["Adjust to the actual situation ",(0,r.jsx)(n.a,{href:"https://github.com/apache/shenyu/tree/master/shenyu-examples/shenyu-examples-sofa",children:"shenyu-examples-sofa"})," application.yml configuration in the project and start it."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"2626-request-service-and-check-result",children:"2.6.2.6 Request service and check result"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20220828012420068",src:i(94581).A+"",width:"1833",height:"572"})}),"\n",(0,r.jsx)(n.h1,{id:"3-how-to-disable-plugin",children:"3. How to disable plugin"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["In ",(0,r.jsx)(n.code,{children:"shenyu-admin"})," --\x3e BasicConfig --\x3e Plugin --\x3e ",(0,r.jsx)(n.code,{children:"sofa"})," set Status disable."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20220829194151368",src:i(26752).A+"",width:"2041",height:"1043"})})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},88119(e,n,i){i.d(n,{A:()=>s});const s=i.p+"assets/images/enable_sofa_en-0fdb2ba4cad714e87d04fb8fa4bd4591.png"},91962(e,n,i){i.d(n,{A:()=>s});const s=i.p+"assets/images/procedure_chart_en-5d71f183478498a526b766c4a72db530.png"},94581(e,n,i){i.d(n,{A:()=>s});const s=i.p+"assets/images/check_request_zh-c4535143f335e2e88be54d7d10a65d61.png"},97169(e,n,i){i.d(n,{A:()=>s});const s=i.p+"assets/images/rule_config_en-64d4b22ac30218bf808693c6f2f94e2d.png"}}]);