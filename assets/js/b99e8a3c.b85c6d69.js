"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[93181],{7428:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>p,frontMatter:()=>t,metadata:()=>o,toc:()=>l});var s=r(74848),i=r(28453);const t={title:"Spring Cloud Proxy",keywords:["Spring Cloud"],description:"springCloud with shenyu gateway"},a=void 0,o={id:"user-guide/proxy/spring-cloud-proxy",title:"Spring Cloud Proxy",description:"springCloud with shenyu gateway",source:"@site/versioned_docs/version-2.6.0/user-guide/proxy/spring-cloud-proxy.md",sourceDirName:"user-guide/proxy",slug:"/user-guide/proxy/spring-cloud-proxy",permalink:"/docs/2.6.0/user-guide/proxy/spring-cloud-proxy",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/shenyu-website/edit/main/versioned_docs/version-2.6.0/user-guide/proxy/spring-cloud-proxy.md",tags:[],version:"2.6.0",frontMatter:{title:"Spring Cloud Proxy",keywords:["Spring Cloud"],description:"springCloud with shenyu gateway"},sidebar:"tutorialSidebar",previous:{title:"Sofa Proxy",permalink:"/docs/2.6.0/user-guide/proxy/sofa-rpc-proxy"},next:{title:"Tars Proxy",permalink:"/docs/2.6.0/user-guide/proxy/tars-proxy"}},d={},l=[{value:"Add springcloud plugin in gateway",id:"add-springcloud-plugin-in-gateway",level:2},{value:"SpringCloud service access gateway",id:"springcloud-service-access-gateway",level:2},{value:"User Request",id:"user-request",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["This document is intended to help the ",(0,s.jsx)(n.code,{children:"Spring Cloud"})," service access the ",(0,s.jsx)(n.code,{children:"Apache ShenYu"})," gateway. The ",(0,s.jsx)(n.code,{children:"Apache ShenYu"})," gateway uses the ",(0,s.jsx)(n.code,{children:"springCloud"})," plugin to handle ",(0,s.jsx)(n.code,{children:"Spring Cloud"})," service."]}),"\n",(0,s.jsxs)(n.p,{children:["Before the connection, start ",(0,s.jsx)(n.code,{children:"shenyu-admin"})," correctly, start ",(0,s.jsx)(n.code,{children:"springCloud"})," plugin, and add related dependencies on the gateway and ",(0,s.jsx)(n.code,{children:"springCloud"})," application client. Refer to the previous ",(0,s.jsx)(n.a,{href:"../../quick-start/quick-start-springcloud",children:"Quick start with Spring Cloud"})," ."]}),"\n",(0,s.jsxs)(n.p,{children:["For details about client access configuration, see ",(0,s.jsx)(n.a,{href:"/docs/2.6.0/user-guide/property-config/register-center-access",children:"Application Client Access Config"})," ."]}),"\n",(0,s.jsxs)(n.p,{children:["For details about data synchronization configurations, see ",(0,s.jsx)(n.a,{href:"/docs/2.6.0/user-guide/property-config/use-data-sync",children:"Data Synchronization Config"})," ."]}),"\n",(0,s.jsx)(n.h2,{id:"add-springcloud-plugin-in-gateway",children:"Add springcloud plugin in gateway"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"add these dependencies in gateway's pom.xml:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"  \x3c!-- apache shenyu springCloud plugin start--\x3e\n  <dependency>\n       <groupId>org.apache.shenyu</groupId>\n       <artifactId>shenyu-spring-boot-starter-plugin-springcloud</artifactId>\n        <version>${project.version}</version>\n  </dependency>\n\n  <dependency>\n       <groupId>org.apache.shenyu</groupId>\n       <artifactId>shenyu-spring-boot-starter-plugin-httpclient</artifactId>\n       <version>${project.version}</version>\n   </dependency>\n   \x3c!-- apache shenyu springCloud plugin end--\x3e\n\n   <dependency>\n        <groupId>org.springframework.cloud</groupId>\n        <artifactId>spring-cloud-commons</artifactId>\n        <version>2.2.0.RELEASE</version>\n   </dependency>\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["If you use ",(0,s.jsx)(n.code,{children:"eureka"})," as SpringCloud registry center."]}),"\n",(0,s.jsx)(n.p,{children:"add these dependencies:"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"  <dependency>\n       <groupId>org.springframework.cloud</groupId>\n       <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\n       <version>2.2.0.RELEASE</version>\n  </dependency>\n"})}),"\n",(0,s.jsx)(n.p,{children:"add these config values in gateway's yaml file:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"   eureka:\n     client:\n       serviceUrl:\n         defaultZone: http://localhost:8761/eureka/ #your eureka address\n     instance:\n       prefer-ip-address: true\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["if you use ",(0,s.jsx)(n.code,{children:"nacos"})," as Spring Cloud registry center."]}),"\n",(0,s.jsx)(n.p,{children:"add these dependencies:"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:" <dependency>\n       <groupId>com.alibaba.cloud</groupId>\n       <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>\n       <version>2.1.0.RELEASE</version>\n </dependency>\n"})}),"\n",(0,s.jsx)(n.p,{children:"add these config values in gateway's yaml file:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"  spring:\n     cloud:\n       nacos:\n         discovery:\n            server-addr: 127.0.0.1:8848 # your nacos address\n"})}),"\n",(0,s.jsx)(n.p,{children:"Special note: Please ensure that the spring Cloud registry service discovery configuration is enabled"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Configuration method"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yml",children:"spring:\n  cloud:\n    discovery:\n      enabled: true\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"code method"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"@SpringBootApplication\n@EnableDiscoveryClient\npublic class ShenyuBootstrapApplication {\n    \n    /**\n     * Main Entrance.\n     *\n     * @param args startup arguments\n     */\n    public static void main(final String[] args) {\n        SpringApplication.run(ShenyuBootstrapApplication.class, args);\n    }\n}\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"restart your gateway service."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"springcloud-service-access-gateway",children:"SpringCloud service access gateway"}),"\n",(0,s.jsxs)(n.p,{children:["Please refer to ",(0,s.jsx)(n.a,{href:"https://github.com/apache/shenyu/tree/master/shenyu-examples/shenyu-examples-springcloud",children:"shenyu-examples-springcloud"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Add the following dependencies to your ",(0,s.jsx)(n.code,{children:"Spring Cloud"})," microservice :"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:" <dependency>\n      <groupId>org.apache.shenyu</groupId>\n      <artifactId>shenyu-spring-boot-starter-client-springcloud</artifactId>\n      <version>${shenyu.version}</version>\n </dependency>\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Add the annotation ",(0,s.jsx)(n.code,{children:"@ShenyuSpringCloudClient"})," in your ",(0,s.jsx)(n.code,{children:"controller"})," interface. you can apply the annotation to class-level in a controller.the name of the path variable is prefix and '/**' will apply proxy for entire interfaces."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["example (1)\uff1aboth ",(0,s.jsx)(n.code,{children:"/test/payment"})," and ",(0,s.jsx)(n.code,{children:"/test/findByUserId"})," will be handled by gateway."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:' @RestController\n @RequestMapping("/test")\n @ShenyuSpringCloudClient(path = "/test/**")\n public class HttpTestController {\n\n     @PostMapping("/payment")\n     public UserDTO post(@RequestBody final UserDTO userDTO) {\n         return userDTO;\n     }\n\n     @GetMapping("/findByUserId")\n     public UserDTO findByUserId(@RequestParam("userId") final String userId) {\n         UserDTO userDTO = new UserDTO();\n         userDTO.setUserId(userId);\n         userDTO.setUserName("hello world");\n         return userDTO;\n     }\n  }\n'})}),"\n",(0,s.jsxs)(n.p,{children:["example (2)\uff1a",(0,s.jsx)(n.code,{children:"/order/save"})," will be handled by gateway, and ",(0,s.jsx)(n.code,{children:"/order/findById"})," won't."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:' @RestController\n @RequestMapping("/order")\n @ShenyuSpringCloudClient(path = "/order")\n public class OrderController {\n\n     @PostMapping("/save")\n     @ShenyuSpringMvcClient(path = "/save")\n     public OrderDTO save(@RequestBody final OrderDTO orderDTO) {\n         orderDTO.setName("hello world save order");\n         return orderDTO;\n     }\n\n     @GetMapping("/findById")\n     public OrderDTO findById(@RequestParam("id") final String id) {\n         OrderDTO orderDTO = new OrderDTO();\n         orderDTO.setId(id);\n         orderDTO.setName("hello world findById");\n         return orderDTO;\n     }\n }\n'})}),"\n",(0,s.jsxs)(n.p,{children:["example (3)\uff1a  ",(0,s.jsx)(n.code,{children:"isFull"}),"\uff1a",(0,s.jsx)(n.code,{children:"true"}),"  represents that all service will be represented by the gateway."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"shenyu:\n  register:\n    registerType: http #zookeeper #etcd #nacos #consul\n    serverLists: http://localhost:9095 #localhost:2181 #http://localhost:2379 #localhost:8848\n    props:\n      username: admin\n      password: 123456\n  client:\n    springCloud:\n      props:\n        contextPath: /springcloud\n        isFull: true\n#        port: 8884\n# registerType : service registre type, see the application client access document\n# serverList: server list, see the application client access document\n# contextPath: route prefix for your project in ShenYu gateway.\n# isFull: set true to proxy your all service and false to proxy some of your controllers\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:' @RestController\n @RequestMapping("/order")\n public class OrderController {\n\n     @PostMapping("/save")\n     @ShenyuSpringMvcClient(path = "/save")\n     public OrderDTO save(@RequestBody final OrderDTO orderDTO) {\n         orderDTO.setName("hello world save order");\n         return orderDTO;\n     }\n\n     @GetMapping("/findById")\n     public OrderDTO findById(@RequestParam("id") final String id) {\n         OrderDTO orderDTO = new OrderDTO();\n         orderDTO.setId(id);\n         orderDTO.setName("hello world findById");\n         return orderDTO;\n     }\n }\n'})}),"\n",(0,s.jsxs)(n.p,{children:["example (4)\uff1aThis is a simplified way to use it, just need a simple annotation to register to the gateway using metadata.\nSpecial note: currently only supports ",(0,s.jsx)(n.code,{children:"@RequestMapping, @GetMapping, @PostMapping, @DeleteMapping, @PutMapping"})," annotations, and only valid for the first path in ",(0,s.jsx)(n.code,{children:"@XXXMapping"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'  @RestController\n  @RequestMapping("new/feature")\n  public class NewFeatureController {\n  \n    /**\n     * no support gateway access api.\n     *\n     * @return result\n     */\n    @RequestMapping("/gateway/not")\n    public EntityResult noSupportGateway() {\n      return new EntityResult(200, "no support gateway access");\n    }\n  \n    /**\n     * Do not use shenyu annotation path. used request mapping path.\n     *\n     * @return result\n     */\n    @RequestMapping("/requst/mapping/path")\n    @ShenyuSpringCloudClient\n    public EntityResult requestMappingUrl() {\n      return new EntityResult(200, "Do not use shenyu annotation path. used request mapping path");\n    }\n  \n    /**\n     * Do not use shenyu annotation path. used post mapping path.\n     *\n     * @return result\n     */\n    @PostMapping("/post/mapping/path")\n    @ShenyuSpringCloudClient\n    public EntityResult postMappingUrl() {\n      return new EntityResult(200, "Do not use shenyu annotation path. used post mapping path");\n    }\n  \n    /**\n     * Do not use shenyu annotation path. used post mapping path.\n     *\n     * @return result\n     */\n    @GetMapping("/get/mapping/path")\n    @ShenyuSpringCloudClient\n    public EntityResult getMappingUrl() {\n      return new EntityResult(200, "Do not use shenyu annotation path. used get mapping path");\n    }\n  }\n\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"After successfully registering your service, go to the backend management system PluginList -> rpc proxy -> springCloud ', you will see the automatic registration of selectors and rules information."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"user-request",children:"User Request"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Send the request as before, only two points need to notice."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"firstly,the domain name that requested before in your service, now need to replace with gateway's domain name."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["secondly, Apache ShenYu gateway needs a route prefix which comes from ",(0,s.jsx)(n.code,{children:"contextPath"}),", it configured during the integration with gateway, you can change it freely in divide plugin of ",(0,s.jsx)(n.code,{children:"shenyu-admin"}),", if your familiar with it."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["For example, your have an ",(0,s.jsx)(n.code,{children:"order"})," service and it has a interface, the request url: ",(0,s.jsx)(n.code,{children:"http://localhost:8080/test/save"})," ."]}),"\n",(0,s.jsxs)(n.p,{children:["Now need to change to\uff1a",(0,s.jsx)(n.code,{children:"http://localhost:9195/order/test/save"})," ."]}),"\n",(0,s.jsxs)(n.p,{children:["We can see ",(0,s.jsx)(n.code,{children:"localhost:9195"})," is the gateway's ip port, default port number is ",(0,s.jsx)(n.code,{children:"9195"})," , ",(0,s.jsx)(n.code,{children:"/order"})," is the ",(0,s.jsx)(n.code,{children:"contextPath"})," in your config yaml file."]}),"\n",(0,s.jsx)(n.p,{children:"The request of other parameters doesn't change. Then you can visit, very easy and simple."}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>o});var s=r(96540);const i={},t=s.createContext(i);function a(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);