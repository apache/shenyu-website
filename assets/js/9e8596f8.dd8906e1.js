"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[74871],{1516(e,n,t){t.d(n,{A:()=>i});const i=t.p+"assets/images/divide-register-zh-0697d4849e6ae1dbd2f15a0fd528cd32.png"},1790(e,n,t){t.d(n,{A:()=>i});const i=t.p+"assets/images/WebClientPlugin-64ae237cda7fd819160795669ee2e2bd.png"},18276(e,n,t){t.d(n,{A:()=>i});const i=t.p+"assets/images/divide-execute-zh-c145705430fc3aec6e561cc4ad183a05.png"},28453(e,n,t){t.d(n,{R:()=>a,x:()=>l});var i=t(96540);const r={},s=i.createContext(r);function a(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(s.Provider,{value:n},e.children)}},33284(e,n,t){t.d(n,{A:()=>i});const i=t.p+"assets/images/MessageWriter-81d10e88b3d5524b1eb2737c238956a6.png"},46954(e,n,t){t.d(n,{A:()=>i});const i=t.p+"assets/images/ShenyuClientRegisterDivideServiceImpl-4d9351b1efbb545cde2a3a172e35f59c.png"},59988(e,n,t){t.d(n,{A:()=>i});const i="data:image/png;base64,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"},69746(e){e.exports=JSON.parse('{"permalink":"/blog/Plugin-SourceCode-Analysis-Divide-Plugin","editUrl":"https://github.com/apache/shenyu-website/edit/main/blog/Plugin-SourceCode-Analysis-Divide-Plugin.md","source":"@site/blog/Plugin-SourceCode-Analysis-Divide-Plugin.md","title":"Code Analysis For Divide Plugin","description":"The ShenYu gateway uses the divide plugin to handle http requests. You can see the official documentation Quick start with Http to learn how to use this plugin.","date":"2025-12-17T02:20:20.000Z","tags":[{"inline":true,"label":"plugin","permalink":"/blog/tags/plugin"},{"inline":true,"label":"divide","permalink":"/blog/tags/divide"},{"inline":true,"label":"Apache ShenYu","permalink":"/blog/tags/apache-shen-yu"}],"readingTime":20.635,"hasTruncateMarker":false,"authors":[{"name":"midnight2104","title":"Apache ShenYu Committer","url":"https://github.com/midnight2104","key":null,"page":null}],"frontMatter":{"title":"Code Analysis For Divide Plugin","author":"midnight2104","author_title":"Apache ShenYu Committer","author_url":"https://github.com/midnight2104","tags":["plugin","divide","Apache ShenYu"]},"unlisted":false,"prevItem":{"title":"Code Analysis For Context-Path Plugin","permalink":"/blog/Plugin-SourceCode-Analysis-Context-Path-Plugin"},"nextItem":{"title":"Code Analysis For Dubbo Plugin","permalink":"/blog/Plugin-SourceCode-Analysis-Dubbo-Plugin"}}')},87439(e,n,t){t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>c});var i=t(69746),r=t(74848),s=t(28453);const a={title:"Code Analysis For Divide Plugin",author:"midnight2104",author_title:"Apache ShenYu Committer",author_url:"https://github.com/midnight2104",tags:["plugin","divide","Apache ShenYu"]},l=void 0,o={authorsImageUrls:[void 0]},c=[{value:"1. Register Service",id:"1-register-service",level:3},{value:"1.1  Declaration of registration interface",id:"11--declaration-of-registration-interface",level:4},{value:"1.2 Scan annotation",id:"12-scan-annotation",level:4},{value:"1.3 Register URI Data",id:"13-register-uri-data",level:4},{value:"1.4 Handle registration information",id:"14-handle-registration-information",level:4},{value:"1.4.1 Register Service",id:"141-register-service",level:5},{value:"1.4.1.1 Register Selector",id:"1411-register-selector",level:6},{value:"1.4.1.2 Register Rule",id:"1412-register-rule",level:6},{value:"1.4.1.3 Register Metadata",id:"1413-register-metadata",level:6},{value:"1.4.1.4 Register ContextPath",id:"1414-register-contextpath",level:6},{value:"1.4.2 Register URI",id:"142-register-uri",level:5},{value:"2. Call Http Service",id:"2-call-http-service",level:3},{value:"2.1 Accept Request",id:"21-accept-request",level:4},{value:"2.2 Matching rule",id:"22-matching-rule",level:4},{value:"2.3 Execute Divide Plugin",id:"23-execute-divide-plugin",level:4},{value:"2.4 Do Request",id:"24-do-request",level:4},{value:"2.5 Response Result",id:"25-response-result",level:4},{value:"3. Summary",id:"3-summary",level:3}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h3:"h3",h4:"h4",h5:"h5",h6:"h6",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"ShenYu"})," gateway uses the ",(0,r.jsx)(n.code,{children:"divide"})," plugin to handle ",(0,r.jsx)(n.code,{children:"http"})," requests. You can see the official documentation ",(0,r.jsx)(n.a,{href:"https://shenyu.apache.org/docs/quick-start/quick-start-http",children:"Quick start with Http"})," to learn how to use this plugin."]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["This article is based on ",(0,r.jsx)(n.code,{children:"shenyu-2.4.3"})," version for source code analysis, please refer to ",(0,r.jsx)(n.a,{href:"https://shenyu.apache.org/docs/user-guide/proxy/http-proxy",children:"Http Proxy"})," for the introduction of the official website."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"1-register-service",children:"1. Register Service"}),"\n",(0,r.jsx)(n.h4,{id:"11--declaration-of-registration-interface",children:"1.1  Declaration of registration interface"}),"\n",(0,r.jsxs)(n.p,{children:["Use the annotation ",(0,r.jsx)(n.code,{children:"@ShenyuSpringMvcClient"})," to register the service to the gateway. The simple ",(0,r.jsx)(n.code,{children:"demo"})," is as follows."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@RestController\n@RequestMapping("/order")\n@ShenyuSpringMvcClient(path = "/order")  // API\npublic class OrderController {\n    @GetMapping("/findById")\n    @ShenyuSpringMvcClient(path = "/findById", desc = "Find by id") // method\n    public OrderDTO findById(@RequestParam("id") final String id) {\n        return build(id, "hello world findById");\n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"define annotation:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'\n@Retention(RetentionPolicy.RUNTIME)\n@Target({ElementType.TYPE, ElementType.METHOD})\npublic @interface ShenyuSpringMvcClient {\n    \n\t//path\n    String path() default "";\n    \n    //rule name\n    String ruleName() default "";\n   \n    //desc info\n    String desc() default "";\n\n    //is enabled\n    boolean enabled() default true;\n    \n    //register MetaData\n    boolean registerMetaData() default false;\n}\n\n'})}),"\n",(0,r.jsx)(n.h4,{id:"12-scan-annotation",children:"1.2 Scan annotation"}),"\n",(0,r.jsxs)(n.p,{children:["Annotation scanning is done through ",(0,r.jsx)(n.code,{children:"SpringMvcClientBeanPostProcessor"}),", which implements the ",(0,r.jsx)(n.code,{children:"BeanPostProcessor"})," interface and is a post-processor provided by ",(0,r.jsx)(n.code,{children:"Spring"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"During constructor instantiation."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Read the property configuration"}),"\n",(0,r.jsxs)(n.li,{children:["Add annotations, read ",(0,r.jsx)(n.code,{children:"path"})," information"]}),"\n",(0,r.jsxs)(n.li,{children:["Start the registry and register with ",(0,r.jsx)(n.code,{children:"shenyu-admin"})]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'public class SpringMvcClientBeanPostProcessor implements BeanPostProcessor {\n    //...\n    /**\n     * Constructor instantiation\n     */\n    public SpringMvcClientBeanPostProcessor(final PropertiesConfig clientConfig,\n                                            final ShenyuClientRegisterRepository shenyuClientRegisterRepository) {\n        // 1. read Properties\n        Properties props = clientConfig.getProps();\n        this.appName = props.getProperty(ShenyuClientConstants.APP_NAME);\n        this.contextPath = props.getProperty(ShenyuClientConstants.CONTEXT_PATH, "");\n        if (StringUtils.isBlank(appName) && StringUtils.isBlank(contextPath)) {\n            String errorMsg = "http register param must config the appName or contextPath";\n            LOG.error(errorMsg);\n            throw new ShenyuClientIllegalArgumentException(errorMsg);\n        }\n        this.isFull = Boolean.parseBoolean(props.getProperty(ShenyuClientConstants.IS_FULL, Boolean.FALSE.toString()));\n        // 2. add annotation\n        mappingAnnotation.add(ShenyuSpringMvcClient.class);\n        mappingAnnotation.add(PostMapping.class);\n        mappingAnnotation.add(GetMapping.class);\n        mappingAnnotation.add(DeleteMapping.class);\n        mappingAnnotation.add(PutMapping.class);\n        mappingAnnotation.add(RequestMapping.class);\n        // 3. start register cneter\n        publisher.start(shenyuClientRegisterRepository);\n    }\n    \n    @Override\n    public Object postProcessAfterInitialization(@NonNull final Object bean, @NonNull final String beanName) throws BeansException {\n       // override post process\n        \n        return bean;\n    }\n    \n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"SpringMvcClientBeanPostProcessor#postProcessAfterInitialization()"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Rewrite post-processor logic: read annotation information, construct metadata objects and ",(0,r.jsx)(n.code,{children:"URI"})," objects, and register them with ",(0,r.jsx)(n.code,{children:"shenyu-admin"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'    @Override\n    public Object postProcessAfterInitialization(@NonNull final Object bean, @NonNull final String beanName) throws BeansException {\n        // 1. If the all service is registered or is not a Controller class, it is not handled\n        if (Boolean.TRUE.equals(isFull) || !hasAnnotation(bean.getClass(), Controller.class)) {\n            return bean;\n        }\n        // 2. Read the annotations on the class ShenyuSpringMvcClient\n        final ShenyuSpringMvcClient beanShenyuClient = AnnotationUtils.findAnnotation(bean.getClass(), ShenyuSpringMvcClient.class);\n        // 2.1 build  superPath\n        final String superPath = buildApiSuperPath(bean.getClass());\n        // 2.2 whether to register the entire class method\n        if (Objects.nonNull(beanShenyuClient) && superPath.contains("*")) {\n            // build the metadata object and register it with shenyu-admin\n            publisher.publishEvent(buildMetaDataDTO(beanShenyuClient, pathJoin(contextPath, superPath)));\n            return bean;\n        }\n        // 3. read all methods\n        final Method[] methods = ReflectionUtils.getUniqueDeclaredMethods(bean.getClass());\n        for (Method method : methods) {\n            // 3.1 read the annotations on the method ShenyuSpringMvcClient\n            ShenyuSpringMvcClient methodShenyuClient = AnnotationUtils.findAnnotation(method, ShenyuSpringMvcClient.class);\n            // If there is no annotation on the method, use the annotation on the class\n            methodShenyuClient = Objects.isNull(methodShenyuClient) ? beanShenyuClient : methodShenyuClient;\n            if (Objects.nonNull(methodShenyuClient)) {\n               // 3.2 Build path information, build metadata objects, register with shenyu-admin\n                publisher.publishEvent(buildMetaDataDTO(methodShenyuClient, buildApiPath(method, superPath)));\n            }\n        }\n        \n        return bean;\n    }\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["If you are registering the whole service or not ",(0,r.jsx)(n.code,{children:"Controller"})," class, do not handle it"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsxs)(n.li,{children:["read the annotation on the class ",(0,r.jsx)(n.code,{children:"ShenyuSpringMvcClient"}),", if the whole class is registered, build the metadata object here and register it with ",(0,r.jsx)(n.code,{children:"shenyu-admin"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsxs)(n.li,{children:["Annotation on the handler method ",(0,r.jsx)(n.code,{children:"ShenyuSpringMvcClient"}),", build ",(0,r.jsx)(n.code,{children:"path"})," information for the specific method, build the metadata object and then register it with ",(0,r.jsx)(n.code,{children:"shenyu-admin"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["There are two methods here that take ",(0,r.jsx)(n.code,{children:"path"})," and need special instructions."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"buildApiSuperPath()"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Construct ",(0,r.jsx)(n.code,{children:"SuperPath"}),": first take the ",(0,r.jsx)(n.code,{children:"path"})," property from the annotation ",(0,r.jsx)(n.code,{children:"ShenyuSpringMvcClient"})," on the class, if not, take the ",(0,r.jsx)(n.code,{children:"path"})," information from the ",(0,r.jsx)(n.code,{children:"RequestMapping"})," annotation on the current class."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'    private String buildApiSuperPath(@NonNull final Class<?> method) {\n        // First take the path property from the annotation ShenyuSpringMvcClient on the class\n        ShenyuSpringMvcClient shenyuSpringMvcClient = AnnotationUtils.findAnnotation(method, ShenyuSpringMvcClient.class);\n        if (Objects.nonNull(shenyuSpringMvcClient) && StringUtils.isNotBlank(shenyuSpringMvcClient.path())) {\n            return shenyuSpringMvcClient.path();\n        }\n        // Take the path information from the RequestMapping annotation of the current class\n        RequestMapping requestMapping = AnnotationUtils.findAnnotation(method, RequestMapping.class);\n        if (Objects.nonNull(requestMapping) && ArrayUtils.isNotEmpty(requestMapping.path()) && StringUtils.isNotBlank(requestMapping.path()[0])) {\n            return requestMapping.path()[0];\n        }\n        return "";\n    }\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"buildApiPath()"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Build ",(0,r.jsx)(n.code,{children:"path"}),": first read the annotation ",(0,r.jsx)(n.code,{children:"ShenyuSpringMvcClient"})," on the method and build it if it exists; otherwise get the ",(0,r.jsx)(n.code,{children:"path"})," information from other annotations on the method; complete ",(0,r.jsx)(n.code,{children:"path = contextPath(context information) + superPath(class information) + methodPath(method information)"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"    private String buildApiPath(@NonNull final Method method, @NonNull final String superPath) {\n        // 1. Read the annotation ShenyuSpringMvcClient on the method\n        ShenyuSpringMvcClient shenyuSpringMvcClient = AnnotationUtils.findAnnotation(method, ShenyuSpringMvcClient.class);\n        // 1.1 If path exists, build\n        if (Objects.nonNull(shenyuSpringMvcClient) && StringUtils.isNotBlank(shenyuSpringMvcClient.path())) {\n            //1.2  path = contextPath+superPath+methodPath\n            return pathJoin(contextPath, superPath, shenyuSpringMvcClient.path());\n        }\n        // 2. Get path information from other annotations on the method\n        final String path = getPathByMethod(method);\n        if (StringUtils.isNotBlank(path)) {\n             // 2.1 path = contextPath+superPath+methodPath\n            return pathJoin(contextPath, superPath, path);\n        }\n        return pathJoin(contextPath, superPath);\n    }\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"getPathByMethod()"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Get ",(0,r.jsx)(n.code,{children:"path"})," information from other annotations on the method, other annotations include."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"ShenyuSpringMvcClient"}),"\n",(0,r.jsx)(n.li,{children:"PostMapping"}),"\n",(0,r.jsx)(n.li,{children:"GetMapping"}),"\n",(0,r.jsx)(n.li,{children:"DeleteMapping"}),"\n",(0,r.jsx)(n.li,{children:"PutMapping"}),"\n",(0,r.jsx)(n.li,{children:"RequestMapping"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"\n    private String getPathByMethod(@NonNull final Method method) {\n        // Iterate through interface annotations to get path information\n        for (Class<? extends Annotation> mapping : mappingAnnotation) {\n            final String pathByAnnotation = getPathByAnnotation(AnnotationUtils.findAnnotation(method, mapping), pathAttributeNames);\n            if (StringUtils.isNotBlank(pathByAnnotation)) {\n                return pathByAnnotation;\n            }\n        }\n        return null;\n    }\n"})}),"\n",(0,r.jsxs)(n.p,{children:["After the scanning annotation is finished, construct the metadata object and send the object to ",(0,r.jsx)(n.code,{children:"shenyu-admin"})," to complete the registration."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Metadata"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Includes the rule information of the currently registered method: contextPath, appName, registration path, description information, registration type, whether it is enabled, rule name and whether to register metadata."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:" private MetaDataRegisterDTO buildMetaDataDTO(@NonNull final ShenyuSpringMvcClient shenyuSpringMvcClient, final String path) {\n        return MetaDataRegisterDTO.builder()\n                .contextPath(contextPath) // contextPath\n                .appName(appName) // appName\n                .path(path) // Registered path, used when gateway rules match\n                .pathDesc(shenyuSpringMvcClient.desc()) // desc info\n                .rpcType(RpcTypeEnum.HTTP.getName()) // divide plugin, http type when default\n                .enabled(shenyuSpringMvcClient.enabled()) // is enabled?\n                .ruleName(StringUtils.defaultIfBlank(shenyuSpringMvcClient.ruleName(), path))//rule name\n                .registerMetaData(shenyuSpringMvcClient.registerMetaData()) // whether to register metadata information\n                .build();\n    }\n"})}),"\n",(0,r.jsx)(n.p,{children:"The specific registration logic is implemented by the registration center, which has been analyzed in the previous articles and will not be analyzed in depth here."}),"\n",(0,r.jsx)(n.h4,{id:"13-register-uri-data",children:"1.3 Register URI Data"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"ContextRegisterListener"})," is responsible for registering the client's ",(0,r.jsx)(n.code,{children:"URI"})," information to ",(0,r.jsx)(n.code,{children:"shenyu-admin"}),", it implements the ",(0,r.jsx)(n.code,{children:"ApplicationListener"})," interface, when the context refresh event ",(0,r.jsx)(n.code,{children:"ContextRefreshedEvent"})," occurs, the ",(0,r.jsx)(n.code,{children:"onApplicationEvent()"})," method is executed to implement the registration logic."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'\npublic class ContextRegisterListener implements ApplicationListener<ContextRefreshedEvent>, BeanFactoryAware {\n\t//......\n    \n    /**\n     * Constructor instantiation\n     */\n    public ContextRegisterListener(final PropertiesConfig clientConfig) {\n        // read Properties\n        final Properties props = clientConfig.getProps();\n        this.isFull = Boolean.parseBoolean(props.getProperty(ShenyuClientConstants.IS_FULL, Boolean.FALSE.toString()));\n        this.contextPath = props.getProperty(ShenyuClientConstants.CONTEXT_PATH);\n        if (Boolean.TRUE.equals(isFull)) {\n            if (StringUtils.isBlank(contextPath)) {\n                final String errorMsg = "http register param must config the contextPath";\n                LOG.error(errorMsg);\n                throw new ShenyuClientIllegalArgumentException(errorMsg);\n            }\n        }\n        this.port = Integer.parseInt(Optional.ofNullable(props.getProperty(ShenyuClientConstants.PORT)).orElseGet(() -> "-1"));\n        this.appName = props.getProperty(ShenyuClientConstants.APP_NAME);\n        this.protocol = props.getProperty(ShenyuClientConstants.PROTOCOL, ShenyuClientConstants.HTTP);\n        this.host = props.getProperty(ShenyuClientConstants.HOST);\n    }\n\n    @Override\n    public void setBeanFactory(final BeanFactory beanFactory) throws BeansException {\n        this.beanFactory = beanFactory;\n    }\n\n    // Execute application events\n    @Override\n    public void onApplicationEvent(@NonNull final ContextRefreshedEvent contextRefreshedEvent) {\n          // The method is guaranteed to be executed once\n        if (!registered.compareAndSet(false, true)) {\n            return;\n        }\n        // 1. If you are registering for the entire service\n        if (Boolean.TRUE.equals(isFull)) {\n            // Build metadata and register\n            publisher.publishEvent(buildMetaDataDTO());\n        }\n        try {\n            // get port\n            final int mergedPort = port <= 0 ? PortUtils.findPort(beanFactory) : port;\n            // 2. Constructing URI data and registering\n            publisher.publishEvent(buildURIRegisterDTO(mergedPort));\n        } catch (ShenyuException e) {\n            throw new ShenyuException(e.getMessage() + "please config ${shenyu.client.http.props.port} in xml/yml !");\n        }\n    }\n\n    // build URI data\n    private URIRegisterDTO buildURIRegisterDTO(final int port) {\n        return URIRegisterDTO.builder()\n            .contextPath(this.contextPath) // contextPath\n            .appName(appName) // appName\n            .protocol(protocol) // protocol\n            .host(IpUtils.isCompleteHost(this.host) ? this.host : IpUtils.getHost(this.host)) //host\n            .port(port) // port\n            .rpcType(RpcTypeEnum.HTTP.getName()) // divide plugin, default registration http type\n            .build();\n    }\n\n    // build MetaData\n    private MetaDataRegisterDTO buildMetaDataDTO() {\n        return MetaDataRegisterDTO.builder()\n            .contextPath(contextPath)\n            .appName(appName)\n            .path(contextPath)\n            .rpcType(RpcTypeEnum.HTTP.getName())\n            .enabled(true)\n            .ruleName(contextPath)\n            .build();\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"14-handle-registration-information",children:"1.4 Handle registration information"}),"\n",(0,r.jsxs)(n.p,{children:["The metadata and ",(0,r.jsx)(n.code,{children:"URI"})," data registered by the client through the registry are processed in ",(0,r.jsx)(n.code,{children:"shenyu-admin"}),", which is responsible for storing to the database and synchronizing to the ",(0,r.jsx)(n.code,{children:"shenyu"})," gateway. The client registration processing logic of ",(0,r.jsx)(n.code,{children:"Divide"})," plugin is in ",(0,r.jsx)(n.code,{children:"ShenyuClientRegisterDivideServiceImpl"}),". The inheritance relationship is as follows."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:t(46954).A+"",width:"1143",height:"768"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"ShenyuClientRegisterService: client registration service, top-level interface."}),"\n",(0,r.jsx)(n.li,{children:"FallbackShenyuClientRegisterService: registration failure, provides retry operation."}),"\n",(0,r.jsx)(n.li,{children:"AbstractShenyuClientRegisterServiceImpl: abstract class, implements part of the public registration logic;"}),"\n",(0,r.jsxs)(n.li,{children:["AbstractContextPathRegisterService: abstract class, responsible for registering ",(0,r.jsx)(n.code,{children:"ContextPath"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["ShenyuClientRegisterDivideServiceImpl: implementation of the ",(0,r.jsx)(n.code,{children:"Divide"})," plug-in registration."]}),"\n"]}),"\n",(0,r.jsx)(n.h5,{id:"141-register-service",children:"1.4.1 Register Service"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"org.apache.shenyu.admin.service.register.AbstractShenyuClientRegisterServiceImpl#register()"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The metadata ",(0,r.jsx)(n.code,{children:"MetaDataRegisterDTO"})," object registered by the client through the registry is picked up and dropped in the ",(0,r.jsx)(n.code,{children:"register()"})," method of ",(0,r.jsx)(n.code,{children:"shenyu-admin"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"   @Override\n    public String register(final MetaDataRegisterDTO dto) {\n        //1. register selector\n        String selectorHandler = selectorHandler(dto);\n        String selectorId = selectorService.registerDefault(dto, PluginNameAdapter.rpcTypeAdapter(rpcType()), selectorHandler);\n        //2. register rule\n        String ruleHandler = ruleHandler();\n        RuleDTO ruleDTO = buildRpcDefaultRuleDTO(selectorId, dto, ruleHandler);\n        ruleService.registerDefault(ruleDTO);\n        //3. register metadat\n        registerMetadata(dto);\n        //4. register ContextPath\n        String contextPath = dto.getContextPath();\n        if (StringUtils.isNotEmpty(contextPath)) {\n            registerContextPath(dto);\n        }\n        return ShenyuResultMessage.SUCCESS;\n    }\n"})}),"\n",(0,r.jsx)(n.h6,{id:"1411-register-selector",children:"1.4.1.1 Register Selector"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"org.apache.shenyu.admin.service.impl.SelectorServiceImpl#registerDefault()"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Build ",(0,r.jsx)(n.code,{children:"contextPath"}),", find if the selector information exists, if it does, return ",(0,r.jsx)(n.code,{children:"id"}),"; if it doesn't, create the default selector information."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"    @Override\n    public String registerDefault(final MetaDataRegisterDTO dto, final String pluginName, final String selectorHandler) {\n        // build contextPath\n        String contextPath = ContextPathUtils.buildContextPath(dto.getContextPath(), dto.getAppName());\n        // Find if selector information exists by name\n        SelectorDO selectorDO = findByNameAndPluginName(contextPath, pluginName);\n        if (Objects.isNull(selectorDO)) {\n            // Create a default selector message if it does not exist\n            return registerSelector(contextPath, pluginName, selectorHandler);\n        }\n        return selectorDO.getId();\n    }\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Default Selector Information"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Construct the default selector information and its conditional properties here."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"   //register selector\n   private String registerSelector(final String contextPath, final String pluginName, final String selectorHandler) {\n        // build selector \n        SelectorDTO selectorDTO = buildSelectorDTO(contextPath, pluginMapper.selectByName(pluginName).getId());\n        selectorDTO.setHandle(selectorHandler);\n        //register default Selector\n        return registerDefault(selectorDTO);\n    }\n     //build\n    private SelectorDTO buildSelectorDTO(final String contextPath, final String pluginId) {\n        //build default\n        SelectorDTO selectorDTO = buildDefaultSelectorDTO(contextPath);\n        selectorDTO.setPluginId(pluginId);\n         //build the conditional properties of the default selector\n        selectorDTO.setSelectorConditions(buildDefaultSelectorConditionDTO(contextPath));\n        return selectorDTO;\n    }\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Build Default Selector"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"private SelectorDTO buildDefaultSelectorDTO(final String name) {\n    return SelectorDTO.builder()\n            .name(name) // name\n            .type(SelectorTypeEnum.CUSTOM_FLOW.getCode()) // default CUSTOM_FLOW\n            .matchMode(MatchModeEnum.AND.getCode()) //default  AND\n            .enabled(Boolean.TRUE)  //default TRUE\n            .loged(Boolean.TRUE)  //default TRUE\n            .continued(Boolean.TRUE) //default TRUE\n            .sort(1) //default 1\n            .build();\n}\n\n\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Build default selector conditional properties"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'private List<SelectorConditionDTO> buildDefaultSelectorConditionDTO(final String contextPath) {\n    SelectorConditionDTO selectorConditionDTO = new SelectorConditionDTO();\n    selectorConditionDTO.setParamType(ParamTypeEnum.URI.getName()); // default URI\n    selectorConditionDTO.setParamName("/");\n    selectorConditionDTO.setOperator(OperatorEnum.MATCH.getAlias()); // default match\n    selectorConditionDTO.setParamValue(contextPath + AdminConstants.URI_SUFFIX); // default /contextPath/**\n    return Collections.singletonList(selectorConditionDTO);\n}\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Register default selector"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"@Override\npublic String registerDefault(final SelectorDTO selectorDTO) {\n    //selector info\n    SelectorDO selectorDO = SelectorDO.buildSelectorDO(selectorDTO);\n    //selector condition  info\n    List<SelectorConditionDTO> selectorConditionDTOs = selectorDTO.getSelectorConditions();\n    if (StringUtils.isEmpty(selectorDTO.getId())) {\n        // insert selector information into the database\n        selectorMapper.insertSelective(selectorDO);\n          // insert selector condition information into the database\n        selectorConditionDTOs.forEach(selectorConditionDTO -> {\n            selectorConditionDTO.setSelectorId(selectorDO.getId());        \n                selectorConditionMapper.insertSelective(SelectorConditionDO.buildSelectorConditionDO(selectorConditionDTO));\n        });\n    }\n    // Publish synchronization events to synchronize selection information and its conditional attributes to the gateway\n    publishEvent(selectorDO, selectorConditionDTOs);\n    return selectorDO.getId();\n}\n"})}),"\n",(0,r.jsx)(n.h6,{id:"1412-register-rule",children:"1.4.1.2 Register Rule"}),"\n",(0,r.jsx)(n.p,{children:"In the second step of registering the service, start building the default rules and then register the rules."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@Override\n    public String register(final MetaDataRegisterDTO dto) {\n        //1. register selector\n        //......\n        \n        //2. register rule\n        // default rule handle\n        String ruleHandler = ruleHandler();\n        // build default rule\n        RuleDTO ruleDTO = buildRpcDefaultRuleDTO(selectorId, dto, ruleHandler);\n        // register rule\n        ruleService.registerDefault(ruleDTO);\n        \n        //3. register Metadata\n        //......\n        \n        //4. register ContextPath\n        //......\n        \n        return ShenyuResultMessage.SUCCESS;\n    }\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"default rule handle"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"    @Override\n    protected String ruleHandler() {\n        // default rule handle\n        return new DivideRuleHandle().toJson();\n    }\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"Divide"})," plugin default rule handle."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"\npublic class DivideRuleHandle implements RuleHandle {\n\n    /**\n     * load balance: default RANDOM\n     */\n    private String loadBalance = LoadBalanceEnum.RANDOM.getName();\n\n    /**\n     * retry strategy: default CURRENT\n     */\n    private String retryStrategy = RetryEnum.CURRENT.getName();\n\n    /**\n     * retry: default 3\n     */\n    private int retry = 3;\n\n    /**\n     *  retry: default 3000\n     */\n    private long timeout = Constants.TIME_OUT;\n\n    /**\n     *  retry: default  10240 byte\n     */\n    private long headerMaxSize = Constants.HEADER_MAX_SIZE;\n\n    /**\n     *  retry: default 102400 byte\n     */\n    private long requestMaxSize = Constants.REQUEST_MAX_SIZE;\n}\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"build default rule info"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'  // build default rule info\n    private RuleDTO buildRpcDefaultRuleDTO(final String selectorId, final MetaDataRegisterDTO metaDataDTO, final String ruleHandler) {\n        return buildRuleDTO(selectorId, ruleHandler, metaDataDTO.getRuleName(), metaDataDTO.getPath());\n    }\n   //  build default rule info\n    private RuleDTO buildRuleDTO(final String selectorId, final String ruleHandler, final String ruleName, final String path) {\n        RuleDTO ruleDTO = RuleDTO.builder()\n                .selectorId(selectorId) //selector Id\n                .name(ruleName) //rule Name\n                .matchMode(MatchModeEnum.AND.getCode()) // default and\n                .enabled(Boolean.TRUE) // default TRUE\n                .loged(Boolean.TRUE) //default TRUE\n                .sort(1) //default 1\n                .handle(ruleHandler)\n                .build();\n        RuleConditionDTO ruleConditionDTO = RuleConditionDTO.builder()\n                .paramType(ParamTypeEnum.URI.getName()) // default URI\n                .paramName("/")\n                .paramValue(path) // path\n                .build();\n        if (path.indexOf("*") > 1) {\n            ruleConditionDTO.setOperator(OperatorEnum.MATCH.getAlias()); //if the path conatins *, default match\n        } else {\n            ruleConditionDTO.setOperator(OperatorEnum.EQ.getAlias()); // default = \n        }\n        ruleDTO.setRuleConditions(Collections.singletonList(ruleConditionDTO));\n        return ruleDTO;\n    }\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"org.apache.shenyu.admin.service.impl.RuleServiceImpl#registerDefault()"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Registration rules: insert records to the database and publish events to the gateway for data synchronization."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'\n    @Override\n    public String registerDefault(final RuleDTO ruleDTO) {\n        RuleDO exist = ruleMapper.findBySelectorIdAndName(ruleDTO.getSelectorId(), ruleDTO.getName());\n        if (Objects.nonNull(exist)) {\n            return "";\n        }\n\n        RuleDO ruleDO = RuleDO.buildRuleDO(ruleDTO);\n        List<RuleConditionDTO> ruleConditions = ruleDTO.getRuleConditions();\n        if (StringUtils.isEmpty(ruleDTO.getId())) {\n            // insert rule into database \n            ruleMapper.insertSelective(ruleDO);\n            //insert rule condition into database \n            ruleConditions.forEach(ruleConditionDTO -> {\n                ruleConditionDTO.setRuleId(ruleDO.getId());           \n                ruleConditionMapper.insertSelective(RuleConditionDO.buildRuleConditionDO(ruleConditionDTO));\n            });\n        }\n        // Publish events to the gateway for data synchronization\n        publishEvent(ruleDO, ruleConditions);\n        return ruleDO.getId();\n    }\n\n'})}),"\n",(0,r.jsx)(n.h6,{id:"1413-register-metadata",children:"1.4.1.3 Register Metadata"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"   @Override\n    public String register(final MetaDataRegisterDTO dto) {\n        //1. register selector\n        //......\n        \n        //2. register rule\n        //......\n        \n        //3. register metadata\n        registerMetadata(dto);\n        \n        //4. register ContextPath\n        //......\n        \n        return ShenyuResultMessage.SUCCESS;\n    }\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"org.apache.shenyu.admin.service.register.ShenyuClientRegisterDivideServiceImpl#registerMetadata()"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Insert or update metadata and then publish sync events to the gateway."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"\n    @Override\n    protected void registerMetadata(final MetaDataRegisterDTO dto) {\n        if (dto.isRegisterMetaData()) { \n            MetaDataService metaDataService = getMetaDataService();\n            MetaDataDO exist = metaDataService.findByPath(dto.getPath());\n            // save or update MetaData\n            metaDataService.saveOrUpdateMetaData(exist, dto);\n        }\n    }\n\n    @Override\n    public void saveOrUpdateMetaData(final MetaDataDO exist, final MetaDataRegisterDTO metaDataDTO) {\n        DataEventTypeEnum eventType;\n        //  DTO->DO\n        MetaDataDO metaDataDO = MetaDataTransfer.INSTANCE.mapRegisterDTOToEntity(metaDataDTO);\n        // insert\n        if (Objects.isNull(exist)) {\n            Timestamp currentTime = new Timestamp(System.currentTimeMillis());\n            metaDataDO.setId(UUIDUtils.getInstance().generateShortUuid());\n            metaDataDO.setDateCreated(currentTime);\n            metaDataDO.setDateUpdated(currentTime);\n            metaDataMapper.insert(metaDataDO);\n            eventType = DataEventTypeEnum.CREATE;\n        } else {\n            // update\n            metaDataDO.setId(exist.getId());\n            metaDataMapper.update(metaDataDO);\n            eventType = DataEventTypeEnum.UPDATE;\n        }\n        // publish event to  gateway\n        eventPublisher.publishEvent(new DataChangedEvent(ConfigGroupEnum.META_DATA, eventType,\n                Collections.singletonList(MetaDataTransfer.INSTANCE.mapToData(metaDataDO))));\n    }\n"})}),"\n",(0,r.jsx)(n.h6,{id:"1414-register-contextpath",children:"1.4.1.4 Register ContextPath"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"   @Override\n    public String register(final MetaDataRegisterDTO dto) {\n        //1. register selector\n        //......\n        \n        //2. register rule\n        //......\n        \n        //3. register metadata\n        //......\n        \n        //4. register ContextPath\n        String contextPath = dto.getContextPath();\n        if (StringUtils.isNotEmpty(contextPath)) {\n            registerContextPath(dto);\n        }\n        return ShenyuResultMessage.SUCCESS;\n    }\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"org.apache.shenyu.admin.service.register.AbstractContextPathRegisterService#registerContextPath()"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'    @Override\n    public void registerContextPath(final MetaDataRegisterDTO dto) {\n        // set contextPath for selector\n        String contextPathSelectorId = getSelectorService().registerDefault(dto, PluginEnum.CONTEXT_PATH.getName(), "");\n        ContextMappingRuleHandle handle = new ContextMappingRuleHandle();\n        handle.setContextPath(PathUtils.decoratorContextPath(dto.getContextPath()));\n        // set contextPath for rule\n        getRuleService().registerDefault(buildContextPathDefaultRuleDTO(contextPathSelectorId, dto, handle.toJson()));\n    }\n'})}),"\n",(0,r.jsx)(n.h5,{id:"142-register-uri",children:"1.4.2 Register URI"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"org.apache.shenyu.admin.service.register.FallbackShenyuClientRegisterService#registerURI()"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The server side receives the ",(0,r.jsx)(n.code,{children:"URI"})," information registered by the client and processes it."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'    @Override\n    public String registerURI(final String selectorName, final List<URIRegisterDTO> uriList) {\n        String result;\n        String key = key(selectorName);\n        try {\n            this.removeFallBack(key);\n            // register URI\n            result = this.doRegisterURI(selectorName, uriList);\n            logger.info("Register success: {},{}", selectorName, uriList);\n        } catch (Exception ex) {\n            logger.warn("Register exception: cause:{}", ex.getMessage());\n            result = "";\n            // Retry after registration failure\n            this.addFallback(key, new FallbackHolder(selectorName, uriList));\n        }\n        return result;\n    }\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"org.apache.shenyu.admin.service.register.AbstractShenyuClientRegisterServiceImpl#doRegisterURI()"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Get a valid ",(0,r.jsx)(n.code,{children:"URI"})," from the ",(0,r.jsx)(n.code,{children:"URI"})," registered by the client, update the corresponding selector ",(0,r.jsx)(n.code,{children:"handle"})," property, and send a selector update event to the gateway."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Override\n    public String doRegisterURI(final String selectorName, final List<URIRegisterDTO> uriList) {\n        //check\n        if (CollectionUtils.isEmpty(uriList)) {\n            return "";\n        }\n        //get selector \n        SelectorDO selectorDO = selectorService.findByNameAndPluginName(selectorName, PluginNameAdapter.rpcTypeAdapter(rpcType()));\n        if (Objects.isNull(selectorDO)) {\n            throw new ShenyuException("doRegister Failed to execute,wait to retry.");\n        }\n        // gte valid URI\n        List<URIRegisterDTO> validUriList = uriList.stream().filter(dto -> Objects.nonNull(dto.getPort()) && StringUtils.isNotBlank(dto.getHost())).collect(Collectors.toList());\n        // build handle\n        String handler = buildHandle(validUriList, selectorDO);\n        if (handler != null) {\n            selectorDO.setHandle(handler);\n            SelectorData selectorData = selectorService.buildByName(selectorName, PluginNameAdapter.rpcTypeAdapter(rpcType()));\n            selectorData.setHandle(handler);\n            // Update the handle property of the selector to the database\n            selectorService.updateSelective(selectorDO);\n            // Send selector update events to the gateway\n            eventPublisher.publishEvent(new DataChangedEvent(ConfigGroupEnum.SELECTOR, DataEventTypeEnum.UPDATE, Collections.singletonList(selectorData)));\n        }\n        return ShenyuResultMessage.SUCCESS;\n    }\n'})}),"\n",(0,r.jsx)(n.p,{children:"The source code analysis on service registration is completed as well as the analysis flow chart is as follows."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:t(1516).A+"",width:"2077",height:"821"})}),"\n",(0,r.jsxs)(n.p,{children:["The next step is to analyze how the ",(0,r.jsx)(n.code,{children:"divide"})," plugin initiates a call to the ",(0,r.jsx)(n.code,{children:"http"})," service based on this information."]}),"\n",(0,r.jsx)(n.h3,{id:"2-call-http-service",children:"2. Call Http Service"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"divide"})," plugin is the core processing plugin used by the gateway to handle ",(0,r.jsx)(n.code,{children:"http protocol"})," requests."]}),"\n",(0,r.jsxs)(n.p,{children:["Take the case provided on the official website ",(0,r.jsx)(n.a,{href:"https://shenyu.apache.org/docs/quick-start/quick-start-http",children:"Quick start with Http"})," as an example, a direct connection request is as follows."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"GET http://localhost:8189/order/findById?id=100\nAccept: application/json\n"})}),"\n",(0,r.jsxs)(n.p,{children:["After proxying through the ",(0,r.jsx)(n.code,{children:"ShenYu"})," gateway, the request is as follows."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"GET http://localhost:9195/http/order/findById?id=100\nAccept: application/json\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The services proxied by the ",(0,r.jsx)(n.code,{children:"ShenYu"})," gateway are still able to request the previous services, where the ",(0,r.jsx)(n.code,{children:"divide"})," plugin comes into play. The class inheritance relationship is as follows."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:t(59988).A+"",width:"470",height:"424"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"ShenyuPlugin: top-level interface, defining interface methods."}),"\n",(0,r.jsx)(n.li,{children:"AbstractShenyuPlugin: abstract class that implements the common logic of the pluin."}),"\n",(0,r.jsx)(n.li,{children:"DividePlugin: Divide pluin."}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"21-accept-request",children:"2.1 Accept Request"}),"\n",(0,r.jsxs)(n.p,{children:["After passing the ",(0,r.jsx)(n.code,{children:"ShenYu"})," gateway proxy, the request entry is ",(0,r.jsx)(n.code,{children:"ShenyuWebHandler"}),", which implements the ",(0,r.jsx)(n.code,{children:"org.springframework.web.server.WebHandler"})," interface."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"public final class ShenyuWebHandler implements WebHandler, ApplicationListener<SortPluginEvent> {\n    //......\n    \n    /**\n     * hanlde web reuest\n     */\n    @Override\n    public Mono<Void> handle(@NonNull final ServerWebExchange exchange) {\n       // execute plugin chain\n        Mono<Void> execute = new DefaultShenyuPluginChain(plugins).execute(exchange);\n        if (scheduled) {\n            return execute.subscribeOn(scheduler);\n        }\n        return execute;\n    }\n    \n    private static class DefaultShenyuPluginChain implements ShenyuPluginChain {\n\n        private int index;\n\n        private final List<ShenyuPlugin> plugins;\n\n        /**\n         * Instantiating the default plugin chain\n         */\n        DefaultShenyuPluginChain(final List<ShenyuPlugin> plugins) {\n            this.plugins = plugins;\n        }\n\n        /**\n         * Execute each plugin\n         */\n        @Override\n        public Mono<Void> execute(final ServerWebExchange exchange) {\n            return Mono.defer(() -> {\n                if (this.index < plugins.size()) {\n                    // get current plugin \n                    ShenyuPlugin plugin = plugins.get(this.index++);\n                    // is skip ?\n                    boolean skip = plugin.skip(exchange);\n                    if (skip) {\n                        // If skipped, execute the next\n                        return this.execute(exchange);\n                    }\n                    // execute current plugin \n                    return plugin.execute(exchange, this);\n                }\n                return Mono.empty();\n            });\n        }\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"22-matching-rule",children:"2.2 Matching rule"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"org.apache.shenyu.plugin.base.AbstractShenyuPlugin#execute()"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Execute the matching logic for selectors and rules in the ",(0,r.jsx)(n.code,{children:"execute()"})," method."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Matching selectors."}),"\n",(0,r.jsx)(n.li,{children:"Matching rules."}),"\n",(0,r.jsx)(n.li,{children:"Execute the plugin."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@Override\n    public Mono<Void> execute(final ServerWebExchange exchange, final ShenyuPluginChain chain) {\n        String pluginName = named();\n        PluginData pluginData = BaseDataCache.getInstance().obtainPluginData(pluginName);\n        if (pluginData != null && pluginData.getEnabled()) {\n            // selector \n            final Collection<SelectorData> selectors = BaseDataCache.getInstance().obtainSelectorData(pluginName);\n            if (CollectionUtils.isEmpty(selectors)) {\n                return handleSelectorIfNull(pluginName, exchange, chain);\n            }\n            // match selector\n            SelectorData selectorData = matchSelector(exchange, selectors);\n            if (Objects.isNull(selectorData)) {\n                return handleSelectorIfNull(pluginName, exchange, chain);\n            }\n            selectorLog(selectorData, pluginName);\n            // rule \n            List<RuleData> rules = BaseDataCache.getInstance().obtainRuleData(selectorData.getId());\n            if (CollectionUtils.isEmpty(rules)) {\n                return handleRuleIfNull(pluginName, exchange, chain);\n            }\n            // match rule \n            RuleData rule;\n            if (selectorData.getType() == SelectorTypeEnum.FULL_FLOW.getCode()) {\n                //get last\n                rule = rules.get(rules.size() - 1);\n            } else {\n                rule = matchRule(exchange, rules);\n            }\n            if (Objects.isNull(rule)) {\n                return handleRuleIfNull(pluginName, exchange, chain);\n            }\n            ruleLog(rule, pluginName);\n            // execute \n            return doExecute(exchange, chain, selectorData, rule);\n        }\n        return chain.execute(exchange);\n    }\n"})}),"\n",(0,r.jsx)(n.h4,{id:"23-execute-divide-plugin",children:"2.3 Execute Divide Plugin"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"org.apache.shenyu.plugin.divide.DividePlugin#doExecute()"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Execute the specific logic of the ",(0,r.jsx)(n.code,{children:"divide"})," plugin in the ",(0,r.jsx)(n.code,{children:"doExecute()"})," method."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Checks the ",(0,r.jsx)(n.code,{children:"header"})," size."]}),"\n",(0,r.jsxs)(n.li,{children:["Checking the ",(0,r.jsx)(n.code,{children:"request"})," size."]}),"\n",(0,r.jsx)(n.li,{children:"Obtaining the list of services."}),"\n",(0,r.jsx)(n.li,{children:"implementing load balancing."}),"\n",(0,r.jsxs)(n.li,{children:["Set request ",(0,r.jsx)(n.code,{children:"url"}),", timeout time, retry policy."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Override\n    protected Mono<Void> doExecute(final ServerWebExchange exchange, final ShenyuPluginChain chain, final SelectorData selector, final RuleData rule) {\n        // shenyu Context\n        ShenyuContext shenyuContext = exchange.getAttribute(Constants.CONTEXT);\n        assert shenyuContext != null;\n        // Get the handle property of the rule\n        DivideRuleHandle ruleHandle = DividePluginDataHandler.CACHED_HANDLE.get().obtainHandle(CacheKeyUtils.INST.getKey(rule));\n        long headerSize = 0;\n        // check header size\n        for (List<String> multiHeader : exchange.getRequest().getHeaders().values()) {\n            for (String value : multiHeader) {\n                headerSize += value.getBytes(StandardCharsets.UTF_8).length;\n            }\n        }\n        if (headerSize > ruleHandle.getHeaderMaxSize()) {\n            LOG.error("request header is too large");\n            Object error = ShenyuResultWrap.error(exchange, ShenyuResultEnum.REQUEST_HEADER_TOO_LARGE, null);\n            return WebFluxResultUtils.result(exchange, error);\n        }\n        \n        // check request size\n        if (exchange.getRequest().getHeaders().getContentLength() > ruleHandle.getRequestMaxSize()) {\n            LOG.error("request entity is too large");\n            Object error = ShenyuResultWrap.error(exchange, ShenyuResultEnum.REQUEST_ENTITY_TOO_LARGE, null);\n            return WebFluxResultUtils.result(exchange, error);\n        }\n        // upstream list\n        List<Upstream> upstreamList = UpstreamCacheManager.getInstance().findUpstreamListBySelectorId(selector.getId());\n        if (CollectionUtils.isEmpty(upstreamList)) {\n            LOG.error("divide upstream configuration error\uff1a {}", rule);\n            Object error = ShenyuResultWrap.error(exchange, ShenyuResultEnum.CANNOT_FIND_HEALTHY_UPSTREAM_URL, null);\n            return WebFluxResultUtils.result(exchange, error);\n        }\n        // request ip\n        String ip = Objects.requireNonNull(exchange.getRequest().getRemoteAddress()).getAddress().getHostAddress();\n        // load balance\n        Upstream upstream = LoadBalancerFactory.selector(upstreamList, ruleHandle.getLoadBalance(), ip);\n        if (Objects.isNull(upstream)) {\n            LOG.error("divide has no upstream");\n            Object error = ShenyuResultWrap.error(exchange, ShenyuResultEnum.CANNOT_FIND_HEALTHY_UPSTREAM_URL, null);\n            return WebFluxResultUtils.result(exchange, error);\n        }\n        // set url\n        String domain = upstream.buildDomain();\n        exchange.getAttributes().put(Constants.HTTP_DOMAIN, domain);\n        // set timeout\n        exchange.getAttributes().put(Constants.HTTP_TIME_OUT, ruleHandle.getTimeout());\n        exchange.getAttributes().put(Constants.HTTP_RETRY, ruleHandle.getRetry());\n        // set retry \n        exchange.getAttributes().put(Constants.RETRY_STRATEGY, ruleHandle.getRetryStrategy());\n        exchange.getAttributes().put(Constants.LOAD_BALANCE, ruleHandle.getLoadBalance());\n        exchange.getAttributes().put(Constants.DIVIDE_SELECTOR_ID, selector.getId());\n        return chain.execute(exchange);\n    }\n'})}),"\n",(0,r.jsx)(n.h4,{id:"24-do-request",children:"2.4 Do Request"}),"\n",(0,r.jsxs)(n.p,{children:["By default, the ",(0,r.jsx)(n.code,{children:"WebClientPlugin"})," initiates a call request to the ",(0,r.jsx)(n.code,{children:"http"})," service with the following class inheritance relationship."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:t(1790).A+"",width:"918",height:"433"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"ShenyuPlugin: top-level plug-in, defining plug-in methods."}),"\n",(0,r.jsx)(n.li,{children:"AbstractHttpClientPlugin: abstract class that implements the public logic of request invocation."}),"\n",(0,r.jsxs)(n.li,{children:["WebClientPlugin: initiating requests through ",(0,r.jsx)(n.code,{children:"WebClient"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["NettyHttpClientPlugin: initiating requests through ",(0,r.jsx)(n.code,{children:"Netty"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Initiate the request call."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"org.apache.shenyu.plugin.httpclient.AbstractHttpClientPlugin#execute()"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Initiate the request call in the ",(0,r.jsx)(n.code,{children:"execute()"})," method."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Get the specified timeout, number of retries"}),"\n",(0,r.jsx)(n.li,{children:"Initiate the request"}),"\n",(0,r.jsx)(n.li,{children:"Retry after failure according to the specified retry policy"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'\npublic abstract class AbstractHttpClientPlugin<R> implements ShenyuPlugin {\n\n    protected static final Logger LOG = LoggerFactory.getLogger(AbstractHttpClientPlugin.class);\n\n    @Override\n    public final Mono<Void> execute(final ServerWebExchange exchange, final ShenyuPluginChain chain) {\n        // shenyu Context\n        final ShenyuContext shenyuContext = exchange.getAttribute(Constants.CONTEXT);\n        assert shenyuContext != null;\n        // uri\n        final URI uri = exchange.getAttribute(Constants.HTTP_URI);\n        if (Objects.isNull(uri)) {\n            Object error = ShenyuResultWrap.error(exchange, ShenyuResultEnum.CANNOT_FIND_URL, null);\n            return WebFluxResultUtils.result(exchange, error);\n        }\n        // get time out\n        final long timeout = (long) Optional.ofNullable(exchange.getAttribute(Constants.HTTP_TIME_OUT)).orElse(3000L);\n        final Duration duration = Duration.ofMillis(timeout);\n        // get retry times\n        final int retryTimes = (int) Optional.ofNullable(exchange.getAttribute(Constants.HTTP_RETRY)).orElse(0);\n        // get retry strategy\n        final String retryStrategy = (String) Optional.ofNullable(exchange.getAttribute(Constants.RETRY_STRATEGY)).orElseGet(RetryEnum.CURRENT::getName);\n        LOG.info("The request urlPath is {}, retryTimes is {}, retryStrategy is {}", uri.toASCIIString(), retryTimes, retryStrategy);\n        // build header\n        final HttpHeaders httpHeaders = buildHttpHeaders(exchange);\n        // do request\n        final Mono<R> response = doRequest(exchange, exchange.getRequest().getMethodValue(), uri, httpHeaders, exchange.getRequest().getBody())\n                .timeout(duration, Mono.error(new TimeoutException("Response took longer than timeout: " + duration)))\n                .doOnError(e -> LOG.error(e.getMessage(), e));\n        \n        // Retry Policy CURRENT, retries the current service.\n        if (RetryEnum.CURRENT.getName().equals(retryStrategy)) {\n            //old version of DividePlugin and SpringCloudPlugin will run on this\n            return response.retryWhen(Retry.anyOf(TimeoutException.class, ConnectTimeoutException.class, ReadTimeoutException.class, IllegalStateException.class)\n                    .retryMax(retryTimes)\n                    .backoff(Backoff.exponential(Duration.ofMillis(200), Duration.ofSeconds(20), 2, true)))\n                    .onErrorMap(TimeoutException.class, th -> new ResponseStatusException(HttpStatus.GATEWAY_TIMEOUT, th.getMessage(), th))\n                    .flatMap((Function<Object, Mono<? extends Void>>) o -> chain.execute(exchange));\n        }\n        \n        // Retry for other services\n        // Exclude services that have already been called\n        final Set<URI> exclude = Sets.newHashSet(uri);\n        // resend\n        return resend(response, exchange, duration, httpHeaders, exclude, retryTimes)\n                .onErrorMap(TimeoutException.class, th -> new ResponseStatusException(HttpStatus.GATEWAY_TIMEOUT, th.getMessage(), th))\n                .flatMap((Function<Object, Mono<? extends Void>>) o -> chain.execute(exchange));\n    }\n\n    private Mono<R> resend(final Mono<R> clientResponse,\n                           final ServerWebExchange exchange,\n                           final Duration duration,\n                           final HttpHeaders httpHeaders,\n                           final Set<URI> exclude,\n                           final int retryTimes) {\n        Mono<R> result = clientResponse;\n        // Retry according to the specified number of retries\n        for (int i = 0; i < retryTimes; i++) {\n            result = resend(result, exchange, duration, httpHeaders, exclude);\n        }\n        return result;\n    }\n\n    private Mono<R> resend(final Mono<R> response,\n                           final ServerWebExchange exchange,\n                           final Duration duration,\n                           final HttpHeaders httpHeaders,\n                           final Set<URI> exclude) {\n        return response.onErrorResume(th -> {\n            final String selectorId = exchange.getAttribute(Constants.DIVIDE_SELECTOR_ID);\n            final String loadBalance = exchange.getAttribute(Constants.LOAD_BALANCE);\n            //Check available services\n            final List<Upstream> upstreamList = UpstreamCacheManager.getInstance().findUpstreamListBySelectorId(selectorId)\n                    .stream().filter(data -> {\n                        final String trimUri = data.getUrl().trim();\n                        for (URI needToExclude : exclude) {\n                            // exclude already called\n                            if ((needToExclude.getHost() + ":" + needToExclude.getPort()).equals(trimUri)) {\n                                return false;\n                            }\n                        }\n                        return true;\n                    }).collect(Collectors.toList());\n            if (CollectionUtils.isEmpty(upstreamList)) {\n                // no need to retry anymore\n                return Mono.error(new ShenyuException(ShenyuResultEnum.CANNOT_FIND_HEALTHY_UPSTREAM_URL_AFTER_FAILOVER.getMsg()));\n            }\n            // requets ip\n            final String ip = Objects.requireNonNull(exchange.getRequest().getRemoteAddress()).getAddress().getHostAddress();\n            // Load Balance\n            final Upstream upstream = LoadBalancerFactory.selector(upstreamList, loadBalance, ip);\n            if (Objects.isNull(upstream)) {\n                // no need to retry anymore\n                return Mono.error(new ShenyuException(ShenyuResultEnum.CANNOT_FIND_HEALTHY_UPSTREAM_URL_AFTER_FAILOVER.getMsg()));\n            }\n            final URI newUri = RequestUrlUtils.buildRequestUri(exchange, upstream.buildDomain());\n            // Exclude uri that has already been called\n            exclude.add(newUri);\n             // Make another call\n            return doRequest(exchange, exchange.getRequest().getMethodValue(), newUri, httpHeaders, exchange.getRequest().getBody())\n                    .timeout(duration, Mono.error(new TimeoutException("Response took longer than timeout: " + duration)))\n                    .doOnError(e -> LOG.error(e.getMessage(), e));\n        });\n    }\n\n    //......\n}\n\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"org.apache.shenyu.plugin.httpclient.WebClientPlugin#doRequest()"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Initiate a real request call via ",(0,r.jsx)(n.code,{children:"webClient"})," in the ",(0,r.jsx)(n.code,{children:"doRequest()"})," method."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"\n@Override\n    protected Mono<ClientResponse> doRequest(final ServerWebExchange exchange, final String httpMethod, final URI uri,\n                                             final HttpHeaders httpHeaders, final Flux<DataBuffer> body) {\n        return webClient.method(HttpMethod.valueOf(httpMethod)).uri(uri) // uri\n                .headers(headers -> headers.addAll(httpHeaders)) // header\n                .body(BodyInserters.fromDataBuffers(body))\n                .exchange() // request\n                .doOnSuccess(res -> {\n                    if (res.statusCode().is2xxSuccessful()) { // success\n                        exchange.getAttributes().put(Constants.CLIENT_RESPONSE_RESULT_TYPE, ResultEnum.SUCCESS.getName());\n                    } else { // error\n                        exchange.getAttributes().put(Constants.CLIENT_RESPONSE_RESULT_TYPE, ResultEnum.ERROR.getName());\n                    }\n                    exchange.getResponse().setStatusCode(res.statusCode());\n                    exchange.getAttributes().put(Constants.CLIENT_RESPONSE_ATTR, res);\n                });\n    }\n"})}),"\n",(0,r.jsx)(n.h4,{id:"25-response-result",children:"2.5 Response Result"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"org.apache.shenyu.plugin.response.ResponsePlugin#execute()"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The response results are handled by the ",(0,r.jsx)(n.code,{children:"ResponsePlugin"})," plugin."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"    @Override\n    public Mono<Void> execute(final ServerWebExchange exchange, final ShenyuPluginChain chain) {\n        ShenyuContext shenyuContext = exchange.getAttribute(Constants.CONTEXT);\n        assert shenyuContext != null;\n        // Processing results according to rpc type\n        return writerMap.get(shenyuContext.getRpcType()).writeWith(exchange, chain);\n    }\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The processing type is determined by ",(0,r.jsx)(n.code,{children:"MessageWriter"})," and the class inheritance relationship is as follows."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:t(33284).A+"",width:"1426",height:"290"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"MessageWriter: interface, defining message processing methods."}),"\n",(0,r.jsxs)(n.li,{children:["NettyClientMessageWriter: processing of ",(0,r.jsx)(n.code,{children:"Netty"})," call results."]}),"\n",(0,r.jsxs)(n.li,{children:["RPCMessageWriter: processing the results of ",(0,r.jsx)(n.code,{children:"RPC"})," calls."]}),"\n",(0,r.jsxs)(n.li,{children:["WebClientMessageWriter: processing ",(0,r.jsx)(n.code,{children:"WebClient"})," call results."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The default is to initiate ",(0,r.jsx)(n.code,{children:"http"})," requests via ",(0,r.jsx)(n.code,{children:"WebCient"}),"."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"org.apache.shenyu.plugin.response.strategy.WebClientMessageWriter#writeWith()"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Process the response results in the ",(0,r.jsx)(n.code,{children:"writeWith()"})," method."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"\n    @Override\n    public Mono<Void> writeWith(final ServerWebExchange exchange, final ShenyuPluginChain chain) {\n        return chain.execute(exchange).then(Mono.defer(() -> {\n            // get response\n            ServerHttpResponse response = exchange.getResponse();\n            ClientResponse clientResponse = exchange.getAttribute(Constants.CLIENT_RESPONSE_ATTR);\n            if (Objects.isNull(clientResponse)) {\n                Object error = ShenyuResultWrap.error(exchange, ShenyuResultEnum.SERVICE_RESULT_ERROR, null);\n                return WebFluxResultUtils.result(exchange, error);\n            }\n            //cookies and headers\n            response.getCookies().putAll(clientResponse.cookies());\n            response.getHeaders().putAll(clientResponse.headers().asHttpHeaders());\n            // image, pdf or stream does not do format processing.\n            // Handling special response types\n            if (clientResponse.headers().contentType().isPresent()) {\n                final String media = clientResponse.headers().contentType().get().toString().toLowerCase();\n                if (media.matches(COMMON_BIN_MEDIA_TYPE_REGEX)) {\n                    return response.writeWith(clientResponse.body(BodyExtractors.toDataBuffers()))\n                            .doOnCancel(() -> clean(exchange));\n                }\n            }\n            // Handling general response types\n            clientResponse = ResponseUtils.buildClientResponse(response, clientResponse.body(BodyExtractors.toDataBuffers()));\n            return clientResponse.bodyToMono(byte[].class)\n                    .flatMap(originData -> WebFluxResultUtils.result(exchange, originData))\n                    .doOnCancel(() -> clean(exchange));\n        }));\n    }\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Analysis to this point, the source code analysis on ",(0,r.jsx)(n.code,{children:"Divide"})," plugin is complete, the analysis flow chart is as follows."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:t(18276).A+"",width:"2065",height:"644"})}),"\n",(0,r.jsx)(n.h3,{id:"3-summary",children:"3. Summary"}),"\n",(0,r.jsxs)(n.p,{children:["The source code analysis in this article starts from the ",(0,r.jsx)(n.code,{children:"http"})," service registration to the ",(0,r.jsx)(n.code,{children:"divide"})," plugin service calls. The ",(0,r.jsx)(n.code,{children:"divide"})," plugin is mainly used to handle ",(0,r.jsx)(n.code,{children:"http"})," requests. Some of the source code does not enter the in-depth analysis, such as the implementation of load balancing, service probe live, will continue to analyze in the following."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);