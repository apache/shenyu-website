"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[51227],{7915(e,n,t){t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"developer/custom-filter","title":"\u81ea\u5b9a\u4e49Filter","description":"filter\u6269\u5c55","source":"@site/i18n/zh/docusaurus-plugin-content-docs/current/developer/custom-filter.md","sourceDirName":"developer","slug":"/developer/custom-filter","permalink":"/zh/docs/next/developer/custom-filter","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/shenyu-website/edit/main/i18n/zh/docusaurus-plugin-content-docs/current/developer/custom-filter.md","tags":[],"version":"current","frontMatter":{"title":"\u81ea\u5b9a\u4e49Filter","description":"filter\u6269\u5c55"},"sidebar":"tutorialSidebar","previous":{"title":"\u81ea\u5b9a\u4e49\u9650\u6d41\u7b56\u7565","permalink":"/zh/docs/next/developer/spi/custom-rate-limiter"},"next":{"title":"\u81ea\u5b9a\u4e49JWT\u63d2\u4ef6\u8f6c\u5316\u7b97\u6cd5","permalink":"/zh/docs/next/developer/custom-jwt-covert-algorithm"}}');var s=t(74848),i=t(28453);const l={title:"\u81ea\u5b9a\u4e49Filter",description:"filter\u6269\u5c55"},o=void 0,a={},c=[{value:"\u8bf4\u660e",id:"\u8bf4\u660e",level:2},{value:"\u8de8\u57df\u652f\u6301",id:"\u8de8\u57df\u652f\u6301",level:2},{value:"\u7f51\u5173\u8fc7\u6ee4 springboot\u5065\u5eb7\u68c0\u67e5",id:"\u7f51\u5173\u8fc7\u6ee4-springboot\u5065\u5eb7\u68c0\u67e5",level:2},{value:"\u7ee7\u627f <code>org.apache.shenyu.web.filter.AbstractWebFilter</code>",id:"\u7ee7\u627f-orgapacheshenyuwebfilterabstractwebfilter",level:2}];function d(e){const n={code:"code",h2:"h2",li:"li",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"\u8bf4\u660e",children:"\u8bf4\u660e"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u672c\u6587\u4ecb\u7ecd\u5982\u4f55\u5bf9 ",(0,s.jsx)(n.code,{children:"org.springframework.web.server.WebFliter"})," \u8fdb\u884c\u6269\u5c55\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u8de8\u57df\u652f\u6301",children:"\u8de8\u57df\u652f\u6301"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u65b0\u589e ",(0,s.jsx)(n.code,{children:"org.apache.shenyu.web.filter.CrossFilter"})," \u5b9e\u73b0 ",(0,s.jsx)(n.code,{children:"WebFilter"}),"\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:' public class CrossFilter implements WebFilter {\n\n     private static final String ALLOWED_HEADERS = "x-requested-with, authorization, Content-Type, Authorization, credential, X-XSRF-TOKEN,token,username,client";\n\n     private static final String ALLOWED_METHODS = "*";\n\n     private static final String ALLOWED_ORIGIN = "*";\n\n     private static final String ALLOWED_EXPOSE = "*";\n\n     private static final String MAX_AGE = "18000";\n\n     @Override\n     @SuppressWarnings("all")\n     public Mono<Void> filter(final ServerWebExchange exchange, final WebFilterChain chain) {\n         ServerHttpRequest request = exchange.getRequest();\n         if (CorsUtils.isCorsRequest(request)) {\n             ServerHttpResponse response = exchange.getResponse();\n             HttpHeaders headers = response.getHeaders();\n             headers.add("Access-Control-Allow-Origin", ALLOWED_ORIGIN);\n             headers.add("Access-Control-Allow-Methods", ALLOWED_METHODS);\n             headers.add("Access-Control-Max-Age", MAX_AGE);\n             headers.add("Access-Control-Allow-Headers", ALLOWED_HEADERS);\n             headers.add("Access-Control-Expose-Headers", ALLOWED_EXPOSE);\n             headers.add("Access-Control-Allow-Credentials", "true");\n             if (request.getMethod() == HttpMethod.OPTIONS) {\n                 response.setStatusCode(HttpStatus.OK);\n                 return Mono.empty();\n             }\n         }\n         return chain.filter(exchange);\n     }\n }\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u5c06 ",(0,s.jsx)(n.code,{children:"CrossFilter"})," \u6ce8\u518c\u6210\u4e3a ",(0,s.jsx)(n.code,{children:"Spring"}),"\u7684",(0,s.jsx)(n.code,{children:"bean"}),"\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u7f51\u5173\u8fc7\u6ee4-springboot\u5065\u5eb7\u68c0\u67e5",children:"\u7f51\u5173\u8fc7\u6ee4 springboot\u5065\u5eb7\u68c0\u67e5"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u6ce8\u610f\u987a\u5e8f\uff0c\u4f7f\u7528 ",(0,s.jsx)(n.code,{children:"@Order"})," \u6ce8\u89e3"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Component\n@Order(-99)\npublic final class HealthFilter implements WebFilter {\n\n    private static final String[] FILTER_TAG = {"/actuator/health", "/health_check"};\n\n    @Override\n    public Mono<Void> filter(@Nullable final ServerWebExchange exchange, @Nullable final WebFilterChain chain) {\n        ServerHttpRequest request = Objects.requireNonNull(exchange).getRequest();\n        String urlPath = request.getURI().getPath();\n        for (String check : FILTER_TAG) {\n            if (check.equals(urlPath)) {\n                String result = JsonUtils.toJson(new Health.Builder().up().build());\n                DataBuffer dataBuffer = exchange.getResponse().bufferFactory().wrap(result.getBytes());\n                return exchange.getResponse().writeWith(Mono.just(dataBuffer));\n            }\n        }\n        return Objects.requireNonNull(chain).filter(exchange);\n    }\n}\n'})}),"\n",(0,s.jsxs)(n.h2,{id:"\u7ee7\u627f-orgapacheshenyuwebfilterabstractwebfilter",children:["\u7ee7\u627f ",(0,s.jsx)(n.code,{children:"org.apache.shenyu.web.filter.AbstractWebFilter"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u65b0\u589e\u4e00\u4e2a\u7c7b\u7ee7\u627f",(0,s.jsx)(n.code,{children:"AbstractWebFilter"}),"\uff0c\u5e76\u5b9e\u73b0\u5b83\u7684\u4e24\u4e2a\u65b9\u6cd5\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"   /**\n     * this is Template Method ,children Implement your own filtering logic.\n     *\n     * @param exchange the current server exchange\n     * @param chain    provides a way to delegate to the next filter\n     * @return {@code Mono<Boolean>} result\uff1aTRUE (is pass)\uff0cand flow next filter\uff1bFALSE (is not pass) execute doDenyResponse(ServerWebExchange exchange)\n     */\n    protected abstract Mono<Boolean> doFilter(ServerWebExchange exchange, WebFilterChain chain);\n\n    /**\n     * this is Template Method ,children Implement your own And response client.\n     *\n     * @param exchange the current server exchange.\n     * @return {@code Mono<Void>} response msg.\n     */\n    protected abstract Mono<Void> doDenyResponse(ServerWebExchange exchange);\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"doFilter"})," \u65b9\u6cd5\u8fd4\u56de ",(0,s.jsx)(n.code,{children:"Mono<true>"})," \u8868\u793a\u901a\u8fc7\uff0c\u53cd\u4e4b\u5219\u4e0d\u901a\u8fc7\uff0c\u4e0d\u901a\u8fc7\u7684\u65f6\u5019\uff0c\u4f1a\u8c03\u7528 ",(0,s.jsx)(n.code,{children:"doDenyResponse"}),"\u8f93\u51fa\u76f8\u5173\u4fe1\u606f\u5230\u524d\u7aef\u3002"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453(e,n,t){t.d(n,{R:()=>l,x:()=>o});var r=t(96540);const s={},i=r.createContext(s);function l(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);