"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[97193],{10646:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/example-selector-en-5f344f0f789b9b37e2ddefe245149eaf.png"},28453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>a});var t=i(96540);const s={},r=t.createContext(s);function l(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),t.createElement(r.Provider,{value:n},e.children)}},29452:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/version2_sign_request_with_body-1823973903b2b06403e1bda8fda9de15.png"},30222:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/version2_sign_request-07e41df7117f83bea75f60631e3c7ec1.png"},34678:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/request_body-1fa3cc7c11fa0dff45216ec5e90c34cd.png"},36867:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/plugin_use_en-8b5661551cdf92fdabc9cb2e7947cffc.jpg"},64234:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>o,frontMatter:()=>r,metadata:()=>a,toc:()=>d});var t=i(74848),s=i(28453);const r={title:"Sign Plugin",keywords:["sign"],description:"sign plugin"},l="1. Overview",a={id:"plugin-center/security/sign-plugin",title:"Sign Plugin",description:"sign plugin",source:"@site/versioned_docs/version-2.7.0.3/plugin-center/security/sign-plugin.md",sourceDirName:"plugin-center/security",slug:"/plugin-center/security/sign-plugin",permalink:"/docs/plugin-center/security/sign-plugin",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/shenyu-website/edit/main/versioned_docs/version-2.7.0.3/plugin-center/security/sign-plugin.md",tags:[],version:"2.7.0.3",frontMatter:{title:"Sign Plugin",keywords:["sign"],description:"sign plugin"},sidebar:"tutorialSidebar",previous:{title:"OAuth2 Plugin",permalink:"/docs/plugin-center/security/oauth2-plugin"},next:{title:"Waf Plugin",permalink:"/docs/plugin-center/security/waf-plugin"}},c={},d=[{value:"1.1 Plugin Name",id:"11-plugin-name",level:2},{value:"1.2 Appropriate Scenario",id:"12-appropriate-scenario",level:2},{value:"1.3 Plugin functionality",id:"13-plugin-functionality",level:2},{value:"1.4 Plugin code",id:"14-plugin-code",level:2},{value:"1.5 Added Since Which shenyu version",id:"15-added-since-which-shenyu-version",level:2},{value:"2.1 Plugin-use procedure chart",id:"21-plugin-use-procedure-chart",level:2},{value:"2.2 Import pom",id:"22-import-pom",level:2},{value:"2.3 Enable plugin",id:"23-enable-plugin",level:2},{value:"2.4 Config Plugin With Authorize\uff081.0.0\uff09",id:"24-config-plugin-with-authorize100",level:2},{value:"2.4.1 AK/SK Config",id:"241-aksk-config",level:3},{value:"2.4.1.1 Explanation",id:"2411-explanation",level:4},{value:"2.4.1.2 Tutorial",id:"2412-tutorial",level:4},{value:"2.4.1.3 PathOperation",id:"2413-pathoperation",level:4},{value:"2.4.2 Implementation of Gateway Technology",id:"242-implementation-of-gateway-technology",level:3},{value:"2.4.3 Authentication Guide",id:"243-authentication-guide",level:3},{value:"2.4.3.1 Generate sign with request header",id:"2431-generate-sign-with-request-header",level:4},{value:"2.4.3.2 Generate sign with request header and request body",id:"2432-generate-sign-with-request-header-and-request-body",level:4},{value:"2.4.4 Request GateWay",id:"244-request-gateway",level:3},{value:"2.4.5 Plugin Config",id:"245-plugin-config",level:3},{value:"2.4.6 Selector Config",id:"246-selector-config",level:3},{value:"2.4.7 Rule Config",id:"247-rule-config",level:3},{value:"2.5 Config Plugin With Authorize\uff082.0.0\uff09",id:"25-config-plugin-with-authorize200",level:2},{value:"2.5.1 Authentication Guide",id:"251-authentication-guide",level:3},{value:"2.5.1.1 prepare",id:"2511-prepare",level:4},{value:"2.5.1.2 Generate Token",id:"2512-generate-token",level:4},{value:"2.5.2 Request GateWay",id:"252-request-gateway",level:3},{value:"2.6 Examples",id:"26-examples",level:2},{value:"2.6.1 Verify api with sign plugin\uff081.0.0\uff09",id:"261-verify-api-with-sign-plugin100",level:3},{value:"2.6.1.1 Plugin Config",id:"2611-plugin-config",level:4},{value:"2.6.1.2 Selector Config",id:"2612-selector-config",level:4},{value:"2.6.1.3 Rule Config",id:"2613-rule-config",level:4},{value:"2.6.1.4 Add AppKey/SecretKey",id:"2614-add-appkeysecretkey",level:4},{value:"2.6.1.5 Request Service and check result",id:"2615-request-service-and-check-result",level:4},{value:"2.6.2 Verify api with sign plugin\uff082.0.0\uff09",id:"262-verify-api-with-sign-plugin200",level:3},{value:"2.6.2.1 Request Service and check result",id:"2621-request-service-and-check-result",level:4}];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"1-overview",children:"1. Overview"}),"\n",(0,t.jsx)(n.h2,{id:"11-plugin-name",children:"1.1 Plugin Name"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Sign Plugin"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"12-appropriate-scenario",children:"1.2 Appropriate Scenario"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Support http header to authorize"}),"\n",(0,t.jsx)(n.li,{children:"Support http header and request body to authorize"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"13-plugin-functionality",children:"1.3 Plugin functionality"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Process signature authentication of requests."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"14-plugin-code",children:"1.4 Plugin code"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Core Module: ",(0,t.jsx)(n.code,{children:"shenyu-plugin-sign"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Core Class: ",(0,t.jsx)(n.code,{children:"org.apache.shenyu.plugin.sign.SignPlugin"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"15-added-since-which-shenyu-version",children:"1.5 Added Since Which shenyu version"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Since ShenYu 2.4.0"}),"\n"]}),"\n",(0,t.jsx)(n.h1,{id:"2-how-to-use-plugin",children:"2. How to use plugin"}),"\n",(0,t.jsx)(n.h2,{id:"21-plugin-use-procedure-chart",children:"2.1 Plugin-use procedure chart"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:i(36867).A+"",width:"343",height:"964"})}),"\n",(0,t.jsx)(n.h2,{id:"22-import-pom",children:"2.2 Import pom"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Introducing ",(0,t.jsx)(n.code,{children:"sign"})," dependency in the ",(0,t.jsx)(n.code,{children:"pom.xml"})," file of the gateway"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:"\x3c!-- apache shenyu sign plugin start--\x3e\n<dependency>\n  <groupId>org.apache.shenyu</groupId>\n  <artifactId>shenyu-spring-boot-starter-plugin-sign</artifactId>\n  <version>${project.version}</version>\n</dependency>\n\x3c!-- apache shenyu sign plugin end--\x3e\n"})}),"\n",(0,t.jsx)(n.h2,{id:"23-enable-plugin",children:"2.3 Enable plugin"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["In ",(0,t.jsx)(n.code,{children:"shenyu-admin"}),"--\x3e BasicConfig --\x3e Plugin --\x3e ",(0,t.jsx)(n.code,{children:"sign"})," set to enable."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"24-config-plugin-with-authorize100",children:"2.4 Config Plugin With Authorize\uff081.0.0\uff09"}),"\n",(0,t.jsx)(n.h3,{id:"241-aksk-config",children:"2.4.1 AK/SK Config"}),"\n",(0,t.jsx)(n.h4,{id:"2411-explanation",children:"2.4.1.1 Explanation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Manage and control the permissions of requests passing through the Apache ShenYu gateway."}),"\n",(0,t.jsxs)(n.li,{children:["Generate ",(0,t.jsx)(n.code,{children:"AK/SK"})," and use it with the ",(0,t.jsx)(n.code,{children:"Sign"})," plugin to achieve precise authority control based on URI level."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"2412-tutorial",children:"2.4.1.2 Tutorial"}),"\n",(0,t.jsxs)(n.p,{children:["First, we can add a piece of authentication information in ",(0,t.jsx)(n.code,{children:"BasicConfig"})," - ",(0,t.jsx)(n.code,{children:"Authentication"})]}),"\n",(0,t.jsx)("img",{src:"/img/shenyu/basicConfig/authorityManagement/auth_manages_add_en.jpg",width:"100%",height:"70%"}),"\n",(0,t.jsx)(n.p,{children:"Then configure this authentication information"}),"\n",(0,t.jsx)("img",{src:"/img/shenyu/basicConfig/authorityManagement/auth_param_en.jpg",width:"50%",height:"40%"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"AppName\uff1aThe application name associated with this account, it can can fill in or choose (data comes from the application name configured in the Metadata)."}),"\n",(0,t.jsx)(n.li,{children:"TelPhone\uff1aTelphone information."}),"\n",(0,t.jsxs)(n.li,{children:["AppParams\uff1aWhen the requested context path is the same as the AppName\uff0cadd this value to the header, the key is ",(0,t.jsx)(n.code,{children:"appParam"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"UserId\uff1aGive the user a name, just as an information record."}),"\n",(0,t.jsx)(n.li,{children:"ExpandInfo\uff1aDescription of the account."}),"\n",(0,t.jsx)(n.li,{children:"PathAuth\uff1aAfter opening, the account only allows access to the resource path configured below."}),"\n",(0,t.jsxs)(n.li,{children:["ResourcePath\uff1aAllow access to the resource path, support path matching\uff0ce.g. ",(0,t.jsx)(n.code,{children:"/order/**"})," ."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["After submit, a piece of authentication information is generated, which contains ",(0,t.jsx)(n.code,{children:"AppKey"})," and ",(0,t.jsx)(n.code,{children:"AppSecret"}),", which is the ",(0,t.jsx)(n.code,{children:"AK/SK"})," in the ",(0,t.jsx)(n.code,{children:"Sign"})," plugin."]}),"\n",(0,t.jsxs)(n.p,{children:["Please refer to the detailed instructions of the ",(0,t.jsx)(n.code,{children:"Sign"})," plugin\uff1a ",(0,t.jsx)(n.a,{href:"../../plugin-center/security/sign-plugin",children:"Sign Plugin"}),"."]}),"\n",(0,t.jsx)(n.h4,{id:"2413-pathoperation",children:"2.4.1.3 PathOperation"}),"\n",(0,t.jsxs)(n.p,{children:["For the created authentication information, you can click ",(0,t.jsx)(n.code,{children:"PathOperation"})," at the end of a piece of authentication information."]}),"\n",(0,t.jsx)("img",{src:"/img/shenyu/basicConfig/authorityManagement/auth_manage_modifyPath_en.jpg",width:"90%",height:"80%"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"On the left is a list of configurable paths, and on the right is a list of paths that allow the account to access."}),"\n",(0,t.jsxs)(n.li,{children:["Check the resource path, click the ",(0,t.jsx)(n.code,{children:">"})," or ",(0,t.jsx)(n.code,{children:"<"})," in the middle to move the checked data to the corresponding list."]}),"\n",(0,t.jsx)(n.li,{children:'In the list of configurable paths on the left, click "Editor" at the end of the account information line, and add them in the "Resource Path" in the pop-up box.'}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"242-implementation-of-gateway-technology",children:"2.4.2 Implementation of Gateway Technology"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Adopt ",(0,t.jsx)(n.code,{children:"AK/SK"})," authentication technical scheme."]}),"\n",(0,t.jsx)(n.li,{children:"Adopt authentication plug-in and Chain of Responsibility Pattern to realize."}),"\n",(0,t.jsx)(n.li,{children:"Take effect when the authentication plugin is enabled and all interfaces are configured for authentication."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"243-authentication-guide",children:"2.4.3 Authentication Guide"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Step 1: ",(0,t.jsx)(n.code,{children:"AK/SK"})," is assigned by the gateway. For example, the ",(0,t.jsx)(n.code,{children:"AK"})," assigned to you is: ",(0,t.jsx)(n.code,{children:"1TEST123456781"})," SK is: ` 506eeb535cf740d7a755cb49f4a1536'"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Step 2: Decide the gateway path you want to access, such as ",(0,t.jsx)(n.code,{children:"/api/service/abc"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Step 3: Construct parameters (the following are general parameters)"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Field"}),(0,t.jsx)(n.th,{children:"Value"}),(0,t.jsx)(n.th,{style:{textAlign:"center"},children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"timestamp"}),(0,t.jsx)(n.td,{children:"current timestamp(String)"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"The number of milliseconds of the current time\uff08gateway will filter requests the before 5 minutes\uff09"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"path"}),(0,t.jsx)(n.td,{children:"/api/service/abc"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"The path that you want to request(Modify by yourself according to your configuration of gateway)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"version"}),(0,t.jsx)(n.td,{children:"1.0.0"}),(0,t.jsxs)(n.td,{style:{textAlign:"center"},children:[(0,t.jsx)(n.code,{children:"1.0.0"})," is a fixed string value"]})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"Sort the above three field natually according to the key, then splice fields and fields, finally splice SK. The following is a code example."}),"\n",(0,t.jsx)(n.h4,{id:"2431-generate-sign-with-request-header",children:"2.4.3.1 Generate sign with request header"}),"\n",(0,t.jsx)(n.p,{children:"Step 1: First, construct a Map."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'\n   Map<String, String> map = Maps.newHashMapWithExpectedSize(3);\n   //timestamp is string format of millisecond. String.valueOf(LocalDateTime.now().toInstant(ZoneOffset.of("+8")).toEpochMilli())\n   map.put("timestamp","1571711067186");  // Value should be string format of milliseconds\n   map.put("path", "/api/service/abc");\n   map.put("version", "1.0.0");\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Step 2: Sort the ",(0,t.jsx)(n.code,{children:"Keys"})," naturally, then splice the key and values, and finally splice the ",(0,t.jsx)(n.code,{children:"SK"})," assigned to you."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'List<String> storedKeys = Arrays.stream(map.keySet()\n                .toArray(new String[]{}))\n                .sorted(Comparator.naturalOrder())\n                .collect(Collectors.toList());\nfinal String sign = storedKeys.stream()\n                .map(key -> String.join("", key, map.get(key)))\n                .collect(Collectors.joining()).trim()\n                .concat("506EEB535CF740D7A755CB4B9F4A1536");\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The returned sign value should be:",(0,t.jsx)(n.code,{children:"path/api/service/abctimestamp1571711067186version1.0.0506EEB535CF740D7A755CB4B9F4A1536"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Step 3: Md5 encryption and then capitalization."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"DigestUtils.md5DigestAsHex(sign.getBytes()).toUpperCase()\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The final returned value is: ",(0,t.jsx)(n.code,{children:"A021BF82BE342668B78CD9ADE593D683"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"2432-generate-sign-with-request-header-and-request-body",children:"2.4.3.2 Generate sign with request header and request body"}),"\n",(0,t.jsx)(n.p,{children:"Step 1: First, construct a Map, and the map must save every request body parameters"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'\n   Map<String, String> map = Maps.newHashMapWithExpectedSize(3);\n   //timestamp is string format of millisecond. String.valueOf(LocalDateTime.now().toInstant(ZoneOffset.of("+8")).toEpochMilli())\n   map.put("timestamp","1660659201000");  // Value should be string format of milliseconds\n   map.put("path", "/http/order/save");\n   map.put("version", "1.0.0");\n   // if your request body is:{"id":123,"name":"order"}\n   map.put("id", "1");\n   map.put("name", "order")\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Step 2: Sort the ",(0,t.jsx)(n.code,{children:"Keys"})," naturally, then splice the key and values, and finally splice the ",(0,t.jsx)(n.code,{children:"SK"})," assigned to you."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'List<String> storedKeys = Arrays.stream(map.keySet()\n                .toArray(new String[]{}))\n                .sorted(Comparator.naturalOrder())\n                .collect(Collectors.toList());\nfinal String sign = storedKeys.stream()\n                .map(key -> String.join("", key, map.get(key)))\n                .collect(Collectors.joining()).trim()\n                .concat("2D47C325AE5B4A4C926C23FD4395C719");\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The returned sign value should be:",(0,t.jsx)(n.code,{children:"id123nameorderpath/http/order/savetimestamp1660659201000version1.0.02D47C325AE5B4A4C926C23FD4395C719"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Step 3: Md5 encryption and then capitalization."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"DigestUtils.md5DigestAsHex(sign.getBytes()).toUpperCase()\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The final returned value is: ",(0,t.jsx)(n.code,{children:"35FE61C21F73E9AAFC46954C14F299D7"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"244-request-gateway",children:"2.4.4 Request GateWay"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["If your visited path is:",(0,t.jsx)(n.code,{children:"/api/service/abc"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Address: http: domain name of gateway ",(0,t.jsx)(n.code,{children:"/api/service/abc"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Set ",(0,t.jsx)(n.code,{children:"header"}),"\uff0c",(0,t.jsx)(n.code,{children:"header"})," Parameter\uff1a"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Field"}),(0,t.jsx)(n.th,{style:{textAlign:"right"},children:"Value"}),(0,t.jsx)(n.th,{style:{textAlign:"center"},children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"timestamp"}),(0,t.jsx)(n.td,{style:{textAlign:"right"},children:(0,t.jsx)(n.code,{children:"1571711067186"})}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"Timestamp when signing"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"appKey"}),(0,t.jsx)(n.td,{style:{textAlign:"right"},children:(0,t.jsx)(n.code,{children:"1TEST123456781"})}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"The AK value assigned to you"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"sign"}),(0,t.jsx)(n.td,{style:{textAlign:"right"},children:(0,t.jsx)(n.code,{children:"A90E66763793BDBC817CF3B52AAAC041"})}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"The signature obtained above"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"version"}),(0,t.jsx)(n.td,{style:{textAlign:"right"},children:(0,t.jsx)(n.code,{children:"1.0.0"})}),(0,t.jsxs)(n.td,{style:{textAlign:"center"},children:[(0,t.jsx)(n.code,{children:"1.0.0"})," is a fixed value."]})]})]})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["The signature plugin will filter requests before ",(0,t.jsx)(n.code,{children:"5"})," minutes by default"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["If the authentication fails, will return code ",(0,t.jsx)(n.code,{children:"401"}),", message may change."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "code": 401,\n  "message": "sign is not pass,Please check you sign algorithm!",\n  "data": null\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"245-plugin-config",children:"2.4.5 Plugin Config"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:i(80416).A+"",width:"1604",height:"1210"})}),"\n",(0,t.jsx)(n.h3,{id:"246-selector-config",children:"2.4.6 Selector Config"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:i(86183).A+"",width:"2256",height:"1279"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Only those matched requests can be authenticated by signature."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Selectors and rules, please refer to: ",(0,t.jsx)(n.a,{href:"../../user-guide/admin-usage/selector-and-rule",children:"Selector And Rule Config"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"247-rule-config",children:"2.4.7 Rule Config"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:i(83480).A+"",width:"2256",height:"1279"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"close(signRequestBody): generate signature with request header."}),"\n",(0,t.jsx)(n.li,{children:"open(signRequestBody): generate signature with request header and request body."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"25-config-plugin-with-authorize200",children:"2.5 Config Plugin With Authorize\uff082.0.0\uff09"}),"\n",(0,t.jsxs)(n.p,{children:["This authentication algorithm is the version 2.0.0 algorithm, which is same as version1's except ",(0,t.jsx)(n.strong,{children:"Authentication Guide"})," and ",(0,t.jsx)(n.strong,{children:"Request GateWay."})]}),"\n",(0,t.jsx)(n.h3,{id:"251-authentication-guide",children:"2.5.1 Authentication Guide"}),"\n",(0,t.jsxs)(n.p,{children:["Authentication algorithm of Version 2.0.0 generates a Token based on the signature algorithm, and puts the Token value into the request header ",(0,t.jsx)(n.code,{children:"ShenYu-Authorization"})," parameter when sending a request. To distinguish it from version 1.0.0, the ",(0,t.jsx)(n.code,{children:"version"})," parameter of the request header is left, which is 2.0.0."]}),"\n",(0,t.jsx)(n.h4,{id:"2511-prepare",children:"2.5.1.1 prepare"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Step 1: ",(0,t.jsx)(n.code,{children:"AK/SK"})," is assigned by the gateway. For example, the ",(0,t.jsx)(n.code,{children:"AK"})," assigned to you is: ",(0,t.jsx)(n.code,{children:"1TEST123456781"})," SK is: ` 506eeb535cf740d7a755cb49f4a1536'"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Step 2: Decide the gateway path you want to access, such as ",(0,t.jsx)(n.code,{children:"/api/service/abc"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"2512-generate-token",children:"2.5.1.2 Generate Token"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"build parameter"}),"\n",(0,t.jsxs)(n.p,{children:["build the ",(0,t.jsx)(n.code,{children:"parameters"})," that is json string"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n    "alg":"MD5",\n    "appKey":"506EEB535CF740D7A755CB4B9F4A1536",\n    "timestamp":"1571711067186"\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"alg"}),": signature algorithm\uff08result is uppercase HEX string\uff09"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"MD5: MD5-HASH(data+key)"}),"\n",(0,t.jsxs)(n.li,{children:["HMD5",":HMAC-MD5"]}),"\n",(0,t.jsxs)(n.li,{children:["HS256",":HMAC-SHA-256"]}),"\n",(0,t.jsxs)(n.li,{children:["HS512",":HMAC-SHA-512"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"appKey"}),"\uff1aappKey"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"timestamp"}),": timestamp of the length is 13"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Calculate signature value"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tex",children:'signature = sign(\n  base64Encoding(parameters) + Relative URL + Body*,\n  secret\n);\n* indicate Optional , it depends on handler config\nRelative URL = path [ "?" query ] eg: /apache/shenyu/pulls?name=jack\n'})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["note :",(0,t.jsx)(n.code,{children:"Relative URL"})," is not include fragment"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Calculate Token"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"token = base64Encoding(parameters) + '.' + base64Encoding(signature)"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Put the Token into the request header ",(0,t.jsx)(n.code,{children:"ShenYu-Authorization"})," parameter."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"252-request-gateway",children:"2.5.2 Request GateWay"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"Field"}),(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"\u503c"}),(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"\u63cf\u8ff0"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"ShenYu-Authorization"}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"Token"}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"Token"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"version"}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"2.0.0"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"Fixed value"})]})]})]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"please change the Authorization field to ShenYu-Authorization as soon as possible to avoid conflicts with application Authorization."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"26-examples",children:"2.6 Examples"}),"\n",(0,t.jsx)(n.h3,{id:"261-verify-api-with-sign-plugin100",children:"2.6.1 Verify api with sign plugin\uff081.0.0\uff09"}),"\n",(0,t.jsx)(n.h4,{id:"2611-plugin-config",children:"2.6.1.1 Plugin Config"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:i(80416).A+"",width:"1604",height:"1210"})}),"\n",(0,t.jsx)(n.h4,{id:"2612-selector-config",children:"2.6.1.2 Selector Config"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:i(10646).A+"",width:"2052",height:"996"})}),"\n",(0,t.jsx)(n.h4,{id:"2613-rule-config",children:"2.6.1.3 Rule Config"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:i(85709).A+"",width:"2256",height:"1279"})}),"\n",(0,t.jsx)(n.h4,{id:"2614-add-appkeysecretkey",children:"2.6.1.4 Add AppKey/SecretKey"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:i(71537).A+"",width:"2256",height:"1279"})}),"\n",(0,t.jsx)(n.h4,{id:"2615-request-service-and-check-result",children:"2.6.1.5 Request Service and check result"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["build request params with ",(0,t.jsx)(n.code,{children:"Authentication Guide"}),","]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'public class Test1 {\n  public static void main(String[] args) {\n    Map<String, String> map = Maps.newHashMapWithExpectedSize(3);\n    //timestamp\u4e3a\u6beb\u79d2\u6570\u7684\u5b57\u7b26\u4e32\u5f62\u5f0f String.valueOf(LocalDateTime.now().toInstant(ZoneOffset.of("+8")).toEpochMilli())\n    map.put("timestamp","1660658725000");  //\u503c\u5e94\u8be5\u4e3a\u6beb\u79d2\u6570\u7684\u5b57\u7b26\u4e32\u5f62\u5f0f\n    map.put("path", "/http/order/save");\n    map.put("version", "1.0.0");\n    map.put("id", "123");\n    map.put("name", "order");\n    // map.put("body", "{\\"id\\":123,\\"name\\":\\"order\\"}");\n\n    List<String> storedKeys = Arrays.stream(map.keySet()\n                    .toArray(new String[]{}))\n            .sorted(Comparator.naturalOrder())\n            .collect(Collectors.toList());\n    final String sign = storedKeys.stream()\n            .map(key -> String.join("", key, map.get(key)))\n            .collect(Collectors.joining()).trim()\n            .concat("2D47C325AE5B4A4C926C23FD4395C719");\n    System.out.println(sign);\n\n    System.out.println(DigestUtils.md5DigestAsHex(sign.getBytes()).toUpperCase());\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["signature without body: ",(0,t.jsx)(n.code,{children:"path/http/order/savetimestamp1571711067186version1.0.02D47C325AE5B4A4C926C23FD4395C719"})]}),"\n",(0,t.jsxs)(n.li,{children:["sign without body result is: ",(0,t.jsx)(n.code,{children:"9696D3E549A6AEBE763CCC2C7952DDC1"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:i(75119).A+"",width:"1440",height:"843"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'public class Test2 {\n  public static void main(String[] args) {\n    Map<String, String> map = Maps.newHashMapWithExpectedSize(3);\n    //timestamp\u4e3a\u6beb\u79d2\u6570\u7684\u5b57\u7b26\u4e32\u5f62\u5f0f String.valueOf(LocalDateTime.now().toInstant(ZoneOffset.of("+8")).toEpochMilli())\n    map.put("timestamp","1660659201000");  //\u503c\u5e94\u8be5\u4e3a\u6beb\u79d2\u6570\u7684\u5b57\u7b26\u4e32\u5f62\u5f0f\n    map.put("path", "/http/order/save");\n    map.put("version", "1.0.0");\n\n    List<String> storedKeys = Arrays.stream(map.keySet()\n                    .toArray(new String[]{}))\n            .sorted(Comparator.naturalOrder())\n            .collect(Collectors.toList());\n    final String sign = storedKeys.stream()\n            .map(key -> String.join("", key, map.get(key)))\n            .collect(Collectors.joining()).trim()\n            .concat("2D47C325AE5B4A4C926C23FD4395C719");\n    System.out.println(sign);\n\n    System.out.println(DigestUtils.md5DigestAsHex(sign.getBytes()).toUpperCase());\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["*signature with body:",(0,t.jsx)(n.code,{children:"id123nameorderpath/http/order/savetimestamp1660659201000version1.0.02D47C325AE5B4A4C926C23FD4395C719"}),"\n*sign with body result is:",(0,t.jsx)(n.code,{children:"35FE61C21F73E9AAFC46954C14F299D7"})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:i(76289).A+"",width:"1300",height:"833"})}),"\n",(0,t.jsx)(n.h3,{id:"262-verify-api-with-sign-plugin200",children:"2.6.2 Verify api with sign plugin\uff082.0.0\uff09"}),"\n",(0,t.jsx)(n.p,{children:"All the configuration parts are the same, so let's look directly at the the calculation part of parameter of request header and the part of sending request."}),"\n",(0,t.jsx)(n.h4,{id:"2621-request-service-and-check-result",children:"2.6.2.1 Request Service and check result"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"implements the algorithm"}),"\n",(0,t.jsx)(n.p,{children:"Suppose we use a signature algorithm named MD5. According to the previous description, the signature value is to concatenate the data and key, and then hash."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'    private static String sign(final String signKey, final String base64Parameters, final URI uri, final String body) {\n\n        String data = base64Parameters\n                + getRelativeURL(uri)\n                + Optional.ofNullable(body).orElse("");\n\n        return DigestUtils.md5Hex(data+signKey).toUpperCase();\n    }\n\n    private static String getRelativeURL(final URI uri) {\n        if (Objects.isNull(uri.getQuery())) {\n            return uri.getPath();\n        }\n        return uri.getPath() + "?" + uri.getQuery();\n    }\n'})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"verify without the request body"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'public static void main(String[] args) {\n    \n    String appSecret = "2D47C325AE5B4A4C926C23FD4395C719";\n\n    URI uri = URI.create("/http/order/save");\n\n    String parameters = JsonUtils.toJson(ImmutableMap.of(\n        "alg","MD5",\n        "appKey","BD7980F5688A4DE6BCF1B5327FE07F5C",\n        "timestamp","1673708353996"));\n\n    String base64Parameters = Base64.getEncoder()\n        .encodeToString(parameters.getBytes(StandardCharsets.UTF_8));\n\n    String signature = sign(appSecret,base64Parameters,uri,null);\n\n    String Token = base64Parameters+"."+signature;\n\n    System.out.println(Token);\n\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Token:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tex",children:"eyJhbGciOiJNRDUiLCJhcHBLZXkiOiJCRDc5ODBGNTY4OEE0REU2QkNGMUI1MzI3RkUwN0Y1QyIsInRpbWVzdGFtcCI6IjE2NzM3MDgzNTM5OTYifQ==.33ED53DF79CA5B53C0BF2448B670AF35\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u53d1\u9001\u8bf7\u6c42\uff1a"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"image-20230114230500887",src:i(30222).A+"",width:"1048",height:"713"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"verify with the request body"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'    public static void main(String[] args) {\n        String appSecret = "2D47C325AE5B4A4C926C23FD4395C719";\n\n        URI uri = URI.create("/http/order/save");\n\n        String parameters = JsonUtils.toJson(ImmutableMap.of(\n                "alg","MD5",\n                "appKey","BD7980F5688A4DE6BCF1B5327FE07F5C",\n                "timestamp","1673708905488"));\n\n        String base64Parameters = Base64.getEncoder()\n                .encodeToString(parameters.getBytes(StandardCharsets.UTF_8));\n\n        String requestBody = "{\\"id\\":123,\\"name\\":\\"order\\"}";\n\n        String signature = sign(appSecret,base64Parameters,uri,requestBody);\n\n        String Token = base64Parameters+"."+signature;\n\n        System.out.println(Token);\n\n    }\n'})}),"\n",(0,t.jsx)(n.p,{children:"Token:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tex",children:"eyJhbGciOiJNRDUiLCJhcHBLZXkiOiJCRDc5ODBGNTY4OEE0REU2QkNGMUI1MzI3RkUwN0Y1QyIsInRpbWVzdGFtcCI6IjE2NzM3MDg5MDU0ODgifQ==.FBCEB6D816644A98378635050AB85EF1\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"image-20230114231032837",src:i(34678).A+"",width:"1032",height:"400"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"image-20230114230922598",src:i(29452).A+"",width:"1049",height:"683"})}),"\n",(0,t.jsx)(n.h1,{id:"3-how-to-disable-plugin",children:"3. How to disable plugin"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["In ",(0,t.jsx)(n.code,{children:"shenyu-admin"}),"--\x3e BasicConfig --\x3e Plugin --\x3e ",(0,t.jsx)(n.code,{children:"sign"})," set to disabled."]}),"\n"]}),"\n",(0,t.jsx)(n.h1,{id:"4-extension",children:"4. Extension"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Please refer to: ",(0,t.jsx)(n.a,{href:"../../developer/custom-sign-algorithm",children:"dev-sign"}),"."]}),"\n"]})]})}function o(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},71537:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/example-sign-auth-en-7531558c55916cf987b149f58a336d16.png"},75119:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/result-1c40210c3da55750298242b3b037f289.png"},76289:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/result-with-body-d430bbcc77fef2c8bdd89cace7d6e418.png"},80416:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/sign_open_en-7a1bcfbe89eec35490eec64c037a7103.jpg"},83480:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/rule-en-66585f6eca8f875a4a6e1fd5c65646d1.png"},85709:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/example-rule-en-503e8b5697e5aada40d67b999ce281c7.png"},86183:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/selector-en-993bda66883505a34953d527663d7475.png"}}]);