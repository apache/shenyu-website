"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[19954],{28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>a});var s=t(96540);const r={},o=s.createContext(r);function i(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(o.Provider,{value:n},e.children)}},94424:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>a,toc:()=>l});var s=t(74848),r=t(28453);const o={title:"Custom Response",keywords:["Custom Response"],description:"customising response structure"},i=void 0,a={id:"developer/custom-result",title:"Custom Response",description:"customising response structure",source:"@site/versioned_docs/version-2.4.2/developer/custom-result.md",sourceDirName:"developer",slug:"/developer/custom-result",permalink:"/docs/2.4.2/developer/custom-result",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/shenyu-website/edit/main/versioned_docs/version-2.4.2/developer/custom-result.md",tags:[],version:"2.4.2",frontMatter:{title:"Custom Response",keywords:["Custom Response"],description:"customising response structure"},sidebar:"tutorialSidebar",previous:{title:"Custom Plugin",permalink:"/docs/2.4.2/developer/custom-plugin"},next:{title:"Custom Sign Algorithm",permalink:"/docs/2.4.2/developer/custom-sign-algorithm"}},c={},l=[{value:"Description",id:"description",level:2},{value:"Default Implementation",id:"default-implementation",level:2},{value:"Extensions",id:"extensions",level:2}];function d(e){const n={blockquote:"blockquote",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"description",children:"Description"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["This doc offers examples for customising response structure in ",(0,s.jsx)(n.code,{children:"Apache ShenYu"})," gateway."]}),"\n",(0,s.jsx)(n.li,{children:"The response body structure in gateways should be unified, it is recommended for specify yours."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"default-implementation",children:"Default Implementation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The default implementation class is ",(0,s.jsx)(n.code,{children:"org.apache.shenyu.plugin.api.result.DefaultShenyuResult"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"Following is the response structure:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"public class ShenyuDefaultEntity implements Serializable {\n\n    private static final long serialVersionUID = -2792556188993845048L;\n\n    private Integer code;\n\n    private String message;\n\n    private Object data;\n\n}\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The returned ",(0,s.jsx)(n.code,{children:"json"})," as follows:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n    "code": -100, //response code,\n    "message": "Your parameter error, please check the relevant documentation!", //hint messages\n    "data": null  // business data\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"extensions",children:"Extensions"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Declare a new class named ",(0,s.jsx)(n.code,{children:"CustomShenyuResult"})," and implements ",(0,s.jsx)(n.code,{children:"org.apache.shenyu.plugin.api.result.ShenyuResult"})]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"/**\n * The interface shenyu result.\n */\npublic interface ShenyuResult<T> {\n\n    /**\n     * The response result.\n     *\n     * @param exchange the exchange\n     * @param formatted the formatted object\n     * @return the result object\n     */\n    default Object result(ServerWebExchange exchange, Object formatted) {\n        return formatted;\n    }\n\n    /**\n     * format the origin, default is json format.\n     *\n     * @param exchange the exchange\n     * @param origin the origin\n     * @return format origin\n     */\n    default Object format(ServerWebExchange exchange, Object origin) {\n        // basic data\n        if (ObjectTypeUtils.isBasicType(origin)) {\n            return origin;\n        }\n        // error result or rpc origin result.\n        return JsonUtils.toJson(origin);\n    }\n\n    /**\n     * the response context type, default is application/json.\n     *\n     * @param exchange the exchange\n     * @param formatted the formatted data that is origin data or byte[] convert string\n     * @return the context type\n     */\n    default MediaType contentType(ServerWebExchange exchange, Object formatted) {\n        return MediaType.APPLICATION_JSON;\n    }\n\n    /**\n     * Error t.\n     *\n     * @param code    the code\n     * @param message the message\n     * @param object  the object\n     * @return the t\n     */\n    T error(int code, String message, Object object);\n}\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["Processing sequence: ",(0,s.jsx)(n.code,{children:"format"}),"->",(0,s.jsx)(n.code,{children:"contextType"}),"->",(0,s.jsx)(n.code,{children:"result"}),". The ",(0,s.jsx)(n.code,{children:"format"})," method performs data formatting. If the data is a basic type and returns itself, other types are converted to ",(0,s.jsx)(n.code,{children:"JSON"}),", and the parameter ",(0,s.jsx)(n.code,{children:"origin"})," is the original data. Formatting can be performed according to the situation. ",(0,s.jsx)(n.code,{children:"contextType"}),", if it is a basic type, use ",(0,s.jsx)(n.code,{children:"text/plain"}),", the default is ",(0,s.jsx)(n.code,{children:"application/json"}),", the parameter ",(0,s.jsx)(n.code,{children:"formatted"})," is the data processed by the ",(0,s.jsx)(n.code,{children:"format"})," method, and can be combined with the return result of ",(0,s.jsx)(n.code,{children:"format"})," for data type Define processing. The parameter ",(0,s.jsx)(n.code,{children:"formatted"})," of ",(0,s.jsx)(n.code,{children:"result"})," is the data processed by the ",(0,s.jsx)(n.code,{children:"format"})," method, which returns to itself by default, and can be combined with the return result of ",(0,s.jsx)(n.code,{children:"format"})," for custom processing of the data type."]}),"\n"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"T"})," is a generic parameter for your response data."]}),"\n",(0,s.jsxs)(n.li,{children:["Register defined class as a ",(0,s.jsx)(n.code,{children:"Spring Bean"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"@Bean\npublic ShenyuResult<?> customShenyuResult() {\n    return new CustomShenyuResult();\n}\n"})})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);