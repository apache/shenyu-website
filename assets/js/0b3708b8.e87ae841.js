"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[58009],{28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>a});var t=i(96540);const s={},l=t.createContext(s);function r(e){const n=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(l.Provider,{value:n},e.children)}},50875:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>a,toc:()=>c});var t=i(74848),s=i(28453);const l={sidebar_position:11,title:"Sign Plugin",keywords:["sign"],description:"sign plugin"},r=void 0,a={id:"plugins/sign-plugin",title:"Sign Plugin",description:"sign plugin",source:"@site/versioned_docs/version-2.3.0-Legacy/plugins/sign-plugin.md",sourceDirName:"plugins",slug:"/plugins/sign-plugin",permalink:"/docs/2.3.0-Legacy/plugins/sign-plugin",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/shenyu-website/edit/main/versioned_docs/version-2.3.0-Legacy/plugins/sign-plugin.md",tags:[],version:"2.3.0-Legacy",sidebarPosition:11,frontMatter:{sidebar_position:11,title:"Sign Plugin",keywords:["sign"],description:"sign plugin"},sidebar:"tutorialSidebar",previous:{title:"Waf Plugin",permalink:"/docs/2.3.0-Legacy/plugins/waf-plugin"},next:{title:"Rewrite Plugin",permalink:"/docs/2.3.0-Legacy/plugins/rewrite-plugin"}},d={},c=[{value:"Explanation",id:"explanation",level:2},{value:"Plugin Setting",id:"plugin-setting",level:2},{value:"Plugin Usage",id:"plugin-usage",level:2},{value:"Add AK/SK",id:"add-aksk",level:2},{value:"Implementation of Gateway Technology",id:"implementation-of-gateway-technology",level:2},{value:"Authentication Guide",id:"authentication-guide",level:2},{value:"Request GateWay",id:"request-gateway",level:2},{value:"Extension",id:"extension",level:2}];function o(e){const n={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"explanation",children:"Explanation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Sign is a native plugin of soul Gateway and is used to process signature authentication of requests."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"plugin-setting",children:"Plugin Setting"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["In ",(0,t.jsx)(n.code,{children:"soul-admin"})," -> plugin management --\x3e ",(0,t.jsx)(n.code,{children:"sign"})," set to enable."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"plugin-usage",children:"Plugin Usage"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Introducing ",(0,t.jsx)(n.code,{children:"sign"})," dependency in the pom.xml file of the gateway"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:"  \x3c!-- soul sign plugin start--\x3e\n  <dependency>\n      <groupId>org.dromara</groupId>\n      <artifactId>soul-spring-boot-starter-plugin-sign</artifactId>\n     <version>${last.version}</version>\n  </dependency>\n  \x3c!-- soul sign plugin end--\x3e\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Selectors and rules, please refer to: ",(0,t.jsx)(n.a,{href:"../admin/selector-and-rule",children:"selector"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Only those matched requests can be authenticated by signature."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"add-aksk",children:"Add AK/SK"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["In soul-admin --\x3e In authentication management, click ",(0,t.jsx)(n.code,{children:"Add"})," to add a new AK/SK\u3002"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"implementation-of-gateway-technology",children:"Implementation of Gateway Technology"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Adopt Ak/SK authentication technical scheme."}),"\n",(0,t.jsx)(n.li,{children:"Adopt authentication plug-in and Chain of Responsibility Pattern to realize."}),"\n",(0,t.jsx)(n.li,{children:"Take effect when the authentication plugin is enabled and all interfaces are configured for authentication."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"authentication-guide",children:"Authentication Guide"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Step 1: AK/SK is assigned by the gateway. For example, the AK assigned to you is: ",(0,t.jsx)(n.code,{children:"1test123456781"})," SK is: ` 506eeb535cf740d7a755cb49f4a1536'"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Step 2: Decide the gateway path you want to access, such as ` /api/service/abc'"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Step 3: Construct parameters (the following are general parameters)"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Field"}),(0,t.jsx)(n.th,{children:"Value"}),(0,t.jsx)(n.th,{style:{textAlign:"center"},children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"timestamp"}),(0,t.jsx)(n.td,{children:"current timestamp(String)"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"The number of milliseconds of the current time\uff08gateway will filter requests the before 5 minutes\uff09"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"path"}),(0,t.jsx)(n.td,{children:"/api/service/abc"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"The path that you want to request(Modify by yourself according to your configuration of gateway)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"version"}),(0,t.jsx)(n.td,{children:"1.0.0"}),(0,t.jsxs)(n.td,{style:{textAlign:"center"},children:[(0,t.jsx)(n.code,{children:"1.0.0"})," is a fixed string value"]})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"Sort the above two field natually according to the key, then splice fields and fields, finally splice SK. The following is a code example."}),"\n",(0,t.jsx)(n.p,{children:"Step 1: First, construct a Map."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'\n   Map<String, String> map = Maps.newHashMapWithExpectedSize(2);\n   //timestamp is string format of millisecond. String.valueOf(LocalDateTime.now().toInstant(ZoneOffset.of("+8")).toEpochMilli()) \n   map.put("timestamp","1571711067186");  // Value should be string format of milliseconds\n   map.put("path", "/api/service/abc");\n   map.put("version", "1.0.0");\n'})}),"\n",(0,t.jsx)(n.p,{children:"Step 2: Sort the Keys naturally, then splice the key and values, and finally splice the SK assigned to you."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'List<String> storedKeys = Arrays.stream(map.keySet()\n                .toArray(new String[]{}))\n                .sorted(Comparator.naturalOrder())\n                .collect(Collectors.toList());\nfinal String sign = storedKeys.stream()\n                .map(key -> String.join("", key, params.get(key)))\n                .collect(Collectors.joining()).trim()\n                .concat("506EEB535CF740D7A755CB4B9F4A1536");\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The returned sign value should be",":path","/api/service/abctimestamp1571711067186version1.0.0506EEB535CF740D7A755CB4B9F4A1536"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Step 3: Md5 encryption and then capitalization."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"DigestUtils.md5DigestAsHex(sign.getBytes()).toUpperCase()\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The final returned value is",":A021BF82BE342668B78CD9ADE593D683"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"request-gateway",children:"Request GateWay"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"If your visited path is:/api/service/abc\u3002"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Address: http: domain name of gateway /api/service/abc."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Set ",(0,t.jsx)(n.code,{children:"header"}),"\uff0c",(0,t.jsx)(n.code,{children:"header"})," Parameter\uff1a"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Field"}),(0,t.jsx)(n.th,{style:{textAlign:"right"},children:"Value"}),(0,t.jsx)(n.th,{style:{textAlign:"center"},children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"timestamp"}),(0,t.jsx)(n.td,{style:{textAlign:"right"},children:(0,t.jsx)(n.code,{children:"1571711067186"})}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"Timestamp when signing"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"appKey"}),(0,t.jsx)(n.td,{style:{textAlign:"right"},children:(0,t.jsx)(n.code,{children:"1TEST123456781"})}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"The AK value assigned to you"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"sign"}),(0,t.jsx)(n.td,{style:{textAlign:"right"},children:(0,t.jsx)(n.code,{children:"A90E66763793BDBC817CF3B52AAAC041"})}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"The signature obtained above"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"version"}),(0,t.jsx)(n.td,{style:{textAlign:"right"},children:(0,t.jsx)(n.code,{children:"1.0.0"})}),(0,t.jsxs)(n.td,{style:{textAlign:"center"},children:[(0,t.jsx)(n.code,{children:"1.0.0"})," is a fixed value."]})]})]})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"The signature plugin will filter requests after 5 minutes by default"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"If the authentication fails, will return code 401, message may change."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'"code":401,"message":"sign is not pass,Please check you sign algorithm!","data":null}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"extension",children:"Extension"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Please refer to: ",(0,t.jsx)(n.a,{href:"../developer-guide/custom-sign-algorithm",children:"dev-sign"}),"."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}}}]);