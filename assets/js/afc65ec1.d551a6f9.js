"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[28715],{28453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>a});var o=n(96540);const r={},s=o.createContext(r);function l(e){const t=o.useContext(s);return o.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),o.createElement(s.Provider,{value:t},e.children)}},58060:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>u,frontMatter:()=>s,metadata:()=>a,toc:()=>c});var o=n(74848),r=n(28453);const s={title:"Custom Jwt convert Algorithm",keywords:["Custom Jwt Convert"],description:"Custom Jwt convert Algorithm"},l=void 0,a={id:"developer/custom-jwt-covert-algorithm",title:"Custom Jwt convert Algorithm",description:"Custom Jwt convert Algorithm",source:"@site/versioned_docs/version-2.7.0.3/developer/custom-jwt-covert-algorithm.md",sourceDirName:"developer",slug:"/developer/custom-jwt-covert-algorithm",permalink:"/docs/developer/custom-jwt-covert-algorithm",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/shenyu-website/edit/main/versioned_docs/version-2.7.0.3/developer/custom-jwt-covert-algorithm.md",tags:[],version:"2.7.0.3",frontMatter:{title:"Custom Jwt convert Algorithm",keywords:["Custom Jwt Convert"],description:"Custom Jwt convert Algorithm"},sidebar:"tutorialSidebar",previous:{title:"Custom Filter",permalink:"/docs/developer/custom-filter"},next:{title:"Fetching Correct IP Address And Host",permalink:"/docs/developer/custom-parsing-ip-and-host"}},i={},c=[{value:"Description",id:"description",level:2},{value:"Extension",id:"extension",level:2}];function d(e){const t={code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h2,{id:"description",children:"Description"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["Users can customize the convert algorithm of ",(0,o.jsx)(t.code,{children:"Jwt-plugin"})," to achieve convert."]}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"extension",children:"Extension"}),"\n",(0,o.jsxs)(t.p,{children:["The default implementation is ",(0,o.jsx)(t.code,{children:"org.apache.shenyu.plugin.jwt.strategy.DefaultJwtConvertStrategy"}),". The SPI mechanism is adopted for extension, and the steps are as follows:"]}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Implements interface ",(0,o.jsx)(t.code,{children:"org.apache.shenyu.plugin.jwt.strategy.JwtConvertStrategy"})]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",children:"   /**\n    * Represents a conversion strategy that convert jwt to some attributes of\n    * serverWebExchange, especially attributes of the request header.\n    */\n   @SPI\n   public interface JwtConvertStrategy {\n   \n       /**\n        * HandleJson needs to be parsed into jwtRuleHandle in order to\n        * specify how to convert jwt.\n        *\n        * @param handleJson handleJson from rule\n        * @return jwtRuleHandle\n        */\n       JwtRuleHandle parseHandleJson(String handleJson);\n   \n       /**\n        * Converts jwt to some attributes of serverWebExchange based on jwtRuleHandle.\n        *\n        * @param jwtRuleHandle jwtRuleHandle\n        * @param exchange      exchange\n        * @param jwtBody       jwtBody\n        * @return serverWebExchange\n        */\n       ServerWebExchange convert(JwtRuleHandle jwtRuleHandle, ServerWebExchange exchange, Map<String, Object> jwtBody);\n   \n   }\n"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",children:'\n    @Join\n    public class CustomJwtConvertStrategy implements JwtConvertStrategy {\n    \n        @Override\n        public CustomJwtRuleHandle parseHandleJson(final String handleJson) {\n    \n            return GsonUtils.getInstance().fromJson(handleJson, CustomJwtRuleHandle.class);\n        }\n    \n        @Override\n        public ServerWebExchange convert(final JwtRuleHandle jwtRuleHandle, final ServerWebExchange exchange, final Map<String, Object> jwtBody) {\n            final CustomJwtRuleHandle customJwtRuleHandle = (CustomJwtRuleHandle) jwtRuleHandle;\n            String customConvert = customJwtRuleHandle.getCustomConvert();\n            ServerHttpRequest modifiedRequest =\n                    exchange.getRequest().mutate().header("custom", customConvert).build();\n    \n            return exchange.mutate().request(modifiedRequest).build();\n        }\n    }\n'})}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Configures SPI"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tex",children:"custom=org.apache.shenyu.plugin.jwt.strategy.CustomJwtConvertStrategy\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["The project would use different conversion strategies based on the",(0,o.jsx)(t.code,{children:"handleType"})," parameter of  ",(0,o.jsx)(t.code,{children:"JwtRuleHandle"})," . For example, for the following ",(0,o.jsx)(t.code,{children:"JwtRuleHandle"}),",the project  would use our above ",(0,o.jsx)(t.code,{children:"CustomJwtConvertStrategy"})," . (Note: ",(0,o.jsx)(t.code,{children:"handleType"})," is ",(0,o.jsx)(t.code,{children:"default"})," or nonexistent, the project would use default ",(0,o.jsx)(t.code,{children:"DefaultJwtConvertStrategy"}),")"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-json",children:'{\n    "handleType":"custom",\n \t"customConvert":"customConvert"\n}\n'})}),"\n",(0,o.jsxs)(t.p,{children:["The case code is available for viewing in ",(0,o.jsx)(t.code,{children:"org.apache.shenyu.plugin.jwt.strategy.CustomJwtConvertStrategy"})]})]})}function u(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);