"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[20628],{28453(e,n,t){t.d(n,{R:()=>i,x:()=>o});var r=t(96540);const s={},a=r.createContext(s);function i(e){const n=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(a.Provider,{value:n},e.children)}},83355(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>g,frontMatter:()=>i,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"zookeeper","title":"Zookeeper Example","description":"Zookeeper","source":"@site/shenyuClientGolang_versioned_docs/version-1.0.0/zookeeper.md","sourceDirName":".","slug":"/zookeeper","permalink":"/shenyuClientGolang/zookeeper","draft":false,"unlisted":false,"tags":[],"version":"1.0.0","lastUpdatedBy":"shown","lastUpdatedAt":1768275723000,"frontMatter":{"description":"Zookeeper","title":"Zookeeper Example"},"sidebar":"tutorialSidebar","previous":{"title":"Nacos Example","permalink":"/shenyuClientGolang/nacos"}}');var s=t(74848),a=t(28453);const i={description:"Zookeeper",title:"Zookeeper Example"},o=void 0,c={},l=[{value:"The Zookeeper type Register",id:"the-zookeeper-type-register",level:2},{value:"Entire Success log",id:"entire-success-log",level:2}];function u(e){const n={code:"code",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"the-zookeeper-type-register",children:"The Zookeeper type Register"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"1.Fist make sure your Zookeeper env is correct,the set this necessary param."})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'    //Create ShenYuZkClient  start\n    zcp := &zk_client.ZkClientParam{\n    ZkServers: []string{"127.0.0.1:2181"}, //require user provide\n    ZkRoot:    "/api",                     //require user provide\n    }\n\n    sdkClient := shenyu_sdk_client.GetFactoryClient(constants.ZOOKEEPER_CLIENT)\n    client, createResult, err := sdkClient.NewClient(zcp)\n\n    if !createResult && err != nil {\n    logger.Fatal("Create ShenYuZkClient error : %v", err)\n    }\n\n    zc := client.(*zk_client.ShenYuZkClient)\n    defer zc.Close()\n    //Create ShenYuZkClient end\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"2. Prepare your service metaData to register"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'//metaData is necessary param, this will be register to shenyu gateway to use\n    metaData1 := &model.MetaDataRegister{\n        AppName: "testMetaDataRegister1", //require user provide\n        Path:    "your/path1",            //require user provide\n        Enabled: true,                    //require user provide\n        Host:    "127.0.0.1",             //require user provide\n        Port:    "8080",                  //require user provide\n    }\n\n    metaData2 := &model.MetaDataRegister{\n        AppName: "testMetaDataRegister2", //require user provide\n        Path:    "your/path2",            //require user provide\n        Enabled: true,                    //require user provide\n        Host:    "127.0.0.1",             //require user provide\n        Port:    "8181",                  //require user provide\n    }\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"3.use client to invoke RegisterServiceInstance"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'   //register multiple metaData\n    registerResult1, err := zc.RegisterServiceInstance(metaData1)\n        if !registerResult1 && err != nil {\n        logger.Fatal("Register zk Instance error : %v", err)\n    }\n\n    registerResult2, err := zc.RegisterServiceInstance(metaData2)\n        if !registerResult2 && err != nil {\n        logger.Fatal("Register zk Instance error : %v", err)\n    }\n    //do your logic\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"4.use client to invoke DeregisterServiceInstance"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:"    //your can chose to invoke,not require\n    deRegisterResult1, err := zc.DeregisterServiceInstance(metaData1)\n        if err != nil {\n        panic(err)\n        }\n\n    deRegisterResult2, err := zc.DeregisterServiceInstance(metaData2)\n        if err != nil {\n        panic(err)\n        }\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"5.use client to GetServiceInstanceInfo"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'    //GetServiceInstanceInfo start\n    instanceDetail, err := zc.GetServiceInstanceInfo(metaData1)\n        nodes1, ok := instanceDetail.([]*model.MetaDataRegister)\n        if !ok {\n        logger.Fatal("get zk client metaData error %v:", err)\n     }\n    \n    //range nodes\n    for index, node := range nodes1 {\n        nodeJson, err := json.Marshal(node)\n        if err == nil {\n        logger.Info("GetNodesInfo ,success Index", index, string(nodeJson))\n        }\n    }\n    \n    instanceDetail2, err := zc.GetServiceInstanceInfo(metaData2)\n        nodes2, ok := instanceDetail2.([]*model.MetaDataRegister)\n        if !ok {\n            logger.Fatal("get zk client metaData error %v:", err)\n    }\n    //GetServiceInstanceInfo end\n\n'})}),"\n",(0,s.jsx)(n.h2,{id:"entire-success-log",children:"Entire Success log"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'2022-07-13 16:09:31 [INFO] [github.com/shenyu-client-golang/example/zk_client/main.go:105] GetNodesInfo ,success Index 0 {"appName":"testMetaDataRegister1","path":"your/path1","contextPath":"","ruleName":"","rpcType":"","enabled":true,"host":"127.0.0.1","port":"8080","pluginNames":null,"registerMetaData":false,"timeMillis":0}\n2022-07-13 16:09:31 [INFO] [github.com/shenyu-client-golang/example/zk_client/main.go:119] GetNodesInfo ,success Index 0 {"appName":"testMetaDataRegister2","path":"your/path2","contextPath":"","ruleName":"","rpcType":"","enabled":true,"host":"127.0.0.1","port":"8181","pluginNames":null,"registerMetaData":false,"timeMillis":0}\n2022-07-13 16:09:31 [INFO] [github.com/shenyu-client-golang/example/zk_client/main.go:132] GetNodesInfo ,success Index 0 {"appName":"testMetaDataRegister3","path":"your/path3","contextPath":"","ruleName":"","rpcType":"","enabled":true,"host":"127.0.0.1","port":"8282","pluginNames":null,"registerMetaData":false,"timeMillis":0}\n2022-07-13 16:09:31 [INFO] [github.com/shenyu-client-golang/example/zk_client/main.go:139] > DeregisterServiceInstance start\n2022-07-13 16:09:31 [INFO] [github.com/shenyu-client-golang/clients/zk_client/zk_client.go:213] ensureName check, path is -> /api/testMetaDataRegister1\n2022-07-13 16:09:31 [INFO] [github.com/shenyu-client-golang/clients/zk_client/zk_client.go:215] ensureName check result is -> true\n2022-07-13 16:09:31 [INFO] [github.com/shenyu-client-golang/clients/zk_client/zk_client.go:213] ensureName check, path is -> /api/testMetaDataRegister2\n2022-07-13 16:09:31 [INFO] [github.com/shenyu-client-golang/clients/zk_client/zk_client.go:215] ensureName check result is -> true\n2022-07-13 16:09:31 [INFO] [github.com/shenyu-client-golang/clients/zk_client/zk_client.go:213] ensureName check, path is -> /api/testMetaDataRegister3\n2022-07-13 16:09:31 [INFO] [github.com/shenyu-client-golang/clients/zk_client/zk_client.go:215] ensureName check result is -> true\n2022-07-13 16:09:31 [INFO] [github.com/shenyu-client-golang/example/zk_client/main.go:156] DeregisterServiceInstance success !\n'})})]})}function g(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}}}]);