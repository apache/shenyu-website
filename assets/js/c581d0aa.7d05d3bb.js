"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[61940],{14402:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>c,frontMatter:()=>s,metadata:()=>a,toc:()=>u});var l=i(74848),r=i(28453);const s={sidebar_position:2,title:"Custom Plugin",keywords:["soul"],description:"plugins"},t=void 0,a={id:"developer-guide/custom-plugin",title:"Custom Plugin",description:"plugins",source:"@site/versioned_docs/version-2.3.0-Legacy/developer-guide/custom-plugin.md",sourceDirName:"developer-guide",slug:"/developer-guide/custom-plugin",permalink:"/docs/2.3.0-Legacy/developer-guide/custom-plugin",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/shenyu-website/edit/main/versioned_docs/version-2.3.0-Legacy/developer-guide/custom-plugin.md",tags:[],version:"2.3.0-Legacy",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Custom Plugin",keywords:["soul"],description:"plugins"},sidebar:"tutorialSidebar",previous:{title:"Filter Extension",permalink:"/docs/2.3.0-Legacy/developer-guide/custom-filter"},next:{title:"File Uploading And Downloading",permalink:"/docs/2.3.0-Legacy/developer-guide/file-and-image"}},o={},u=[{value:"Description",id:"description",level:2},{value:"Single Responsibility Plugins",id:"single-responsibility-plugins",level:2},{value:"Matching Traffic Processing Plugin",id:"matching-traffic-processing-plugin",level:2},{value:"Subscribe your plugin data and do customized jobs",id:"subscribe-your-plugin-data-and-do-customized-jobs",level:2},{value:"Do not use SelectorList and RulesList",id:"do-not-use-selectorlist-and-ruleslist",level:2}];function d(e){const n={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"description",children:"Description"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Plugins are core executors of soul gateway. Every plugin handles matched requests when enabled."}),"\n",(0,l.jsx)(n.li,{children:"There are two kinds of plugins in the soul gateway."}),"\n",(0,l.jsx)(n.li,{children:"The first type is a call chain with a single responsibility, and traffic cannot be customized."}),"\n",(0,l.jsx)(n.li,{children:"The other one can do its own chain of responsibility for matched traffic."}),"\n",(0,l.jsx)(n.li,{children:"You could reference from soul-plugin module and develop plugins by yourself. Please fire pull requests of your wonderful plugins without hesitate."}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"single-responsibility-plugins",children:"Single Responsibility Plugins"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Add following dependency:"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:" <dependency>\n        <groupId>org.dromara</groupId>\n        <artifactId>soul-plugin-api</artifactId>\n        <version>${last.version}</version>\n  </dependency>\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:['Declare a new class named "A" and implements ',(0,l.jsx)(n.code,{children:"org.dromara.soul.plugin.api.SoulPlugin"})]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'public interface SoulPlugin {\n    \n    /**\n     * Process the Web request and (optionally) delegate to the next\n     * {@code WebFilter} through the given {@link SoulPluginChain}.\n     *\n     * @param exchange the current server exchange\n     * @param chain    provides a way to delegate to the next filter\n     * @return {@code Mono<Void>} to indicate when request processing is complete\n     */\n    Mono<Void> execute(ServerWebExchange exchange, SoulPluginChain chain);\n    \n    /**\n     * return plugin order .\n     * This attribute To determine the plugin execution order in the same type plugin.\n     *\n     * @return int order\n     */\n    int getOrder();\n    \n    /**\n     * acquire plugin name.\n     * this is plugin name define you must offer the right name.\n     * if you impl AbstractSoulPlugin this attribute not use.\n     *\n     * @return plugin name.\n     */\n    default String named() {\n        return "";\n    }\n    \n    /**\n     * plugin is execute.\n     * if return true this plugin can not execute.\n     *\n     * @param exchange the current server exchange\n     * @return default false.\n     */\n    default Boolean skip(ServerWebExchange exchange) {\n        return false;\n    }\n}\n\n'})}),"\n",(0,l.jsx)(n.p,{children:"Detailed instruction of interface methods:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"execute()"})," core method, you can do any task here freely."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"getOrder()"})," get the order of current plugin."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"named()"})," acquire the name of specific plugin."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"skip()"})," determines whether this plugin should be skipped under certain conditions."]}),"\n",(0,l.jsxs)(n.li,{children:["Register plugin in Spring as a Bean, or simply apply ",(0,l.jsx)(n.code,{children:"@Component"})," in implementation class."]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"    @Bean\n    public SoulPlugin a() {\n        return new A();\n    }\n"})}),"\n",(0,l.jsx)(n.h2,{id:"matching-traffic-processing-plugin",children:"Matching Traffic Processing Plugin"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Introduce the following dependency:"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-xml",children:" <dependency>\n        <groupId>org.dromara</groupId>\n        <artifactId>soul-plugin-base</artifactId>\n        <version>${last.version}</version>\n  </dependency>\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["Add a new class A, inherit from ",(0,l.jsx)(n.code,{children:"org.dromara.soul.plugin.base.AbstractSoulPlugin"})]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"examples down below:"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'/**\n * This is your custom plugin.\n * He is running in after before plugin, implement your own functionality.\n * extends AbstractSoulPlugin so you must user soul-admin And add related plug-in development.\n *\n * @author xiaoyu(Myth)\n */\npublic class CustomPlugin extends AbstractSoulPlugin {\n    \n    /**\n     * return plugin order .\n     * The same plugin he executes in the same order.\n     *\n     * @return int\n     */\n    @Override\n    public int getOrder() {\n        return 0;\n    }\n\n    /**\n     * acquire plugin name.\n     * return you custom plugin name.\n     * It must be the same name as the plug-in you added in the admin background.\n     *\n     * @return plugin name.\n     */\n    @Override\n    public String named() {\n        return "soul";\n    }\n\n    /**\n     * plugin is execute.\n     * Do I need to skip.\n     * if you need skip return true.\n     *\n     * @param exchange the current server exchange\n     * @return default false.\n     */\n    @Override\n    public Boolean skip(final ServerWebExchange exchange) {\n        return false;\n    }\n\n    @Override\n    protected Mono<Void> doExecute(ServerWebExchange exchange, SoulPluginChain chain, SelectorZkDTO selector, RuleZkDTO rule) {\n        LOGGER.debug(".......... function plugin start..............");\n        /*\n         * Processing after your selector matches the rule.\n         * rule.getHandle() is you Customize the json string to be processed.\n         * for this example.\n         * Convert your custom json string pass to an entity class.\n         */\n        final String ruleHandle = rule.getHandle();\n\n        final Test test = GsonUtils.getInstance().fromJson(ruleHandle, Test.class);\n\n        /*\n         * Then do your own business processing.\n         * The last execution  chain.execute(exchange).\n         * Let it continue on the chain until the end.\n         */\n        System.out.println(test.toString());\n        return chain.execute(exchange);\n    }\n}\n\n'})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Detailed explanation:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Plugins will match the selector rule for customized plugins inherit from this abstract class. Following steps guide you to config your plugins."}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["Firstly define a new plugin in ",(0,l.jsx)(n.code,{children:"soul-admin"}),", please mind that your plugin name should match the named() method overridden in your class."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["Re-login  ",(0,l.jsx)(n.code,{children:"soul-admin"}),", the plugin you added now showing on plugin-list page, you can choose selectors for matching."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["There is a field named ",(0,l.jsx)(n.code,{children:"handler"})," in rules, it is customized json string to be processed. You can process data after acquiring a ruleHandle (",(0,l.jsx)(n.code,{children:"final String ruleHandle = rule.getHandle();"}),") in ",(0,l.jsx)(n.code,{children:"doExecute()"})," method."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["Register plugin in Spring as a Bean, or simply apply ",(0,l.jsx)(n.code,{children:"@Component"})," in implementation class."]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"    @Bean\n    public SoulPlugin a() {\n        return new A();\n    }\n"})}),"\n",(0,l.jsx)(n.h2,{id:"subscribe-your-plugin-data-and-do-customized-jobs",children:"Subscribe your plugin data and do customized jobs"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:['Declare a new class named "A" and implements ',(0,l.jsx)(n.code,{children:"org.dromara.soul.plugin.base.handler.PluginDataHandler"})]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"public interface PluginDataHandler {\n    \n    /**\n     * Handler plugin.\n     *\n     * @param pluginData the plugin data\n     */\n    default void handlerPlugin(PluginData pluginData) {\n    }\n    \n    /**\n     * Remove plugin.\n     *\n     * @param pluginData the plugin data\n     */\n    default void removePlugin(PluginData pluginData) {\n    }\n    \n    /**\n     * Handler selector.\n     *\n     * @param selectorData the selector data\n     */\n    default void handlerSelector(SelectorData selectorData) {\n    }\n    \n    /**\n     * Remove selector.\n     *\n     * @param selectorData the selector data\n     */\n    default void removeSelector(SelectorData selectorData) {\n    }\n    \n    /**\n     * Handler rule.\n     *\n     * @param ruleData the rule data\n     */\n    default void handlerRule(RuleData ruleData) {\n    }\n    \n    /**\n     * Remove rule.\n     *\n     * @param ruleData the rule data\n     */\n    default void removeRule(RuleData ruleData) {\n    }\n    \n    /**\n     * Plugin named string.\n     *\n     * @return the string\n     */\n    String pluginNamed();\n    \n}\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Ensure ",(0,l.jsx)(n.code,{children:"pluginNamed()"})," is same as the plugin name you defined."]}),"\n",(0,l.jsxs)(n.li,{children:["Register defined class as a Spring Bean, or simply apply ",(0,l.jsx)(n.code,{children:"@Component"})," in implementation class."]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"    @Bean\n    public PluginDataHandler a() {\n        return new A();\n    }\n"})}),"\n",(0,l.jsx)(n.h2,{id:"do-not-use-selectorlist-and-ruleslist",children:"Do not use SelectorList and RulesList"}),"\n",(0,l.jsx)(n.p,{children:"Not all plugins need both."}),"\n",(0,l.jsxs)(n.p,{children:["Therefore, we provide the following two methods, written in ",(0,l.jsx)(n.strong,{children:"CustomPlugin"}),"."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"    @Override\n    protected Mono<Void> handleSelectorIsNull(final String pluginName, \n                                              final ServerWebExchange exchange, \n                                              final SoulPluginChain chain) {\n        return doExecute(exchange, chain, null, null);\n    }\n\n    @Override\n    protected Mono<Void> handleRuleIsNull(final String pluginName, \n                                          final ServerWebExchange exchange, \n                                          final SoulPluginChain chain) {\n        return doExecute(exchange, chain, null, null);\n    }\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Note that if there is no rewriting, your plug-in will be invalid due to the absence of ",(0,l.jsx)(n.strong,{children:"SelectorList"})," and ",(0,l.jsx)(n.strong,{children:"RulesList"}),"."]}),"\n"]})]})}function c(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>a});var l=i(96540);const r={},s=l.createContext(r);function t(e){const n=l.useContext(s);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),l.createElement(s.Provider,{value:n},e.children)}}}]);