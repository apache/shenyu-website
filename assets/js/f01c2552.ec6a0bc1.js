"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[28427],{28453(e,n,s){s.d(n,{R:()=>l,x:()=>a});var i=s(96540);const t={},d=i.createContext(t);function l(e){const n=i.useContext(d);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(d.Provider,{value:n},e.children)}},47180(e,n,s){s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"design/database-design","title":"Admin Database Design","description":"ShenYu Admin Database Design","source":"@site/versioned_docs/version-2.6.1/design/database-design.md","sourceDirName":"design","slug":"/design/database-design","permalink":"/docs/2.6.1/design/database-design","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/shenyu-website/edit/main/versioned_docs/version-2.6.1/design/database-design.md","tags":[],"version":"2.6.1","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Admin Database Design","keywords":["db"],"description":"ShenYu Admin Database Design"},"sidebar":"tutorialSidebar","previous":{"title":"Overview","permalink":"/docs/2.6.1/"},"next":{"title":"Data Sync Design","permalink":"/docs/2.6.1/design/data-sync"}}');var t=s(74848),d=s(28453);const l={sidebar_position:1,title:"Admin Database Design",keywords:["db"],description:"ShenYu Admin Database Design"},a=void 0,r={},o=[{value:"Plugin, Selector And Rule",id:"plugin-selector-and-rule",level:2},{value:"Resource Permission",id:"resource-permission",level:2},{value:"Data Permission",id:"data-permission",level:2},{value:"Meta Data",id:"meta-data",level:2},{value:"Dictionary Management",id:"dictionary-management",level:2},{value:"API Documentation",id:"API-documentation",level:2}];function c(e){const n={code:"code",h2:"h2",img:"img",li:"li",p:"p",ul:"ul",...(0,d.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Apache Shenyu Admin is the management system of the gateway, which can manage all plugins, selectors and rules visually, set users, roles and resources."}),"\n",(0,t.jsx)(n.h2,{id:"plugin-selector-and-rule",children:"Plugin, Selector And Rule"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Plugin: ShenYu uses the plugin design idea to realize the hot plug of the plugin, which is easy to expand. Built-in rich plugins, including RPC proxy, circuit breaker and current limiting, authority and certification, monitoring, and more."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Selector: Each plugin can set multiple selectors to carry out preliminary filtering of traffic."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Rule: Multiple rules can be set per selector for more fine-grained control of flow."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"The Database Table UML Diagram:"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:s(82832).A+"",width:"2790",height:"1914"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Detailed design:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"One plugin corresponds to multiple selectors,one selector corresponds to multiple rules."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"One selector corresponds to multiple match conditions,one rule corresponds to multiple match conditions."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Each rule handles differently in corresponding plugin according to field handler,field handler is a kind of data of JSON string type.You can view detail during the use of shenyu-admin."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"resource-permission",children:"Resource Permission"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"The resource are the menus and buttons in the shenyu-admin console."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Resource Permission use database to store user name,role,resource data and relationship."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["The Resource Permission Table UML Diagram:\n",(0,t.jsx)(n.img,{src:s(89224).A+"",width:"2790",height:"1914"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Detailed design:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"one user corresponds to multiple role,one role corresponds to multiple resources."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"data-permission",children:"Data Permission"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Data Permission use database to store the relationship between users, selectors and rules."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["The Data Permission Table UML Diagram:\n",(0,t.jsx)(n.img,{alt:"data permission uml",src:s(79267).A+"",width:"1031",height:"707"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Detailed design:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The most important table is ",(0,t.jsx)(n.code,{children:"data_permission"}),", where a user corresponds to multiple data permissions."]}),"\n",(0,t.jsxs)(n.li,{children:["The field ",(0,t.jsx)(n.code,{children:"data_type"})," distinguishes between different types of data, which corresponds to the following: 0 -> selector, 1 -> rule."]}),"\n",(0,t.jsxs)(n.li,{children:["The field ",(0,t.jsx)(n.code,{children:"data_id"})," holds the primary key id of the corresponding type."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"meta-data",children:"Meta Data"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Metadata is used for generic invoke by gateway."}),"\n",(0,t.jsx)(n.li,{children:"For each interface method, there is one piece of metadata."}),"\n",(0,t.jsx)(n.li,{children:"The Database Table UML Diagram:"}),"\n"]}),"\n",(0,t.jsx)("img",{src:"/img/shenyu/db/mata_data_table.png",width:"30%",height:"30%"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Detailed design\uff1a","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"path"}),": When the gateway is requested, a piece of data will be matched according to ",(0,t.jsx)(n.code,{children:"path"}),", and then the subsequent process will be carried out."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"rpc_ext"}),": Used to hold extended information for the RPC proxy.\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"dictionary-management",children:"Dictionary Management"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Dictionary management is used to maintain and manage public data dictionaries."}),"\n",(0,t.jsx)(n.li,{children:"The Database Table UML Diagram:"}),"\n"]}),"\n",(0,t.jsx)("img",{src:"/img/shenyu/db/shenyu_dict.png",width:"30%",height:"30%"}),"\n",(0,t.jsx)(n.h2,{id:"API-documentation",children:"API Documentation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The API document tables used to maintain and manage API documents."}),"\n",(0,t.jsxs)(n.li,{children:["The API document (such as json, md, html, etc.) of common specifications (such as OpenApi3.0 and yapi) can be imported into ",(0,t.jsx)(n.code,{children:"shenyu-admin"})," and finally stored in the API document tables."]}),"\n",(0,t.jsx)(n.li,{children:"API documents of other common specifications can be generated through the API document tables."}),"\n",(0,t.jsx)(n.li,{children:"The Database Table UML Diagram:"}),"\n"]}),"\n",(0,t.jsx)("img",{src:"/img/shenyu/db/shenyu-api-doc-table.png",width:"105%",height:"105%"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Detailed design:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"A tag can have multiple child tags, the level of tags is unlimited, the lowest leaf node is API."}),"\n",(0,t.jsx)(n.li,{children:"Interfaces with the same path but supporting multiple http methods, they are counted as multiple APIs."}),"\n",(0,t.jsx)(n.li,{children:"An API has multiple request parameters and response fields."}),"\n",(0,t.jsx)(n.li,{children:"A parameter/field has its own type (model), and each type have multiple fields."}),"\n",(0,t.jsx)(n.li,{children:"A field has its own type, which corresponds to multiple values."}),"\n",(0,t.jsx)(n.li,{children:"A value can be used as either a request example value, or a response example value (for example, 200 indicates OK, and 400 indicates illegal parameters)."}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"query"}),", ",(0,t.jsx)(n.code,{children:"header"})," and ",(0,t.jsx)(n.code,{children:"body"}),", all of them are ",(0,t.jsx)(n.code,{children:"json"})," stored in ",(0,t.jsx)(n.code,{children:"mock_request_record"}),"\uff0cbut ",(0,t.jsx)(n.code,{children:"body"})," does not support special types such as file\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"ext"})," of the ",(0,t.jsx)(n.code,{children:"tag"})," table stores the full amount of json data of its parent tag (including the parent tag of the parent tag, and so on)."]}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"ext"})," of the ",(0,t.jsx)(n.code,{children:"api"})," table may store the IP list and the service name of ",(0,t.jsx)(n.code,{children:"SpringCloud"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"type"})," of the ",(0,t.jsx)(n.code,{children:"parameter"})," table mainly includes ",(0,t.jsx)(n.code,{children:"requestUrlParam"}),", ",(0,t.jsx)(n.code,{children:"requestHeader"}),", ",(0,t.jsx)(n.code,{children:"requestBody"}),", ",(0,t.jsx)(n.code,{children:"requestPathVariable"}),", ",(0,t.jsx)(n.code,{children:"responseHeader"}),", and ",(0,t.jsx)(n.code,{children:"responseBody"}),"; If the returned type is a special type (such as file), do not associate ",(0,t.jsx)(n.code,{children:"model_id"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"ext"})," of the ",(0,t.jsx)(n.code,{children:"field"})," table stores generic type in json format (convenient for subsequent expansion), such as ",(0,t.jsx)(n.code,{children:'{"genericTypes": [model_id1, model_id2]}'}),"; ",(0,t.jsx)(n.code,{children:"model_id"})," indicates which type has this field, ",(0,t.jsx)(n.code,{children:"self_model_id"})," indicates which type of this field."]}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"is_example"})," of ",(0,t.jsx)(n.code,{children:"detail"})," table indicates whether a value is a request sample value, true is a request sample value, and false is a response value."]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},79267(e,n,s){s.d(n,{A:()=>i});const i=s.p+"assets/images/data_permission-f382375f134eeb359e481ee2cd43482d.png"},82832(e,n,s){s.d(n,{A:()=>i});const i=s.p+"assets/images/shenyu-db-0847449c4fb817f83e61abad7125ae4a.png"},89224(e,n,s){s.d(n,{A:()=>i});const i=s.p+"assets/images/shenyu-permission-db-90c870eefea0da663079cdf6638c7ce7.png"}}]);