"use strict";(self.webpackChunkshenyu_website=self.webpackChunkshenyu_website||[]).push([[46461],{12313:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>p,toc:()=>l});var r=n(58168),a=(n(96540),n(15680));const i={title:"AiPrompt Plugin",keywords:["aiPrompt"],description:"aiPrompt plugin"},o=void 0,p={unversionedId:"plugin-center/ai/ai-prompt",id:"plugin-center/ai/ai-prompt",isDocsHomePage:!1,title:"AiPrompt Plugin",description:"aiPrompt plugin",source:"@site/docs/plugin-center/ai/ai-prompt.md",sourceDirName:"plugin-center/ai",slug:"/plugin-center/ai/ai-prompt",permalink:"/zh/docs/next/plugin-center/ai/ai-prompt",editUrl:"https://github.com/apache/shenyu-website/edit/main/docs/plugin-center/ai/ai-prompt.md",version:"current",frontMatter:{title:"AiPrompt Plugin",keywords:["aiPrompt"],description:"aiPrompt plugin"},sidebar:"tutorialSidebar",previous:{title:"Mock \u63d2\u4ef6",permalink:"/zh/docs/next/plugin-center/mock/mock-plugin"},next:{title:"AiProxy Plugin",permalink:"/zh/docs/next/plugin-center/ai/ai-proxy"}},l=[{value:"Explanation",id:"explanation",children:[]},{value:"Plugin Configuration",id:"plugin-configuration",children:[]},{value:"API Usage",id:"api-usage",children:[]}],s={toc:l},g="wrapper";function u({components:e,...t}){return(0,a.yg)(g,(0,r.A)({},s,t,{components:e,mdxType:"MDXLayout"}),(0,a.yg)("h2",{id:"explanation"},"Explanation"),(0,a.yg)("p",null,"The ",(0,a.yg)("strong",{parentName:"p"},"aiPrompt")," plugin is used to dynamically inject preset prompt content (such as system-role messages or contextual information) into requests before forwarding them. When a request configured with aiPrompt reaches the gateway, the plugin first adds the specified prompt text to the request body (for example, inserting a ",(0,a.yg)("strong",{parentName:"p"},"system")," message at the beginning of the message list). This is useful for unified context control or preset roles\u2014for instance, automatically adding a \u201cYou are a translation assistant\u201d system prompt to every request. Used together with aiProxy, it\u2019s primarily for enhancing prompts."),(0,a.yg)("h2",{id:"plugin-configuration"},"Plugin Configuration"),(0,a.yg)("p",null,"In the ShenYu admin interface, you first create a ",(0,a.yg)("strong",{parentName:"p"},"Selector")," and then a ",(0,a.yg)("strong",{parentName:"p"},"Rule"),". A Selector matches incoming requests (by path, headers, etc.), while a Rule configures plugin parameters or forwarding targets. For more on Selector and Rule setup, see ",(0,a.yg)("a",{parentName:"p",href:"../../user-guide/admin-usage/selector-and-rule"},"Selector and Rule Management"),"."),(0,a.yg)("p",null,"When configuring aiPrompt, pay attention to:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Selector"),": Defines which requests to match. For example, set ",(0,a.yg)("inlineCode",{parentName:"li"},"Pattern")," to ",(0,a.yg)("inlineCode",{parentName:"li"},"/**")," to match all requests, or specify a particular route."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Rule"),": Specify plugin parameters at the rule level:",(0,a.yg)("ul",{parentName:"li"},(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"prepend"),": ",(0,a.yg)("strong",{parentName:"li"},"Prepend prompt content.")," This text is inserted before the user\u2019s original messages as the first message sent to the LLM. Typically used to inject global system instructions or context, e.g., \u201cYou are a translation assistant; translate user input into English.\u201d"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"preRole"),": ",(0,a.yg)("strong",{parentName:"li"},"Role for the prepend prompt.")," Sets the ",(0,a.yg)("inlineCode",{parentName:"li"},"role")," field for the ",(0,a.yg)("inlineCode",{parentName:"li"},"prepend")," message (same options as the OpenAI Chat API)."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"append"),": ",(0,a.yg)("strong",{parentName:"li"},"Append prompt content.")," Text added after the user\u2019s messages."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"postRole"),": ",(0,a.yg)("strong",{parentName:"li"},"Role for the append prompt.")," Sets the ",(0,a.yg)("inlineCode",{parentName:"li"},"role")," field for the ",(0,a.yg)("inlineCode",{parentName:"li"},"append")," message.")))),(0,a.yg)("p",null,"Below are example screenshots of aiPrompt plugin configuration in the admin UI:"),(0,a.yg)("p",null,(0,a.yg)("img",{src:n(34802).A})),(0,a.yg)("p",null,(0,a.yg)("img",{src:n(57849).A})),(0,a.yg)("blockquote",null,(0,a.yg)("p",{parentName:"blockquote"},(0,a.yg)("strong",{parentName:"p"},"Note:")," The aiPrompt plugin depends on aiProxy. In a typical request flow, apply ",(0,a.yg)("strong",{parentName:"p"},"AiPrompt")," first (if injecting prompts), then ",(0,a.yg)("strong",{parentName:"p"},"AiTokenLimiter")," for token counting/rate limiting (if needed), and finally ",(0,a.yg)("strong",{parentName:"p"},"AiProxy")," to forward the request to the LLM service. Ensure ",(0,a.yg)("strong",{parentName:"p"},"AiTokenLimiter"),"\u2019s ",(0,a.yg)("strong",{parentName:"p"},"sort")," value is ",(0,a.yg)("strong",{parentName:"p"},"less than")," ",(0,a.yg)("strong",{parentName:"p"},"AiProxy")," and ",(0,a.yg)("strong",{parentName:"p"},"greater than")," ",(0,a.yg)("strong",{parentName:"p"},"AiPrompt")," in the \u201cPlugin Management\u201d order.")),(0,a.yg)("h2",{id:"api-usage"},"API Usage"),(0,a.yg)("p",null,"After enabling the aiProxy plugin, you can send requests to the ShenYu gateway (e.g., via Postman) to obtain LLM responses through the proxy:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},'curl --location --request POST \'http://localhost:9195/ai/proxy/v1/chat/completions\' \\\n  --header \'Content-Type: application/json\' \\\n  --data-raw \'{\n    "model": "gpt-4o-mini",\n    "messages": [\n      {\n        "role": "user",\n        "content": "I bloom amidst slaughter, like a flower at dawn."\n      }\n    ]\n  }\'\n')),(0,a.yg)("p",null,(0,a.yg)("img",{src:n(27939).A})))}u.isMDXComponent=!0},15680:(e,t,n)=>{n.d(t,{xA:()=>g,yg:()=>y});var r=n(96540);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){a(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function p(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),s=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},g=function(e){var t=s(e.components);return r.createElement(l.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef(function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,g=p(e,["components","mdxType","originalType","parentName"]),u=s(n),c=a,y=u["".concat(l,".").concat(c)]||u[c]||m[c]||i;return n?r.createElement(y,o(o({ref:t},g),{},{components:n})):r.createElement(y,o({ref:t},g))});function y(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=c;var p={};for(var l in t)hasOwnProperty.call(t,l)&&(p[l]=t[l]);p.originalType=e,p[u]="string"==typeof e?e:a,o[1]=p;for(var s=2;s<i;s++)o[s]=n[s];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}c.displayName="MDXCreateElement"},27939:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/ai-prompt-api-867ce005e059588819b7a7899a1f53b4.png"},34802:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/ai-prompt-selector-en-91a8a8b25fa4798839b1d88150bb85b7.png"},57849:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/ai-prompt-rule-en-ad41c83349adf623db8ded5f479296c1.png"}}]);