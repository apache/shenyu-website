<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache ShenYu Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache ShenYu Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Apache ShenYu" href="/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/news/rss.xml" title="Apache ShenYu Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/news/atom.xml" title="Apache ShenYu Blog Atom Feed"><title data-react-helmet="true">Selector And Rule Config | Apache ShenYu</title><meta data-react-helmet="true" property="og:url" content="https://shenyu.apache.org//docs/2.7.0.1/user-guide/admin-usage/selector-and-rule"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="2.7.0.1"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-2.7.0.1"><meta data-react-helmet="true" property="og:title" content="Selector And Rule Config | Apache ShenYu"><meta data-react-helmet="true" name="description" content="detailed explanation of selector and rule"><meta data-react-helmet="true" property="og:description" content="detailed explanation of selector and rule"><meta data-react-helmet="true" name="keywords" content="Selector,Rule"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.svg"><link data-react-helmet="true" rel="canonical" href="https://shenyu.apache.org//docs/2.7.0.1/user-guide/admin-usage/selector-and-rule"><link data-react-helmet="true" rel="alternate" href="https://shenyu.apache.org//docs/2.7.0.1/user-guide/admin-usage/selector-and-rule" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://shenyu.apache.org//zh/docs/2.7.0.1/user-guide/admin-usage/selector-and-rule" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://shenyu.apache.org//docs/2.7.0.1/user-guide/admin-usage/selector-and-rule" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.581a6ac8.css">
<link rel="preload" href="/assets/js/runtime~main.1c5d765b.js" as="script">
<link rel="preload" href="/assets/js/main.adb5374d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Apache ShenYu Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/logo-light.svg" alt="Apache ShenYu Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/download">Download</a><a class="navbar__item navbar__link" href="/document">Docs</a><a class="navbar__item navbar__link" href="/community/contributor-guide">Community</a><a class="navbar__item navbar__link" href="/team">Team</a><a class="navbar__item navbar__link" href="/event">Event</a><a class="navbar__item navbar__link" href="/news">News</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/users">Users</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Foundation</a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License</a></li><li><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events</a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li><li><a href="https://www.apache.org/foundation/policies/privacy.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks</a></li></ul></div><a href="https://github.com/apache/shenyu" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg t="1631348384596" class="icon" viewBox="0 0 1024 1024" version="1.1" style="vertical-align:text-bottom;margin-right:5px" p-id="557" width="20" height="20"><path d="M547.797333 638.208l-104.405333-103.168 1.237333-1.28a720.170667 720.170667 0 0 0 152.490667-268.373333h120.448V183.082667h-287.744V100.906667H347.605333v82.218666H59.818667V265.386667h459.178666a648.234667 648.234667 0 0 1-130.304 219.946666 643.242667 643.242667 0 0 1-94.976-137.728H211.541333a722.048 722.048 0 0 0 122.453334 187.434667l-209.194667 206.378667 58.368 58.368 205.525333-205.525334 127.872 127.829334 31.232-83.84m231.424-208.426667h-82.218666l-184.96 493.312h82.218666l46.037334-123.306667h195.242666l46.464 123.306667h82.218667l-185.002667-493.312m-107.690666 287.744l66.56-178.005333 66.602666 178.005333z" fill="currentColor" p-id="558"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/docs/2.7.0.1/user-guide/admin-usage/selector-and-rule" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li><a href="/zh/docs/2.7.0.1/user-guide/admin-usage/selector-and-rule" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">ç®€ä½“ä¸­æ–‡</a></li></ul></div><div class="react-toggle toggle_2i4l react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_Bc3W"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_lDyR"><button class="clean-btn backToTopButton_i9tI" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh menuWithAnnouncementBar_+O1J"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/2.7.0.1/index">Overview</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Design</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deployment</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Quick Start</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">User Guide</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Admin Usage</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.0.1/user-guide/admin-usage/api-document">API Document Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.0.1/user-guide/admin-usage/data-permission">Data Permission Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.0.1/user-guide/admin-usage/dictionary-management">Dictionary Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.0.1/user-guide/admin-usage/namepsace">Namespace Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.0.1/user-guide/admin-usage/plugin-handle-explanation">Plugin Config</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.0.1/user-guide/admin-usage/role-management">Role Management</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/2.7.0.1/user-guide/admin-usage/selector-and-rule">Selector And Rule Config</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Property Config</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Shenyu-Sdk Usage</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Discovery</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Quick Connect to Your Service</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Kubernetes Controller</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">API Document Aggregation</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Plugin Center</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Developer</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Benchmark Test</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for Apache ShenYu <b>2.7.0.1</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/user-guide/admin-usage/selector-and-rule">latest version</a></b> (2.7.0.2).</div></div><div class="docItemContainer_oiyr"><article><span class="badge badge--secondary">Version: 2.7.0.1</span><div class="tocCollapsible_aw-L tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_dC7a">Selector And Rule Config</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="features"></a>Features<a class="hash-link" href="#features" title="Direct link to heading">#</a></h2><p>This document will introduce the use of selectors and rules in the Apache ShenYu background management system. For the concept and design of selectors and rules, please refer to <code>Flow Control</code>.</p><img src="/img/shenyu/dataSync/flow-control-en.png" width="60%" height="50%"><p>Please refer to the <code>deployment</code> document, choose a way to start <code>shenyu-admin</code>. For example, <a href="/docs/2.7.0.1/deployment/deployment-local">local deployment</a>. After startup, visit <code>http://localhost:9095</code>, the default username and password are: <code>admin</code> and <code>123456</code> .</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="selector"></a>Selector<a class="hash-link" href="#selector" title="Direct link to heading">#</a></h2><p>All plugins are displayed in the PluginList, and selectors and rules can be added to each plugin:</p><img src="/img/shenyu/basicConfig/pluginHandle/selector_rule_page_en.jpg" width="80%" height="80%"><p>For example, add a selector to the <code>divide</code> plugin:</p><img src="/img/shenyu/basicConfig/pluginHandle/divide_selector_config_en.jpg" width="80%" height="80%"><ul><li><p>selector detailed explanationï¼š</p><ul><li>Name: create your selector with a distinguish name.</li><li>Type: Choose request matching strategy.<ul><li><code>custom</code>: Only handle requests that meet the following matching conditions.</li><li><code>full</code>: Handle all requests.</li></ul></li><li>MatchType: Condition combination type.<ul><li><code>and</code>ï¼š Need to meet all conditions.</li><li><code>or</code>: Meet any of the conditions.</li></ul></li><li>Conditionsï¼š<ul><li>uri: filter request with uri.</li><li>header: filter request with request header.</li><li>query: filter request with query string.</li><li>ip: filter request with your real ip.</li><li>host: filter request with your real host.</li><li>post: not recommend to use.</li><li>cookie: filter request with cookie.</li><li>req_method: filter request with request method.</li><li>condition match:<ul><li>match : fuzzy string matchingï¼Œrecommend to combine with uriï¼Œsupport path-matching.ï¼ˆ/test/**).</li><li>= : matches only if they are equal.</li><li>regEx : regex matchingï¼Œmatch characters in regex expression.</li><li>contains: when it contains the specified value, it matches.</li><li>TimeBefore: before the specified time.</li><li>TimeAfter: after the specified time.</li><li>exclude: the inverse of the method of <code>match</code>.</li><li>startsWith: when its prefix is equal to the specified value, it matches. In certain scenarios, <code>match</code> can be replaced (such as <code>/test/</code> instead of <code>/test/**</code>) for better performance.</li><li>endsWith: when its suffix is equal to the specified value, it matches.</li><li>pathPattern: it&#x27;s an optimized version of <code>match</code>, which has better performance than <code>match</code>, but does not support writing <code>**</code> in the middle of the path (such as <code>/api/**/xxx</code>).</li></ul></li></ul></li><li>Continued: whether the subsequent selector is still executed.</li><li>PrintLogs: it will print the matching log with the open option enabled.</li><li>Enable: whether to enable the plugin.</li><li>Orderï¼šthe smaller will have high priority to execute among multi-selectors.</li><li>Handler: The <code>handle</code> field, configured in <a href="/docs/2.7.0.1/user-guide/admin-usage/plugin-handle-explanation">Plugin handle management</a>. Its purpose is to determine the actions to take when the request matches this selector. Within the selector, the <code>handle</code> field is often used to represent a manually maintained list of service instances. Each service instance includes the following fields:<ul><li><code>host</code>: Host address</li><li><code>ip:port</code>: IP+port address</li><li><code>protocol</code>: Protocol</li><li><code>weight</code>: Weight of the service instance</li><li><code>warmupTime</code>: Service warm-up time</li><li><code>startupTime</code>: Service startup time</li><li><code>status</code>: true indicates the service node is available, false indicates it is not available</li></ul></li></ul></li></ul><blockquote><p><strong>Note</strong>: For plugins that incorporate service discovery modules (such as the Divide plugin, Grpc plugin, and WebSocket plugin), the selector page does not display the handler (i.e., the <code>handle</code> field). Instead, it is manually managed through the <code>Service Discovery</code> tab under local mode. See <a href="/docs/2.7.0.1/user-guide/discovery/discovery-mode">Discovery Module</a> for details.</p></blockquote><ul><li>the above picture means: when the prefix of the request uri is <code>/http</code>, it will redirect to this service <code>127.0.0.1:8080</code>.</li><li>selector advice : combine <code>uri</code> condition and <code>startsWith</code> prefixï¼ˆ/contextPath/ï¼‰as the first request filter.</li><li>selector(the same for rule) match condition fuzzy string matching rule:<ul><li><code>?</code> matches one character</li><li><code>*</code> matches zero or more characters</li><li><code>**</code> matches zero or more directories in a path</li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="rule"></a>Rule<a class="hash-link" href="#rule" title="Direct link to heading">#</a></h2><img src="/img/shenyu/basicConfig/pluginHandle/plugin_rule_config_en.jpg" width="80%" height="80%"><ul><li><p>when the request was passed by the selector, then it will be processed by the rule, the final filter.</p></li><li><p>rule is the final confirmation about how to execute request logically.</p></li><li><p>rule detailed explanationï¼š</p><ul><li><p>Nameï¼šcreate your rule with a distinguish name.</p></li><li><p>MatchType: you can combine these conditions with &#x27;and&#x27; , &#x27;or&#x27; operators.</p></li><li><p>Conditionsï¼š</p><ul><li><p>uri: filter request with uri.</p></li><li><p>header: filter request with request header.</p></li><li><p>query: filter request with query string.</p></li><li><p>ip: filter request with your real ip.</p></li><li><p>host: filter request with your real host.</p></li><li><p>post: not recommend to use.</p></li><li><p>cookie: filter request with cookie.</p></li><li><p>req_method: filter request with request method.</p></li><li><p>condition match:</p><ul><li>match : fuzzy string matchingï¼Œrecommend to combine with uriï¼Œsupport path-matching.ï¼ˆ/test/**).</li><li>= : matches only if they are equal.</li><li>regEx : regex matchingï¼Œmatch characters in regex expression.</li><li>contains: when it contains the specified value, it matches.</li><li>TimeBefore: before the specified time.</li><li>TimeAfter: after the specified time.</li><li>exclude: Same function as <code>match</code>, flow selection is opposite.</li><li>startsWith: when its prefix is equal to the specified value, it matches. In certain scenarios, <code>match</code> can be replaced (such as <code>/test/</code> instead of <code>/test/**</code>) for better performance.</li><li>endsWith: when its suffix is equal to the specified value, it matches.</li><li>pathPattern: it&#x27;s an optimized version of <code>match</code>, which has better performance than <code>match</code>, but does not support writing <code>**</code> in the middle of the path (such as <code>/api/**/xxx</code>).</li></ul></li></ul></li><li><p>PrintLogs: it will print the matching log with the open option enabled.</p></li><li><p>Enable: whether to enable the plugin.</p></li><li><p>Orderï¼šthe smaller will have high priority to execute among multi-rules.</p></li><li><p>handle: The operation when the request matches the rule.</p></li></ul></li><li><p>above picture means: when the request <code>uri</code> equals to <code>/http/order/save</code>, it will execute based on this ruleï¼Œload strategy is <code>random</code>.</p></li><li><p>rule advice: combine <code>uri</code> condition with <code>match</code> the real <code>uri path</code> condition as the final filter.</p></li><li><p>combine selector means ï¼šwhen the request <code>uri</code> is <code>/http/order/save</code>, it will be redicted to <code>127.0.0.1:8080</code> by <code>random</code> method.</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="match-strategy"></a>Match Strategy<a class="hash-link" href="#match-strategy" title="Direct link to heading">#</a></h2><p>Matching mode refers to the matching mode between multiple conditions when a selector or rule is matched. Currently, <code>and</code> and <code>or</code> are supported.</p><ul><li><p><code>and</code></p><p><code>and</code> indicates that a selector or rule can be matched only if more than one condition is met.</p><p>The example below shows that a request must meet both the condition <code>uri = /http/order/findById</code> and the condition <code>id = 100</code>  to match this rule.</p><p>For example, a real request <code>http://localhost:9195/http/order/findById?id=100</code> satisfies both conditions, this rule can be matched.</p></li></ul><p><img src="/assets/images/match-strategy-and-en-3dc5ce5d8c0bc56e60b51e0f6abd12bd.png"></p><ul><li><p><code>or</code></p><p><code>or</code> indicates that one of the conditions matches a selector or rule.</p><p>The example below shows that a request matches this rule if it meets either the condition <code>uri = /http/order/findById</code> or the condition <code>id = 100</code>.</p><p>For example, a real request <code>http://localhost:9195/http/order/findById?id=99</code> satisfies the first condition <code>uri = /http/order/findById</code>, so it can also match this rule.</p></li></ul><p><img src="/assets/images/match-strategy-or-en-a9b2dc0ee90d0532004ef7f0defad516.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="condition-parameter-data"></a>Condition Parameter Data<a class="hash-link" href="#condition-parameter-data" title="Direct link to heading">#</a></h2><p>Conditional parameter Settings in selectors and rules are explained again. Suppose the following is a request header for an <code>Http</code> request:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">GET http://localhost:9195/http/order/findById?id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">Accept: application/json</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Cookie: </span><span class="token assign-left variable" style="color:#36acaa">shenyu</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">shenyu_cookie</span></span><span class="token-line" style="color:#393A34"><span class="token plain">MyHeader: custom-header</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In <code>ShenYu</code> you can set different conditional parameters to get real data from the request information.</p><ul><li>If the condition parameter is <code>uri</code>, then the actual data retrieved is <code>/http/order/findById</code>;</li><li>If the condition parameter is <code>header</code>, the field name is <code>MyHeader</code>, then the actual data retrieved is <code>custom-header</code>;</li><li>If the condition parameter is <code>query</code>, the field name is <code>id</code>, then the actual data retrieved is <code>100</code>;</li><li>If the condition parameter is <code>ip</code>, then the actual data retrieved is <code>0:0:0:0:0:0:0:1</code>;</li><li>If the condition parameter is <code>host</code>, then the actual data retrieved is <code>0:0:0:0:0:0:0:1</code>;</li><li>If the condition parameter is <code>post</code>, the field name is <code>contextPath</code>, then the actual data retrieved is <code>/http</code>;</li><li>If the condition parameter is <code>cookie</code>, the field name is <code>shenyu</code>, then the actual data retrieved is <code>shenyu_cookie</code>;</li><li>If the condition parameter is <code>req_method</code>, then the actual data retrieved is <code>GET</code>;</li></ul><ul><li><p><code>uri</code>(recommended)</p><ul><li><p><code>uri</code> matches are based on the <code>uri</code> in the path you requested, and there is almost no change in the front end when accessing the gateway.</p></li><li><p>When using <code>match</code>, the principle is the same as <code>SpringMVC</code> fuzzy matching.</p></li><li><p>In selectors, it is recommended to use prefixes in <code>URI</code> for matching, while in rules, specific paths are used for matching.</p></li><li><p>When using this matching method, fill in the value of the matching field, as shown in the figure <code>/http/**</code>.</p></li></ul><p><img src="/assets/images/parameter-data-uri-en-8106039033485e12adc70d751e4ba81b.png"></p></li><li><p><code>header</code> </p><ul><li><p>The <code>header</code> is matched against the field values in your <code>http</code> request header.</p></li><li><p>When using this matching method, you need to fill in the field name and field value. The examples in the figure are <code>MyHeader</code> and <code>custom-header</code> respectively</p></li></ul><p><img src="/assets/images/parameter-data-header-en-2d7350e606875425ba7000a63f60bae4.png"></p></li><li><p><code>query</code> </p><ul><li><p>This matches the query parameters in your <code>uri</code>, such as <code>/test?id=1</code>, then the matching method can be selected.</p></li><li><p>When using this matching method, you need to fill in the field name and field value. The examples in the figure are <code>id</code> and 1 respectively.</p></li></ul><p><img src="/assets/images/parameter-data-query-en-ae199d298b7d11fb67e656e2c84c7d15.png"></p></li><li><p><code>ip</code></p><ul><li><p>This is matched against the <code>http</code> caller&#x27;s <code>ip</code>.</p></li><li><p>Especially in waf plugin, if an <code>ip</code> address is found to be attacked, you can add a matching condition, fill in the <code>ip</code>, deny the <code>ip</code> access.</p></li><li><p>If you use nginx proxy before ShenYu, you can get the right ip with refering to <a href="/docs/2.7.0.1/developer/custom-parsing-ip-and-host">parsing-ip-and-host</a></p></li><li><p>When using this matching method, fill in the value of the matching field, as shown in the example <code>192.168.236.75</code>.</p></li></ul><p><img src="/assets/images/parameter-data-ip-en-24cba6d24a6946934d4cae32b8c25520.png"></p></li></ul><ul><li><p><code>host</code> </p><ul><li><p>This is matched against the <code>http</code> caller&#x27;s <code>host</code>.</p></li><li><p>Especially in waf plugin, if an <code>host</code> address is found to be attacked, you can add a matching condition, fill in the <code>host</code>, deny the <code>host</code> access.</p></li><li><p>If you use nginx proxy before ShenYu, you can get the right ip with refering to <a href="/docs/2.7.0.1/developer/custom-parsing-ip-and-host">parsing-ip-and-host</a></p></li><li><p>When using this matching method, fill in the value of the matching field, as shown in the example <code>localhost</code>.</p></li></ul><p><img src="/assets/images/parameter-data-host-en-e602968ecae139d1fd003b2088d93954.png"></p></li><li><p><code>post</code> </p><ul><li><p>To get condition parameters from the request context(<code>org.apache.shenyu.plugin.api.context.ShenyuContext</code>), reflection is required to get the value of the field, which is not recommended.</p></li><li><p>When using this matching method, the field name and value need to be specified. The examples in the figure are <code>contextPath</code> and <code>/http</code> respectively.</p></li></ul><p><img src="/assets/images/parameter-data-post-en-64c4fa2226342bdbfcc7e1110e7375da.png"></p></li></ul><ul><li><p><code>cookie</code> </p><ul><li><p>This is matched against the <code>Cookie</code> in the <code>http</code> caller&#x27;s request header as a condition parameter.</p></li><li><p>When using this matching method, you need to fill in the field name and field value. The examples in the figure are <code>shenyu</code> and <code>shenyu_cookie</code> respectively.</p></li></ul><p><img src="/assets/images/parameter-data-cookie-en-d4f494e4ff70a1029c64946c0fc6d3be.png"></p></li><li><p><code>req_method</code> </p><ul><li><p>This matches the request form of the <code>http</code> caller, such as <code>GET</code>, <code>POST</code>, etc.</p></li><li><p>When using this matching method, fill in the value of the matching field, as shown in the example <code>GET</code>.</p></li></ul><p><img src="/assets/images/parameter-data-req_method-en-0dcbf034ad9d7e94df26cfbf09534f2d.png"></p></li></ul><p>For a more in-depth understanding of condition parameter fetching, read the source code, package name is <code>org.apache.shenyu.plugin.base.condition.data</code>:</p><table><thead><tr><th align="left">Condition Parameter</th><th align="left">Class</th></tr></thead><tbody><tr><td align="left"><code>uri</code></td><td align="left"><code>URIParameterData</code></td></tr><tr><td align="left"><code>header</code></td><td align="left"><code>HeaderParameterData</code></td></tr><tr><td align="left"><code>query</code></td><td align="left"><code>QueryParameterData</code></td></tr><tr><td align="left"><code>ip</code></td><td align="left"><code>IpParameterData</code></td></tr><tr><td align="left"><code>host</code></td><td align="left"><code>HostParameterData</code></td></tr><tr><td align="left"><code>post</code></td><td align="left"><code>PostParameterData</code></td></tr><tr><td align="left"><code>cookie</code></td><td align="left"><code>CookieParameterData</code></td></tr><tr><td align="left"><code>req_method</code></td><td align="left"><code>RequestMethodParameterData</code></td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="condition-match-strategy"></a>Condition Match Strategy<a class="hash-link" href="#condition-match-strategy" title="Direct link to heading">#</a></h2><p>Condition parameters allow you to retrieve the actual data of the request. How the real data matches the conditional data preset by the selector or rule is realized through the condition match strategy.</p><ul><li><p><code>match</code> </p><p><code>match</code> supports fuzzy matching (<code>/**</code>). Request <code>/http/order/findById</code> will match if your selector condition is set as follows.</p><p><img src="/assets/images/predicate-judge-match-en-bfda0697b6762102f2a40f375d1be44b.png"></p></li><li><p><code>=</code> </p><p><code>=</code> means that the requested real data is equal to the preset condition data. If your selector condition is set to request uri equal to <code>/http/order/findById</code>, then request<code>/http/order/findById?id=1</code> can match it.</p><p><img src="/assets/images/predicate-judge-equals-en-a9e1c88ebd6b0c4e109ac6e030fb1b35.png"></p></li><li><p><code>regex</code> </p><p><code>regex</code> means that the requested real data can meet the preset condition of the regular expression to match successfully. Suppose your rule conditions are sets as follows: the request parameter contains an <code>id</code> and is a three-digit number. So request <code>/http/order/findById?id=900</code> will match.</p><p><img src="/assets/images/predicate-judge-regex-en-079903a9d60961830e37eab69821e0f7.png"></p></li><li><p><code>contains</code> </p><p><code>contains</code> means that the requested real data contains the default condition data. Suppose your rule condition is set as follows: request uri contains <code>findById</code>. Request <code>/http/order/findById?id=1</code> will match.</p><p><img src="/assets/images/predicate-judge-contains-en-b23ef6d367776827239d836ef55e1fd6.png"></p></li><li><p><code>TimeBefore</code> </p><p><code>TimeBefore</code> indicates that the request time will be matched before the preset condition time. Suppose your rule conditions are sets as follows: request parameters contain <code>date</code> and <code>date</code> is less than <code>2021-09-26 06:12:10</code>. Request <code>/http/order/findById?id=100&amp;date=2021-09-22 06:12:10</code> will match.</p><p><img src="/assets/images/predicate-judge-timebefore-en-56c335cbe779dd1e56760a3d8c13ab94.png"></p></li><li><p><code>TimeAfter</code> </p><p><code>TimeAfter</code> indicates that the request time will be matched before the preset condition time. Suppose your rule conditions are sets as follows: request parameters contain <code>date</code> and <code>date</code> is greater than <code>2021-09-26 06:12:10</code>. Request <code>/http/order/findById?id=100&amp;date=2021-09-22 06:12:10</code> will match.</p><p><img src="/assets/images/predicate-judge-timeafter-en-c3a68a43426d513363d677dd6d1f5f44.png"></p></li><li><p><code>exclude</code></p><p><code>exclude</code> is the inverse of the method of <code>match</code>, and some functions of <code>match</code> are also available, but it is a matching filter. If your selector condition is set as follows, the request <code>/http/order/findById</code> will filter this.</p><p><img src="/assets/images/predicate-judge-exclude-en-1715ee844304c48941ba38af56ea5f03.png"></p></li><li><p><code>startsWith</code></p><p><code>startsWith</code> indicates that the prefix of the requested real data is equal to the preset condition data. Suppose your rule conditions are sets as follows: the prefix in the request <code>uri</code> is equal to <code>/http/</code>, the request <code>/http/order/findById?id=1</code> can be matched.</p><p><img src="/assets/images/predicate-judge-startswith-en-b2cca14e882a7608e314fbe0c0fdfbe0.png"></p></li><li><p><code>endsWith</code></p><p><code>endsWith</code> indicates that the suffix of the requested real data is equal to the preset condition data. Suppose your rule conditions are sets as follows: request <code>uri</code> suffix equals <code>Id</code>. Then the request <code>/http/order/findById?id=1</code> can be matched.</p><p><img src="/assets/images/predicate-judge-endswith-en-6da555605e5eebba2895ab8ee3f22b9d.png"></p></li><li><p><code>pathPattern</code></p><p>Like <code>match</code>, <code>pathPattern</code> supports fuzzy matching (<code>/**</code>). If your rule conditions are sets as follows, then the request <code>/http/order/findById</code> can be matched;</p><p>Notice: writing <code>**</code> in the middle of the path (such as <code>/api/**/xxx</code>) is not supported!</p><p><img src="/assets/images/predicate-judge-pathpattern-en-caac10533eaa86164bfcfb75d0c9f3a5.png"></p></li></ul><p>If you want to further understand conditions matching strategy, please read the source code, the package name is <code>org.apache.shenyu.plugin.base.condition.judge</code>:</p><table><thead><tr><th align="left">Match Strategy</th><th align="left">Class</th></tr></thead><tbody><tr><td align="left"><code>match</code></td><td align="left"><code>MatchPredicateJudge</code></td></tr><tr><td align="left"><code>=</code></td><td align="left"><code>EqualsPredicateJudge</code></td></tr><tr><td align="left"><code>regex</code></td><td align="left"><code>RegexPredicateJudge</code></td></tr><tr><td align="left"><code>contains</code></td><td align="left"><code>ContainsPredicateJudge</code></td></tr><tr><td align="left"><code>TimeBefore</code></td><td align="left"><code>TimerBeforePredicateJudge</code></td></tr><tr><td align="left"><code>TimeAfter</code></td><td align="left"><code>TimerAfterPredicateJudge</code></td></tr><tr><td align="left"><code>exclude</code></td><td align="left"><code>ExcludePredicateJudge</code></td></tr><tr><td align="left"><code>startsWith</code></td><td align="left"><code>StartsWithPredicateJudge</code></td></tr><tr><td align="left"><code>endsWith</code></td><td align="left"><code>EndsWithPredicateJudge</code></td></tr><tr><td align="left"><code>pathPattern</code></td><td align="left"><code>PathPatternPredicateJudge</code></td></tr></tbody></table><p>The examples in this article illustrate the use of selectors and rules. The Settings of specific conditions need to be selected according to actual conditions.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/apache/shenyu-website/edit/main/versioned_docs/version-2.7.0.1/user-guide/admin-usage/selector-and-rule.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_wj+Z"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/2.7.0.1/user-guide/admin-usage/role-management"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Role Management</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/2.7.0.1/user-guide/property-config/admin-property-config"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Admin Property Config Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#features" class="table-of-contents__link">Features</a></li><li><a href="#selector" class="table-of-contents__link">Selector</a></li><li><a href="#rule" class="table-of-contents__link">Rule</a></li><li><a href="#match-strategy" class="table-of-contents__link">Match Strategy</a></li><li><a href="#condition-parameter-data" class="table-of-contents__link">Condition Parameter Data</a></li><li><a href="#condition-match-strategy" class="table-of-contents__link">Condition Match Strategy</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.1c5d765b.js"></script>
<script src="/assets/js/main.adb5374d.js"></script>
</body>
</html>