"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[83103],{28453(e,n,t){t.d(n,{R:()=>a,x:()=>c});var r=t(96540);const i={},s=r.createContext(i);function a(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(s.Provider,{value:n},e.children)}},57105(e,n,t){t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>p});const r=JSON.parse('{"id":"http","title":"Http Example","description":"http","source":"@site/shenyuClientRust/http.md","sourceDirName":".","slug":"/http","permalink":"/zh/shenyuClientRust/http","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":"shown","lastUpdatedAt":1768275723000,"frontMatter":{"description":"http","title":"Http Example"},"sidebar":"community"}');var i=t(74848),s=t(28453);const a={description:"http",title:"Http Example"},c="The Http type Register",o={},p=[];function l(e){const n={code:"code",h1:"h1",header:"header",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"the-http-type-register",children:"The Http type Register"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"1.Fist make sure The ShenYuAdmin is Started, and ShenYuAdmin service active port is 9095."})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-log",children:"//Or you will see this error :\n \n2024-10-09T07:23:26.970200Z ERROR shenyu_client_rust::core: Can't get register token\n2024-10-09T07:23:29.015550Z ERROR shenyu_client_rust::core: [ERROR], register metadata to http://127.0.0.1:9095/shenyu-client/register-metadata failed, app_name: shenyu_client_app, path: /health, contextPath: /xxx\n2024-10-09T07:23:31.039558Z ERROR shenyu_client_rust::core: [ERROR], register metadata to http://127.0.0.1:9095/shenyu-client/register-metadata failed, app_name: shenyu_client_app, path: /users, contextPath: /xxx\n2024-10-09T07:23:33.089412Z ERROR shenyu_client_rust::core: [ERROR], register uri to http://127.0.0.1:9095/shenyu-client/register-uri failed, app_name: shenyu_client_app, host: 10.10.9.198, port: 3000\n2024-10-09T07:23:35.124249Z ERROR shenyu_client_rust::core: [ERROR], register discover config to http://127.0.0.1:9095/shenyu-client/register-discoveryConfig failed, discovery_type: zookeeper, host: 10.10.9.198, port: 3000\n \n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"2.Step 1 Get shenyu_admin_client. (Register service need this)"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:'#  a yml-format config file\nshenyu:\n  register:\n    register_type: "http"\n    servers: "http://127.0.0.1:9095"\n    props:\n      username: "admin"\n      password: "123456"\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'fn register_test() {\n    //init config.\n    let config = ShenYuConfig::from_yaml_file("config.yml").unwrap();\n    // init shenyu client.\n    let client = ShenyuClient::new(config, app.app_name(), app.uri_infos(), 3000).unwrap();\n    /// other steps.\n}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'The adminToken like this :\n{\n    "code":200,\n    "message":"login dashboard user success",\n    "data":{\n        "id":"1",\n        "userName":"admin",\n        "role":1,\n        "enabled":true,\n        "dateCreated":"2018-06-23 15:12:22",\n        "dateUpdated":"2024-10-03 02:29:39",\n        "token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyTmFtZSI6ImFkbWluIiwiZXhwIjoxNzI4NTQ3NjQ3fQ.93LAuDP_MrJZeQB5A6gX-3-Vyxy9egw41QhnNHlUWEE"\n    }\n}\n\nWhen you success get toekn, you will see this :\n2024-10-09T08:07:27.721483Z  INFO shenyu_client_rust::core: [SUCCESS], get register token success, register token: "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyTmFtZSI6ImFkbWluIiwiZXhwIjoxNzI4NTQ3NjQ3fQ.93LAuDP_MrJZeQB5A6gX-3-Vyxy9egw41QhnNHlUWEE"\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"3.Step 2 Register to ShenYu admin. (maybe add the admin sync data to gateway doc url)."})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'fn register_test() {\n    /// Step1.\n    // register to shenyu admin.\n    client.register().expect("TODO: panic message");\n}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-log",children:'2024-10-03T02:29:39.392390Z  INFO shenyu_client_rust::core: [SUCCESS], register metadata success, register data: Object {\n"appName": String("shenyu_client_app"),\n"contextPath": String("/xxx"),\n"enabled": Bool(true),\n"host": String("10.1.0.187"),\n"methodName": String("get"),\n"parameterTypes": String(""),\n"path": String("/xxx/health"),\n"pathDesc": String(""),\n"pluginNames": Array [],\n"port": Number(4000),\n"registerMetaData": String(""),\n"rpcExt": String(""),\n"rpcType": String("http"),\n"ruleName": String("/xxx/health"),\n"serviceName": String("shenyu_client_app"),\n}\n2024-10-03T02:29:39.398917Z  INFO shenyu_client_rust::core: [SUCCESS], register metadata success, register data: Object {\n"appName": String("shenyu_client_app"),\n"contextPath": String("/xxx"),\n"enabled": Bool(true),\n"host": String("10.1.0.187"),\n"methodName": String("post"),\n"parameterTypes": String(""),\n"path": String("/xxx/create_user"),\n"pathDesc": String(""),\n"pluginNames": Array [],\n"port": Number(4000),\n"registerMetaData": String(""),\n"rpcExt": String(""),\n"rpcType": String("http"),\n"ruleName": String("/xxx/create_user"),\n"serviceName": String("shenyu_client_app"),\n}\n2024-10-03T02:29:39.404389Z  INFO shenyu_client_rust::core: [SUCCESS], register metadata success, register data: Object {\n"appName": String("shenyu_client_app"),\n"contextPath": String("/xxx"),\n"enabled": Bool(true),\n"host": String("10.1.0.187"),\n"methodName": String("get"),\n"parameterTypes": String(""),\n"path": String("/xxx/"),\n"pathDesc": String(""),\n"pluginNames": Array [],\n"port": Number(4000),\n"registerMetaData": String(""),\n"rpcExt": String(""),\n"rpcType": String("http"),\n"ruleName": String("/xxx/"),\n"serviceName": String("shenyu_client_app"),\n}\n2024-10-03T02:29:39.409866Z  INFO shenyu_client_rust::core: [SUCCESS], register uri success, register data: Object {\n"appName": String("shenyu_client_app"),\n"contextPath": String("/xxx"),\n"eventType": String("REGISTER"),\n"host": String("10.1.0.187"),\n"port": Number(4000),\n"protocol": String("http"),\n"rpcType": String("http"),\n}\n2024-10-03T02:29:39.433662Z  INFO shenyu_client_rust::core: [SUCCESS], register discover config success, register data: Object {\n"discoveryType": String("zookeeper"),\n"handler": String("{}"),\n"listenerNode": String("/shenyu/discovery/http_example"),\n"name": String("defaultzookeeper"),\n"pluginName": String(""),\n"props": Object {\n"baseSleepTimeMilliseconds": String("1000"),\n"connectionTimeoutMilliseconds": String("60000"),\n"maxRetries": String("4"),\n"maxSleepTimeMilliseconds": String("5000"),\n"sessionTimeoutMilliseconds": String("8"),\n},\n"selectorName": String("/xxx"),\n"serverList": String("127.0.0.1:2181"),\n}\n\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"3.Step 3 Offline register from ShenYu GateWay."})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-log",children:'2024-10-03T02:29:50.311159Z  INFO shenyu_client_rust::core: [SUCCESS], offline success, register data: Object {\n"appName": String("shenyu_client_app"),\n"contextPath": String("/xxx"),\n"eventType": String("REGISTER"),\n"host": String("10.1.0.187"),\n"port": Number(4000),\n"protocol": String("http"),\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}}}]);