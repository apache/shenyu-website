"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[54700],{28453(e,n,s){s.d(n,{R:()=>o,x:()=>i});var r=s(96540);const c={},t=r.createContext(c);function o(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:o(e.components),r.createElement(t.Provider,{value:n},e.children)}},46332(e,n,s){s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"user-guide/proxy/grpc-proxy","title":"gRPC Proxy","description":"gRPC access shenyu gateway","source":"@site/versioned_docs/version-2.7.0.1/user-guide/proxy/grpc-proxy.md","sourceDirName":"user-guide/proxy","slug":"/user-guide/proxy/grpc-proxy","permalink":"/docs/2.7.0.1/user-guide/proxy/grpc-proxy","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/shenyu-website/edit/main/versioned_docs/version-2.7.0.1/user-guide/proxy/grpc-proxy.md","tags":[],"version":"2.7.0.1","frontMatter":{"title":"gRPC Proxy","keywords":["gRPC"],"description":"gRPC access shenyu gateway"},"sidebar":"tutorialSidebar","previous":{"title":"Dubbo Proxy","permalink":"/docs/2.7.0.1/user-guide/proxy/dubbo-proxy"},"next":{"title":"Http Proxy","permalink":"/docs/2.7.0.1/user-guide/proxy/http-proxy"}}');var c=s(74848),t=s(28453);const o={title:"gRPC Proxy",keywords:["gRPC"],description:"gRPC access shenyu gateway"},i=void 0,a={},l=[{value:"Add gRPC plugin in gateway",id:"add-grpc-plugin-in-gateway",level:2},{value:"gRPC service access gateway",id:"grpc-service-access-gateway",level:2},{value:"User Request",id:"user-request",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(n.p,{children:["This document is intended to help the ",(0,c.jsx)(n.code,{children:"gRPC"})," service access the ",(0,c.jsx)(n.code,{children:"Apache ShenYu"})," gateway. The ",(0,c.jsx)(n.code,{children:"Apache ShenYu"})," gateway uses the ",(0,c.jsx)(n.code,{children:"gRPC"})," plugin to handle ",(0,c.jsx)(n.code,{children:"gRPC"})," service."]}),"\n",(0,c.jsxs)(n.p,{children:["Before the connection, start ",(0,c.jsx)(n.code,{children:"shenyu-admin"})," correctly, start ",(0,c.jsx)(n.code,{children:"gRPC"})," plugin, and add related dependencies on the gateway and ",(0,c.jsx)(n.code,{children:"gRPC"})," application client. Refer to the previous ",(0,c.jsx)(n.a,{href:"../../quick-start/quick-start-grpc",children:"Quick start with gRPC"})," ."]}),"\n",(0,c.jsxs)(n.p,{children:["For details about client access configuration, see ",(0,c.jsx)(n.a,{href:"/docs/2.7.0.1/user-guide/property-config/register-center-access",children:"Application Client Access Config"})," ."]}),"\n",(0,c.jsxs)(n.p,{children:["For details about data synchronization configurations, see ",(0,c.jsx)(n.a,{href:"/docs/2.7.0.1/user-guide/property-config/use-data-sync",children:"Data Synchronization Config"})," ."]}),"\n",(0,c.jsx)(n.h2,{id:"add-grpc-plugin-in-gateway",children:"Add gRPC plugin in gateway"}),"\n",(0,c.jsxs)(n.p,{children:["Add the following dependencies in the gateway's ",(0,c.jsx)(n.code,{children:"pom.xml"})," file:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-xml",children:"        \x3c!-- apache shenyu grpc plugin start--\x3e\n        <dependency>\n            <groupId>org.apache.shenyu</groupId>\n            <artifactId>shenyu-spring-boot-starter-plugin-grpc</artifactId>\n            <version>${project.version}</version>\n        </dependency>\n        \x3c!-- apache shenyu grpc plugin end--\x3e\n"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Restart the gateway service."}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"grpc-service-access-gateway",children:"gRPC service access gateway"}),"\n",(0,c.jsxs)(n.p,{children:["You can refer to\uff1a",(0,c.jsx)(n.a,{href:"https://github.com/apache/shenyu/tree/master/shenyu-examples/shenyu-examples-grpc",children:"shenyu-examples-grpc"})," ."]}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["In the microservice built by ",(0,c.jsx)(n.code,{children:"gRPC"}),", add the following dependencies:"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-xml",children:"        <dependency>\n            <groupId>org.apache.shenyu</groupId>\n            <artifactId>shenyu-spring-boot-starter-client-grpc</artifactId>\n            <version>${shenyu.version}</version>\n            <exclusions>\n                <exclusion>\n                    <artifactId>guava</artifactId>\n                    <groupId>com.google.guava</groupId>\n                </exclusion>\n            </exclusions>\n        </dependency>\n"})}),"\n",(0,c.jsxs)(n.p,{children:["Execute command to generate java code in  ",(0,c.jsx)(n.code,{children:"shenyu-examples-grpc"})," project."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"mvn protobuf:compile \nmvn protobuf:compile-custom \n"})}),"\n",(0,c.jsxs)(n.ol,{start:"2",children:["\n",(0,c.jsx)(n.li,{children:"Add the following configuration to application.yaml:"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:"shenyu:\n  register:\n    registerType: http #zookeeper #etcd #nacos #consul\n    serverLists: http://localhost:9095 #localhost:2181 #http://localhost:2379 #localhost:8848\n    props:\n      username: admin\n      password: 123456\n  client:\n    grpc:\n      props:\n        contextPath: /grpc\n        appName: grpc\n        ipAndPort: 127.0.0.1:38080\n        port: 38080\n"})}),"\n",(0,c.jsxs)(n.ol,{start:"3",children:["\n",(0,c.jsxs)(n.li,{children:["Add ",(0,c.jsx)(n.code,{children:"@ShenyuGrpcClient"})," Annotation on the ",(0,c.jsx)(n.code,{children:"gRPC"})," service interface implementation class. Start your service provider, after successful registration, in the background management system go to PluginList -> rpc proxy -> gRPC, you will see automatic registration of selectors and rules information."]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"Example:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-java",children:'    @Override\n    @ShenyuGrpcClient(path = "/echo", desc = "echo")\n    public void echo(EchoRequest request, StreamObserver<EchoResponse> responseObserver) {\n        System.out.println("Received: " + request.getMessage());\n        EchoResponse.Builder response = EchoResponse.newBuilder()\n                .setMessage("ReceivedHELLO")\n                .addTraces(Trace.newBuilder().setHost(getHostname()).build());\n        responseObserver.onNext(response.build());\n        responseObserver.onCompleted();\n    }\n\n'})}),"\n",(0,c.jsx)(n.h2,{id:"user-request",children:"User Request"}),"\n",(0,c.jsxs)(n.p,{children:["You can request your gRPC service by Http. The ",(0,c.jsx)(n.code,{children:"Apache ShenYu"})," gateway needs to have a route prefix that you access to configure ",(0,c.jsx)(n.code,{children:"contextPath"}),"."]}),"\n",(0,c.jsxs)(n.p,{children:["If your ",(0,c.jsx)(n.code,{children:"proto"})," file is defined as follows:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-protobuf",children:"message EchoRequest {\n  string message = 1;\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"So the request parameters look like this:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n    "data": [\n        {\n            "message": "hello grpc"\n        }\n    ]\n}\n'})}),"\n",(0,c.jsxs)(n.p,{children:["The parameters are currently passed in ",(0,c.jsx)(n.code,{children:"json"})," format, and the name of ",(0,c.jsx)(n.code,{children:"key"})," defaults to ",(0,c.jsx)(n.code,{children:"data"}),", which you can reset in ",(0,c.jsx)(n.code,{children:"GrpcConstants.JSON_DESCRIPTOR_PROTO_FIELD_NAME"}),"; The ",(0,c.jsx)(n.code,{children:"value"})," is passed in according to the ",(0,c.jsx)(n.code,{children:"proto"})," file you define."]}),"\n",(0,c.jsxs)(n.p,{children:["the Apache ShenYu can support streaming calls to ",(0,c.jsx)(n.code,{children:"gRPC"})," service, passing multiple arguments in the form of an array."]}),"\n",(0,c.jsxs)(n.p,{children:["If your ",(0,c.jsx)(n.code,{children:"proto"})," file is defined as follows:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-protobuf",children:"message RequestData {\n  string text = 1;\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"The corresponding method call request parameters are as follows:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"UNARY"})}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n    "data": [\n        {\n            "text": "hello grpc"\n        }\n    ]\n}\n'})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"CLIENT_STREAMING"})}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n    "data": [\n        {\n            "text": "hello grpc"\n        }, \n        {\n            "text": "hello grpc"\n        }, \n        {\n            "text": "hello grpc"\n        }\n    ]\n}\n'})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"SERVER_STREAMING"})}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n    "data": [\n        {\n            "text": "hello grpc"\n        }\n    ]\n}\n'})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"BIDI_STREAMING"})}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n    "data": [\n        {\n            "text": "hello grpc"\n        }, \n        {\n            "text": "hello grpc"\n        }, \n        {\n            "text": "hello grpc"\n        }\n    ]\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}}}]);