"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[68534],{17274(e,n,r){r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var s=r(84087),t=r(74848),i=r(28453);const o={title:"McpServer Plugin Source Code Analysis",author:"yusiheng",author_title:"Apache ShenYu Contributor",author_url:"https://github.com/478320",tags:["plugin","mcp","Apache ShenYu"]},a=void 0,l={authorsImageUrls:[void 0]},c=[{value:"Introduction",id:"introduction",level:3},{value:"1. Service Registration",id:"1-service-registration",level:3},{value:"1.1 Transport and McpServer Registration",id:"11-transport-and-mcpserver-registration",level:4},{value:"1.1.1 Transport Registration",id:"111-transport-registration",level:5},{value:"1.1.2 McpServer Registration",id:"112-mcpserver-registration",level:5},{value:"1.2 Tools Registration",id:"12-tools-registration",level:4},{value:"2. Plugin Execution",id:"2-plugin-execution",level:3},{value:"2.1 Client Sends SSE Request",id:"21-client-sends-sse-request",level:4},{value:"2.2 Client Sends Message Request",id:"22-client-sends-message-request",level:4},{value:"3. Tool Invocation",id:"3-tool-invocation",level:3},{value:"4. Summary",id:"4-summary",level:3}];function d(e){const n={a:"a",blockquote:"blockquote",br:"br",code:"code",h3:"h3",h4:"h4",h5:"h5",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["In the Shenyu gateway, when you start this plugin, Shenyu becomes a fully-featured McpServer.",(0,t.jsx)(n.br,{}),"\n","You can easily register a service as a tool within the Shenyu gateway by simple configuration and use the extended functions the gateway offers."]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["This article is based on version ",(0,t.jsx)(n.code,{children:"shenyu-2.7.0.2"}),". Here, I will track the Shenyu Mcp plugin chain and analyze the source code of its SSE communication."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"introduction",children:"Introduction"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"The Shenyu gateway's Mcp plugin is built on top of the spring-ai-mcp extension. To better understand how the Mcp plugin works, I\u2019ll briefly introduce how some official Mcp Java classes collaborate within its JDK."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"I want to start by introducing three key official Mcp Java classes:"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"McpServer"}),(0,t.jsx)(n.br,{}),"\n","This class manages resources like tools, Resource, promote, etc."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"TransportProvider"}),(0,t.jsx)(n.br,{}),"\n","Provides corresponding communication methods based on client-server communication protocols."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Session"}),(0,t.jsx)(n.br,{}),"\n","Handles request data, response data, and notifications, offers some basic methods and corresponding handlers, and executes tool queries and calls here."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"1-service-registration",children:"1. Service Registration"}),"\n",(0,t.jsxs)(n.p,{children:["In Shenyu Admin, after filling in endpoint and tool information for the McpServer plugin, this info is automatically registered into Shenyu bootstrap.",(0,t.jsx)(n.br,{}),"\n","You can refer to the official ",(0,t.jsx)(n.a,{href:"https://shenyu.incubator.apache.org/blog/DataSync-SourceCode-Analysis-WebSocket-Data-Sync",children:"websocket data sync source code"})," for details."]}),"\n",(0,t.jsxs)(n.p,{children:["Shenyu bootstrap receives the data synced from admin in the ",(0,t.jsx)(n.code,{children:"handler()"})," method of ",(0,t.jsx)(n.code,{children:"McpServerPluginDataHandler"}),"."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"handlerSelector()"})," receives URL data and creates McpServer."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"handlerRule()"})," receives tool info and registers tools."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"These two methods together form the service registration part of the Shenyu Mcp plugin. Below, I will analyze these two methods in detail."}),"\n",(0,t.jsx)(n.h4,{id:"11-transport-and-mcpserver-registration",children:"1.1 Transport and McpServer Registration"}),"\n",(0,t.jsxs)(n.p,{children:["Let\u2019s analyze the ",(0,t.jsx)(n.code,{children:"handlerSelector()"})," method, which handles McpServer registration."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["What ",(0,t.jsx)(n.code,{children:"handlerSelector()"})," does:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public class McpServerPluginDataHandler implements PluginDataHandler {\n    @Override\n    public void handlerSelector(final SelectorData selectorData) {\n        // Get URI\n        String uri = selectorData.getConditionList().stream()\n                .filter(condition -> Constants.URI.equals(condition.getParamType()))\n                .map(ConditionData::getParamValue)\n                .findFirst()\n                .orElse(null);\n        \n        // Build McpServer\n        ShenyuMcpServer shenyuMcpServer = GsonUtils.getInstance().fromJson(Objects.isNull(selectorData.getHandle()) ? DEFAULT_MESSAGE_ENDPOINT : selectorData.getHandle(), ShenyuMcpServer.class);\n        shenyuMcpServer.setPath(path);\n        // Cache shenyuMcpServer\n        CACHED_SERVER.get().cachedHandle(\n                selectorData.getId(),\n                shenyuMcpServer);\n        String messageEndpoint = shenyuMcpServer.getMessageEndpoint();\n        // Try to get or register transportProvider\n        shenyuMcpServerManager.getOrCreateMcpServerTransport(uri, messageEndpoint);\n    }\n    \n}\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"ShenyuMcpServerManager"})," is the management center of McpServer in Shenyu. It not only stores ",(0,t.jsx)(n.code,{children:"McpAsyncServer"}),", ",(0,t.jsx)(n.code,{children:"CompositeTransportProvider"}),", etc., but also contains methods to register Transport and McpServer."]}),"\n"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"getOrCreateMcpServerTransport()"})," method works as follows:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"@Component\npublic class ShenyuMcpServerManager {\n    public ShenyuSseServerTransportProvider getOrCreateMcpServerTransport(final String uri, final String messageEndPoint) {\n        // Remove /streamablehttp and /message suffixes\n        String normalizedPath = processPath(uri);\n        return getOrCreateTransport(normalizedPath, SSE_PROTOCOL,\n                () -> createSseTransport(normalizedPath, messageEndPoint));\n    }\n    \n    private <T> T getOrCreateTransport(final String normalizedPath, final String protocol,\n                                       final java.util.function.Supplier<T> transportFactory) {\n        // Get composite Transport instance\n        CompositeTransportProvider compositeTransport = getOrCreateCompositeTransport(normalizedPath);\n\n        T transport = switch (protocol) {\n            case SSE_PROTOCOL -> (T) compositeTransport.getSseTransport();\n            case STREAMABLE_HTTP_PROTOCOL -> (T) compositeTransport.getStreamableHttpTransport();\n            default -> null;\n        };\n        // If instance is missing in cache, create a new one\n        if (Objects.isNull(transport)) {\n            // Call createSseTransport() to create and store a new transport\n            transport = transportFactory.get();\n            // Create McpAsyncServer and register the transport\n            addTransportToSharedServer(normalizedPath, protocol, transport);\n        }\n\n        return transport;\n    }\n}\n"})}),"\n",(0,t.jsx)(n.h5,{id:"111-transport-registration",children:"1.1.1 Transport Registration"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"createSseTransport()"})," method"]}),"\n"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["This method is called within ",(0,t.jsx)(n.code,{children:"getOrCreateMcpServerTransport()"})," and is used to create a Transport"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"@Component\npublic class ShenyuMcpServerManager {\n    private ShenyuSseServerTransportProvider createSseTransport(final String normalizedPath, final String messageEndPoint) {\n        String messageEndpoint = normalizedPath + messageEndPoint;\n        ShenyuSseServerTransportProvider transportProvider = ShenyuSseServerTransportProvider.builder()\n                .objectMapper(objectMapper)\n                .sseEndpoint(normalizedPath)\n                .messageEndpoint(messageEndpoint)\n                .build();\n        // Register the two functions of transportProvider to the Manager's routeMap\n        registerRoutes(normalizedPath, messageEndpoint, transportProvider::handleSseConnection, transportProvider::handleMessage);\n        return transportProvider;\n    }\n}\n"})}),"\n",(0,t.jsx)(n.h5,{id:"112-mcpserver-registration",children:"1.1.2 McpServer Registration"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"addTransportToSharedServer()"})," method"]}),"\n"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["This method is called within ",(0,t.jsx)(n.code,{children:"getOrCreateMcpServerTransport()"})," and is used to create and save McpServer"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["This method creates a new McpServer, stores it in ",(0,t.jsx)(n.code,{children:"sharedServerMap"}),", and saves the TransportProvider obtained above into ",(0,t.jsx)(n.code,{children:"compositeTransportMap"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'@Component\npublic class ShenyuMcpServerManager {\n    private void addTransportToSharedServer(final String normalizedPath, final String protocol, final Object transportProvider) {\n        // Get or create and register McpServer\n        getOrCreateSharedServer(normalizedPath);\n\n        // Save the new transport protocol into compositeTransportMap\n        compositeTransport.addTransport(protocol, transportProvider);\n        \n    }\n\n    private McpAsyncServer getOrCreateSharedServer(final String normalizedPath) {\n        return sharedServerMap.computeIfAbsent(normalizedPath, path -> {\n            // Get transport protocols\n            CompositeTransportProvider compositeTransport = getOrCreateCompositeTransport(path);\n\n            // Select server capabilities\n            var capabilities = McpSchema.ServerCapabilities.builder()\n                    .tools(true)\n                    .logging()\n                    .build();\n\n            // Create and store McpServer\n            McpAsyncServer server = McpServer\n                    .async(compositeTransport)\n                    .serverInfo("MCP Shenyu Server (Multi-Protocol)", "1.0.0")\n                    .capabilities(capabilities)\n                    .tools(Lists.newArrayList())\n                    .build();\n            \n            return server;\n        });\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"12-tools-registration",children:"1.2 Tools Registration"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"handlerRule()"})," method works as follows:"]}),"\n"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Captures the tool configuration info users fill in for the Tool, all used to build the tool"}),"\n",(0,t.jsxs)(n.li,{children:["Deserializes to create ",(0,t.jsx)(n.code,{children:"ShenyuMcpServerTool"})," and obtains tool info"]}),"\n"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["Note: ",(0,t.jsx)(n.code,{children:"ShenyuMcpServerTool"})," is also a Shenyu-side object for storing tool info, unrelated by inheritance to ",(0,t.jsx)(n.code,{children:"McpServerTool"})]}),"\n"]}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsxs)(n.li,{children:["Calls ",(0,t.jsx)(n.code,{children:"addTool()"})," method to create the tool using this info and registers the tool to the matching McpServer based on SelectorId"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public class McpServerPluginDataHandler implements PluginDataHandler {\n    @Override\n    public void handlerRule(final RuleData ruleData) {\n        Optional.ofNullable(ruleData.getHandle()).ifPresent(s -> {\n            // Deserialize a new ShenyuMcpServerTool\n            ShenyuMcpServerTool mcpServerTool = GsonUtils.getInstance().fromJson(s, ShenyuMcpServerTool.class);\n            // Cache mcpServerTool\n            CACHED_TOOL.get().cachedHandle(CacheKeyUtils.INST.getKey(ruleData), mcpServerTool);\n            // Build MCP schema\n            List<McpServerToolParameter> parameters = mcpServerTool.getParameters();\n            String inputSchema = JsonSchemaUtil.createParameterSchema(parameters);\n            ShenyuMcpServer server = CACHED_SERVER.get().obtainHandle(ruleData.getSelectorId());\n            if (Objects.nonNull(server)) {\n                // Save tool info into Manager's sharedServerMap\n                shenyuMcpServerManager.addTool(server.getPath(),\n                        StringUtils.isBlank(mcpServerTool.getName()) ? ruleData.getName()\n                                : mcpServerTool.getName(),\n                        mcpServerTool.getDescription(),\n                        mcpServerTool.getRequestConfig(),\n                        inputSchema);\n            }\n        });\n    }\n}\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"addTool()"})," method"]}),"\n"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["This method is called by ",(0,t.jsx)(n.code,{children:"handlerRule()"})," to add a new tool"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This method performs:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Converts the previous tool info into a ",(0,t.jsx)(n.code,{children:"shenyuToolDefinition"})," object"]}),"\n",(0,t.jsxs)(n.li,{children:["Creates a ",(0,t.jsx)(n.code,{children:"ShenyuToolCallback"})," object using the converted ",(0,t.jsx)(n.code,{children:"shenyuToolDefinition"})]}),"\n"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"ShenyuToolCallback"})," overrides the ",(0,t.jsx)(n.code,{children:"call()"})," method of ",(0,t.jsx)(n.code,{children:"ToolCallBack"})," and registers this overridden method to ",(0,t.jsx)(n.code,{children:"AsyncToolSpecification"}),", so calling the tool's ",(0,t.jsx)(n.code,{children:"call()"})," will actually invoke this overridden method"]}),"\n"]}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsxs)(n.li,{children:["Converts ",(0,t.jsx)(n.code,{children:"ShenyuToolCallback"})," to ",(0,t.jsx)(n.code,{children:"AsyncToolSpecification"})," and registers it to the corresponding McpServer"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public class McpServerPluginDataHandler implements PluginDataHandler {\n    public void addTool(final String serverPath, final String name, final String description,\n                        final String requestTemplate, final String inputSchema) {\n        String normalizedPath = normalizeServerPath(serverPath);\n        // Build Definition object\n        ToolDefinition shenyuToolDefinition = ShenyuToolDefinition.builder()\n                .name(name)\n                .description(description)\n                .requestConfig(requestTemplate)\n                .inputSchema(inputSchema)\n                .build();\n        \n        ShenyuToolCallback shenyuToolCallback = new ShenyuToolCallback(shenyuToolDefinition);\n\n        // Get previously registered McpServer and register the Tool\n        McpAsyncServer sharedServer = sharedServerMap.get(normalizedPath);\n        for (AsyncToolSpecification asyncToolSpecification : McpToolUtils.toAsyncToolSpecifications(shenyuToolCallback)) {\n            sharedServer.addTool(asyncToolSpecification).block();\n        }        \n    }\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"With this, service registration analysis is complete."}),"\n",(0,t.jsxs)(n.p,{children:["Service registration overview diagram",(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.img,{src:r(58867).A+"",width:"1604",height:"610"})]}),"\n",(0,t.jsx)(n.h3,{id:"2-plugin-execution",children:"2. Plugin Execution"}),"\n",(0,t.jsxs)(n.p,{children:["Clients will send two types of messages with ",(0,t.jsx)(n.code,{children:"/sse"})," and ",(0,t.jsx)(n.code,{children:"/message"})," suffixes. These messages are captured by the Shenyu McpServer plugin, which handles them differently. When receiving ",(0,t.jsx)(n.code,{children:"/sse"})," messages, the plugin creates and saves a session object, then returns a session id for ",(0,t.jsx)(n.code,{children:"/message"})," usage. When receiving ",(0,t.jsx)(n.code,{children:"/message"})," messages, the plugin executes methods based on the method info carried by the ",(0,t.jsx)(n.code,{children:"/message"})," message, such as fetching work lists, tool invocation, and resource lists."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"doExecute()"})," method works as follows:"]}),"\n"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Matches the path and checks if the Mcp plugin registered it"}),"\n",(0,t.jsxs)(n.li,{children:["Calls ",(0,t.jsx)(n.code,{children:"routeByProtocol()"})," to choose the appropriate handling plan based on the request protocol"]}),"\n"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["This article focuses on the SSE request mode, so we enter the ",(0,t.jsx)(n.code,{children:"handleSseRequest()"})," method"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public class McpServerPlugin extends AbstractShenyuPlugin {\n    @Override\n    protected Mono<Void> doExecute(final ServerWebExchange exchange,\n                                   final ShenyuPluginChain chain,\n                                   final SelectorData selector,\n                                   final RuleData rule) {\n        final String uri = exchange.getRequest().getURI().getRawPath();\n        // Check if Mcp plugin registered this route; if not, continue chain without handling\n        if (!shenyuMcpServerManager.canRoute(uri)) {\n            return chain.execute(exchange);\n        }\n        final ServerRequest request = ServerRequest.create(exchange, messageReaders);\n        // Choose handling method based on URI protocol\n        return routeByProtocol(exchange, chain, request, selector, uri);\n    }\n\n    private Mono<Void> routeByProtocol(final ServerWebExchange exchange,\n                                       final ShenyuPluginChain chain,\n                                       final ServerRequest request,\n                                       final SelectorData selector,\n                                       final String uri) {\n\n        if (isStreamableHttpProtocol(uri)) {\n            return handleStreamableHttpRequest(exchange, chain, request, uri);\n        } else if (isSseProtocol(uri)) {\n            // Handle SSE requests\n            return handleSseRequest(exchange, chain, request, selector, uri);\n        } \n    }\n}\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"handleSseRequest()"})," method"]}),"\n"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["Called by ",(0,t.jsx)(n.code,{children:"routeByProtocol()"})," to determine if the client wants to create a session or call a tool based on URI suffix"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public class McpServerPlugin extends AbstractShenyuPlugin {\n    private Mono<Void> handleSseRequest(final ServerWebExchange exchange,\n                                        final ShenyuPluginChain chain,\n                                        final ServerRequest request,\n                                        final SelectorData selector,\n                                        final String uri) {\n        ShenyuMcpServer server = McpServerPluginDataHandler.CACHED_SERVER.get().obtainHandle(selector.getId());\n        String messageEndpoint = server.getMessageEndpoint();\n        // Get the transport provider\n        ShenyuSseServerTransportProvider transportProvider\n                = shenyuMcpServerManager.getOrCreateMcpServerTransport(uri, messageEndpoint);\n        // Determine if the request is an SSE connection or a message call\n        if (uri.endsWith(messageEndpoint)) {\n            setupSessionContext(exchange, chain);\n            return handleMessageEndpoint(exchange, transportProvider, request);\n        } else {\n            return handleSseEndpoint(exchange, transportProvider, request);\n        }\n    }\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"21-client-sends-sse-request",children:"2.1 Client Sends SSE Request"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["If the client sends a request ending with ",(0,t.jsx)(n.code,{children:"/sse"}),", the ",(0,t.jsx)(n.code,{children:"handleSseEndpoint()"})," method is executed"]}),"\n"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"handleSseEndpoint()"})," mainly does:"]}),"\n"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Sets SSE request headers"}),"\n",(0,t.jsxs)(n.li,{children:["Calls ",(0,t.jsx)(n.code,{children:"ShenyuSseServerTransportProvider.createSseFlux()"})," to create the SSE stream"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public class McpServerPlugin extends AbstractShenyuPlugin {\n    private Mono<Void> handleSseEndpoint(final ServerWebExchange exchange,\n                                         final ShenyuSseServerTransportProvider transportProvider,\n                                         final ServerRequest request) {\n        // Configure SSE request headers\n        configureSseHeaders(exchange);\n\n        // Create SSE stream\n        return exchange.getResponse()\n                .writeWith(transportProvider\n                        .createSseFlux(request));\n    }\n}\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"createSseFlux()"})," method"]}),"\n"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["Called by ",(0,t.jsx)(n.code,{children:"handleSseEndpoint()"}),"; mainly used to create and save a session"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Creates session; the session factory registers a series of handlers, which are the objects actually executing tool calls"}),"\n",(0,t.jsx)(n.li,{children:"Saves the session for reuse"}),"\n",(0,t.jsx)(n.li,{children:"Sends the session id as a parameter of the endpoint URL back to the client, to be used when calling the message endpoint"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'public class ShenyuSseServerTransportProvider implements McpServerTransportProvider {\n    public Flux<ServerSentEvent<?>> createSseFlux(final ServerRequest request) {\n        return Flux.<ServerSentEvent<?>>create(sink -> {\n                    WebFluxMcpSessionTransport sessionTransport = new WebFluxMcpSessionTransport(sink);\n                    // Create McpServerSession and temporarily store plugin chain info\n                    McpServerSession session = sessionFactory.create(sessionTransport);\n                    String sessionId = session.getId();\n                    sessions.put(sessionId, session);\n\n                    // Send session id info back to client\n                    String endpointUrl = this.baseUrl + this.messageEndpoint + "?sessionId=" + sessionId;\n                    ServerSentEvent<String> endpointEvent = ServerSentEvent.<String>builder()\n                            .event(ENDPOINT_EVENT_TYPE)\n                            .data(endpointUrl)\n                            .build();\n                }).doOnSubscribe(subscription -> LOGGER.info("SSE Flux subscribed"))\n                .doOnRequest(n -> LOGGER.debug("SSE Flux requested {} items", n));\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"22-client-sends-message-request",children:"2.2 Client Sends Message Request"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["If the client sends a request ending with ",(0,t.jsx)(n.code,{children:"/message"}),", the current ",(0,t.jsx)(n.code,{children:"ShenyuPluginChain"})," info is saved into the session, and ",(0,t.jsx)(n.code,{children:"handleMessageEndpoint()"})," is called.",(0,t.jsx)(n.br,{}),"\n","Subsequent tool calls continue executing this plugin chain, so plugins after the Mcp plugin will affect tool requests."]}),"\n"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"handleMessageEndpoint()"})," method, calls ",(0,t.jsx)(n.code,{children:"ShenyuSseServerTransportProvider.handleMessageEndpoint()"})," to process"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"if (uri.endsWith(messageEndpoint)) {\n       setupSessionContext(exchange, chain);\n       return handleMessageEndpoint(exchange, transportProvider, request);\n} \n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public class McpServerPlugin extends AbstractShenyuPlugin {\n    private Mono<Void> handleMessageEndpoint(final ServerWebExchange exchange,\n                                             final ShenyuSseServerTransportProvider transportProvider,\n                                             final ServerRequest request) {\n        // Handle message requests\n        return transportProvider.handleMessageEndpoint(request)\n                .flatMap(result -> {\n                    return exchange.getResponse()\n                            .writeWith(Mono.just(exchange.getResponse().bufferFactory().wrap(responseBody.getBytes())));\n                });\n    }\n}\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"handleMessageEndpoint()"})," method"]}),"\n"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["Called by ",(0,t.jsx)(n.code,{children:"McpServerPlugin.handleMessageEndpoint()"}),", hands over the request to the session for processing"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["The session's ",(0,t.jsx)(n.code,{children:"handler()"})," method performs different actions depending on the message.",(0,t.jsx)(n.br,{}),"\n","For example, when the method in the message is ",(0,t.jsx)(n.code,{children:'"tools/call"'}),", the tool invocation handler executes the ",(0,t.jsx)(n.code,{children:"call()"})," method to call the tool.",(0,t.jsx)(n.br,{}),"\n","The related source is omitted here."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'public class ShenyuSseServerTransportProvider implements McpServerTransportProvider {\n    public Mono<MessageHandlingResult> handleMessageEndpoint(final ServerRequest request) {\n        // Get session\n        String sessionId = request.queryParam("sessionId").get();\n        McpServerSession session = sessions.get(sessionId);\n        return request.bodyToMono(String.class)\n                .flatMap(body -> {\n                    McpSchema.JSONRPCMessage message = McpSchema.deserializeJsonRpcMessage(objectMapper, body);\n                    return session.handle(message);\n                });\n    }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"At this point, the Shenyu Mcp Plugin service invocation source code analysis is complete."}),"\n",(0,t.jsxs)(n.p,{children:["Process flow overview",(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.img,{src:r(19755).A+"",width:"811",height:"490"})]}),"\n",(0,t.jsx)(n.h3,{id:"3-tool-invocation",children:"3. Tool Invocation"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["If the client sends a message to invoke a tool, the session will use the tool invocation handler to execute the tool\u2019s ",(0,t.jsx)(n.code,{children:"call()"})," method.",(0,t.jsx)(n.br,{}),"\n","From service registration, we know the tool call actually runs the ",(0,t.jsx)(n.code,{children:"call()"})," method of ",(0,t.jsx)(n.code,{children:"ShenyuToolCallback"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Therefore, the tool invocation executes the following:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"call()"})," method mainly does:"]}),"\n"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Gets session id"}),"\n",(0,t.jsxs)(n.li,{children:["Gets ",(0,t.jsx)(n.code,{children:"requestTemplate"}),", the extra configuration provided by Shenyu"]}),"\n",(0,t.jsx)(n.li,{children:"Gets the previously stored Shenyu plugin chain and passes the tool call info to the chain for continued execution"}),"\n",(0,t.jsx)(n.li,{children:"Asynchronously waits for the tool response"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"After the plugin chain completes, the tool call request is actually sent to the service hosting the tool."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public class ShenyuToolCallback implements ToolCallback {\n    @NonNull\n    @Override\n    public String call(@NonNull final String input, final ToolContext toolContext) {\n        // Extract sessionId from MCP request\n        final McpSyncServerExchange mcpExchange = extractMcpExchange(toolContext);\n        final String sessionId = extractSessionId(mcpExchange);\n        // Extract requestTemplate info\n        final String configStr = extractRequestConfig(shenyuTool);\n\n        // Get the previously stored plugin chain by sessionId\n        final ServerWebExchange originExchange = getOriginExchange(sessionId);\n        final ShenyuPluginChain chain = getPluginChain(originExchange);\n        \n        // Execute the tool call\n        return executeToolCall(originExchange, chain, sessionId, configStr, input);\n    }\n\n    private String executeToolCall(final ServerWebExchange originExchange,\n                                   final ShenyuPluginChain chain,\n                                   final String sessionId,\n                                   final String configStr,\n                                   final String input) {\n\n        final CompletableFuture<String> responseFuture = new CompletableFuture<>();\n        final ServerWebExchange decoratedExchange = buildDecoratedExchange(\n                originExchange, responseFuture, sessionId, configStr, input);\n        // Execute plugin chain, call the actual tool\n        chain.execute(decoratedExchange)\n                .subscribe();\n\n        // Wait for response\n        final String result = responseFuture.get(DEFAULT_TIMEOUT_SECONDS, TimeUnit.SECONDS);\n        return result;\n    }\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"This concludes the Shenyu MCP Plugin tool invocation analysis."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:r(76661).A+"",width:"658",height:"114"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"4-summary",children:"4. Summary"}),"\n",(0,t.jsxs)(n.p,{children:["This article analyzed the source code from Mcp service registration, through Mcp plugin service invocation, to tool invocation.",(0,t.jsx)(n.br,{}),"\n","The McpServer plugin makes Shenyu a powerful and centralized McpServer."]}),"\n",(0,t.jsx)(n.hr,{})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},19755(e,n,r){r.d(n,{A:()=>s});const s=r.p+"assets/images/Mcp-server-execute-en-29cfc2484b94d6221407e4063d52ad29.png"},28453(e,n,r){r.d(n,{R:()=>o,x:()=>a});var s=r(96540);const t={},i=s.createContext(t);function o(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(i.Provider,{value:n},e.children)}},58867(e,n,r){r.d(n,{A:()=>s});const s=r.p+"assets/images/Mcp-server-register-en-daa12f6fee06542c61e64f8e6c587268.png"},76661(e,n,r){r.d(n,{A:()=>s});const s="data:image/png;base64,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"},84087(e){e.exports=JSON.parse('{"permalink":"/blog/Plugin-SourceCode-Analysis-Mcp-Server-Plugin","editUrl":"https://github.com/apache/shenyu-website/edit/main/blog/Plugin-SourceCode-Analysis-Mcp-Server-Plugin.md","source":"@site/blog/Plugin-SourceCode-Analysis-Mcp-Server-Plugin.md","title":"McpServer Plugin Source Code Analysis","description":"In the Shenyu gateway, when you start this plugin, Shenyu becomes a fully-featured McpServer.","date":"2026-01-13T03:42:03.000Z","tags":[{"inline":true,"label":"plugin","permalink":"/blog/tags/plugin"},{"inline":true,"label":"mcp","permalink":"/blog/tags/mcp"},{"inline":true,"label":"Apache ShenYu","permalink":"/blog/tags/apache-shen-yu"}],"readingTime":9.98,"hasTruncateMarker":false,"authors":[{"name":"yusiheng","title":"Apache ShenYu Contributor","url":"https://github.com/478320","key":null,"page":null}],"frontMatter":{"title":"McpServer Plugin Source Code Analysis","author":"yusiheng","author_title":"Apache ShenYu Contributor","author_url":"https://github.com/478320","tags":["plugin","mcp","Apache ShenYu"]},"unlisted":false,"prevItem":{"title":"Code Analysis For Dubbo Plugin","permalink":"/blog/Plugin-SourceCode-Analysis-Dubbo-Plugin"},"nextItem":{"title":"Code Analysis For Param-Mapping Plugin","permalink":"/blog/Plugin-SourceCode-Analysis-Param-Mapping-Plugin"}}')}}]);