"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[24988],{15680:(e,n,t)=>{t.d(n,{xA:()=>s,yg:()=>u});var r=t(96540);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach(function(n){a(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function p(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=r.createContext({}),c=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},s=function(e){var n=c(e.components);return r.createElement(l.Provider,{value:n},e.children)},g="mdxType",y={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef(function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,s=p(e,["components","mdxType","originalType","parentName"]),g=c(t),d=a,u=g["".concat(l,".").concat(d)]||g[d]||y[d]||o;return t?r.createElement(u,i(i({ref:n},s),{},{components:t})):r.createElement(u,i({ref:n},s))});function u(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=d;var p={};for(var l in n)hasOwnProperty.call(n,l)&&(p[l]=n[l]);p.originalType=e,p[g]="string"==typeof e?e:a,i[1]=p;for(var c=2;c<o;c++)i[c]=t[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},33537:(e,n,t)=>{t.r(n),t.d(n,{contentTitle:()=>i,default:()=>g,frontMatter:()=>o,metadata:()=>p,toc:()=>l});var r=t(58168),a=(t(96540),t(15680));const o={title:"McpTool Service Integration",keywords:["Mcp"],description:"McpTool Service Integration"},i=void 0,p={unversionedId:"user-guide/proxy/mcp-tool-proxy",id:"user-guide/proxy/mcp-tool-proxy",isDocsHomePage:!1,title:"McpTool Service Integration",description:"McpTool Service Integration",source:"@site/docs/user-guide/proxy/mcp-tool-proxy.md",sourceDirName:"user-guide/proxy",slug:"/user-guide/proxy/mcp-tool-proxy",permalink:"/zh/docs/next/user-guide/proxy/mcp-tool-proxy",editUrl:"https://github.com/apache/shenyu-website/edit/main/docs/user-guide/proxy/mcp-tool-proxy.md",version:"current",frontMatter:{title:"McpTool Service Integration",keywords:["Mcp"],description:"McpTool Service Integration"},sidebar:"tutorialSidebar",previous:{title:"\u4f7f\u7528Zookeeper\u63a5\u5165",permalink:"/zh/docs/next/user-guide/sdk-usage/shenyu-sdk-zookeeper"},next:{title:"Dubbo\u670d\u52a1\u63a5\u5165",permalink:"/zh/docs/next/user-guide/proxy/dubbo-proxy"}},l=[{value:"Add mcpServer and proxy plugins in gateway",id:"add-mcpserver-and-proxy-plugins-in-gateway",children:[]},{value:"Integrate mcpTool with the gateway (for springMvc)",id:"integrate-mcptool-with-the-gateway-for-springmvc",children:[{value:"Example 1",id:"example-1",children:[]},{value:"Example 2",id:"example-2",children:[]},{value:"Example 3",id:"example-3",children:[]}]},{value:"McpTool integration with gateway (Other Languages, Non-SpringMvc)",id:"mcptool-integration-with-gateway-other-languages-non-springmvc",children:[]},{value:"User requests",id:"user-requests",children:[]}],c={toc:l},s="wrapper";function g({components:e,...n}){return(0,a.yg)(s,(0,r.A)({},c,n,{components:e,mdxType:"MDXLayout"}),(0,a.yg)("p",null,"This document is intended to help the ",(0,a.yg)("inlineCode",{parentName:"p"},"mcpTool")," service access the ",(0,a.yg)("inlineCode",{parentName:"p"},"Apache ShenYu")," gateway. The ",(0,a.yg)("inlineCode",{parentName:"p"},"Apache ShenYu")," gateway uses the ",(0,a.yg)("inlineCode",{parentName:"p"},"mcpServer")," plugin to connect with ",(0,a.yg)("inlineCode",{parentName:"p"},"mcpTool")," services."),(0,a.yg)("p",null,"Before the connection, start ",(0,a.yg)("inlineCode",{parentName:"p"},"shenyu-admin")," correctly, start  ",(0,a.yg)("inlineCode",{parentName:"p"},"mcpServer")," plugin and add related dependencies on the gateway and ",(0,a.yg)("inlineCode",{parentName:"p"},"mcpTool")," application client service side. You can refer to the previous ",(0,a.yg)("a",{parentName:"p",href:"../../quick-start/quick-start-McpServer"},"Quick Start with McpServer"),"."),(0,a.yg)("p",null,"For details about client access configuration, see ",(0,a.yg)("a",{parentName:"p",href:"../property-config/register-center-access.md"},"Application Client Access Config")," ."),(0,a.yg)("p",null,"For details about data synchronization configurations, see ",(0,a.yg)("a",{parentName:"p",href:"../property-config/use-data-sync.md"},"Data Synchronization Config")," ."),(0,a.yg)("h2",{id:"add-mcpserver-and-proxy-plugins-in-gateway"},"Add mcpServer and proxy plugins in gateway"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"Add the following dependencies to the gateway\u2019s ",(0,a.yg)("inlineCode",{parentName:"li"},"pom.xml")," file:")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-xml"},"    \x3c!--Mcp Server Plugin Start--\x3e\n    <dependency>\n        <groupId>org.apache.shenyu</groupId>\n        <artifactId>shenyu-spring-boot-starter-plugin-mcp-server</artifactId>\n        <version>${project.version}</version>\n    </dependency>\n    \x3c!--Mcp Server Plugin End--\x3e\n")),(0,a.yg)("h2",{id:"integrate-mcptool-with-the-gateway-for-springmvc"},"Integrate mcpTool with the gateway (for springMvc)"),(0,a.yg)("p",null,"Refer to the example project: ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/apache/shenyu/tree/master/shenyu-examples/shenyu-examples-mcp"},"shenyu-examples-mcp")),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},(0,a.yg)("inlineCode",{parentName:"p"},"SpringBoot")," Users"),(0,a.yg)("ol",{parentName:"li"},(0,a.yg)("li",{parentName:"ol"},"Add the following dependencies to your ",(0,a.yg)("inlineCode",{parentName:"li"},"mcpTool")," service\u2019s ",(0,a.yg)("inlineCode",{parentName:"li"},"pom.xml")," file:")),(0,a.yg)("pre",{parentName:"li"},(0,a.yg)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n    <groupId>org.apache.shenyu</groupId>\n    <artifactId>shenyu-spring-boot-starter-client-mcp</artifactId>\n    <version>${shenyu.version}</version>\n</dependency>\n")),(0,a.yg)("ol",{parentName:"li",start:2},(0,a.yg)("li",{parentName:"ol"},"Add the following configuration in ",(0,a.yg)("inlineCode",{parentName:"li"},"application.yaml"),":")),(0,a.yg)("pre",{parentName:"li"},(0,a.yg)("code",{parentName:"pre",className:"language-yaml"},"shenyu:\n  register:\n    registerType: http #zookeeper #etcd #nacos #consul\n    serverLists: http://localhost:9095 #localhost:2181 #http://localhost:2379 #localhost:8848\n    props:\n      username: admin\n      password: 123456\n  client:\n    mcp:\n      props:\n        contextPath: /mcp\n        appName: mcp\n"))),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},(0,a.yg)("inlineCode",{parentName:"p"},"Spring")," Users"),(0,a.yg)("p",{parentName:"li"},"Add the following dependencies to your HTTP service\u2019s ",(0,a.yg)("inlineCode",{parentName:"p"},"pom.xml")," file:"),(0,a.yg)("pre",{parentName:"li"},(0,a.yg)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n    <groupId>org.apache.shenyu</groupId>\n    <artifactId>shenyu-client-mcp</artifactId>\n    <version>${shenyu.version}</version>\n</dependency>\n")),(0,a.yg)("p",{parentName:"li"},"Then add the following bean definitions to your XML configuration file:"),(0,a.yg)("pre",{parentName:"li"},(0,a.yg)("code",{parentName:"pre",className:"language-xml"},'<bean id="clientConfig" class="org.apache.shenyu.register.common.config.PropertiesConfig">\n    <property name="props">\n      <map>\n        <entry key="contextPath" value="/yourContextPath"/>\n        <entry key="appName" value="yourAppName"/>\n      </map>\n    </property>\n</bean>\n\n<bean id="shenyuRegisterCenterConfig" class="org.apache.shenyu.register.common.config.ShenyuRegisterCenterConfig">\n   <property name="registerType" value="http"/>\n   <property name="serverList" value="http://localhost:9095"/>\n</bean>\n\n<bean id="shenyuClientRegisterRepository" class="org.apache.shenyu.client.core.register.ShenyuClientRegisterRepositoryFactory" factory-method="newInstance">\n       <property name="shenyuRegisterCenterConfig" ref="shenyuRegisterCenterConfig"/>\n </bean>\n\n<bean id="McpServiceEventListener" class="org.apache.shenyu.client.mcp.McpServiceEventListener">\n   <constructor-arg name="clientConfig" ref="clientConfig"/>\n   <constructor-arg name="shenyuClientRegisterRepository" ref="shenyuClientRegisterRepository"/>\n   <constructor-arg name="env" ref="environment"/>  \n</bean>\n')),(0,a.yg)("p",{parentName:"li"},"Add the ",(0,a.yg)("inlineCode",{parentName:"p"},"@ShenyuMcpTool")," annotations to your controller interfaces."),(0,a.yg)("p",{parentName:"li"},"You need to add the ",(0,a.yg)("inlineCode",{parentName:"p"},"@ShenyuMcpTool")," annotation on the ",(0,a.yg)("inlineCode",{parentName:"p"},"Controller")," class. Only controllers annotated with ",(0,a.yg)("inlineCode",{parentName:"p"},"@ShenyuMcpTool")," will be recognized as ",(0,a.yg)("inlineCode",{parentName:"p"},"mcpTool"),"."))),(0,a.yg)("h3",{id:"example-1"},"Example 1"),(0,a.yg)("p",null,"This example demonstrates full McpTool configuration. You can fully customize your configuration by annotations, including parameter information defined in the operation."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-java"},'@GetMapping("/findById")\n@ShenyuMcpTool(\n        operation = @Operation(\n                method = "GET", description = "find order by id"\n        ),\n        requestConfig = @ShenyuMcpRequestConfig(\n                bodyToJson = "false",\n                headers = {\n                        @ShenyuMcpHeader(key = "aaa", value = "bbb")\n                }\n        ),\n        enabled = true, toolName = "findOrderById"\n)\n@ApiDoc(desc = "findById")\npublic OrderDTO findById(@ShenyuMcpToolParam(\n        parameter = @Parameter(\n                name = "id",\n                in = ParameterIn.PATH,\n                description = "the id of order",\n                required = true,\n                schema = @Schema(\n                        type = "string",\n                        defaultValue = "1"\n                )\n        )\n) @RequestParam("id") final String id) {\n        OrderDTO dto = new OrderDTO();\n        dto.setId(id);\n        return dto;\n}\n')),(0,a.yg)("h3",{id:"example-2"},"Example 2"),(0,a.yg)("p",null,"This example shows the configuration for a McpTool function without parameters."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-java"},'@GetMapping("/findAll")\n@ShenyuMcpTool(\n        operation = @Operation(\n                method = "GET", description = "find all order"\n        ),\n        requestConfig = @ShenyuMcpRequestConfig(\n                bodyToJson = "false",\n                headers = {\n                        @ShenyuMcpHeader(key = "aaa", value = "bbb")\n                }\n        ),\n        enabled = true, toolName = "findAllOrder"\n)\n@ApiDoc(desc = "findAll")\npublic String findAll() {\n        return "hello apache shenyu , mcp findAll success";\n}\n')),(0,a.yg)("h3",{id:"example-3"},"Example 3"),(0,a.yg)("p",null,"This is a simplified usage that requires only a simple annotation to register the ",(0,a.yg)("inlineCode",{parentName:"p"},"McpTool")," to the gateway."),(0,a.yg)("blockquote",null,(0,a.yg)("p",{parentName:"blockquote"},"Special note: Currently only supports ",(0,a.yg)("inlineCode",{parentName:"p"},"@RequestMapping"),", ",(0,a.yg)("inlineCode",{parentName:"p"},"@GetMapping"),", ",(0,a.yg)("inlineCode",{parentName:"p"},"@PostMapping"),", ",(0,a.yg)("inlineCode",{parentName:"p"},"@DeleteMapping"),", and ",(0,a.yg)("inlineCode",{parentName:"p"},"@PutMapping")," annotations. Only the first path of the ",(0,a.yg)("inlineCode",{parentName:"p"},"@XXXMapping")," annotation is effective.")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-java"},'@GetMapping("/findByName")\n@ShenyuMcpTool\n@ApiDoc(desc = "findName")\npublic OrderDTO findByName(@ShenyuMcpToolParam final String name) {\n        OrderDTO dto = new OrderDTO();\n        dto.setName(name);\n        return dto;\n}\n')),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"Start your project. Your service interfaces will be connected to the gateway. In the ",(0,a.yg)("inlineCode",{parentName:"li"},"shenyu-admin")," backend management system, go to ",(0,a.yg)("inlineCode",{parentName:"li"},"Plugin List -> HTTP process -> mcpServer"),", and you will see the automatically created endpoints and Tools.")),(0,a.yg)("h2",{id:"mcptool-integration-with-gateway-other-languages-non-springmvc"},"McpTool integration with gateway (Other Languages, Non-SpringMvc)"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"First, find the ",(0,a.yg)("inlineCode",{parentName:"p"},"mcpServer")," plugin in ",(0,a.yg)("inlineCode",{parentName:"p"},"shenyu-admin"),", then add selectors and rules to filter traffic accordingly.")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"If you are unsure how to configure, please refer to ",(0,a.yg)("a",{parentName:"p",href:"../admin-usage/selector-and-rule"},"Selector and Rule Management"),"."))),(0,a.yg)("h2",{id:"user-requests"},"User requests"),(0,a.yg)("p",null,"After your ",(0,a.yg)("inlineCode",{parentName:"p"},"mcpTool")," service is connected to the ",(0,a.yg)("inlineCode",{parentName:"p"},"Apache ShenYu")," gateway, you can use the ",(0,a.yg)("inlineCode",{parentName:"p"},"endPoint")," configured in the ",(0,a.yg)("inlineCode",{parentName:"p"},"Selector")," as the request interface for your ",(0,a.yg)("inlineCode",{parentName:"p"},"McpClient"),"."),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"Firstly, the domain name of your previous ",(0,a.yg)("inlineCode",{parentName:"p"},"endPoint")," was your own service; now it should be replaced with the gateway\u2019s domain name.")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"Secondly, the ",(0,a.yg)("inlineCode",{parentName:"p"},"Apache ShenYu")," gateway requires a route prefix configured as the ",(0,a.yg)("inlineCode",{parentName:"p"},"contextPath")," in your integration project."),(0,a.yg)("ul",{parentName:"li"},(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"In the ",(0,a.yg)("inlineCode",{parentName:"p"},"mcpServer")," plugin, this ",(0,a.yg)("inlineCode",{parentName:"p"},"contextPath")," corresponds to your ",(0,a.yg)("inlineCode",{parentName:"p"},"endPoint"),".")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"For example, if you configured ",(0,a.yg)("inlineCode",{parentName:"p"},"contextPath")," as ",(0,a.yg)("inlineCode",{parentName:"p"},"mcp"),", then your ",(0,a.yg)("inlineCode",{parentName:"p"},"endPoint")," should be configured as: ",(0,a.yg)("inlineCode",{parentName:"p"},"http://localhost:9195/mcp/sse"),".")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"Here, ",(0,a.yg)("inlineCode",{parentName:"p"},"localhost:9195")," is the IP and port of your gateway (default port is ",(0,a.yg)("inlineCode",{parentName:"p"},"9195"),"), and ",(0,a.yg)("inlineCode",{parentName:"p"},"/mcp")," is the ",(0,a.yg)("inlineCode",{parentName:"p"},"contextPath")," configured during integration.")))),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},"Third, the mcpServer plugin does not include request forwarding functionality. To perform remote tool invocation, please enable the corresponding proxy plugin for proxying. You can refer to ",(0,a.yg)("a",{parentName:"p",href:"../../quick-start/quick-start-McpServer"},"Quick Start with McpServer"),"."))),(0,a.yg)("p",null,"Then you can invoke tools via the ",(0,a.yg)("inlineCode",{parentName:"p"},"mcpClient")," through the gateway easily."))}g.isMDXComponent=!0}}]);