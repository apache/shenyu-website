"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[51602],{587(e,n,i){i.d(n,{A:()=>s});const s=i.p+"assets/images/config_zk_plugin-5271390332992da24b2a6217511a5858.png"},20047(e,n,i){i.d(n,{A:()=>s});const s=i.p+"assets/images/common-config-4807e44ef780a311651c4c784c46040d.png"},28453(e,n,i){i.d(n,{R:()=>r,x:()=>l});var s=i(96540);const o={},t=s.createContext(o);function r(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(t.Provider,{value:n},e.children)}},30756(e,n,i){i.d(n,{A:()=>s});const s=i.p+"assets/images/db-design-ace76c69c809afe5bf47464fc1b0209c.png"},44553(e,n,i){i.d(n,{A:()=>s});const s=i.p+"assets/images/zk_dict_zh-7711eeddd9904ca431ad023400379950.png"},45537(e,n,i){i.d(n,{A:()=>s});const s=i.p+"assets/images/discovery-seletor-config-906cdc621f3f0100b3d36449a28cbb43.png"},55112(e,n,i){i.d(n,{A:()=>s});const s=i.p+"assets/images/discovery-design-3081f14fec1ef9322d39bd1b998f42a3.png"},55709(e,n,i){i.d(n,{A:()=>s});const s=i.p+"assets/images/discovery-local-mode-608163775c2d412644ce9af4fff9f23d.png"},73490(e,n,i){i.d(n,{A:()=>s});const s=i.p+"assets/images/add_listener_node-fcab34011135088da7d7bfe08219bae5.png"},87530(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"plugin-center/discovery/discovery-mode","title":"Discovery","description":"Discovery Modules","source":"@site/versioned_docs/version-2.6.0/plugin-center/discovery/discovery-mode.md","sourceDirName":"plugin-center/discovery","slug":"/plugin-center/discovery/discovery-mode","permalink":"/docs/2.6.0/plugin-center/discovery/discovery-mode","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/shenyu-website/edit/main/versioned_docs/version-2.6.0/plugin-center/discovery/discovery-mode.md","tags":[],"version":"2.6.0","frontMatter":{"title":"Discovery","keywords":["Discovery"],"description":"Discovery Modules"},"sidebar":"tutorialSidebar","previous":{"title":"Mock Plugin","permalink":"/docs/2.6.0/plugin-center/mock/mock-plugin"},"next":{"title":"Custom Load Balancer","permalink":"/docs/2.6.0/developer/spi/custom-load-balance"}}');var o=i(74848),t=i(28453);const r={title:"Discovery",keywords:["Discovery"],description:"Discovery Modules"},l="1. Overview",c={},a=[{value:"1.1 Module Name",id:"11-module-name",level:2},{value:"1.2 Design",id:"12-design",level:2},{value:"1.3 Notes",id:"13-notes",level:2},{value:"1.3.1 Listener mode",id:"131-listener-mode",level:3},{value:"1.3.2 Scope of action",id:"132-scope-of-action",level:3},{value:"2.1 Plug-in level Configuration",id:"21-plug-in-level-configuration",level:2},{value:"2.2 Selector level configuration",id:"22-selector-level-configuration",level:2},{value:"3.1 Registration Information Configuration",id:"31-registration-information-configuration",level:2},{value:"3.1.1 Basic Configuration",id:"311-basic-configuration",level:3},{value:"3.1.2 Detailed explanation of data",id:"312-detailed-explanation-of-data",level:3},{value:"3.2 Configuration in different modes",id:"32-configuration-in-different-modes",level:2},{value:"3.1 LOCAL",id:"31-local",level:3},{value:"3.2 ZOOKEEPER",id:"32-zookeeper",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"1-overview",children:"1. Overview"})}),"\n",(0,o.jsx)(n.h2,{id:"11-module-name",children:"1.1 Module Name"}),"\n",(0,o.jsx)(n.p,{children:"Discovery"}),"\n",(0,o.jsx)(n.h2,{id:"12-design",children:"1.2 Design"}),"\n",(0,o.jsxs)(n.p,{children:["Design drawing\n",(0,o.jsx)(n.img,{alt:"discovery-design.png",src:i(55112).A+"",width:"1005",height:"638"})]}),"\n",(0,o.jsxs)(n.p,{children:["DataBase Design\n",(0,o.jsx)(n.img,{alt:"db-design.png",src:i(30756).A+"",width:"494",height:"412"})]}),"\n",(0,o.jsx)(n.h2,{id:"13-notes",children:"1.3 Notes"}),"\n",(0,o.jsx)(n.p,{children:"The 'Discovery' gateway admin service actively listens to register to the gateway service. The shenyu gateway has the ability to actively discover the changes of the proxy service list\n'Discovery' can be at the selector level or the plugin level.\nThe 'Discovery' plugin is currently introduced as a TCP plugin."}),"\n",(0,o.jsx)(n.h3,{id:"131-listener-mode",children:"1.3.1 Listener mode"}),"\n",(0,o.jsx)(n.p,{children:"LOCAL , ZOOKEEPER , NACOS(To be supported) , ERURKA(To be supported) ...."}),"\n",(0,o.jsx)(n.p,{children:"LOCAL mode: relies heavily on manually maintaining the upstream list to push to the gateway"}),"\n",(0,o.jsx)(n.p,{children:"ZOOKEEPER mode: Listen for temporary node changes in the specified node in zk for data"}),"\n",(0,o.jsx)(n.h3,{id:"132-scope-of-action",children:"1.3.2 Scope of action"}),"\n",(0,o.jsx)(n.p,{children:"Plugin-level: THIS APPLIES TO THE entire PLUGIN. All CHOICES MADE BY the PLUGIN will default to the current listening mode\nSelector level: This applies to the current selector. There are different selectors that use different listening modes under the current plugin"}),"\n",(0,o.jsx)(n.h1,{id:"2-how-to-use",children:"2. How to use"}),"\n",(0,o.jsx)(n.h2,{id:"21-plug-in-level-configuration",children:"2.1 Plug-in level Configuration"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"In the plugin that supports the Discovery module click 'Discovery configuration' to select the listening mode for the response\nTake Zookeeper as an example"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"config_zk_plugin.png",src:i(587).A+"",width:"1173",height:"658"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"In the selector, click 'Add' on the new selector page and click 'DiscoveryConfig' to find the Type type to force the plugin-level listener that you just configured\nIn this case, we need to listen to the 'ListenerNode' : /shenyu/discovery as an example"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"add_listener_node.png",src:i(73490).A+"",width:"1196",height:"543"})}),"\n",(0,o.jsx)(n.p,{children:"Note: In this Handler configuration, shenyu specifies that the upstream registration data is sent in the following json form"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:' {\n     "url": "127.0.0.1::6379",  // upstream\'s url\n     "protocol": "tcp", // upstream\'s protocol\n     "status": 0, // upstream\'s (0, healthy, 1 unhealthy)\n     "weight": 10 // Used when calculating load balancing\n }\n'})}),"\n",(0,o.jsx)(n.p,{children:"You can alias the handler if your service alias is different from the json format defined by shenyu\nIn the above image, I need to change the status to healthy. The other is to save the original json-key form"}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"See plugin for details on how to configure selector properties"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"22-selector-level-configuration",children:"2.2 Selector level configuration"}),"\n",(0,o.jsxs)(n.p,{children:["Similar to plug-in level configuration. Combine the '1', '2' steps above\n",(0,o.jsx)(n.img,{alt:"discovery-seletor-config.png",src:i(45537).A+"",width:"1154",height:"879"})]}),"\n",(0,o.jsx)(n.p,{children:"Note: When using selector levels. It has to be reconfigured each time"}),"\n",(0,o.jsx)(n.p,{children:"If you choose the LOCAL mode, you don't need to log into a registry and manually maintain the upstream list"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"discovery-local-mode.png",src:i(55709).A+"",width:"1142",height:"528"})}),"\n",(0,o.jsx)(n.h1,{id:"3-configuration",children:"3. Configuration"}),"\n",(0,o.jsx)(n.h2,{id:"31-registration-information-configuration",children:"3.1 Registration Information Configuration"}),"\n",(0,o.jsx)(n.h3,{id:"311-basic-configuration",children:"3.1.1 Basic Configuration"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"common-config.png",src:i(20047).A+"",width:"1063",height:"372"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Type registered Type [LOCAL | ZOOKEEPER]"}),"\n",(0,o.jsx)(n.li,{children:"ListenerNode registers listeners like '/shenyu/discovery'"}),"\n",(0,o.jsx)(n.li,{children:"Handler handles aliasing of upstream registration information"}),"\n",(0,o.jsx)(n.li,{children:"ServerList registry link url"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"312-detailed-explanation-of-data",children:"3.1.2 Detailed explanation of data"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["The ",(0,o.jsx)(n.code,{children:"upstream"})," registration data is :"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "protocol": "tcp",\n  "url": "127.0.0.1:6379",\n  "status": 0,\n  "weight": 1,\n  "props": "{}"\n}\n'})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:'If the registered data format is different from the default json format, you can set an alias in the "Conversion process"\uff1a'}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "${yourProtocol}": "tcp",\n  "${yourUrl}": "127.0.0.1:6379",\n  "${yourStatus}": 1,\n  "${yourWeight}": 1,\n  "${yourProps}": "{}"\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"32-configuration-in-different-modes",children:"3.2 Configuration in different modes"}),"\n",(0,o.jsx)(n.h3,{id:"31-local",children:"3.1 LOCAL"}),"\n",(0,o.jsx)(n.p,{children:"Only the selector level is supported in LOCAL mode\nNo need to specify a link registry configuration just manually maintain the upstream list"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"discovery-local-mode.png",src:i(55709).A+"",width:"1142",height:"528"})}),"\n",(0,o.jsx)(n.h3,{id:"32-zookeeper",children:"3.2 ZOOKEEPER"}),"\n",(0,o.jsx)(n.p,{children:"ZOOKEEPER mode supports both the plugin level and the selector level"}),"\n",(0,o.jsxs)(n.p,{children:["SEE ",(0,o.jsx)(n.code,{children:"shenyu-discovery-zookeeper#ZookeeperDiscoveryService#init"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "baseSleepTimeMilliseconds": "1000",\n  "maxRetries": "3",\n  "maxSleepTimeMilliseconds": "1000",\n  "connectionTimeoutMilliseconds": "1000",\n  "sessionTimeoutMilliseconds": "1000",\n  "namespace": "",\n  "digest": null\n}\n'})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:['You can search for the dictionary name as "zookeeper" in ',(0,o.jsx)(n.code,{children:"shenyu-admin"})," --\x3e BasicConfig --\x3e Dictionary,\nand modify the dictionary value corresponding to the default properties\n( ",(0,o.jsx)(n.strong,{children:"Note"}),": The dictionary type and dictionary name cannot be modified)\uff1a"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"zk_dict.png",src:i(44553).A+"",width:"1831",height:"858"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);