"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[60074],{28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>c});var s=i(96540);const t={},r=s.createContext(t);function o(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(r.Provider,{value:n},e.children)}},83430:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>c,toc:()=>d});var s=i(74848),t=i(28453);const r={sidebar_position:7,title:"Cluster Deployment",keywords:["Gateway Cluster Enviroment","Cluster Enviroment"],description:"Cluster Delopyment"},o=void 0,c={id:"deployment/deployment-cluster",title:"Cluster Deployment",description:"Cluster Delopyment",source:"@site/versioned_docs/version-2.4.2/deployment/deployment-cluster.md",sourceDirName:"deployment",slug:"/deployment/deployment-cluster",permalink:"/docs/2.4.2/deployment/deployment-cluster",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/shenyu-website/edit/main/versioned_docs/version-2.4.2/deployment/deployment-cluster.md",tags:[],version:"2.4.2",sidebarPosition:7,frontMatter:{sidebar_position:7,title:"Cluster Deployment",keywords:["Gateway Cluster Enviroment","Cluster Enviroment"],description:"Cluster Delopyment"},sidebar:"tutorialSidebar",previous:{title:"Custom Deployment",permalink:"/docs/2.4.2/deployment/deployment-custom"},next:{title:"Quick start with Dubbo",permalink:"/docs/2.4.2/quick-start/quick-start-dubbo"}},l={},d=[{value:"Enviromental Preparation",id:"enviromental-preparation",level:3},{value:"Start Apache ShenYu Admin",id:"start-apache-shenyu-admin",level:3},{value:"Start Apache ShenYu Boostrap",id:"start-apache-shenyu-boostrap",level:3},{value:"Start Nginx",id:"start-nginx",level:3}];function a(e){const n={a:"a",blockquote:"blockquote",code:"code",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["This aritcle introduces how to delopy the ",(0,s.jsx)(n.code,{children:"Shenyu"})," gateway in cluster enviroment."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["In this part, you can see  ",(0,s.jsx)(n.a,{href:"/docs/2.4.2/deployment/deployment-package",children:"ShenYu Binary Packages Deployment"})," before deploying."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"enviromental-preparation",children:"Enviromental Preparation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Two or more Gateway Boostrap servers, these servers must install JDK1.8+."}),"\n",(0,s.jsx)(n.li,{children:"A server for Gateway Admin, this server must install mysql/pgsql/h2 and JDK1.8+."}),"\n",(0,s.jsx)(n.li,{children:"A server for nginx."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"start-apache-shenyu-admin",children:"Start Apache ShenYu Admin"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["download and unzip ",(0,s.jsx)(n.a,{href:"https://archive.apache.org/dist/incubator/shenyu/2.4.2/apache-shenyu-incubating-2.4.2-admin-bin.tar.gz",children:"apache-shenyu-incubating-2.4.2-admin-bin.tar.gz"})," in your Gateway Admin server."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["config your database, go to the ",(0,s.jsx)(n.code,{children:"/conf"})," directory, and  modify ",(0,s.jsx)(n.code,{children:"spring.profiles.active"})," of the configuration in ",(0,s.jsx)(n.code,{children:"application.yaml"})," to ",(0,s.jsx)(n.code,{children:"mysql"}),", ",(0,s.jsx)(n.code,{children:"pg"})," or ",(0,s.jsx)(n.code,{children:"h2"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["config your way of synchronization, go to the ",(0,s.jsx)(n.code,{children:"/conf"})," directory, and modify ",(0,s.jsx)(n.code,{children:"shenyu.sync"})," of configuration in ",(0,s.jsx)(n.code,{children:"application.yaml"})," to ",(0,s.jsx)(n.code,{children:"websocket"}),", ",(0,s.jsx)(n.code,{children:"http"}),", ",(0,s.jsx)(n.code,{children:"zookeeper"}),", ",(0,s.jsx)(n.code,{children:"etcd"}),", ",(0,s.jsx)(n.code,{children:"consul"})," or ",(0,s.jsx)(n.code,{children:"nacos"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["start Apache ShenYu Admin in ",(0,s.jsx)(n.code,{children:"bin"})," directory."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"> windows: start.bat \n\n> linux: ./start.sh \n"})}),"\n",(0,s.jsx)(n.h3,{id:"start-apache-shenyu-boostrap",children:"Start Apache ShenYu Boostrap"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["download and unzip ",(0,s.jsx)(n.a,{href:"https://archive.apache.org/dist/incubator/shenyu/2.4.2/apache-shenyu-incubating-2.4.2-bootstrap-bin.tar.gz",children:"apache-shenyu-incubating-2.4.2-bootstrap-bin.tar.gz"})," in your Gateway Boostrap server."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["config your synchronization, go to the ",(0,s.jsx)(n.code,{children:"/conf"})," directory, and modify ",(0,s.jsx)(n.code,{children:"shenyu.sync"})," of configuration in ",(0,s.jsx)(n.code,{children:"application.yaml"})," to ",(0,s.jsx)(n.code,{children:"websocket"}),", ",(0,s.jsx)(n.code,{children:"http"}),", ",(0,s.jsx)(n.code,{children:"zookeeper"}),", ",(0,s.jsx)(n.code,{children:"etcd"}),", ",(0,s.jsx)(n.code,{children:"consul"})," or ",(0,s.jsx)(n.code,{children:"nacos"}),", this configuaration must remain the same of ",(0,s.jsx)(n.code,{children:"ShenyYu Admin"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["repeat above-mentioned operations in each ",(0,s.jsx)(n.code,{children:"ShenYu Bootstrap"})," server."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["start Apache ShenYu Bootstrap in ",(0,s.jsx)(n.code,{children:"bin"})," directory."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"> windwos : start.bat \n\n> linux : ./start.sh \n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["After completing these operations, you will deploy ",(0,s.jsx)(n.code,{children:"ShenYu Boostrap"})," Cluster."]}),"\n",(0,s.jsxs)(n.p,{children:["For example. you will deploy ",(0,s.jsx)(n.code,{children:"ShenYu Bootstrap"})," in ",(0,s.jsx)(n.code,{children:"10.1.1.1"})," and ",(0,s.jsx)(n.code,{children:"10.1.1.2"})," and deploy nginx in ",(0,s.jsx)(n.code,{children:"10.1.1.3"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"start-nginx",children:"Start Nginx"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["download and install ",(0,s.jsx)(n.code,{children:"nginx"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["modify ",(0,s.jsx)(n.code,{children:"upstream"})," and ",(0,s.jsx)(n.code,{children:"server"})," of configuration in ",(0,s.jsx)(n.code,{children:"nginx.conf"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-nginx",children:"upstream shenyu_gateway_cluster {\n  ip_hash;\n  server 10.1.1.1:9195 max_fails=3 fail_timeout=10s weight=50;\n  server 10.1.1.2:9195 max_fails=3 fail_timeout=10s weight=50;\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-nginx",children:"server {\n  location / {\n\t\tproxy_pass http://shenyu_gateway_cluster;\n\t\tproxy_set_header HOST $host;\n\t\tproxy_read_timeout 10s;\n\t\tproxy_connect_timeout 10s;\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"start nginx."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"> windows: ./nginx.exe\n\n> linux: /usr/local/nginx/sbin/nginx \n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["verify nginx, looking at your ",(0,s.jsx)(n.code,{children:"ShenYu Bootstrap"})," log or ",(0,s.jsx)(n.code,{children:"Nginx"})," log, Where will the verification request go."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}}}]);