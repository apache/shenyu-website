"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[17980],{28453:(e,i,n)=>{n.d(i,{R:()=>l,x:()=>o});var t=n(96540);const r={},s=t.createContext(r);function l(e){const i=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function o(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(s.Provider,{value:i},e.children)}},44029:(e,i,n)=>{n.d(i,{A:()=>t});const t=n.p+"assets/images/enable-en-d6ddedc0d79f6f071df86d262a7cda03.png"},55755:(e,i,n)=>{n.d(i,{A:()=>t});const t=n.p+"assets/images/selector-en-0b99d7a7e1ce0334e5dadc04ba8611c8.png"},57761:(e,i,n)=>{n.d(i,{A:()=>t});const t=n.p+"assets/images/select-and-rule-en-3a62f8cb06cf350e1f7e48daaa601978.png"},59084:(e,i,n)=>{n.d(i,{A:()=>t});const t=n.p+"assets/images/rule-en-0b219597a708404400981a3a9d6a89c0.png"},64989:(e,i,n)=>{n.d(i,{A:()=>t});const t=n.p+"assets/images/procedure-en-5b17e369f9d6c12d70118a29f5b7bd30.png"},81167:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>d});var t=n(74848),r=n(28453);const s={title:"Divide Plugin",keywords:["divide"],description:"divide plugin"},l="1. Overview",o={id:"plugin-center/proxy/divide-plugin",title:"Divide Plugin",description:"divide plugin",source:"@site/versioned_docs/version-2.5.0/plugin-center/proxy/divide-plugin.md",sourceDirName:"plugin-center/proxy",slug:"/plugin-center/proxy/divide-plugin",permalink:"/docs/2.5.0/plugin-center/proxy/divide-plugin",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/shenyu-website/edit/main/versioned_docs/version-2.5.0/plugin-center/proxy/divide-plugin.md",tags:[],version:"2.5.0",frontMatter:{title:"Divide Plugin",keywords:["divide"],description:"divide plugin"},sidebar:"tutorialSidebar",previous:{title:"Rewrite Plugin",permalink:"/docs/2.5.0/plugin-center/http-process/rewrite-plugin"},next:{title:"Dubbo Plugin",permalink:"/docs/2.5.0/plugin-center/proxy/dubbo-plugin"}},c={},d=[{value:"1.1 Plugin Name",id:"11-plugin-name",level:2},{value:"1.2 Appropriate Scenario",id:"12-appropriate-scenario",level:2},{value:"1.3 Plugin functionality",id:"13-plugin-functionality",level:2},{value:"1.4 Plugin Code",id:"14-plugin-code",level:2},{value:"2.1 Plugin-use procedure chart",id:"21-plugin-use-procedure-chart",level:2},{value:"2.2 Import pom",id:"22-import-pom",level:2},{value:"2.3 Enable plugin",id:"23-enable-plugin",level:2},{value:"2.4 Config plugin",id:"24-config-plugin",level:2},{value:"2.4.1 Configure access parameters in the client project configuration file",id:"241-configure-access-parameters-in-the-client-project-configuration-file",level:3},{value:"2.4.2 Configure upstream validity detection parameters in the shenyu-admin configuration file",id:"242-configure-upstream-validity-detection-parameters-in-the-shenyu-admin-configuration-file",level:3},{value:"2.4.3 Configure the selector and rule information of the divide plugin in shenyu-admin",id:"243-configure-the-selector-and-rule-information-of-the-divide-plugin-in-shenyu-admin",level:3},{value:"2.4.3.1 Selector configuration",id:"2431-selector-configuration",level:4},{value:"2.4.3.1.1 Selector handling information configuration",id:"24311-selector-handling-information-configuration",level:5},{value:"2.4.3.2 Processing information configuration of rules",id:"2432-processing-information-configuration-of-rules",level:4},{value:"2.4.3.2.1 Rule processing information configuration",id:"24321-rule-processing-information-configuration",level:5},{value:"2.5 Examples",id:"25-examples",level:2},{value:"2.5.1 Example A/B Test",id:"251-example-ab-test",level:3},{value:"2.5.2 Example Grayscale Test",id:"252-example-grayscale-test",level:3}];function a(e){const i={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.h1,{id:"1-overview",children:"1. Overview"}),"\n",(0,t.jsx)(i.h2,{id:"11-plugin-name",children:"1.1 Plugin Name"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"divide"})," Plugin"]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"12-appropriate-scenario",children:"1.2 Appropriate Scenario"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Handling ",(0,t.jsx)(i.code,{children:"http protocol"})," requests."]}),"\n",(0,t.jsx)(i.li,{children:"Support traffic management, such as a/b test, grayscale test."}),"\n",(0,t.jsx)(i.li,{children:"Service Load Balancing."}),"\n",(0,t.jsx)(i.li,{children:"Set request timeout."}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"13-plugin-functionality",children:"1.3 Plugin functionality"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Supports traffic management based on request information such as uri, header, and query."}),"\n",(0,t.jsx)(i.li,{children:"Supports setting the load balancing strategy for requests, and supports service warm-up. Currently, three strategies are supported: ip hash (consistent hash with virtual nodes), round-robbin (weighted polling), random (weighted random)."}),"\n",(0,t.jsx)(i.li,{children:"Supports setting the maximum value of the request header, the maximum value of the request body, and the request level timeout."}),"\n",(0,t.jsx)(i.li,{children:"Supports setting the timeout retry policy and the number of retries. Currently, the retry policy supports: current (retrying the server that failed before) and failover (retrying other servers)."}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"14-plugin-code",children:"1.4 Plugin Code"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Core module is ",(0,t.jsx)(i.code,{children:"shenyu-plugin-divide"}),"."]}),"\n",(0,t.jsxs)(i.li,{children:["Core class is ",(0,t.jsx)(i.code,{children:"org.apache.shenyu.plugin.divide.DividePlugin"}),"."]}),"\n"]}),"\n",(0,t.jsx)(i.h1,{id:"2-how-to-use-plugin",children:"2. How to use plugin"}),"\n",(0,t.jsx)(i.h2,{id:"21-plugin-use-procedure-chart",children:"2.1 Plugin-use procedure chart"}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:n(64989).A+"",width:"232",height:"579"})}),"\n",(0,t.jsx)(i.h2,{id:"22-import-pom",children:"2.2 Import pom"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Import maven in shenyu-bootstrap project's ",(0,t.jsx)(i.code,{children:"pom.xml"})," file."]}),"\n"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-xml",children:"  <dependency>\n      <groupId>org.apache.shenyu</groupId>\n      <artifactId>shenyu-spring-boot-starter-gateway</artifactId>\n     <version>${project.version}</version>\n  </dependency>\n"})}),"\n",(0,t.jsx)(i.h2,{id:"23-enable-plugin",children:"2.3 Enable plugin"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["In ",(0,t.jsx)(i.code,{children:"shenyu-admin"})," --\x3e BasicConfig --\x3e Plugin --\x3e ",(0,t.jsx)(i.code,{children:"divide"})," set Status enable."]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:n(44029).A+"",width:"1909",height:"763"})}),"\n",(0,t.jsx)(i.h2,{id:"24-config-plugin",children:"2.4 Config plugin"}),"\n",(0,t.jsx)(i.h3,{id:"241-configure-access-parameters-in-the-client-project-configuration-file",children:"2.4.1 Configure access parameters in the client project configuration file"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Client access method and server address. The following example uses the http access method. Currently, the client supports the following access methods: http, zookeeper, etcd, nacos, consul. For detailed access configuration parameters, please refer to ",(0,t.jsx)(i.a,{href:"/docs/next/user-guide/property-config/register-center-access",children:"Client Access Configuration"}),"."]}),"\n",(0,t.jsx)(i.li,{children:"Client configuration, including the protocol name and the routing address of the service, please use the http protocol here, and the value of contextPath must be configured as the routing address of each service."}),"\n"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-yaml",children:"  shenyu:\n    register:\n      registerType: http\n      serverLists: http://localhost:9095\n      props:\n        username: admin\n        password: 123456\n    client:\n      http: # http protocol\n        props:\n          contextPath: /http # routing address for each service\n"})}),"\n",(0,t.jsx)(i.h3,{id:"242-configure-upstream-validity-detection-parameters-in-the-shenyu-admin-configuration-file",children:"2.4.2 Configure upstream validity detection parameters in the shenyu-admin configuration file"}),"\n",(0,t.jsxs)(i.p,{children:["The following example uses the http access method. Currently, the client supports the following access methods: http, zookeeper, etcd, nacos, consul. For detailed access configuration parameters, please refer to ",(0,t.jsx)(i.a,{href:"/docs/next/user-guide/property-config/register-center-access",children:"Client Access Configuration"}),"."]}),"\n",(0,t.jsxs)(i.blockquote,{children:["\n",(0,t.jsx)(i.p,{children:"Only http-type registries support upstream detection."}),"\n"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-yaml",children:"  shenyu:\n    register:\n      registerType: http # Only http-type register center support upstream detection.\n      serverLists: \n      props:\n        checked: true # The default is true, set to false, do not detect.\n        zombieCheckTimes: 5 # The maximum number of zombie upstream detections. If it exceeds 5 times, its validity will no longer be detected. The default value is 5.\n        scheduledTime: 10 # Timing detection interval, the default is 10 seconds.\n        zombieRemovalTimes: 60 # How many seconds the upstream is offline to be considered as a zombie upstream, the default is 60 seconds.\n"})}),"\n",(0,t.jsx)(i.h3,{id:"243-configure-the-selector-and-rule-information-of-the-divide-plugin-in-shenyu-admin",children:"2.4.3 Configure the selector and rule information of the divide plugin in shenyu-admin"}),"\n",(0,t.jsxs)(i.p,{children:["After the client is started, the ",(0,t.jsx)(i.a,{href:"../../user-guide/admin-usage/selector-and-rule",children:"selector and rule"})," information will be automatically registered in shenyu-admin -> Plugin List -> Proxy -> Divide."]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:n(57761).A+"",width:"1913",height:"766"})}),"\n",(0,t.jsx)(i.h4,{id:"2431-selector-configuration",children:"2.4.3.1 Selector configuration"}),"\n",(0,t.jsxs)(i.p,{children:["Example of divide selector. For general selector configuration, please refer to ",(0,t.jsx)(i.a,{href:"../../user-guide/admin-usage/selector-and-rule",children:"Selectors and Rules"}),"."]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:n(55755).A+"",width:"1307",height:"735"})}),"\n",(0,t.jsx)(i.h5,{id:"24311-selector-handling-information-configuration",children:"2.4.3.1.1 Selector handling information configuration"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"host"}),": fill in ",(0,t.jsx)(i.code,{children:"localhost"}),", this field is not used currently."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"ip:port"}),": ",(0,t.jsx)(i.code,{children:"ip"})," and port, fill in the ",(0,t.jsx)(i.code,{children:"ip"})," + port of your real service here."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"protocol"}),": ",(0,t.jsx)(i.code,{children:"http"})," protocol, fill in ",(0,t.jsx)(i.code,{children:"http:"})," or ",(0,t.jsx)(i.code,{children:"https:"}),", if not fill in, the default is: ",(0,t.jsx)(i.code,{children:"http:"}),"."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"startupTime"}),": Startup time in milliseconds."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"weight"}),": load balancing weight, the default value of service startup automatic registration is 50."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"warmupTime"}),": Warmup time, in milliseconds. The server during warmup will calculate the instantaneous weight, and the calculated value will be smaller than the actual configured weight to protect the server just started. The default value of service startup registration is 10. For example, the warm-up time is 100 milliseconds, the current startup is 50 milliseconds, the configured weight is 50, and the actual weight is 25."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"status"}),": On or off, this selector is valid only in the on state."]}),"\n"]}),"\n",(0,t.jsx)(i.h4,{id:"2432-processing-information-configuration-of-rules",children:"2.4.3.2 Processing information configuration of rules"}),"\n",(0,t.jsxs)(i.p,{children:["Example of divide rule. For general rule configuration, please refer to ",(0,t.jsx)(i.a,{href:"../../user-guide/admin-usage/selector-and-rule",children:"selectors and rules"}),"."]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:n(59084).A+"",width:"999",height:"697"})}),"\n",(0,t.jsx)(i.h5,{id:"24321-rule-processing-information-configuration",children:"2.4.3.2.1 Rule processing information configuration"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"loadStrategy"}),": If the ",(0,t.jsx)(i.code,{children:"http"})," client is a cluster, which load balancing strategy is used when the ",(0,t.jsx)(i.code,{children:"Apache ShenYu"})," gateway is called, currently supports ",(0,t.jsx)(i.code,{children:"roundRobin"}),", ",(0,t.jsx)(i.code,{children:"random"})," and ",(0,t.jsx)(i.code,{children:"hash"}),"."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"timeout"}),": The timeout for calling the ",(0,t.jsx)(i.code,{children:"http"})," client."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"retry Count"}),": The number of retries that failed to call the ",(0,t.jsx)(i.code,{children:"http"})," client timeout."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"headerMaxSize"}),": The maximum value of the requested ",(0,t.jsx)(i.code,{children:"header"}),"."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"requestMaxSize"}),": The maximum value of the request body."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"retryStrategy"}),": Supported since ",(0,t.jsx)(i.code,{children:"2.4.3"}),", retry strategy after failure, default ",(0,t.jsx)(i.code,{children:"current"})," to maintain compatibility with lower versions. For example, there are 3 downstream services ",(0,t.jsx)(i.code,{children:"http:localhost:1111"}),", ",(0,t.jsx)(i.code,{children:"http:localhost:1112"})," and ",(0,t.jsx)(i.code,{children:"http:localhost:1113"}),", assuming the first load balancing to ",(0,t.jsx)(i.code,{children:"http:localhost:1111"})," and ",(0,t.jsx)(i.code,{children:"call failed"}),". Using the ",(0,t.jsx)(i.code,{children:"current"})," strategy will continue to retry calling ",(0,t.jsx)(i.code,{children:"http:localhost:1111"}),"; using the ",(0,t.jsx)(i.code,{children:"failover"})," strategy will retry calling other services such as ",(0,t.jsx)(i.code,{children:"http:localhost:1112"})," through the ",(0,t.jsx)(i.code,{children:"load balancing"}),", if it fails again at this time , call to ",(0,t.jsx)(i.code,{children:"http:localhost:1113"})," until no service is available."]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"25-examples",children:"2.5 Examples"}),"\n",(0,t.jsx)(i.h3,{id:"251-example-ab-test",children:"2.5.1 Example A/B Test"}),"\n",(0,t.jsx)(i.p,{children:"To be added, welcome contribute."}),"\n",(0,t.jsx)(i.h3,{id:"252-example-grayscale-test",children:"2.5.2 Example Grayscale Test"}),"\n",(0,t.jsx)(i.p,{children:"To be added, welcome contribute."}),"\n",(0,t.jsx)(i.h1,{id:"3-how-to-disable-plugin",children:"3. How to disable plugin"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["In ",(0,t.jsx)(i.code,{children:"shenyu-admin"})," --\x3e BasicConfig --\x3e Plugin --\x3e ",(0,t.jsx)(i.code,{children:"divide"})," set Status disable."]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:n(99676).A+"",width:"1916",height:"772"})})]})}function h(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},99676:(e,i,n)=>{n.d(i,{A:()=>t});const t=n.p+"assets/images/disable-en-8ae0fcbf271bbccd293931cc20f3dfa1.png"}}]);