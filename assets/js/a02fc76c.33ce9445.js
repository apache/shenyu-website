"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[87059],{17387(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"user-guide/proxy/http-proxy","title":"Http Proxy","description":"Integrate Http with shenyu gateway","source":"@site/docs/user-guide/proxy/http-proxy.md","sourceDirName":"user-guide/proxy","slug":"/user-guide/proxy/http-proxy","permalink":"/docs/next/user-guide/proxy/http-proxy","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/shenyu-website/edit/main/docs/user-guide/proxy/http-proxy.md","tags":[],"version":"current","frontMatter":{"title":"Http Proxy","keywords":["Http"],"description":"Integrate Http with shenyu gateway"},"sidebar":"tutorialSidebar","previous":{"title":"gRPC Proxy","permalink":"/docs/next/user-guide/proxy/grpc-proxy"},"next":{"title":"McpTool Service Integration","permalink":"/docs/next/user-guide/proxy/mcp-tool-proxy"}}');var s=t(74848),i=t(28453);const o={title:"Http Proxy",keywords:["Http"],description:"Integrate Http with shenyu gateway"},a=void 0,c={},l=[{value:"Add divide plugin in gateway",id:"add-divide-plugin-in-gateway",level:2},{value:"Http request access gateway (for springMvc)",id:"http-request-access-gateway-for-springmvc",level:2},{value:"Http request access gateway(other framework)",id:"http-request-access-gatewayother-framework",level:2},{value:"User request",id:"user-request",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["This document is intended to help the ",(0,s.jsx)(n.code,{children:"Http"})," service access the ",(0,s.jsx)(n.code,{children:"Apache ShenYu"})," gateway. The ",(0,s.jsx)(n.code,{children:"Apache ShenYu"})," gateway uses the ",(0,s.jsx)(n.code,{children:"Divide"})," plugin to handle ",(0,s.jsx)(n.code,{children:"Http"})," requests."]}),"\n",(0,s.jsxs)(n.p,{children:["Before the connection, start ",(0,s.jsx)(n.code,{children:"shenyu-admin"})," correctly, start ",(0,s.jsx)(n.code,{children:"Divide"})," plugin, and add related dependencies on the gateway and ",(0,s.jsx)(n.code,{children:"Http"})," application client. Refer to the previous ",(0,s.jsx)(n.a,{href:"../../quick-start/quick-start-http",children:"Quick start with Http"})," ."]}),"\n",(0,s.jsxs)(n.p,{children:["For details about client access configuration, see ",(0,s.jsx)(n.a,{href:"/docs/next/user-guide/property-config/register-center-access",children:"Application Client Access Config"})," ."]}),"\n",(0,s.jsxs)(n.p,{children:["For details about data synchronization configurations, see ",(0,s.jsx)(n.a,{href:"/docs/next/user-guide/property-config/use-data-sync",children:"Data Synchronization Config"})," ."]}),"\n",(0,s.jsx)(n.h2,{id:"add-divide-plugin-in-gateway",children:"Add divide plugin in gateway"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Add the following dependencies to the gateway's ",(0,s.jsx)(n.code,{children:"pom.xml"})," file:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"    <dependency>\n        <groupId>org.apache.shenyu</groupId>\n        <artifactId>shenyu-spring-boot-starter-plugin-divide</artifactId>\n        <version>${project.version}</version>\n    </dependency>\n\n    <dependency>\n        <groupId>org.apache.shenyu</groupId>\n        <artifactId>shenyu-spring-boot-starter-plugin-httpclient</artifactId>\n        <version>${project.version}</version>\n    </dependency>\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"http-request-access-gateway-for-springmvc",children:"Http request access gateway (for springMvc)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"SpringBoot"}),"\n",(0,s.jsxs)(n.p,{children:["Please refer this\uff1a",(0,s.jsx)(n.a,{href:"https://github.com/apache/shenyu/tree/master/shenyu-examples/shenyu-examples-http",children:"shenyu-examples-http"})]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Add the following dependencies to the ",(0,s.jsx)(n.code,{children:"pom.xml"})," file in your ",(0,s.jsx)(n.code,{children:"Http"})," service:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"    <dependency>\n        <groupId>org.apache.shenyu</groupId>\n        <artifactId>shenyu-spring-boot-starter-client-springmvc</artifactId>\n        <version>${shenyu.version}</version>\n    </dependency>\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"Add the following configuration to application.yaml:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"shenyu:\n  register:\n    registerType: http #zookeeper #etcd #nacos #consul\n    serverLists: http://localhost:9095 #localhost:2181 #http://localhost:2379 #localhost:8848\n    props:\n      username: admin\n      password: 123456\n  client:\n    http:\n      props:\n        contextPath: /http\n        appName: http\n  #      port: 8189\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"SpringMvc"}),"\n",(0,s.jsxs)(n.p,{children:["Please refer this\uff1a",(0,s.jsx)(n.a,{href:"https://github.com/apache/shenyu/tree/master/shenyu-examples/shenyu-examples-springmvc",children:"shenyu-examples-springmvc"})]}),"\n",(0,s.jsxs)(n.p,{children:["Add the following dependencies to the ",(0,s.jsx)(n.code,{children:"pom.xml"})," file in your ",(0,s.jsx)(n.code,{children:"Http"})," service:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"    <dependency>\n        <groupId>org.apache.shenyu</groupId>\n        <artifactId>shenyu-client-springmvc</artifactId>\n        <version>${shenyu.version}</version>\n    </dependency>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Add the following to the ",(0,s.jsx)(n.code,{children:"XML"})," file defined by your ",(0,s.jsx)(n.code,{children:"bean"})," :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'   <bean id="springMvcClientBeanPostProcessor" class="org.apache.shenyu.client.springmvc.init.SpringMvcClientBeanPostProcessor">\n       <constructor-arg ref="clientPropertiesConfig"/>\n       <constructor-arg ref="clientRegisterRepository"/>\n   </bean>\n       \n   \x3c!-- Config register center according to your register type--\x3e\n   <bean id="shenyuRegisterCenterConfig" class="org.apache.shenyu.register.common.config.ShenyuRegisterCenterConfig">\n       <property name="registerType" value="http"/>\n       <property name="serverLists" value="http://localhost:9095"/>\n   </bean>\n\n   \x3c!-- Client properties config --\x3e\n   <bean id="clientPropertiesConfig"\n         class="org.apache.shenyu.register.common.config.ShenyuClientConfig.ClientPropertiesConfig">\n     <property name="props">\n         <map>\n             <entry key="contextPath" value="/your contextPath"/>\n             <entry key="appName" value="your appName"/>\n             <entry key="port" value="your port"/>\n             <entry key="isFull" value="false"/>\n         </map>\n     </property>\n   </bean>\n\n   \x3c!-- Config register repository according to your register type --\x3e\n   <bean id="clientRegisterRepository" class="org.apache.shenyu.register.client.http.HttpClientRegisterRepository">\n       <constructor-arg ref="shenyuRegisterCenterConfig"/>\n   </bean>\n   \n   <bean id="shenyuClientShutdownHook" class="org.apache.shenyu.client.core.shutdown.ShenyuClientShutdownHook">\n       <constructor-arg ref="shenyuRegisterCenterConfig"/>\n       <constructor-arg ref="clientRegisterRepository"/>\n   </bean>\n   \n   <bean id="contextRegisterListener" class="org.apache.shenyu.client.springmvc.init.ContextRegisterListener">\n       <constructor-arg ref="clientPropertiesConfig"/>\n   </bean>\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Add this annotation ",(0,s.jsx)(n.code,{children:"@ShenyuSpringMvcClient"})," in your ",(0,s.jsx)(n.code,{children:"controller"})," interface."]}),"\n",(0,s.jsxs)(n.p,{children:["You can apply the annotation to class-level in a controller. The name of the ",(0,s.jsx)(n.code,{children:"path"})," variable is prefix and ",(0,s.jsx)(n.code,{children:"/**"})," will apply proxy for entire interfaces."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Example(1)"}),"\n",(0,s.jsxs)(n.p,{children:["The following indicates that ",(0,s.jsx)(n.code,{children:"/test/payment"}),", ",(0,s.jsx)(n.code,{children:"/test/findByUserId"})," will be proxy by the gateway."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'  @RestController\n  @RequestMapping("/test")\n  @ShenyuSpringMvcClient(path = "/test/**")\n  public class HttpTestController {\n\n      @PostMapping("/payment")\n      public UserDTO post(@RequestBody final UserDTO userDTO) {\n          return userDTO;\n      }\n\n      @GetMapping("/findByUserId")\n      public UserDTO findByUserId(@RequestParam("userId") final String userId) {\n          UserDTO userDTO = new UserDTO();\n          userDTO.setUserId(userId);\n          userDTO.setUserName("hello world");\n          return userDTO;\n      }\n   }\n'})}),"\n",(0,s.jsx)(n.p,{children:"Example(2)"}),"\n",(0,s.jsxs)(n.p,{children:["The following indicates that ",(0,s.jsx)(n.code,{children:"/order/save"})," is proxied by the gateway, while ",(0,s.jsx)(n.code,{children:"/order/findById"})," is not."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'  @RestController\n  @RequestMapping("/order")\n  @ShenyuSpringMvcClient(path = "/order")\n  public class OrderController {\n\n      @PostMapping("/save")\n      @ShenyuSpringMvcClient(path = "/save")\n      public OrderDTO save(@RequestBody final OrderDTO orderDTO) {\n          orderDTO.setName("hello world save order");\n          return orderDTO;\n      }\n\n      @GetMapping("/findById")\n      public OrderDTO findById(@RequestParam("id") final String id) {\n          OrderDTO orderDTO = new OrderDTO();\n          orderDTO.setId(id);\n          orderDTO.setName("hello world findById");\n          return orderDTO;\n      }\n  }\n'})}),"\n",(0,s.jsxs)(n.p,{children:["example (3)\uff1aThis is a simplified way to use it, just need a simple annotation to register to the gateway using metadata.\nSpecial note: currently only supports ",(0,s.jsx)(n.code,{children:"@RequestMapping, @GetMapping, @PostMapping, @DeleteMapping, @PutMapping"})," annotations, and only valid for the first path in ",(0,s.jsx)(n.code,{children:"@XXXMapping"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'  @RestController\n  @RequestMapping("new/feature")\n  public class NewFeatureController {\n  \n    /**\n     * no support gateway access api.\n     *\n     * @return result\n     */\n    @RequestMapping("/gateway/not")\n    public EntityResult noSupportGateway() {\n      return new EntityResult(200, "no support gateway access");\n    }\n  \n    /**\n     * Do not use shenyu annotation path. used request mapping path.\n     *\n     * @return result\n     */\n    @RequestMapping("/requst/mapping/path")\n    @ShenyuSpringCloudClient\n    public EntityResult requestMappingUrl() {\n      return new EntityResult(200, "Do not use shenyu annotation path. used request mapping path");\n    }\n  \n    /**\n     * Do not use shenyu annotation path. used post mapping path.\n     *\n     * @return result\n     */\n    @PostMapping("/post/mapping/path")\n    @ShenyuSpringCloudClient\n    public EntityResult postMappingUrl() {\n      return new EntityResult(200, "Do not use shenyu annotation path. used post mapping path");\n    }\n  \n    /**\n     * Do not use shenyu annotation path. used post mapping path.\n     *\n     * @return result\n     */\n    @GetMapping("/get/mapping/path")\n    @ShenyuSpringCloudClient\n    public EntityResult getMappingUrl() {\n      return new EntityResult(200, "Do not use shenyu annotation path. used get mapping path");\n    }\n  }\n\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Start your project, your service interface is connected to the gateway, go to the ",(0,s.jsx)(n.code,{children:"shenyu-admin"})," management system plugin list ",(0,s.jsx)(n.code,{children:"->"})," HTTP process ",(0,s.jsx)(n.code,{children:"->"})," Divide, see automatically created selectors and rules."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"http-request-access-gatewayother-framework",children:"Http request access gateway(other framework)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["First, find ",(0,s.jsx)(n.code,{children:"divide"})," plugin in ",(0,s.jsx)(n.code,{children:"shenyu-admin"}),", add selector, and rules, and filter traffic matching."]}),"\n",(0,s.jsxs)(n.li,{children:["If you don't know how to configure, please refer to ",(0,s.jsx)(n.a,{href:"../admin-usage/selector-and-rule",children:"Selector Detailed Explanation"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["You can also develop your customized http-client\uff0crefer to ",(0,s.jsx)(n.a,{href:"../../developer/developer-shenyu-client",children:"multi-language Http client development"}),"\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"user-request",children:"User request"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Send the request as before, only two points need to notice."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Firstly, the domain name that requested before in your service, now need to replace with gateway's domain name."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Secondly, ",(0,s.jsx)(n.code,{children:"Apache ShenYu"})," Gateway needs a route prefix which comes from ",(0,s.jsx)(n.code,{children:"contextPath"}),", it configured during the integration with gateway, you can change it freely in ",(0,s.jsx)(n.code,{children:"divide"})," plugin of ",(0,s.jsx)(n.code,{children:"shenyu-admin"}),", if you are familiar with it."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["for example, if you have an ",(0,s.jsx)(n.code,{children:"order"})," service, and it has an interface, the request url: ",(0,s.jsx)(n.code,{children:"http://localhost:8080/test/save"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Now need to change to:  ",(0,s.jsx)(n.code,{children:"http://localhost:9195/order/test/save"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["We can see ",(0,s.jsx)(n.code,{children:"localhost:9195"})," is your gateway's ",(0,s.jsx)(n.code,{children:"ip"})," port\uff0cdefault port number is ",(0,s.jsx)(n.code,{children:"9195"})," \uff0c",(0,s.jsx)(n.code,{children:"/order"})," is your ",(0,s.jsx)(n.code,{children:"contextPath"})," which you configured with gateway."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Other parameters doesn't change in request method."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Then you can visit, very easy and simple."}),"\n"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453(e,n,t){t.d(n,{R:()=>o,x:()=>a});var r=t(96540);const s={},i=r.createContext(s);function o(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);