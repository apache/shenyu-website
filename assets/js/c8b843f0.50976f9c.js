"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[6485],{6873:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/shenyu-agent-plugin-tracing-zipkin-7817c8ccb7bb44e939400213adebba08.png"},28453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>c});var i=n(96540);const s={},r=i.createContext(s);function l(e){const t=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(r.Provider,{value:t},e.children)}},44844:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/shenyu-agent-plugin-tracing-jaeger-1-675ef230ed483bf24008b91b0576e2dc.jpg"},66453:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>l,default:()=>o,frontMatter:()=>r,metadata:()=>c,toc:()=>d});var i=n(74848),s=n(28453);const r={title:"Tracing",keywords:["Tracing"],description:"Tracing access"},l=void 0,c={id:"user-guide/observability/tracing",title:"Tracing",description:"Tracing access",source:"@site/versioned_docs/version-2.4.2/user-guide/observability/tracing.md",sourceDirName:"user-guide/observability",slug:"/user-guide/observability/tracing",permalink:"/docs/2.4.2/user-guide/observability/tracing",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/shenyu-website/edit/main/versioned_docs/version-2.4.2/user-guide/observability/tracing.md",tags:[],version:"2.4.2",frontMatter:{title:"Tracing",keywords:["Tracing"],description:"Tracing access"},sidebar:"tutorialSidebar",previous:{title:"Observability",permalink:"/docs/2.4.2/user-guide/observability/"},next:{title:"Dubbo Proxy",permalink:"/docs/2.4.2/user-guide/proxy/dubbo-proxy"}},a={},d=[{value:"Catalog Structure",id:"catalog-structure",level:2},{value:"Edit shenyu-agent.yaml",id:"edit-shenyu-agentyaml",level:2},{value:"jaeger",id:"jaeger",level:4},{value:"opentelemetry",id:"opentelemetry",level:4},{value:"zipkin",id:"zipkin",level:5},{value:"Agent Plugin Tracing Jaeger",id:"agent-plugin-tracing-jaeger",level:2},{value:"Agent Plugin Tracing Zipkin",id:"agent-plugin-tracing-zipkin",level:2},{value:"Agent Plugin Tracing OpenTelemetry",id:"agent-plugin-tracing-opentelemetry",level:2}];function h(e){const t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h4:"h4",h5:"h5",img:"img",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:["This article introduces how to use the ",(0,i.jsx)(t.code,{children:"Apache ShenYu Agent Tracing"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"Apache ShenYu"})," uses ",(0,i.jsx)(t.code,{children:"java agent"})," and ",(0,i.jsx)(t.code,{children:"bytecode enhancement"})," technology to achieve seamless embedding, so that users can access third-party observability systems without introducing dependencies, and obtain Traces, Metrics and Logging."]}),"\n",(0,i.jsx)(t.h2,{id:"catalog-structure",children:"Catalog Structure"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-text",children:".\n\u251c\u2500\u2500 conf\n\u2502\xa0\xa0 \u251c\u2500\u2500 logback.xml\n\u2502\xa0\xa0 \u251c\u2500\u2500 shenyu-agent.yaml\n\u2502\xa0\xa0 \u2514\u2500\u2500 tracing-point.yaml\n\u251c\u2500\u2500 plugins\n\u2502\xa0\xa0 \u251c\u2500\u2500 shenyu-agent-plugin-tracing-common-${latest.release.version}.jar\n\u2502\xa0\xa0 \u251c\u2500\u2500 shenyu-agent-plugin-tracing-jaeger-${latest.release.version}.jar\n\u2502\xa0\xa0 \u251c\u2500\u2500 shenyu-agent-plugin-tracing-opentelemetry-${latest.release.version}.jar\n\u2502\xa0\xa0 \u2514\u2500\u2500 shenyu-agent-plugin-tracing-zipkin-${latest.release.version}.jar\n\u2514\u2500\u2500 shenyu-agent.jar\n"})}),"\n",(0,i.jsx)(t.h2,{id:"edit-shenyu-agentyaml",children:"Edit shenyu-agent.yaml"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:'appName: shenyu-agent\nsupports:\n  tracing:\n    - jaeger\n    - opentelemetry\n    - zipkin\n\nplugins:\n  tracing:\n    jaeger:\n      host: "localhost"\n      port: 5775\n      props:\n        SERVICE_NAME: "shenyu-agent"\n        JAEGER_SAMPLER_TYPE: "const"\n        JAEGER_SAMPLER_PARAM: "1"\n    zipkin:\n      host: \n      port: \n      props:\n    opentelemetry:\n      props:\n        otel.traces.exporter: jaeger #zipkin #otlp\n        otel.resource.attributes: "service.name=shenyu-agent"\n        otel.exporter.jaeger.endpoint: "http://localhost:14250/api/traces"\n'})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Select the plugin to be used in ",(0,i.jsx)(t.code,{children:"supports"})]}),"\n",(0,i.jsxs)(t.li,{children:["Configure the parameters of the plug-in in ",(0,i.jsx)(t.code,{children:"plugins"}),". The specific usage of each plug-in props parameter is shown in the following tables:"]}),"\n"]}),"\n",(0,i.jsx)(t.h4,{id:"jaeger",children:"jaeger"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Name"}),(0,i.jsx)(t.th,{style:{textAlign:"center"},children:"Type"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"SERVICE_NAME"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"String"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"shenyu-agent"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"The name displayed in the traces system"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"JAEGER_SAMPLER_TYPE"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"String"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"const"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Jaeger sample rate type"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"JAEGER_SAMPLER_PARAM"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"String"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"1"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Jaeger sample rate parameters"})]})]})]}),"\n",(0,i.jsx)(t.h4,{id:"opentelemetry",children:"opentelemetry"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Name"}),(0,i.jsx)(t.th,{style:{textAlign:"center"},children:"Type"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"otel.traces.exporter"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"String"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"jaeger"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Traces exporter type, if not filled in, the default is otlp"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"otel.resource.attributes"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"String"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"service.name=shenyu-agent"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"otel resource attributes, if you fill in more than one, they can be separated by commas"})]})]})]}),"\n",(0,i.jsxs)(t.p,{children:["The SDK used by the opentelemetry plugin is initialized based on ",(0,i.jsx)(t.code,{children:"opentelemetry-sdk-extension-autoconfigure"}),". For more usage, please refer to ",(0,i.jsx)(t.a,{href:"https://github.com/open-telemetry/opentelemetry-java/tree/v1.9.1/sdk-extensions/autoconfigure#opentelemetry-sdk-autoconfigure",children:"OpenTelemetry SDK AutoConfiguration Instructions"})]}),"\n",(0,i.jsx)(t.h5,{id:"zipkin",children:"zipkin"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Name"}),(0,i.jsx)(t.th,{style:{textAlign:"center"},children:"Type"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"SERVICE_NAME"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"String"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"shenyu-agent"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"The name displayed in the traces system"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"URL_VERSION"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"String"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"/api/v2/spans"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"zipkin url version"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"SAMPLER_TYPE"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"String"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"const"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"zipkin sampler type"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"SAMPLER_PARAM"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"String"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"1"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"zipkin sampler param"})]})]})]}),"\n",(0,i.jsx)(t.h2,{id:"agent-plugin-tracing-jaeger",children:"Agent Plugin Tracing Jaeger"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"modify yaml file"}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["Specify the use of the ",(0,i.jsx)(t.code,{children:"jaeger"})," plugin via ",(0,i.jsx)(t.code,{children:"supports.tracing"})," in the ",(0,i.jsx)(t.code,{children:"shenyu-agent.yaml"})," file, and fill in the ",(0,i.jsx)(t.code,{children:"jaeger"})," configuration information via ",(0,i.jsx)(t.code,{children:"plugins.tracing"}),"."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:'appName: shenyu-agent\nsupports:\n  tracing:\n    - jaeger\n\nplugins:\n  tracing:\n    jaeger:\n      host: "localhost"\n      port: 5775\n      props:\n        SERVICE_NAME: "shenyu-agent"\n        JAEGER_SAMPLER_TYPE: "const"\n        JAEGER_SAMPLER_PARAM: "1"\n'})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"start jaeger server"}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["please see ",(0,i.jsx)(t.a,{href:"https://www.jaegertracing.io/docs/1.28/getting-started/",children:"jaeger-quickstart"})," to start ",(0,i.jsx)(t.code,{children:"jaeger"})]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"tracing test"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Reference ",(0,i.jsx)(t.a,{href:"/docs/2.4.2/deployment/deployment-local",children:"Deployment"})," to start ",(0,i.jsx)(t.code,{children:"shenyu-admin"}),"."]}),"\n",(0,i.jsx)(t.li,{children:"Start the gateway by referring to the above procedure."}),"\n",(0,i.jsxs)(t.li,{children:["Refer to ",(0,i.jsx)(t.a,{href:"/docs/2.4.2/quick-start/quick-start-http",children:"Quick start with Http"})," to start ",(0,i.jsx)(t.code,{children:"shenyu-examples-http"}),"."]}),"\n",(0,i.jsx)(t.li,{children:"Launch a request to the gateway."}),"\n"]}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsxs)(t.p,{children:["GET ",(0,i.jsx)(t.a,{href:"http://localhost:9195/http/order/findById?id=1",children:"http://localhost:9195/http/order/findById?id=1"})]}),"\n",(0,i.jsx)(t.p,{children:"Accept: application/json"}),"\n"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["After a successful request, you can see that the link log has been reported to jaeger:\n",(0,i.jsx)(t.img,{src:n(44844).A+"",width:"2870",height:"1382"}),"\n",(0,i.jsx)(t.img,{src:n(71291).A+"",width:"2872",height:"872"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"agent-plugin-tracing-zipkin",children:"Agent Plugin Tracing Zipkin"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"modify yaml file"}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["Specify the use of the ",(0,i.jsx)(t.code,{children:"zipkin"})," plugin via ",(0,i.jsx)(t.code,{children:"supports.tracing"})," in the ",(0,i.jsx)(t.code,{children:"shenyu-agent.yaml"})," file, and fill in the ",(0,i.jsx)(t.code,{children:"zipkin"})," configuration information via ",(0,i.jsx)(t.code,{children:"plugins.tracing"}),"."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:'appName: shenyu-agent\nsupports:\n  tracing:\n    - zipkin\n\nplugins:\n  tracing:\n    zipkin:\n      host: "localhost"\n      port: 9411\n      props:\n        SERVICE_NAME: "shenyu-agent"\n        URL_VERSION: "/api/v2/spans"\n        SAMPLER_TYPE: "const"\n        SAMPLER_PARAM: "1"\n'})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"start zipkin-server"}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["please see ",(0,i.jsx)(t.a,{href:"https://zipkin.io/pages/quickstart",children:"zipkin-quickstart"})," to start ",(0,i.jsx)(t.code,{children:"zipkin-server"})," ."]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"tracing test"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Reference ",(0,i.jsx)(t.a,{href:"/docs/2.4.2/deployment/deployment-local",children:"Deployment"})," to start ",(0,i.jsx)(t.code,{children:"shenyu-admin"}),"."]}),"\n",(0,i.jsx)(t.li,{children:"Start the gateway by referring to the above procedure."}),"\n",(0,i.jsxs)(t.li,{children:["Refer to ",(0,i.jsx)(t.a,{href:"/docs/2.4.2/quick-start/quick-start-http",children:"Quick start with Http"})," to start ",(0,i.jsx)(t.code,{children:"shenyu-examples-http"}),"."]}),"\n",(0,i.jsx)(t.li,{children:"Launch a request to the gateway."}),"\n"]}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsxs)(t.p,{children:["GET ",(0,i.jsx)(t.a,{href:"http://localhost:9195/http/order/findById?id=999",children:"http://localhost:9195/http/order/findById?id=999"})]}),"\n",(0,i.jsx)(t.p,{children:"Accept: application/json"}),"\n"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["After a successful request, you can see that the link log has been reported to zipkin:\n",(0,i.jsx)(t.img,{src:n(6873).A+"",width:"2511",height:"1271"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"agent-plugin-tracing-opentelemetry",children:"Agent Plugin Tracing OpenTelemetry"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"modify yaml file"}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["Specify the use of the ",(0,i.jsx)(t.code,{children:"opentelemetry"})," plugin via ",(0,i.jsx)(t.code,{children:"supports.tracing"})," in the ",(0,i.jsx)(t.code,{children:"shenyu-agent.yaml"})," file, and fill in the ",(0,i.jsx)(t.code,{children:"opentelemetry"})," configuration information via ",(0,i.jsx)(t.code,{children:"plugins.tracing"}),"."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:'appName: shenyu-agent\nsupports:\n  tracing:\n    - opentelemetry\n\nplugins:\n  tracing:\n    opentelemetry:\n      props:\n        otel.traces.exporter: jaeger #zipkin #otlp\n        otel.resource.attributes: "service.name=shenyu-agent"\n        otel.exporter.jaeger.endpoint: "http://localhost:14250/api/traces"\n'})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Start jaeger or zipkin or opentelemetry-collector according to exporter configuration"}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["To start jaeger, please refer to ",(0,i.jsx)(t.a,{href:"https://www.jaegertracing.io/docs/1.28/getting-started/",children:"jaeger-quickstart"})]}),"\n",(0,i.jsxs)(t.p,{children:["To start zipkin, please refer to ",(0,i.jsx)(t.a,{href:"https://zipkin.io/pages/quickstart",children:"zipkin-quickstart"})]}),"\n",(0,i.jsxs)(t.p,{children:["To start otel-collector, please refer to ",(0,i.jsx)(t.a,{href:"https://opentelemetry.io/docs/collector/getting-started/",children:"opentelemetry-collector-quickstart"})]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"tracing test"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Reference ",(0,i.jsx)(t.a,{href:"/docs/2.4.2/deployment/deployment-local",children:"Deployment"})," to start ",(0,i.jsx)(t.code,{children:"shenyu-admin"}),"."]}),"\n",(0,i.jsx)(t.li,{children:"Start the gateway by referring to the above procedure."}),"\n",(0,i.jsxs)(t.li,{children:["Refer to ",(0,i.jsx)(t.a,{href:"/docs/2.4.2/quick-start/quick-start-http",children:"Quick start with Http"})," to start ",(0,i.jsx)(t.code,{children:"shenyu-examples-http"}),"."]}),"\n",(0,i.jsx)(t.li,{children:"Launch a request to the gateway."}),"\n"]}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsxs)(t.p,{children:["GET ",(0,i.jsx)(t.a,{href:"http://localhost:9195/http/order/findById?id=999",children:"http://localhost:9195/http/order/findById?id=999"})]}),"\n",(0,i.jsx)(t.p,{children:"Accept: application/json"}),"\n"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["After the request is successful, you can see the link log in the corresponding backend, the effect is the same as the above ",(0,i.jsx)(t.code,{children:"jaeger"})," plugin and ",(0,i.jsx)(t.code,{children:"zipkin"})," plugin."]}),"\n"]}),"\n"]}),"\n"]})]})}function o(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},71291:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/shenyu-agent-plugin-tracing-jaeger-2-d9f040809859450a478dbb52188eeb22.jpg"}}]);