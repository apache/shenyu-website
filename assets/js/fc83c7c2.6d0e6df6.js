"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[26304],{28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>r});var t=s(96540);const o={},i=t.createContext(o);function c(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),t.createElement(i.Provider,{value:n},e.children)}},83964:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>d});var t=s(74848),o=s(28453);const i={title:"Websocket Proxy",description:"Websocket Proxy"},c=void 0,r={id:"user-guide/proxy/websocket-proxy",title:"Websocket Proxy",description:"Websocket Proxy",source:"@site/versioned_docs/version-2.7.0.3/user-guide/proxy/websocket-proxy.md",sourceDirName:"user-guide/proxy",slug:"/user-guide/proxy/websocket-proxy",permalink:"/docs/user-guide/proxy/websocket-proxy",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/shenyu-website/edit/main/versioned_docs/version-2.7.0.3/user-guide/proxy/websocket-proxy.md",tags:[],version:"2.7.0.3",frontMatter:{title:"Websocket Proxy",description:"Websocket Proxy"},sidebar:"tutorialSidebar",previous:{title:"Tars Proxy",permalink:"/docs/user-guide/proxy/tars-proxy"},next:{title:"Build And Deploy Kubernetes Controller",permalink:"/docs/user-guide/kubernetes-controller/build-deploy"}},a={},d=[{value:"Add Websocket plugin in gateway",id:"add-websocket-plugin-in-gateway",level:2},{value:"Websocket service access gateway",id:"websocket-service-access-gateway",level:2},{value:"User Request",id:"user-request",level:2}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["This document is intended to help the ",(0,t.jsx)(n.code,{children:"Websocket"})," service access the ",(0,t.jsx)(n.code,{children:"Apache ShenYu"})," gateway. The ",(0,t.jsx)(n.code,{children:"Apache ShenYu"})," gateway uses the ",(0,t.jsx)(n.code,{children:"Websocket"})," plugin to handle ",(0,t.jsx)(n.code,{children:"Websocket"})," service."]}),"\n",(0,t.jsxs)(n.p,{children:["Before the connection, start ",(0,t.jsx)(n.code,{children:"shenyu-admin"})," correctly, start ",(0,t.jsx)(n.code,{children:"Websocket"})," plugin, and add related dependencies on the gateway and ",(0,t.jsx)(n.code,{children:"Websocket"})," application client. Refer to the previous ",(0,t.jsx)(n.a,{href:"../../quick-start/quick-start-websocket",children:"Quick start with Websocket"})," ."]}),"\n",(0,t.jsxs)(n.p,{children:["For details about client access configuration, see ",(0,t.jsx)(n.a,{href:"/docs/user-guide/property-config/register-center-access",children:"Application Client Access Config"})," ."]}),"\n",(0,t.jsxs)(n.p,{children:["For details about data synchronization configurations, see ",(0,t.jsx)(n.a,{href:"/docs/user-guide/property-config/use-data-sync",children:"Data Synchronization Config"}),")."]}),"\n",(0,t.jsx)(n.h2,{id:"add-websocket-plugin-in-gateway",children:"Add Websocket plugin in gateway"}),"\n",(0,t.jsxs)(n.p,{children:["Add the following dependencies to the gateway's ",(0,t.jsx)(n.code,{children:"pom.xml"})," file , which is introduced by default\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:"        \x3c!--shenyu websocket plugin start--\x3e\n        <dependency>\n            <groupId>org.apache.shenyu</groupId>\n            <artifactId>shenyu-spring-boot-starter-plugin-websocket</artifactId>\n            <version>${project.version}</version>\n        </dependency>\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Restart your gateway service."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"websocket-service-access-gateway",children:"Websocket service access gateway"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["Please refer to\uff1a ",(0,t.jsx)(n.a,{href:"https://github.com/apache/shenyu/tree/master/shenyu-examples/shenyu-examples-websocket",children:"shenyu-examples-websocket"}),", Contains examples of the three implementations of  ",(0,t.jsx)(n.code,{children:"annotation websocket"}),"\u3001",(0,t.jsx)(n.code,{children:"spring native websocket"}),"\u3001",(0,t.jsx)(n.code,{children:"spring reactive websocket"})]}),"\n"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["In the ",(0,t.jsx)(n.code,{children:"Websocket"})," service, add the following dependencies:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:"        <dependency>\n            <groupId>org.apache.shenyu</groupId>\n            <artifactId>shenyu-spring-boot-starter-client-websocket</artifactId>\n            <version>${shenyu.version}</version>\n        </dependency>\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsxs)(n.li,{children:["Add the following configuration to the ",(0,t.jsx)(n.code,{children:"application.yaml"})," configuration file:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"shenyu:\n  register:\n    registerType: http\n    serverLists: http://localhost:9095 # shenyu-admin ip and port\n    props:\n      username: admin\n      password: 123456\n  client:\n    websocket:\n      props:\n        contextPath: /ws-annotation\n        appName: ws-annotation\n        port: 8001 # need to be consistent with the service port\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsxs)(n.li,{children:["Add ",(0,t.jsx)(n.code,{children:"@ShenyuSpringWebSocketClient"})," annotation to the ",(0,t.jsx)(n.code,{children:"Websocket"})," service interface implementation class, start your service and after successful registration, go to ",(0,t.jsx)(n.code,{children:"Client List -> Proxy -> Websocket"})," in the ",(0,t.jsx)(n.code,{children:"shenyu-admin"})," management system and you will see the auto-registered selector and rule information."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u793a\u4f8b\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'@ShenyuSpringWebSocketClient("/myWs")\n@ServerEndpoint("/myWs")\npublic class WsServerEndpoint {\n    @OnOpen\n    public void onOpen(final Session session) {\n        LOG.info("connect successful");\n    }\n\n    @OnClose\n    public void onClose(final Session session) {\n        LOG.info("connect closed");\n    }\n\n    @OnMessage\n    public String onMsg(final String text) {\n        return "server send message\uff1a" + text;\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"user-request",children:"User Request"}),"\n",(0,t.jsxs)(n.p,{children:["You need to request your ",(0,t.jsx)(n.code,{children:"Websocket"})," service via the ",(0,t.jsx)(n.code,{children:"ws"})," protocol. The ",(0,t.jsx)(n.code,{children:"Apache ShenYu"})," gateway will configure a routing prefix which is the ",(0,t.jsx)(n.code,{children:"contextPath"})," in the access gateway configuration file. For example: ",(0,t.jsx)(n.code,{children:"ws://localhost:9195/ws-annotation/myWs"}),", after which you can establish a connection to send and receive messages normally."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}}}]);