"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[26605],{4661:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>h,contentTitle:()=>r,default:()=>a,frontMatter:()=>l,metadata:()=>c,toc:()=>o});var t=i(74848),s=i(28453);const l={sidebar_position:3,title:"Selector Detailed Explanation",keywords:["soul"],description:"detailed explanation of selector and rule"},r=void 0,c={id:"admin/selector-and-rule",title:"Selector Detailed Explanation",description:"detailed explanation of selector and rule",source:"@site/versioned_docs/version-2.3.0-Legacy/admin/selector-and-rule.md",sourceDirName:"admin",slug:"/admin/selector-and-rule",permalink:"/docs/2.3.0-Legacy/admin/selector-and-rule",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/shenyu-website/edit/main/versioned_docs/version-2.3.0-Legacy/admin/selector-and-rule.md",tags:[],version:"2.3.0-Legacy",sidebarPosition:3,frontMatter:{sidebar_position:3,title:"Selector Detailed Explanation",keywords:["soul"],description:"detailed explanation of selector and rule"},sidebar:"tutorialSidebar",previous:{title:"Plugin Handle Explanation",permalink:"/docs/2.3.0-Legacy/admin/plugin-handle-explanation"},next:{title:"Environment Setup",permalink:"/docs/2.3.0-Legacy/users-guide/soul-set-up"}},h={},o=[{value:"Features",id:"features",level:2},{value:"Overview",id:"overview",level:2},{value:"Selector",id:"selector",level:2},{value:"Rule",id:"rule",level:2},{value:"Condition Explanation",id:"condition-explanation",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",img:"img",li:"li",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"features",children:"Features"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Selector and rule are the key point of soul gateway, you can manage any request with it."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"This chapter is mainly focus on the concepts of selector and rule and how to use it."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"One plugin has many selector and a selector has many rules, selector is the first filter of request, and the rule is the final filter."}),"\n",(0,t.jsx)(n.li,{children:"Please consider this, it would be perfect when the plugin executes the request until it reached the config value."}),"\n",(0,t.jsx)(n.li,{children:"Selector and rule are designed to execute only when the request meet the specific condition."}),"\n",(0,t.jsxs)(n.li,{children:["Please refer to the previous data structure ",(0,t.jsx)(n.a,{href:"../design/database-design",children:"database design"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"selector",children:"Selector"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://yu199195.github.io/images/soul/selector.png",alt:""})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"selector detailed explanation\uff1a"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"name\uff1acreate your selector with a distinguish name."}),"\n",(0,t.jsx)(n.li,{children:"type\uff1acustom flow is customized request, full flow is full request. customized request will be handled by the conditions as below, while  full request won't."}),"\n",(0,t.jsx)(n.li,{children:"match method: you can combine these conditions with 'and' , 'or' operators."}),"\n",(0,t.jsxs)(n.li,{children:["condition\uff1a","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"uri: filter request with uri method and support fuzzy matching (/**)."}),"\n",(0,t.jsx)(n.li,{children:"header: filter request with request header."}),"\n",(0,t.jsx)(n.li,{children:"query: filter request with query string."}),"\n",(0,t.jsx)(n.li,{children:"ip: filter request with your real ip."}),"\n",(0,t.jsx)(n.li,{children:"host: filter request with your real host."}),"\n",(0,t.jsx)(n.li,{children:"post: not recommend to use."}),"\n",(0,t.jsxs)(n.li,{children:["condition match:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"match : fuzzy string matching\uff0crecommend to combine with uri\uff0csupport restful matching.\uff08/test/**)."}),"\n",(0,t.jsx)(n.li,{children:"= : if the values are the same, then they match."}),"\n",(0,t.jsx)(n.li,{children:"regEx : regex matching\uff0cmatch characters in regex expression."}),"\n",(0,t.jsx)(n.li,{children:"like : string fuzzy matching."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"open option\uff1aonly work with enabled."}),"\n",(0,t.jsx)(n.li,{children:"print log\uff1ait will print the matching log with the open option enabled."}),"\n",(0,t.jsx)(n.li,{children:"execution order\uff1athe smaller will have high priorty to execute among multi-selectors."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["the above picture means: when the prefix of the request uri is ",(0,t.jsx)(n.code,{children:"/test"})," and the value of ",(0,t.jsx)(n.code,{children:"module"})," in",(0,t.jsx)(n.code,{children:"header"})," is",(0,t.jsx)(n.code,{children:"test"}),", it will redirect to this service ",(0,t.jsx)(n.code,{children:"1.1.1.1:8080"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["selector advice : combine ",(0,t.jsx)(n.code,{children:"uri"})," conditon and ",(0,t.jsx)(n.code,{children:"match"})," prefix\uff08/contextPath\uff09as the first request filter."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"rule",children:"Rule"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://yu199195.github.io/images/soul/rule.png",alt:""})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"when the request was passed by the seletor, then it will be processed by the rule, the final filter."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"rule is the final confirmation about how to execute request logically."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"rule detailed explanation\uff1a"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"name\uff1acreate your rule with a distinguish name."}),"\n",(0,t.jsx)(n.li,{children:"match method: you can combine these conditions with 'and' , 'or' operators."}),"\n",(0,t.jsxs)(n.li,{children:["condition\uff1a","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"uri: filter request with uri method and support fuzzy matching (/**)."}),"\n",(0,t.jsx)(n.li,{children:"header: filter request with request header."}),"\n",(0,t.jsx)(n.li,{children:"query: filter request with query string."}),"\n",(0,t.jsx)(n.li,{children:"ip: filter request with your real ip."}),"\n",(0,t.jsx)(n.li,{children:"host: filter request with your real host."}),"\n",(0,t.jsx)(n.li,{children:"post: not recommend to use."}),"\n",(0,t.jsxs)(n.li,{children:["condition match:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"match : fuzzy string matching\uff0crecommend to combine with uri\uff0csupport restful matching.\uff08/test/**\uff09"}),"\n",(0,t.jsx)(n.li,{children:"= : if the values are the same, then they match."}),"\n",(0,t.jsx)(n.li,{children:"regEx : regex matching\uff0cmatch characters in regex expression."}),"\n",(0,t.jsx)(n.li,{children:"like : string fuzzy matching."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"open option\uff1aonly work with enabled."}),"\n",(0,t.jsx)(n.li,{children:"print log\uff1ait will print the matching log with the open option enabled."}),"\n",(0,t.jsx)(n.li,{children:"execution order\uff1athe smaller will have high priorty to execute among multi-rules."}),"\n",(0,t.jsx)(n.li,{children:"handle: different plugin has different execution method, pls refer to the specific one."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["above picture means: when the request ",(0,t.jsx)(n.code,{children:"uri"})," equals to ",(0,t.jsx)(n.code,{children:"/http/order/save"}),", it will execute based on this rule\uff0cload strategy is ",(0,t.jsx)(n.code,{children:"random"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["combine selector means \uff1awhen the request ",(0,t.jsx)(n.code,{children:"uri"})," is ",(0,t.jsx)(n.code,{children:"/http/order/save"}),", it will be redicted to ",(0,t.jsx)(n.code,{children:"1.1.1.1:8080"})," by ",(0,t.jsx)(n.code,{children:"random"})," method."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["rule advice: combine ",(0,t.jsx)(n.code,{children:"uri"})," condition with ",(0,t.jsx)(n.code,{children:"match"})," the real ",(0,t.jsx)(n.code,{children:"uri path"})," condition as the final filter."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"condition-explanation",children:"Condition Explanation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"uri matching \uff08recommend\uff09"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"uri matching is based on your request uri, the frontend won't change anything before accessing the gateway."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["the ",(0,t.jsx)(n.code,{children:"match"})," filter method is the same with",(0,t.jsx)(n.code,{children:"springmvc"})," fuzzy matching."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"in selector\uff0cwe recommend to match with the prefix of uri, and use the specific path in rule."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"when changing the match method, the matching field name can be filled randomly, but make sure the match value must be correct."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"header matching"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["header matches with your ",(0,t.jsx)(n.code,{children:"http"})," request header value."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"query matching"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"it matches the query string in your uri, such as: /test?a=1&&b=2."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"so you can add a new condition, choose query method: a   =  1."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"ip matching"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"it matches the ip of the http caller."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"especially in the waf plugin, if you find some ip is unsafe, you can add a match condition with this ip, then it can't access any more."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["if you use nginx proxy before soul, you can get the right ip with refering to ",(0,t.jsx)(n.a,{href:"../developer-guide/custom-parsing-ip-and-host",children:"parsing-ip-and-host"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"host matching"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"it matches the host of http caller."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"especially in waf plugin, if you find some host is unsafe, you can add a match condition with this host, then it can't access any more."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["if you use nginx proxy before soul, you can get the right ip with refering to ",(0,t.jsx)(n.a,{href:"../developer-guide/custom-parsing-ip-and-host",children:"parsing-ip-and-host"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"post matching"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"not recommend to use."}),"\n"]}),"\n"]}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>c});var t=i(96540);const s={},l=t.createContext(s);function r(e){const n=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);