"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[93086],{10134:(e,r,t)=>{t.d(r,{A:()=>s});const s=t.p+"assets/images/Consul-ui-6e5afcb94cfa0232bfd9772e041b9fab.png"},28453:(e,r,t)=>{t.d(r,{R:()=>d,x:()=>l});var s=t(96540);const i={},n=s.createContext(i);function d(e){const r=s.useContext(n);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),s.createElement(n.Provider,{value:r},e.children)}},42176:(e,r,t)=>{t.d(r,{A:()=>s});const s=t.p+"assets/images/client-2a4cad0acb6c752051faec3132baf52c.png"},67639:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>n,metadata:()=>l,toc:()=>a});var s=t(74848),i=t(28453);const n={title:"Register Center Design",keywords:["soul"],description:"register center design"},d=void 0,l={id:"register-center/register-center-design",title:"Register Center Design",description:"register center design",source:"@site/versioned_docs/version-2.3.0-Legacy/register-center/register-center-design.md",sourceDirName:"register-center",slug:"/register-center/register-center-design",permalink:"/docs/2.3.0-Legacy/register-center/register-center-design",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/shenyu-website/edit/main/versioned_docs/version-2.3.0-Legacy/register-center/register-center-design.md",tags:[],version:"2.3.0-Legacy",frontMatter:{title:"Register Center Design",keywords:["soul"],description:"register center design"},sidebar:"tutorialSidebar",previous:{title:"Register Center Access",permalink:"/docs/2.3.0-Legacy/register-center/register-center-access"},next:{title:"Quick start with Dubbo",permalink:"/docs/2.3.0-Legacy/quick-start/quick-start-dubbo"}},c={},a=[{value:"Description",id:"description",level:2},{value:"Client",id:"client",level:4},{value:"Server",id:"server",level:4},{value:"Http Registry",id:"http-registry",level:2},{value:"Zookeeper Registry",id:"zookeeper-registry",level:2},{value:"Etcd Registry",id:"etcd-registry",level:2},{value:"Consul Registry",id:"consul-registry",level:2},{value:"Nacos Register",id:"nacos-register",level:2},{value:"SPI",id:"spi",level:2}];function o(e){const r={code:"code",em:"em",h2:"h2",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.h2,{id:"description",children:"Description"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"This article mainly explains three ways of register center and their principles."}),"\n"]}),"\n",(0,s.jsx)(r.h4,{id:"client",children:"Client"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.img,{src:t(42176).A+"",width:"824",height:"438"})}),"\n",(0,s.jsx)(r.p,{children:"When client server start, the register center client will be loaded by spi."}),"\n",(0,s.jsx)(r.p,{children:"Put data to Disruptor when spring bean load."}),"\n",(0,s.jsx)(r.p,{children:"Soul register client get data from Disruptor, and it will send request to register server."}),"\n",(0,s.jsx)(r.p,{children:"Disruptor can decouple data from operation and facilitate expansion."}),"\n",(0,s.jsx)(r.h4,{id:"server",children:"Server"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.img,{src:t(75948).A+"",width:"828",height:"1435"})}),"\n",(0,s.jsx)(r.p,{children:"When Soul-Admin server start, register center server will be loaded by spi. Meanwile Disruptor will be inited too."}),"\n",(0,s.jsx)(r.p,{children:"Soul register server get data from register client, and then put then to Disruptor."}),"\n",(0,s.jsx)(r.p,{children:"Soul-Admin Disruptor consumer get data from register server by Disruptor queue,  then save them to database and publish data synchronize event."}),"\n",(0,s.jsx)(r.p,{children:"Disruptor can decouple data from operation and buffering."}),"\n",(0,s.jsx)(r.h2,{id:"http-registry",children:"Http Registry"}),"\n",(0,s.jsx)(r.p,{children:"Principle of http register center is simple"}),"\n",(0,s.jsx)(r.p,{children:"Call interface of register server when Soul-Client start."}),"\n",(0,s.jsx)(r.p,{children:"Soul-Admin accept request,  then save to database and publish data synchronize event."}),"\n",(0,s.jsx)(r.h2,{id:"zookeeper-registry",children:"Zookeeper Registry"}),"\n",(0,s.jsx)(r.p,{children:"Zookeeper storage struct is:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"soul\n   \u251c\u2500\u2500regsiter\n   \u251c    \u251c\u2500\u2500metadata\n   \u251c    \u251c     \u251c\u2500\u2500${rpcType}\n   \u251c    \u251c     \u251c      \u251c\u2500\u2500\u2500\u2500${contextPath}\n   \u251c    \u251c     \u251c               \u251c\u2500\u2500${ruleName} : save metadata data of MetaDataRegisterDTO\n   \u251c    \u251c\u2500\u2500uri\n   \u251c    \u251c     \u251c\u2500\u2500${rpcType}\n   \u251c    \u251c     \u251c      \u251c\u2500\u2500\u2500\u2500${contextPath}\n   \u251c    \u251c     \u251c               \u251c\u2500\u2500${ip:port} : save uri data of URIRegisterDTO\n   \u251c    \u251c     \u251c               \u251c\u2500\u2500${ip:port}\n"})}),"\n",(0,s.jsx)(r.p,{children:"Zookeeper register client will save data to zookeeper when soul client is started."}),"\n",(0,s.jsx)(r.p,{children:"Zookeeper register server will keep watching the change of data node."}),"\n",(0,s.jsx)(r.p,{children:"Trigger selector and rule data update and event will be published, when metadata data node update."}),"\n",(0,s.jsx)(r.p,{children:"Trigger selector and upstream update and event will be published, when uri data node update."}),"\n",(0,s.jsx)(r.h2,{id:"etcd-registry",children:"Etcd Registry"}),"\n",(0,s.jsx)(r.p,{children:"Etcd storage struct is:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"soul\n   \u251c\u2500\u2500regsiter\n   \u251c    \u251c\u2500\u2500metadata\n   \u251c    \u251c     \u251c\u2500\u2500${rpcType}\n   \u251c    \u251c     \u251c      \u251c\u2500\u2500\u2500\u2500${contextPath}\n   \u251c    \u251c     \u251c               \u251c\u2500\u2500${ruleName} : save metadata data of MetaDataRegisterDTO\n   \u251c    \u251c\u2500\u2500uri\n   \u251c    \u251c     \u251c\u2500\u2500${rpcType}\n   \u251c    \u251c     \u251c      \u251c\u2500\u2500\u2500\u2500${contextPath}\n   \u251c    \u251c     \u251c               \u251c\u2500\u2500${ip:port} : save uri data of URIRegisterDTO\n   \u251c    \u251c     \u251c               \u251c\u2500\u2500${ip:port}\n"})}),"\n",(0,s.jsx)(r.p,{children:"Etcd register client will save data to etcd when soul client is started."}),"\n",(0,s.jsx)(r.p,{children:"Etcd register server will keep watching the change of data node."}),"\n",(0,s.jsx)(r.p,{children:"Trigger selector and rule data update and event will be published, when metadata data node update."}),"\n",(0,s.jsx)(r.p,{children:"Trigger selector and upstream update and event will be published, when uri data node update."}),"\n",(0,s.jsx)(r.h2,{id:"consul-registry",children:"Consul Registry"}),"\n",(0,s.jsx)(r.p,{children:"Consul register client will save URIRegisterDTO to service instance metadata, and URIRegisterDTO will disappear with service unregister."}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.img,{src:t(10134).A+"",width:"1657",height:"581"})}),"\n",(0,s.jsx)(r.p,{children:"And Consul register client will save MetaDataRegisterDTO to Key/Value store, storage struct is:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"soul\n   \u251c\u2500\u2500regsiter\n   \u251c    \u251c\u2500\u2500metadata\n   \u251c    \u251c     \u251c\u2500\u2500${rpcType}\n   \u251c    \u251c     \u251c      \u251c\u2500\u2500\u2500\u2500${contextPath}\n   \u251c    \u251c     \u251c               \u251c\u2500\u2500${ruleName} : save metadata data of MetaDataRegisterDTO\n\n"})}),"\n",(0,s.jsx)(r.p,{children:"Consul register client will save data to consul when soul client is started."}),"\n",(0,s.jsx)(r.p,{children:"Consul register server will keep watching the change of data node."}),"\n",(0,s.jsx)(r.p,{children:"Trigger selector and rule data update and event will be published, when metadata data node update."}),"\n",(0,s.jsx)(r.p,{children:"Trigger selector and upstream update and event will be published, when uri data node update."}),"\n",(0,s.jsx)(r.h2,{id:"nacos-register",children:"Nacos Register"}),"\n",(0,s.jsx)(r.p,{children:"Nacos register have two parts\uff1aURI and Metadata\u3002"}),"\n",(0,s.jsx)(r.p,{children:"URI is instance register. URI instance node will be deleted when server is down."}),"\n",(0,s.jsx)(r.p,{children:"URI service's instance name will be named like below. Every URI instance has ip, port and contextPath as identifiers."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"soul.register.service.${rpcType}\n"})}),"\n",(0,s.jsx)(r.p,{children:"When URI instance up, it will publish metadata config. It's name like below."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"soul.register.service.${rpcType}.${contextPath}\n"})}),"\n",(0,s.jsx)(r.p,{children:"Trigger selector and upstream update and event will be published, when URI service up or down."}),"\n",(0,s.jsx)(r.p,{children:"Trigger selector and rule data update and event will be published, when metadata config update."}),"\n",(0,s.jsx)(r.h2,{id:"spi",children:"SPI"}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:(0,s.jsx)(r.em,{children:"SPI Name"})}),(0,s.jsx)(r.th,{children:(0,s.jsx)(r.em,{children:"Description"})})]})}),(0,s.jsx)(r.tbody,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"SoulClientRegisterRepository"}),(0,s.jsx)(r.td,{children:"Soul client register SPI"})]})})]}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:(0,s.jsx)(r.em,{children:"Implementation Class"})}),(0,s.jsx)(r.th,{children:(0,s.jsx)(r.em,{children:"Description"})})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"HttpClientRegisterRepository"}),(0,s.jsx)(r.td,{children:"Http client register repository"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"ZookeeperClientRegisterRepository"}),(0,s.jsx)(r.td,{children:"Zookeeper client register repository"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"EtcdClientRegisterRepository"}),(0,s.jsx)(r.td,{children:"Etcd client register repository"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"ConsulClientRegisterRepository"}),(0,s.jsx)(r.td,{children:"Consul client register repository"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"NacosClientRegisterRepository"}),(0,s.jsx)(r.td,{children:"Nacos client register repository"})]})]})]}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:(0,s.jsx)(r.em,{children:"SPI Name"})}),(0,s.jsx)(r.th,{children:(0,s.jsx)(r.em,{children:"Description"})})]})}),(0,s.jsx)(r.tbody,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"SoulServerRegisterRepository"}),(0,s.jsx)(r.td,{children:"Soul server register SPI"})]})})]}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:(0,s.jsx)(r.em,{children:"Implementation Class"})}),(0,s.jsx)(r.th,{children:(0,s.jsx)(r.em,{children:"Description"})})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"SoulHttpRegistryController"}),(0,s.jsx)(r.td,{children:"Http server repository"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"ZookeeperServerRegisterRepository"}),(0,s.jsx)(r.td,{children:"Zookeeper server registry repository"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"EtcdServerRegisterRepository"}),(0,s.jsx)(r.td,{children:"Etcd server registry repository"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"ConsulServerRegisterRepository"}),(0,s.jsx)(r.td,{children:"Consul server registry repository"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"NacosServerRegisterRepository"}),(0,s.jsx)(r.td,{children:"Nacos server registry repository"})]})]})]})]})}function h(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},75948:(e,r,t)=>{t.d(r,{A:()=>s});const s=t.p+"assets/images/server-1fb998f5ef8107b38fd6a8838bcaf37f.png"}}]);