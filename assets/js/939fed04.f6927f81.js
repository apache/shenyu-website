"use strict";(globalThis.webpackChunkshenyu_website=globalThis.webpackChunkshenyu_website||[]).push([[64470],{19165(n,e,s){s.r(e),s.d(e,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>r});const i=JSON.parse('{"id":"user-guide/property-config/use-data-sync","title":"Data Synchronization Config","description":"use different data-sync strategy","source":"@site/versioned_docs/version-2.7.0/user-guide/property-config/use-data-sync.md","sourceDirName":"user-guide/property-config","slug":"/user-guide/property-config/use-data-sync","permalink":"/docs/2.7.0/user-guide/property-config/use-data-sync","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/shenyu-website/edit/main/versioned_docs/version-2.7.0/user-guide/property-config/use-data-sync.md","tags":[],"version":"2.7.0","frontMatter":{"title":"Data Synchronization Config","keywords":["Data Synchronization"],"description":"use different data-sync strategy"},"sidebar":"tutorialSidebar","previous":{"title":"Gateway SSL Config","permalink":"/docs/2.7.0/user-guide/property-config/ssl"},"next":{"title":"Using Consul with Shenyu-SDK","permalink":"/docs/2.7.0/user-guide/sdk-usage/shenyu-sdk-consul"}}');var a=s(74848),c=s(28453);const t={title:"Data Synchronization Config",keywords:["Data Synchronization"],description:"use different data-sync strategy"},o=void 0,d={},r=[{value:"WebSocket Synchronization Config\uff08default strategy, recommend\uff09",id:"websocket-synchronization-configdefault-strategy-recommend",level:3},{value:"Zookeeper Synchronization Config",id:"zookeeper-synchronization-config",level:3},{value:"HTTP Long Polling Synchronization Config",id:"http-long-polling-synchronization-config",level:3},{value:"Nacos Synchronization Config",id:"nacos-synchronization-config",level:3},{value:"Etcd Synchronization Config",id:"etcd-synchronization-config",level:3},{value:"Consul Synchronization Config",id:"consul-synchronization-config",level:3},{value:"Apollo Synchronization Config",id:"apollo-synchronization-config",level:3}];function l(n){const e={a:"a",blockquote:"blockquote",code:"code",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.p,{children:"This document focuses on how to use different data synchronization strategies. Data synchronization refers to the strategy used to synchronize data to ShenYu gateway after shenyu-admin background operation data. ShenYu gateway currently supports ZooKeeper, WebSocket, HTTP Long Polling, Nacos, Etcd and Consul for data synchronization."}),"\n",(0,a.jsx)("img",{src:"/img/shenyu/dataSync/data-sync-config-dir-en.png",width:"70%",height:"60%"}),"\n",(0,a.jsxs)(e.p,{children:["For details about the data synchronization principles, see ",(0,a.jsx)(e.a,{href:"../../design/data-sync",children:"Data Synchronization Design"})," in the design document."]}),"\n",(0,a.jsx)(e.h3,{id:"websocket-synchronization-configdefault-strategy-recommend",children:"WebSocket Synchronization Config\uff08default strategy, recommend\uff09"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:["\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.code,{children:"Apache ShenYu"})," gateway config"]}),"\n",(0,a.jsxs)(e.p,{children:["Add these dependencies in ",(0,a.jsx)(e.code,{children:"pom.xml"}),"\uff1a"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"    \x3c!-- apache shenyu data sync start use websocket--\x3e\n    <dependency>\n        <groupId>org.apache.shenyu</groupId>\n        <artifactId>shenyu-spring-boot-starter-sync-data-websocket</artifactId>\n        <version>${project.version}</version>\n    </dependency>\n"})}),"\n",(0,a.jsx)("img",{src:"/img/shenyu/dataSync/shenyu-data-sync-websocket-pom.png",width:"80%",height:"70%"}),"\n",(0,a.jsx)(e.p,{children:"Add these config values in  yaml file:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"shenyu:\n  sync:\n    websocket :\n      # urls: address of shenyu-admin\uff0cmulti-address will be separated with (,).\n      urls: ws://localhost:9095/websocket\n      allowOrigin: ws://localhost:9195\n"})}),"\n",(0,a.jsx)("img",{src:"/img/shenyu/dataSync/shenyu-data-sync-websocket-yml.png",width:"80%",height:"70%"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:["\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.code,{children:"shenyu-admin"})," config"]}),"\n",(0,a.jsx)(e.p,{children:"Add these config values in  yaml file:"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yml",children:"shenyu:\n  sync:\n    websocket:\n      enabled: true\n"})}),"\n",(0,a.jsx)("img",{src:"/img/shenyu/dataSync/shenyu-data-sync-websocket-admin-yml.png",width:"80%",height:"70%"}),"\n",(0,a.jsxs)(e.p,{children:["After the connection is established, the data will be fully obtained once, and the subsequent data will be updated and added increments, with good performance. It also supports disconnection (default: ",(0,a.jsx)(e.code,{children:"30"})," seconds). This mode is recommended for data synchronization and is the default data synchronization strategy of ShenYu."]}),"\n",(0,a.jsx)(e.h3,{id:"zookeeper-synchronization-config",children:"Zookeeper Synchronization Config"}),"\n",(0,a.jsxs)(e.blockquote,{children:["\n",(0,a.jsx)(e.p,{children:"Please pay attention! From ShenYu 2.5.0, ShenYu will no longer support Zookeeper 3.4.x or below version. If you're already using Zookeeper, You need to use Zookeeper with a higher version and initialize the data."}),"\n"]}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:["\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.code,{children:"Apache ShenYu"})," gateway config"]}),"\n",(0,a.jsxs)(e.p,{children:["Add these dependencies in ",(0,a.jsx)(e.code,{children:"pom.xml"}),"\uff1a"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"       \x3c!-- apache shenyu data sync start use zookeeper--\x3e\n       <dependency>\n           <groupId>org.apache.shenyu</groupId>\n           <artifactId>shenyu-spring-boot-starter-sync-data-zookeeper</artifactId>\n           <version>${project.version}</version>\n       </dependency>\n"})}),"\n",(0,a.jsx)("img",{src:"/img/shenyu/dataSync/shenyu-data-sync-zk-pom.png",width:"80%",height:"70%"}),"\n",(0,a.jsx)(e.p,{children:"Add these config values in  yaml file:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"shenyu:\n  sync:\n    zookeeper:\n      url: localhost:2181\n       #url: config with your zk address, used by the cluster environment, separated with (,).\n      sessionTimeout: 5000\n      connectionTimeout: 2000\n"})}),"\n",(0,a.jsx)("img",{src:"/img/shenyu/dataSync/shenyu-data-sync-zk-yml.png",width:"80%",height:"70%"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.code,{children:"shenyu-admin"})," config"]}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:"Add these config values in  yaml file:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"shenyu:\n  sync:\n    zookeeper:\n      url: localhost:2181\n       #url: config with your zk address, used by the cluster environment, separated with (,).\n      sessionTimeout: 5000\n      connectionTimeout: 2000\n"})}),"\n",(0,a.jsx)("img",{src:"/img/shenyu/dataSync/shenyu-data-sync-admin-zk-yml.png",width:"80%",height:"70%"}),"\n",(0,a.jsx)(e.p,{children:"It is a good idea to use ZooKeeper synchronization mechanism with high timeliness, but we also have to deal with the unstable environment of ZK, cluster brain splitting and other problems."}),"\n",(0,a.jsx)(e.h3,{id:"http-long-polling-synchronization-config",children:"HTTP Long Polling Synchronization Config"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.code,{children:"Apache ShenYu"})," gateway config"]}),"\n"]}),"\n",(0,a.jsxs)(e.p,{children:["Add these dependencies in ",(0,a.jsx)(e.code,{children:"pom.xml"}),"\uff1a"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"        \x3c!-- apache shenyu data sync start use http--\x3e\n        <dependency>\n            <groupId>org.apache.shenyu</groupId>\n            <artifactId>shenyu-spring-boot-starter-sync-data-http</artifactId>\n            <version>${project.version}</version>\n        </dependency>\n"})}),"\n",(0,a.jsx)("img",{src:"/img/shenyu/dataSync/shenyu-data-sync-http-pom.png",width:"80%",height:"70%"}),"\n",(0,a.jsx)(e.p,{children:"Add these config values in  yaml file:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"shenyu:\n    sync:\n        http:\n             url: http://localhost:9095\n        #url: config your shenyu-admin  ip and port\uff0ccluster IP by split by (,)\n"})}),"\n",(0,a.jsx)("img",{src:"/img/shenyu/dataSync/shenyu-data-sync-http-yml.png",width:"80%",height:"70%"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:["\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.code,{children:"shenyu-admin"})," config"]}),"\n",(0,a.jsx)(e.p,{children:"Add these config values in  yaml file:"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"shenyu:\n  sync:\n    http:\n      enabled: true\n"})}),"\n",(0,a.jsx)("img",{src:"/img/shenyu/dataSync/shenyu-data-sync-admin-http-yml.png",width:"80%",height:"70%"}),"\n",(0,a.jsx)(e.p,{children:"HTTP long-polling makes the gateway lightweight, but less time-sensitive. It pulls according to the group key, if the data is too large, it will have some influences, a small change under a group will pull the entire group."}),"\n",(0,a.jsx)(e.h3,{id:"nacos-synchronization-config",children:"Nacos Synchronization Config"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.code,{children:"Apache ShenYu"})," gateway config"]}),"\n"]}),"\n",(0,a.jsxs)(e.p,{children:["Add these dependencies in ",(0,a.jsx)(e.code,{children:"pom.xml"}),"\uff1a"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"        \x3c!-- apache shenyu data sync start use nacos--\x3e\n        <dependency>\n            <groupId>org.apache.shenyu</groupId>\n            <artifactId>shenyu-spring-boot-starter-sync-data-nacos</artifactId>\n            <version>${project.version}</version>\n        </dependency>\n"})}),"\n",(0,a.jsx)("img",{src:"/img/shenyu/dataSync/shenyu-data-sync-nacos-pom.png",width:"80%",height:"70%"}),"\n",(0,a.jsx)(e.p,{children:"Add these config values in  yaml file:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"shenyu:\n  sync:\n    nacos:\n      url: localhost:8848\n         # url: config with your nacos address, please use (,) to split your cluster environment.\n      namespace: 1c10d748-af86-43b9-8265-75f487d20c6c\n      username:\n      password:\n      acm:\n        enabled: false\n        endpoint: acm.aliyun.com\n        namespace:\n        accessKey:\n        secretKey:\n     # other configure\uff0cplease refer to the naocs website.\n"})}),"\n",(0,a.jsx)("img",{src:"/img/shenyu/dataSync/shenyu-data-sync-nacos-yml.png",width:"80%",height:"70%"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:["\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.code,{children:"shenyu-admin"})," config"]}),"\n",(0,a.jsx)(e.p,{children:"Add these config values in  yaml file:"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"shenyu:\n  sync:\n      nacos:\n        url: localhost:8848\n        namespace: 1c10d748-af86-43b9-8265-75f487d20c6c\n        username:\n        password:\n        acm:\n          enabled: false\n          endpoint: acm.aliyun.com\n          namespace:\n          accessKey:\n          secretKey:\n        # url: config with your nacos address, pls use (,) to split your cluster environment.\n        # other configure\uff0cpls refer to the naocs website.\n"})}),"\n",(0,a.jsx)("img",{src:"/img/shenyu/dataSync/shenyu-data-sync-admin-nacos-yml.png",width:"80%",height:"70%"}),"\n",(0,a.jsx)(e.h3,{id:"etcd-synchronization-config",children:"Etcd Synchronization Config"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:["\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.code,{children:"Apache ShenYu"})," gateway config"]}),"\n",(0,a.jsxs)(e.p,{children:["Add these dependencies in ",(0,a.jsx)(e.code,{children:"pom.xml"}),"\uff1a"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"        \x3c!-- apache shenyu data sync start use etcd--\x3e\n        <dependency>\n            <groupId>org.apache.shenyu</groupId>\n            <artifactId>shenyu-spring-boot-starter-sync-data-etcd</artifactId>\n            <version>${project.version}</version>\n            <exclusions>\n                <exclusion>\n                    <groupId>io.grpc</groupId>\n                    <artifactId>grpc-grpclb</artifactId>\n                </exclusion>\n                <exclusion>\n                    <groupId>io.grpc</groupId>\n                    <artifactId>grpc-netty</artifactId>\n                </exclusion>\n            </exclusions>\n        </dependency>\n"})}),"\n",(0,a.jsx)("img",{src:"/img/shenyu/dataSync/shenyu-data-sync-etcd-pom.png",width:"80%",height:"70%"}),"\n",(0,a.jsx)(e.p,{children:"Add these config values in  yaml file:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"shenyu:\n    sync:\n       etcd:\n         url: http://localhost:2379\n       #url: config with your etcd address, used by the cluster environment, separated with (,).\n"})}),"\n",(0,a.jsx)("img",{src:"/img/shenyu/dataSync/shenyu-data-sync-etcd-yml.png",width:"80%",height:"70%"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:["\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.code,{children:"shenyu-admin"})," config"]}),"\n",(0,a.jsx)(e.p,{children:"Add these config values in  yaml file:"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"shenyu:\n  sync:\n    etcd:\n      url: http://localhost:2379\n       #url: config with your etcd address, used by the cluster environment, separated with (,).\n"})}),"\n",(0,a.jsx)("img",{src:"/img/shenyu/dataSync/shenyu-data-sync-admin-etcd-yml.png",width:"80%",height:"70%"}),"\n",(0,a.jsx)(e.h3,{id:"consul-synchronization-config",children:"Consul Synchronization Config"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.code,{children:"Apache ShenYu"})," gateway config"]}),"\n"]}),"\n",(0,a.jsxs)(e.p,{children:["Add these dependencies in ",(0,a.jsx)(e.code,{children:"pom.xml"}),"\uff1a"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"\x3c!-- apache shenyu data sync start use consul--\x3e\n<dependency>\n  <groupId>org.apache.shenyu</groupId>\n  <artifactId>shenyu-spring-boot-starter-sync-data-consul</artifactId>\n  <version>${project.version}</version>\n</dependency>\n"})}),"\n",(0,a.jsx)("img",{src:"/img/shenyu/dataSync/shenyu_consul_sync_gateway.jpg",width:"80%",height:"70%"}),"\n",(0,a.jsx)(e.p,{children:"Add these config values in  yaml file:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"shenyu:\n    sync:\n      consul:\n        url: http://localhost:8500\n        waitTime: 1000\t# query wait time\n        watchDelay: 1000\t# Data synchronization interval                             \n"})}),"\n",(0,a.jsx)("img",{src:"/img/shenyu/dataSync/shenyu_consul_gateway_sync_config.jpg",width:"80%",height:"70%"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:["\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.code,{children:"shenyu-admin"})," config"]}),"\n",(0,a.jsx)(e.p,{children:"Add these config values in  yaml file:"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"shenyu:\n  sync:\n    consul:\n      url: http://localhost:8500\n"})}),"\n",(0,a.jsx)("img",{src:"/img/shenyu/dataSync/shenyu_consul_admin_sync_config.jpg",width:"80%",height:"70%"}),"\n",(0,a.jsx)(e.h3,{id:"apollo-synchronization-config",children:"Apollo Synchronization Config"}),"\n",(0,a.jsx)(e.p,{children:"Apollo just support Java [8,17), if you want to use apollo as data sync center, please make sure your JDK version is between [8,17)."}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.code,{children:"Apache ShenYu"})," gateway config"]}),"\n"]}),"\n",(0,a.jsxs)(e.p,{children:["Download the corresponding version of the jar package from ",(0,a.jsx)(e.code,{children:"https://repo1.maven.org/maven2/org/apache/shenyu/shenyu-spring-boot-starter-sync-data-apollo/"}),", and then put the jar package into the ",(0,a.jsx)(e.code,{children:"/lib"})," directory."]}),"\n",(0,a.jsx)(e.p,{children:"Add these config values in  yaml file:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"shenyu:\n  sync:\n    apollo:\n    appId: shenyu\n    meta: http://localhost:8080\n    env: dev\n    clusterName: test\n    namespace: application\n"})}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.code,{children:"Apache ShenYu Admin"})," config"]}),"\n"]}),"\n",(0,a.jsxs)(e.p,{children:["Download the corresponding version of the jar package from ",(0,a.jsx)(e.code,{children:"https://repo1.maven.org/maven2/org/apache/shenyu/shenyu-admin-listener-apollo/"}),", and then put the jar package into the ",(0,a.jsx)(e.code,{children:"/lib"})," directory."]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"shenyu:\n  sync:\n    apollo:\n      meta: http://localhost:8080\n      appId: shenyu\n      portalUrl: http://localhost:8070\n      env: dev\n      clusterName: test\n      namespace: application\n      token: 0fff5645fc74ee5e0d63a6389433c8c8afc0beea31eed0279ecc1c8961d12da9\n"})}),"\n",(0,a.jsx)("img",{src:"/img/shenyu/dataSync/shenyu-data-sync-admin-apollo-yml.png",width:"80%",height:"70%"}),"\n",(0,a.jsxs)(e.blockquote,{children:["\n",(0,a.jsx)(e.p,{children:"After the data synchronization strategy of Apache ShenYu gateway and shenyu-admin is reconfigured, the microservice needs to be restarted.\nthe Apache ShenYu gateway and shenyu-admin must use the same synchronization strategy."}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,c.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(l,{...n})}):l(n)}},28453(n,e,s){s.d(e,{R:()=>t,x:()=>o});var i=s(96540);const a={},c=i.createContext(a);function t(n){const e=i.useContext(c);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:t(n.components),i.createElement(c.Provider,{value:e},n.children)}}}]);